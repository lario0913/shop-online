!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},T.error=function(){var t=new T(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];T.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new T(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=T,t.fetch=function(i,o){return new Promise(function(n,t){var e=new w(i,o),r=new XMLHttpRequest;r.onload=function(){var t={status:r.status,statusText:r.statusText,headers:function(t){var i=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i}(r.getAllResponseHeaders()||"")};t.url="responseURL"in r?r.responseURL:t.headers.get("X-Request-URL");var e="response"in r?r.response:r.responseText;n(new T(e,t))},r.onerror=function(){t(new TypeError("Network request failed"))},r.ontimeout=function(){t(new TypeError("Network request failed"))},r.open(e.method,e.url,!0),"include"===e.credentials?r.withCredentials=!0:"omit"===e.credentials&&(r.withCredentials=!1),"responseType"in r&&a&&(r.responseType="blob"),e.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function g(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function v(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=v(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=m(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function T(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(t){return t&&t.Math==Math&&t}function m(t){try{return!!t()}catch(t){return!0}}function g(t){return"object"==typeof t?null!==t:"function"==typeof t}function i(t){return w?y.createElement(t):{}}function d(t){if(!g(t))throw TypeError(String(t)+" is not an object");return t}function o(t,e){if(!g(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!g(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function v(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function h(e,n){try{S(b,e,n)}catch(t){b[e]=n}return n}function c(t,e){return A.call(t,e)}function s(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++O+P).toString(36)}function r(t){return M[t]||(M[t]=s(t))}var a,u,l,b=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),f=!1,p=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),y=b.document,w=g(y)&&g(y.createElement),_=!p&&!m(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}),T=Object.defineProperty,E={f:p?T:function(t,e,n){if(d(t),e=o(e,!0),d(n),_)try{return T(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},S=p?function(t,e,n){return E.f(t,e,v(1,n))}:function(t,e,n){return t[e]=n,t},I="__core-js_shared__",C=b[I]||h(I,{}),N=e(function(t){(t.exports=function(t,e){return C[t]||(C[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.4.1",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),A={}.hasOwnProperty,k=N("native-function-to-string",Function.toString),D=b.WeakMap,R="function"==typeof D&&/native code/.test(k.call(D)),O=0,P=Math.random(),M=N("keys"),L={},x=b.WeakMap;if(R){var F=new x,U=F.get,V=F.has,q=F.set;a=function(t,e){return q.call(F,t,e),e},u=function(t){return U.call(F,t)||{}},l=function(t){return V.call(F,t)}}else{var B=r("state");L[B]=!0,a=function(t,e){return S(t,B,e),e},u=function(t){return c(t,B)?t[B]:{}},l=function(t){return c(t,B)}}function j(t){return G.call(t).slice(8,-1)}function W(t){return X[t]||(X[t]=z&&Y[t]||(z?Y:s)("Symbol."+t))}function K(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),J))?n:$?j(e):"Object"==(r=j(e))&&"function"==typeof e.callee?"Arguments":r}var Q={set:a,get:u,has:l,enforce:function(t){return l(t)?u(t):a(t,{})},getterFor:function(n){return function(t){var e;if(!g(t)||(e=u(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},H=e(function(t){var e=Q.get,s=Q.enforce,u=String(k).split("toString");N("inspectSource",function(t){return k.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||c(n,"name")||S(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==b?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:S(t,e,n)):o?t[e]=n:h(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||k.call(this)})}),G={}.toString,z=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),Y=b.Symbol,X=N("wks"),J=W("toStringTag"),$="Arguments"==j(function(){return arguments}()),Z={};Z[W("toStringTag")]="z";var tt="[object z]"!==String(Z)?function(){return"[object "+K(this)+"]"}:Z.toString,et=Object.prototype;tt!==et.toString&&H(et,"toString",tt,{unsafe:!0});function nt(t){return isNaN(t=+t)?0:(0<t?bt:vt)(t)}function rt(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function it(s){return function(t,e){var n,r,i=String(rt(t)),o=nt(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}}function ot(t){return It(rt(t))}function at(t){return"function"==typeof t?t:void 0}function st(t,e){return arguments.length<2?at(At[t])||at(b[t]):At[t]&&At[t][e]||b[t]&&b[t][e]}function ut(t){return 0<t?kt(nt(t),9007199254740991):0}function ct(s){return function(t,e,n){var r,i=ot(t),o=ut(i.length),a=function(t,e){var n=nt(t);return n<0?Dt(n+e,0):Rt(n,e)}(n,o);if(s&&e!=e){for(;a<o;)if((r=i[a++])!=r)return!0}else for(;a<o;a++)if((s||a in i)&&i[a]===e)return s||a||0;return!s&&-1}}function ht(t,e){var n,r=ot(t),i=0,o=[];for(n in r)!c(L,n)&&c(r,n)&&o.push(n);for(;e.length>i;)c(r,n=e[i++])&&(~Ot(o,n)||o.push(n));return o}function lt(t,e){for(var n=Ft(e),r=E.f,i=Nt.f,o=0;o<n.length;o++){var a=n[o];c(t,a)||r(t,a,i(e,a))}}function ft(t,e){var n=qt[Vt(t)];return n==jt||n!=Bt&&("function"==typeof e?m(e):!!e)}function pt(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?b:c?b[s]||h(s,{}):(b[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Kt(n,r))&&a.value:n[r],!Wt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;lt(o,i)}(t.sham||i&&i.sham)&&S(o,"sham",!0),H(n,r,o,t)}}function dt(t){return Object(rt(t))}var yt,mt,gt,vt=Math.ceil,bt=Math.floor,wt={codeAt:it(!1),charAt:it(!0)},_t={}.propertyIsEnumerable,Tt=Object.getOwnPropertyDescriptor,Et={f:Tt&&!_t.call({1:2},1)?function(t){var e=Tt(this,t);return!!e&&e.enumerable}:_t},St="".split,It=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==j(t)?St.call(t,""):Object(t)}:Object,Ct=Object.getOwnPropertyDescriptor,Nt={f:p?Ct:function(t,e){if(t=ot(t),e=o(e,!0),_)try{return Ct(t,e)}catch(t){}if(c(t,e))return v(!Et.f.call(t,e),t[e])}},At=b,kt=Math.min,Dt=Math.max,Rt=Math.min,Ot={includes:ct(!0),indexOf:ct(!1)}.indexOf,Pt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Mt=Pt.concat("length","prototype"),Lt={f:Object.getOwnPropertyNames||function(t){return ht(t,Mt)}},xt={f:Object.getOwnPropertySymbols},Ft=st("Reflect","ownKeys")||function(t){var e=Lt.f(d(t)),n=xt.f;return n?e.concat(n(t)):e},Ut=/#|\.prototype\./,Vt=ft.normalize=function(t){return String(t).replace(Ut,".").toLowerCase()},qt=ft.data={},Bt=ft.NATIVE="N",jt=ft.POLYFILL="P",Wt=ft,Kt=Nt.f,Qt=!m(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Ht=r("IE_PROTO"),Gt=Object.prototype,zt=Qt?Object.getPrototypeOf:function(t){return t=dt(t),c(t,Ht)?t[Ht]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Gt:null},Yt=W("iterator"),Xt=!1;[].keys&&("next"in(gt=[].keys())?(mt=zt(zt(gt)))!==Object.prototype&&(yt=mt):Xt=!0),null==yt&&(yt={}),c(yt,Yt)||S(yt,Yt,function(){return this});function Jt(){}var $t={IteratorPrototype:yt,BUGGY_SAFARI_ITERATORS:Xt},Zt=Object.keys||function(t){return ht(t,Pt)},te=p?Object.defineProperties:function(t,e){d(t);for(var n,r=Zt(e),i=r.length,o=0;o<i;)E.f(t,n=r[o++],e[n]);return t},ee=st("document","documentElement"),ne=r("IE_PROTO"),re="prototype",ie=function(){var t,e=i("iframe"),n=Pt.length,r="script";for(e.style.display="none",ee.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),ie=t.F;n--;)delete ie[re][Pt[n]];return ie()},oe=Object.create||function(t,e){var n;return null!==t?(Jt[re]=d(t),n=new Jt,Jt[re]=null,n[ne]=t):n=ie(),void 0===e?n:te(n,e)};L[ne]=!0;function ae(t,e,n){t&&!c(t=n?t:t.prototype,le)&&he(t,le,{configurable:!0,value:e})}function se(){return this}function ue(){return this}function ce(t,e,n,r,i,o,a){function s(t){if(t===i&&y)return y;if(!me&&t in p)return p[t];switch(t){case"keys":case ve:case be:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=oe(pe,{next:v(1,n)}),ae(t,r,!1),fe[r]=se}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[ge]||p["@@iterator"]||i&&p[i],y=!me&&d||s(i),m="Array"==e&&p.entries||d;if(m&&(u=zt(m.call(new t)),ye!==Object.prototype&&u.next&&(zt(u)!==ye&&(de?de(u,ye):"function"!=typeof u[ge]&&S(u,ge,ue)),ae(u,l,!0))),i==ve&&d&&d.name!==ve&&(f=!0,y=function(){return d.call(this)}),p[ge]!==y&&S(p,ge,y),fe[e]=y,i)if(c={values:s(ve),keys:o?y:s("keys"),entries:s(be)},a)for(h in c)!me&&!f&&h in p||H(p,h,c[h]);else pt({target:e,proto:!0,forced:me||f},c);return c}var he=E.f,le=W("toStringTag"),fe={},pe=$t.IteratorPrototype,de=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return d(t),function(t){if(!g(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),ye=$t.IteratorPrototype,me=$t.BUGGY_SAFARI_ITERATORS,ge=W("iterator"),ve="values",be="entries",we=wt.charAt,_e="String Iterator",Te=Q.set,Ee=Q.getterFor(_e);ce(String,"String",function(t){Te(this,{type:_e,string:String(t),index:0})},function(){var t,e=Ee(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=we(n,r),e.index+=t.length,{value:t,done:!1})});var Se={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ie=W("unscopables"),Ce=Array.prototype;null==Ce[Ie]&&S(Ce,Ie,oe(null));function Ne(t){Ce[Ie][t]=!0}var Ae="Array Iterator",ke=Q.set,De=Q.getterFor(Ae),Re=ce(Array,"Array",function(t,e){ke(this,{type:Ae,target:ot(t),index:0,kind:e})},function(){var t=De(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");fe.Arguments=fe.Array,Ne("keys"),Ne("values"),Ne("entries");var Oe=W("iterator"),Pe=W("toStringTag"),Me=Re.values;for(var Le in Se){var xe=b[Le],Fe=xe&&xe.prototype;if(Fe){if(Fe[Oe]!==Me)try{S(Fe,Oe,Me)}catch(Cs){Fe[Oe]=Me}if(Fe[Pe]||S(Fe,Pe,Le),Se[Le])for(var Ue in Re)if(Fe[Ue]!==Re[Ue])try{S(Fe,Ue,Re[Ue])}catch(Cs){Fe[Ue]=Re[Ue]}}}function Ve(t,e,n){for(var r in e)H(t,r,e[r],n);return t}function qe(t){var e=st(t),n=E.f;p&&e&&!e[ze]&&n(e,ze,{configurable:!0,get:function(){return this}})}function Be(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function je(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function We(t){return void 0!==t&&(fe.Array===t||Xe[Ye]===t)}function Ke(r,i,t){if(Be(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}}function Qe(t){if(null!=t)return t[Je]||t["@@iterator"]||fe[K(t)]}function He(e,t,n,r){try{return r?t(d(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&d(i.call(e)),t}}var Ge=b.Promise,ze=W("species"),Ye=W("iterator"),Xe=Array.prototype,Je=W("iterator"),$e=e(function(t){function p(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l,f=Ke(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=Qe(t)))throw TypeError("Target is not iterable");if(We(a)){for(s=0,u=ut(t.length);s<u;s++)if((c=r?f(d(l=t[s])[0],l[1]):f(t[s]))&&c instanceof p)return c;return new p(!1)}o=a.call(t)}for(h=o.next;!(l=h.call(o)).done;)if("object"==typeof(c=He(o,f,l.value,r))&&c&&c instanceof p)return c;return new p(!1)}).stop=function(t){return new p(!0,t)}}),Ze=W("iterator"),tn=!1;try{var en=0,nn={next:function(){return{done:!!en++}},return:function(){tn=!0}};nn[Ze]=function(){return this},Array.from(nn,function(){throw 2})}catch(Cs){}function rn(t,e){if(!e&&!tn)return!1;var n=!1;try{var r={};r[Ze]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}function on(t,e){var n,r=d(t).constructor;return void 0===r||null==(n=d(r)[pn])?e:Be(n)}function an(t){if(En.hasOwnProperty(t)){var e=En[t];delete En[t],e()}}function sn(t){return function(){an(t)}}function un(t){an(t.data)}function cn(t){b.postMessage(t+"",mn.protocol+"//"+mn.host)}var hn,ln,fn,pn=W("species"),dn=st("navigator","userAgent")||"",yn=/(iphone|ipod|ipad).*applewebkit/i.test(dn),mn=b.location,gn=b.setImmediate,vn=b.clearImmediate,bn=b.process,wn=b.MessageChannel,_n=b.Dispatch,Tn=0,En={},Sn="onreadystatechange";gn&&vn||(gn=function(t){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);return En[++Tn]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},hn(Tn),Tn},vn=function(t){delete En[t]},"process"==j(bn)?hn=function(t){bn.nextTick(sn(t))}:_n&&_n.now?hn=function(t){_n.now(sn(t))}:wn&&!yn?(fn=(ln=new wn).port2,ln.port1.onmessage=un,hn=Ke(fn.postMessage,fn,1)):!b.addEventListener||"function"!=typeof postMessage||b.importScripts||m(cn)?hn=Sn in i("script")?function(t){ee.appendChild(i("script"))[Sn]=function(){ee.removeChild(this),an(t)}}:function(t){setTimeout(sn(t),0)}:(hn=cn,b.addEventListener("message",un,!1)));var In,Cn,Nn,An,kn,Dn,Rn,On,Pn={set:gn,clear:vn},Mn=Nt.f,Ln=Pn.set,xn=b.MutationObserver||b.WebKitMutationObserver,Fn=b.process,Un=b.Promise,Vn="process"==j(Fn),qn=Mn(b,"queueMicrotask"),Bn=qn&&qn.value;Bn||(In=function(){var t,e;for(Vn&&(t=Fn.domain)&&t.exit();Cn;){e=Cn.fn,Cn=Cn.next;try{e()}catch(t){throw Cn?An():Nn=void 0,t}}Nn=void 0,t&&t.enter()},An=Vn?function(){Fn.nextTick(In)}:xn&&!yn?(kn=!0,Dn=document.createTextNode(""),new xn(In).observe(Dn,{characterData:!0}),function(){Dn.data=kn=!kn}):Un&&Un.resolve?(Rn=Un.resolve(void 0),On=Rn.then,function(){On.call(Rn,In)}):function(){Ln.call(b,In)});function jn(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=t,r=e}),this.resolve=Be(n),this.reject=Be(r)}function Wn(t,e){if(d(t),g(e)&&e.constructor===t)return e;var n=zn.f(t);return(0,n.resolve)(e),n.promise}function Kn(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}var Qn,Hn,Gn=Bn||function(t){var e={fn:t,next:void 0};Nn&&(Nn.next=e),Cn||(Cn=e,An()),Nn=e},zn={f:function(t){return new jn(t)}},Yn=b.process,Xn=Yn&&Yn.versions,Jn=Xn&&Xn.v8;Jn?Hn=(Qn=Jn.split("."))[0]+Qn[1]:dn&&(!(Qn=dn.match(/Edge\/(\d+)/))||74<=Qn[1])&&(Qn=dn.match(/Chrome\/(\d+)/))&&(Hn=Qn[1]);function $n(t){var e;return!(!g(t)||"function"!=typeof(e=t.then))&&e}function Zn(l,f,p){if(!f.notified){f.notified=!0;var d=f.reactions;Gn(function(){for(var t=f.value,e=1==f.state,n=0;d.length>n;){var r,i,o,a=d[n++],s=e?a.ok:a.fail,u=a.resolve,c=a.reject,h=a.domain;try{s?(e||(2===f.rejection&&kr(l,f),f.rejection=1),!0===s?r=t:(h&&h.enter(),r=s(t),h&&(h.exit(),o=!0)),r===a.promise?c(yr("Promise-chain cycle")):(i=$n(r))?i.call(r,u,c):u(r)):c(t)}catch(t){h&&!o&&h.exit(),c(t)}}f.reactions=[],f.notified=!1,p&&!f.rejection&&Nr(l,f)})}}function tr(t,e,n){var r,i;Er?((r=mr.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),b.dispatchEvent(r)):r={promise:e,reason:n},(i=b["on"+t])?i(r):t===Sr&&function(t,e){var n=b.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)}function er(e,n,r,i){return function(t){e(n,r,t,i)}}function nr(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,Zn(t,e,!0))}var rr,ir,or,ar,sr=Hn&&+Hn,ur=Pn.set,cr=W("species"),hr="Promise",lr=Q.get,fr=Q.set,pr=Q.getterFor(hr),dr=Ge,yr=b.TypeError,mr=b.document,gr=b.process,vr=N("inspectSource"),br=st("fetch"),wr=zn.f,_r=wr,Tr="process"==j(gr),Er=!!(mr&&mr.createEvent&&b.dispatchEvent),Sr="unhandledrejection",Ir=Wt(hr,function(){var t=vr(dr)!==String(dr);if(66===sr)return!0;if(!t&&!Tr&&"function"!=typeof PromiseRejectionEvent)return!0;if(51<=sr&&/native code/.test(dr))return!1;function e(t){t(function(){},function(){})}var n=dr.resolve(1);return(n.constructor={})[cr]=e,!(n.then(function(){})instanceof e)}),Cr=Ir||!rn(function(t){dr.all(t).catch(function(){})}),Nr=function(n,r){ur.call(b,function(){var t,e=r.value;if(Ar(r)&&(t=Kn(function(){Tr?gr.emit("unhandledRejection",e,n):tr(Sr,n,e)}),r.rejection=Tr||Ar(r)?2:1,t.error))throw t.value})},Ar=function(t){return 1!==t.rejection&&!t.parent},kr=function(t,e){ur.call(b,function(){Tr?gr.emit("rejectionHandled",t):tr("rejectionhandled",t,e.value)})},Dr=function(n,r,t,e){if(!r.done){r.done=!0,e&&(r=e);try{if(n===t)throw yr("Promise can't be resolved itself");var i=$n(t);i?Gn(function(){var e={done:!1};try{i.call(t,er(Dr,n,e,r),er(nr,n,e,r))}catch(t){nr(n,e,t,r)}}):(r.value=t,r.state=1,Zn(n,r,!1))}catch(t){nr(n,{done:!1},t,r)}}};Ir&&(dr=function(t){je(this,dr,hr),Be(t),rr.call(this);var e=lr(this);try{t(er(Dr,this,e),er(nr,this,e))}catch(t){nr(this,e,t)}},(rr=function(t){fr(this,{type:hr,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Ve(dr.prototype,{then:function(t,e){var n=pr(this),r=wr(on(this,dr));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=Tr?gr.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Zn(this,n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),ir=function(){var t=new rr,e=lr(t);this.promise=t,this.resolve=er(Dr,t,e),this.reject=er(nr,t,e)},zn.f=wr=function(t){return t===dr||t===or?new ir(t):_r(t)},"function"==typeof Ge&&(ar=Ge.prototype.then,H(Ge.prototype,"then",function(t,e){var n=this;return new dr(function(t,e){ar.call(n,t,e)}).then(t,e)},{unsafe:!0}),"function"==typeof br&&pt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Wn(dr,br.apply(b,arguments))}}))),pt({global:!0,wrap:!0,forced:Ir},{Promise:dr}),ae(dr,hr,!1),qe(hr),or=st(hr),pt({target:hr,stat:!0,forced:Ir},{reject:function(t){var e=wr(this);return e.reject.call(void 0,t),e.promise}}),pt({target:hr,stat:!0,forced:Ir},{resolve:function(t){return Wn(this,t)}}),pt({target:hr,stat:!0,forced:Cr},{all:function(t){var s=this,e=wr(s),u=e.resolve,c=e.reject,n=Kn(function(){var r=Be(s.resolve),i=[],o=0,a=1;$e(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(s,t).then(function(t){n||(n=!0,i[e]=t,--a||u(i))},c)}),--a||u(i)});return n.error&&c(n.value),e.promise},race:function(t){var n=this,r=wr(n),i=r.reject,e=Kn(function(){var e=Be(n.resolve);$e(t,function(t){e.call(n,t).then(r.resolve,i)})});return e.error&&i(e.value),r.promise}}),pt({target:"Promise",stat:!0},{allSettled:function(t){var s=this,e=zn.f(s),u=e.resolve,n=e.reject,r=Kn(function(){var r=Be(s.resolve),i=[],o=0,a=1;$e(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(s,t).then(function(t){n||(n=!0,i[e]={status:"fulfilled",value:t},--a||u(i))},function(t){n||(n=!0,i[e]={status:"rejected",reason:t},--a||u(i))})}),--a||u(i)});return r.error&&n(r.value),e.promise}}),pt({target:"Promise",proto:!0,real:!0},{finally:function(e){var n=on(this,st("Promise")),t="function"==typeof e;return this.then(t?function(t){return Wn(n,e()).then(function(){return t})}:e,t?function(t){return Wn(n,e()).then(function(){throw t})}:e)}}),"function"!=typeof Ge||Ge.prototype.finally||H(Ge.prototype,"finally",st("Promise").prototype.finally);At.Promise;var Rr=Q.set,Or=Q.getterFor("AggregateError"),Pr=function(t,e){var n=this;if(!(n instanceof Pr))return new Pr(t,e);de&&(n=de(new Error(e),zt(n)));var r=[];return $e(t,r.push,r),p?Rr(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==e&&S(n,"message",String(e)),n};Pr.prototype=oe(Error.prototype,{constructor:v(5,Pr),message:v(5,""),name:v(5,"AggregateError")}),p&&E.f(Pr.prototype,"errors",{get:function(){return Or(this).errors},configurable:!0}),pt({global:!0},{AggregateError:Pr}),pt({target:"Promise",stat:!0},{try:function(t){var e=zn.f(this),n=Kn(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var Mr="No one promise resolved";pt({target:"Promise",stat:!0},{any:function(t){var u=this,e=zn.f(u),c=e.resolve,h=e.reject,n=Kn(function(){var r=Be(u.resolve),i=[],o=0,a=1,s=!1;$e(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(u,t).then(function(t){n||s||(s=!0,c(t))},function(t){n||s||(n=!0,i[e]=t,--a||h(new(st("AggregateError"))(i,Mr)))})}),--a||h(new(st("AggregateError"))(i,Mr))});return n.error&&h(n.value),e.promise}});function Lr(t,e){var n;return Fr(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Fr(n.prototype)?g(n)&&null===(n=n[Ur])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function xr(p){var d=1==p,y=2==p,m=3==p,g=4==p,v=6==p,b=5==p||v;return function(t,e,n,r){for(var i,o,a=dt(t),s=It(a),u=Ke(e,n,3),c=ut(s.length),h=0,l=r||Lr,f=d?l(t,c):y?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:Vr.call(f,i)}else if(g)return!1;return v?-1:m||g?g:f}}var Fr=Array.isArray||function(t){return"Array"==j(t)},Ur=W("species"),Vr=[].push,qr={forEach:xr(0),map:xr(1),filter:xr(2),some:xr(3),every:xr(4),find:xr(5),findIndex:xr(6)},Br=qr.find,jr="find",Wr=!0;jr in[]&&Array(1)[jr](function(){Wr=!1}),pt({target:"Array",proto:!0,forced:Wr},{find:function(t,e){return Br(this,t,1<arguments.length?e:void 0)}}),Ne(jr);function Kr(t,e,n){return Ke(Qr,b[t].prototype[e],n)}var Qr=Function.call,Hr=(Kr("Array","find"),qr.findIndex),Gr="findIndex",zr=!0;Gr in[]&&Array(1)[Gr](function(){zr=!1}),pt({target:"Array",proto:!0,forced:zr},{findIndex:function(t,e){return Hr(this,t,1<arguments.length?e:void 0)}}),Ne(Gr);function Yr(t,e,n){var r=o(e);r in t?E.f(t,r,v(0,n)):t[r]=n}Kr("Array","findIndex");var Xr=!rn(function(t){Array.from(t)});pt({target:"Array",stat:!0,forced:Xr},{from:function(t,e,n){var r,i,o,a,s,u=dt(t),c="function"==typeof this?this:Array,h=arguments.length,l=1<h?e:void 0,f=void 0!==l,p=0,d=Qe(u);if(f&&(l=Ke(l,2<h?n:void 0,2)),null==d||c==Array&&We(d))for(i=new c(r=ut(u.length));p<r;p++)Yr(i,p,f?l(u[p],p):u[p]);else for(s=(a=d.call(u)).next,i=new c;!(o=s.call(a)).done;p++)Yr(i,p,f?He(a,l,[o.value,p],!0):o.value);return i.length=p,i}});At.Array.from;var Jr,$r,Zr,ti=qr.some;pt({target:"Array",proto:!0,forced:(Jr="some",Zr=[][Jr],!Zr||!m(function(){Zr.call(null,$r||function(){throw 1},1)}))},{some:function(t,e){return ti(this,t,1<arguments.length?e:void 0)}});Kr("Array","some");function ei(t){return g(t)&&c(gi,K(t))}var ni,ri=E.f,ii=b.DataView,oi=ii&&ii.prototype,ai=b.Int8Array,si=ai&&ai.prototype,ui=b.Uint8ClampedArray,ci=ui&&ui.prototype,hi=ai&&zt(ai),li=si&&zt(si),fi=Object.prototype,pi=(fi.isPrototypeOf,W("toStringTag")),di=s("TYPED_ARRAY_TAG"),yi=!(!b.ArrayBuffer||!ii),mi=yi&&!!de&&"Opera"!==K(b.opera),gi={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(ni in gi)b[ni]||(mi=!1);if((!mi||"function"!=typeof hi||hi===Function.prototype)&&(hi=function(){throw TypeError("Incorrect invocation")},mi))for(ni in gi)b[ni]&&de(b[ni],hi);if((!mi||!li||li===fi)&&(li=hi.prototype,mi))for(ni in gi)b[ni]&&de(b[ni].prototype,li);if(mi&&zt(ci)!==li&&de(ci,li),p&&!c(li,pi))for(ni in!0,ri(li,pi,{get:function(){return g(this)?this[di]:void 0}}),gi)b[ni]&&S(b[ni],di,ni);yi&&de&&zt(oi)!==fi&&de(oi,fi);function vi(){return Ei.call(Ci(this))}var bi=function(t){if(ei(t))return t;throw TypeError("Target is not a typed array")},wi=function(t,e,n){if(p){if(n)for(var r in gi){var i=b[r];i&&c(i.prototype,t)&&delete i.prototype[t]}li[t]&&!n||H(li,t,n?e:mi&&si[t]||e)}},_i=W("iterator"),Ti=b.Uint8Array,Ei=Re.values,Si=Re.keys,Ii=Re.entries,Ci=bi,Ni=wi,Ai=Ti&&Ti.prototype[_i],ki=!!Ai&&("values"==Ai.name||null==Ai.name);Ni("entries",function(){return Ii.call(Ci(this))}),Ni("keys",function(){return Si.call(Ci(this))}),Ni("values",vi,!ki),Ni(_i,vi,!ki);var Di=Object.assign,Ri=!Di||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Di({},t)[n]||Zt(Di({},e)).join("")!=r})?function(t,e){for(var n=dt(t),r=arguments.length,i=1,o=xt.f,a=Et.f;i<r;)for(var s,u=It(arguments[i++]),c=o?Zt(u).concat(o(u)):Zt(u),h=c.length,l=0;l<h;)s=c[l++],p&&!a.call(u,s)||(n[s]=u[s]);return n}:Di;pt({target:"Object",stat:!0,forced:Object.assign!==Ri},{assign:Ri});At.Object.assign;function Oi(s){return function(t){for(var e,n=ot(t),r=Zt(n),i=r.length,o=0,a=[];o<i;)e=r[o++],p&&!Pi.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}}var Pi=Et.f,Mi={entries:Oi(!0),values:Oi(!1)},Li=Mi.entries;pt({target:"Object",stat:!0},{entries:function(t){return Li(t)}});At.Object.entries;var xi=Mi.values;pt({target:"Object",stat:!0},{values:function(t){return xi(t)}});At.Object.values;function Fi(t){if(function(t){var e;return g(t)&&(void 0!==(e=t[Vi])?!!e:"RegExp"==j(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}function Ui(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[qi]=!1,"/./"[e](n)}catch(t){}}return!1}var Vi=W("match"),qi=W("match");pt({target:"String",proto:!0,forced:!Ui("includes")},{includes:function(t,e){return!!~String(rt(this)).indexOf(Fi(t),1<arguments.length?e:void 0)}});Kr("String","includes");var Bi="".startsWith,ji=Math.min;pt({target:"String",proto:!0,forced:!Ui("startsWith")},{startsWith:function(t,e){var n=String(rt(this));Fi(t);var r=ut(ji(1<arguments.length?e:void 0,n.length)),i=String(t);return Bi?Bi.call(n,i,r):n.slice(r,r+i.length)===i}});Kr("String","startsWith");pt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(rt(this)),n="",r=nt(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});Kr("String","repeat");function Wi(t){if(!g(t))return!1;var e=t[Hi];return void 0!==e?!!e:Fr(t)}var Ki,Qi=W("species"),Hi=W("isConcatSpreadable"),Gi=9007199254740991,zi="Maximum allowed index exceeded",Yi=51<=sr||!m(function(){var t=[];return t[Hi]=!1,t.concat()[0]!==t}),Xi=(Ki="concat",51<=sr||!m(function(){var t=[];return(t.constructor={})[Qi]=function(){return{foo:1}},1!==t[Ki](Boolean).foo}));pt({target:"Array",proto:!0,forced:!Yi||!Xi},{concat:function(t){var e,n,r,i,o,a=dt(this),s=Lr(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Wi(o=-1===e?a:arguments[e])){if(i=ut(o.length),Gi<u+i)throw TypeError(zi);for(n=0;n<i;n++,u++)n in o&&Yr(s,u,o[n])}else{if(Gi<=u)throw TypeError(zi);Yr(s,u++,o)}return s.length=u,s}});function Ji(t){var e=At.Symbol||(At.Symbol={});c(e,t)||so(e,t,{value:ao.f(t)})}function $i(t,e){var n=Eo[t]=oe(go[lo]);return po(n,{type:ho,tag:t,description:e}),p||(n.description=e),n}function Zi(e,t){d(e);var n=ot(t),r=Zt(n).concat(Mo(n));return uo(r,function(t){p&&!Po.call(n,t)||Oo(e,t,n[t])}),e}function to(t,e){var n=ot(t),r=o(e,!0);if(n!==mo||!c(Eo,r)||c(So,r)){var i=bo(n,r);return!i||!c(Eo,r)||c(n,co)&&n[co][r]||(i.enumerable=!0),i}}function eo(t){var e=_o(ot(t)),n=[];return uo(e,function(t){c(Eo,t)||c(L,t)||n.push(t)}),n}var no=Lt.f,ro={}.toString,io="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],oo={f:function(t){return io&&"[object Window]"==ro.call(t)?function(t){try{return no(t)}catch(t){return io.slice()}}(t):no(ot(t))}},ao={f:W},so=E.f,uo=qr.forEach,co=r("hidden"),ho="Symbol",lo="prototype",fo=W("toPrimitive"),po=Q.set,yo=Q.getterFor(ho),mo=Object[lo],go=b.Symbol,vo=st("JSON","stringify"),bo=Nt.f,wo=E.f,_o=oo.f,To=Et.f,Eo=N("symbols"),So=N("op-symbols"),Io=N("string-to-symbol-registry"),Co=N("symbol-to-string-registry"),No=N("wks"),Ao=b.QObject,ko=!Ao||!Ao[lo]||!Ao[lo].findChild,Do=p&&m(function(){return 7!=oe(wo({},"a",{get:function(){return wo(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=bo(mo,e);r&&delete mo[e],wo(t,e,n),r&&t!==mo&&wo(mo,e,r)}:wo,Ro=z&&"symbol"==typeof go.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof go},Oo=function(t,e,n){t===mo&&Oo(So,e,n),d(t);var r=o(e,!0);return d(n),c(Eo,r)?(n.enumerable?(c(t,co)&&t[co][r]&&(t[co][r]=!1),n=oe(n,{enumerable:v(0,!1)})):(c(t,co)||wo(t,co,v(1,{})),t[co][r]=!0),Do(t,r,n)):wo(t,r,n)},Po=function(t){var e=o(t,!0),n=To.call(this,e);return!(this===mo&&c(Eo,e)&&!c(So,e))&&(!(n||!c(this,e)||!c(Eo,e)||c(this,co)&&this[co][e])||n)},Mo=function(t){var e=t===mo,n=_o(e?So:ot(t)),r=[];return uo(n,function(t){!c(Eo,t)||e&&!c(mo,t)||r.push(Eo[t])}),r};if(z||(H((go=function(t){if(this instanceof go)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=s(e),r=function(t){this===mo&&r.call(So,t),c(this,co)&&c(this[co],n)&&(this[co][n]=!1),Do(this,n,v(1,t))};return p&&ko&&Do(mo,n,{configurable:!0,set:r}),$i(n,e)})[lo],"toString",function(){return yo(this).tag}),Et.f=Po,E.f=Oo,Nt.f=to,Lt.f=oo.f=eo,xt.f=Mo,p&&(wo(go[lo],"description",{configurable:!0,get:function(){return yo(this).description}}),H(mo,"propertyIsEnumerable",Po,{unsafe:!0})),ao.f=function(t){return $i(W(t),t)}),pt({global:!0,wrap:!0,forced:!z,sham:!z},{Symbol:go}),uo(Zt(No),function(t){Ji(t)}),pt({target:ho,stat:!0,forced:!z},{for:function(t){var e=String(t);if(c(Io,e))return Io[e];var n=go(e);return Io[e]=n,Co[n]=e,n},keyFor:function(t){if(!Ro(t))throw TypeError(t+" is not a symbol");if(c(Co,t))return Co[t]},useSetter:function(){ko=!0},useSimple:function(){ko=!1}}),pt({target:"Object",stat:!0,forced:!z,sham:!p},{create:function(t,e){return void 0===e?oe(t):Zi(oe(t),e)},defineProperty:Oo,defineProperties:Zi,getOwnPropertyDescriptor:to}),pt({target:"Object",stat:!0,forced:!z},{getOwnPropertyNames:eo,getOwnPropertySymbols:Mo}),pt({target:"Object",stat:!0,forced:m(function(){xt.f(1)})},{getOwnPropertySymbols:function(t){return xt.f(dt(t))}}),vo){var Lo=!z||m(function(){var t=go();return"[null]"!=vo([t])||"{}"!=vo({a:t})||"{}"!=vo(Object(t))});pt({target:"JSON",stat:!0,forced:Lo},{stringify:function(t,e,n){for(var r,i=[t],o=1;o<arguments.length;)i.push(arguments[o++]);if((g(r=e)||void 0!==t)&&!Ro(t))return Fr(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!Ro(e))return e}),i[1]=e,vo.apply(null,i)}})}go[lo][fo]||S(go[lo],fo,go[lo].valueOf),ae(go,ho),L[co]=!0,Ji("asyncIterator");var xo=E.f,Fo=b.Symbol;if(!(!p||"function"!=typeof Fo||"description"in Fo.prototype&&void 0===Fo().description)){var Uo={},Vo=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof Vo?new Fo(e):void 0===e?Fo():Fo(e);return""===e&&(Uo[n]=!0),n};lt(Vo,Fo);var qo=Vo.prototype=Fo.prototype;qo.constructor=Vo;var Bo=qo.toString,jo="Symbol(test)"==String(Fo("test")),Wo=/^Symbol\((.*)\)[^)]+$/;xo(qo,"description",{configurable:!0,get:function(){var t=g(this)?this.valueOf():this,e=Bo.call(t);if(c(Uo,t))return"";var n=jo?e.slice(7,-1):e.replace(Wo,"$1");return""===n?void 0:n}}),pt({global:!0,forced:!0},{Symbol:Vo})}Ji("hasInstance"),Ji("isConcatSpreadable"),Ji("iterator"),Ji("match"),Ji("matchAll"),Ji("replace"),Ji("search"),Ji("species"),Ji("split"),Ji("toPrimitive"),Ji("toStringTag"),Ji("unscopables"),ae(Math,"Math",!0),ae(b.JSON,"JSON",!0);At.Symbol;Ji("asyncDispose"),Ji("dispose"),Ji("observable"),Ji("patternMatch"),Ji("replaceAll");ao.f("iterator");function Ko(r,t,e,i,o){function n(t){var n=s[t];H(s,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!g(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!g(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!g(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})}var a=b[r],s=a&&a.prototype,u=a,c=i?"set":"add",h={};if(Wt(r,"function"!=typeof a||!(o||s.forEach&&!m(function(){(new a).entries().next()}))))u=e.getConstructor(t,r,i,c),Go.REQUIRED=!0;else if(Wt(r,!0)){var l=new u,f=l[c](o?{}:-0,1)!=l,p=m(function(){l.has(1)}),d=rn(function(t){new a(t)}),y=!o&&m(function(){for(var t=new a,e=5;e--;)t[c](e,e);return!t.has(-0)});d||(((u=t(function(t,e){je(t,u,r);var n=function(t,e,n){var r,i;return de&&"function"==typeof(r=e.constructor)&&r!==n&&g(i=r.prototype)&&i!==n.prototype&&de(t,i),t}(new a,t,u);return null!=e&&$e(e,n[c],n,i),n})).prototype=s).constructor=u),(p||y)&&(n("delete"),n("has"),i&&n("get")),(y||f)&&n(c),o&&s.clear&&delete s.clear}return h[r]=u,pt({global:!0,forced:u!=a},h),ae(u,r),o||e.setStrong(u,r,i),u}function Qo(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return Be(this),(r=void 0!==u)&&Be(u),null==t?new this:(i=[],r?(o=0,a=Ke(u,2<s?n:void 0,2),$e(t,function(t){i.push(a(t,o++))})):$e(t,i.push,i),new this(i))}var Ho=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Go=e(function(t){function n(t){e(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var e=E.f,r=s("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!g(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!c(t,r)){if(!o(t))return"F";if(!e)return"E";n(t)}return t[r].objectID},getWeakData:function(t,e){if(!c(t,r)){if(!o(t))return!0;if(!e)return!1;n(t)}return t[r].weakData},onFreeze:function(t){return Ho&&a.REQUIRED&&o(t)&&!c(t,r)&&n(t),t}};L[r]=!0}),zo=(Go.REQUIRED,Go.fastKey,Go.getWeakData,Go.onFreeze,E.f),Yo=Go.fastKey,Xo=Q.set,Jo=Q.getterFor,$o={getConstructor:function(t,n,r,i){function o(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=Yo(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),p?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t}var a=t(function(t,e){je(t,a,n),Xo(t,{type:n,index:oe(null),first:void 0,last:void 0,size:0}),p||(t.size=0),null!=e&&$e(e,t[i],t,r)}),s=Jo(n),u=function(t,e){var n,r=s(t),i=Yo(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Ve(a.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,p?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),p?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=s(this),i=Ke(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!u(this,t)}}),Ve(a.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return o(this,0===t?0:t,e)}}:{add:function(t){return o(this,t=0===t?0:t,t)}}),p&&zo(a.prototype,"size",{get:function(){return s(this).size}}),a},setStrong:function(t,e,n){var r=e+" Iterator",i=Jo(e),o=Jo(r);ce(t,e,function(t,e){Xo(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),qe(e)}};Ko("Map",function(e){return function(t){return e(this,arguments.length?t:void 0)}},$o,!0),At.Map;pt({target:"Map",stat:!0},{from:Qo});function Zo(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}pt({target:"Map",stat:!0},{of:Zo});function ta(){for(var t,e=d(this),n=Be(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r}pt({target:"Map",proto:!0,real:!0,forced:f},{deleteAll:function(){return ta.apply(this,arguments)}});function ea(t){return Map.prototype.entries.call(t)}pt({target:"Map",proto:!0,real:!0,forced:f},{every:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3);return!$e(r,function(t,e){if(!i(e,t,n))return $e.stop()},void 0,!0,!0).stopped}}),pt({target:"Map",proto:!0,real:!0,forced:f},{filter:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Map"))),a=Be(o.set);return $e(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),pt({target:"Map",proto:!0,real:!0,forced:f},{find:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t,e){if(i(e,t,n))return $e.stop(e)},void 0,!0,!0).result}}),pt({target:"Map",proto:!0,real:!0,forced:f},{findKey:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t,e){if(i(e,t,n))return $e.stop(t)},void 0,!0,!0).result}}),pt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;Be(n);var i=Be(r.has),o=Be(r.get),a=Be(r.set);return $e(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});pt({target:"Map",proto:!0,real:!0,forced:f},{includes:function(n){return $e(ea(d(this)),function(t,e){if(function(t,e){return t===e||t!=t&&e!=e}(e,n))return $e.stop()},void 0,!0,!0).stopped}}),pt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Be(e);var r=Be(n.set);return $e(t,function(t){r.call(n,e(t),t)}),n}}),pt({target:"Map",proto:!0,real:!0,forced:f},{keyOf:function(n){return $e(ea(d(this)),function(t,e){if(e===n)return $e.stop(t)},void 0,!0,!0).result}}),pt({target:"Map",proto:!0,real:!0,forced:f},{mapKeys:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Map"))),a=Be(o.set);return $e(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),pt({target:"Map",proto:!0,real:!0,forced:f},{mapValues:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Map"))),a=Be(o.set);return $e(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),pt({target:"Map",proto:!0,real:!0,forced:f},{merge:function(t){for(var e=d(this),n=Be(e.set),r=0;r<arguments.length;)$e(arguments[r++],n,e,!0);return e}}),pt({target:"Map",proto:!0,real:!0,forced:f},{reduce:function(n,t){var r=d(this),e=ea(r),i=arguments.length<2,o=i?void 0:t;if(Be(n),$e(e,function(t,e){o=i?(i=!1,e):n(o,e,t,r)},void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return o}}),pt({target:"Map",proto:!0,real:!0,forced:f},{some:function(t,e){var n=d(this),r=ea(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t,e){if(i(e,t,n))return $e.stop()},void 0,!0,!0).stopped}}),pt({target:"Map",proto:!0,real:!0,forced:f},{update:function(t,e,n){var r=d(this),i=arguments.length;Be(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):Be(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}});function na(t,e,n){var r,i=d(this),o=2<arguments.length?n:void 0;if("function"!=typeof e&&"function"!=typeof o)throw TypeError("At least one callback required");return i.has(t)?(r=i.get(t),"function"==typeof e&&(r=e(r),i.set(t,r))):"function"==typeof o&&(r=o(),i.set(t,r)),r}pt({target:"Map",proto:!0,real:!0,forced:f},{upsert:na}),pt({target:"Map",proto:!0,real:!0,forced:f},{updateOrInsert:na});Ko("Set",function(e){return function(t){return e(this,arguments.length?t:void 0)}},$o),At.Set;pt({target:"Set",stat:!0},{from:Qo}),pt({target:"Set",stat:!0},{of:Zo});pt({target:"Set",proto:!0,real:!0,forced:f},{addAll:function(){return function(){for(var t=d(this),e=Be(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),pt({target:"Set",proto:!0,real:!0,forced:f},{deleteAll:function(){return ta.apply(this,arguments)}});function ra(t){return Set.prototype.values.call(t)}pt({target:"Set",proto:!0,real:!0,forced:f},{every:function(t,e){var n=d(this),r=ra(n),i=Ke(t,1<arguments.length?e:void 0,3);return!$e(r,function(t){if(!i(t,t,n))return $e.stop()},void 0,!1,!0).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{difference:function(t){var e=d(this),n=new(on(e,st("Set")))(e),r=Be(n.delete);return $e(t,function(t){r.call(n,t)}),n}}),pt({target:"Set",proto:!0,real:!0,forced:f},{filter:function(t,e){var n=d(this),r=ra(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Set"))),a=Be(o.add);return $e(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),pt({target:"Set",proto:!0,real:!0,forced:f},{find:function(t,e){var n=d(this),r=ra(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t){if(i(t,t,n))return $e.stop(t)},void 0,!1,!0).result}}),pt({target:"Set",proto:!0,real:!0,forced:f},{intersection:function(t){var e=d(this),n=new(on(e,st("Set"))),r=Be(e.has),i=Be(n.add);return $e(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),pt({target:"Set",proto:!0,real:!0,forced:f},{isDisjointFrom:function(t){var e=d(this),n=Be(e.has);return!$e(t,function(t){if(!0===n.call(e,t))return $e.stop()}).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{isSubsetOf:function(t){var e=function(t){var e=Qe(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return d(e.call(t))}(this),n=d(t),r=n.has;return"function"!=typeof r&&(n=new(st("Set"))(t),r=Be(n.has)),!$e(e,function(t){if(!1===r.call(n,t))return $e.stop()},void 0,!1,!0).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{isSupersetOf:function(t){var e=d(this),n=Be(e.has);return!$e(t,function(t){if(!1===n.call(e,t))return $e.stop()}).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{join:function(t){var e=d(this),n=ra(e),r=void 0===t?",":String(t),i=[];return $e(n,i.push,i,!1,!0),i.join(r)}}),pt({target:"Set",proto:!0,real:!0,forced:f},{map:function(t,e){var n=d(this),r=ra(n),i=Ke(t,1<arguments.length?e:void 0,3),o=new(on(n,st("Set"))),a=Be(o.add);return $e(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),pt({target:"Set",proto:!0,real:!0,forced:f},{reduce:function(e,t){var n=d(this),r=ra(n),i=arguments.length<2,o=i?void 0:t;if(Be(e),$e(r,function(t){o=i?(i=!1,t):e(o,t,t,n)},void 0,!1,!0),i)throw TypeError("Reduce of empty set with no initial value");return o}}),pt({target:"Set",proto:!0,real:!0,forced:f},{some:function(t,e){var n=d(this),r=ra(n),i=Ke(t,1<arguments.length?e:void 0,3);return $e(r,function(t){if(i(t,t,n))return $e.stop()},void 0,!1,!0).stopped}}),pt({target:"Set",proto:!0,real:!0,forced:f},{symmetricDifference:function(t){var e=d(this),n=new(on(e,st("Set")))(e),r=Be(n.delete),i=Be(n.add);return $e(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),pt({target:"Set",proto:!0,real:!0,forced:f},{union:function(t){var e=d(this),n=new(on(e,st("Set")))(e);return $e(t,Be(n.add),n),n}});var ia=Math.floor;pt({target:"Number",stat:!0},{isInteger:function(t){return!g(t)&&isFinite(t)&&ia(t)===t}});At.Number.isInteger;var oa=function(t,e){return(oa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function aa(t,e){function n(){this.constructor=t}oa(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var sa=function(){return(sa=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ua(o,a,s,u){return new(s=s||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function ca(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function ha(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function la(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function fa(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(la(arguments[e]));return t}function pa(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function da(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function ya(t){try{return ba.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var ma={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},ga=function(t,e){if(!t)throw va(e)},va=function(t){return new Error("Firebase Database ("+ma.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},ba={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(da(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function wa(t){return _a(void 0,t)}function _a(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=_a(t[n],e[n]));return t}var Ta=(Ea.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},Ea);function Ea(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}function Sa(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ia(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Sa())}function Ca(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Na(){return!0===ma.NODE_ADMIN}var Aa,ka=(aa(Da,Aa=Error),Da);function Da(t,e){var n=Aa.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,Da.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,Ra.prototype.create),n}var Ra=(Oa.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,r){return t.replace(Pa,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new ka(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},Oa);function Oa(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Pa=/\{\$([^}]+)}/g;function Ma(t){return JSON.parse(t)}function La(t){return JSON.stringify(t)}function xa(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Ma(ya(o[0])||""),n=Ma(ya(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function Fa(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ua(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Va(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function qa(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Ba=(ja.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},ja.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},ja.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},ja.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},ja);function ja(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Wa(t,e){var n=new Ka(t,e);return n.subscribe.bind(n)}var Ka=(Qa.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},Qa.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},Qa.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},Qa.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=Ha),void 0===r.error&&(r.error=Ha),void 0===r.complete&&(r.complete=Ha);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},Qa.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Qa.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},Qa.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},Qa.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},Qa);function Qa(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function Ha(){}function Ga(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function za(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Ya(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(za(t,e,r)+"must be a valid function.")}function Xa(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(za(t,e,r)+"must be a valid context object.")}function Ja(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}var $a,Za;function ts(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}(Za=$a=$a||{})[Za.DEBUG=0]="DEBUG",Za[Za.VERBOSE=1]="VERBOSE",Za[Za.INFO=2]="INFO",Za[Za.WARN=3]="WARN",Za[Za.ERROR=4]="ERROR",Za[Za.SILENT=5]="SILENT";function es(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case $a.DEBUG:case $a.VERBOSE:console.log.apply(console,ts(["["+i+"]  "+t.name+":"],n));break;case $a.INFO:console.info.apply(console,ts(["["+i+"]  "+t.name+":"],n));break;case $a.WARN:console.warn.apply(console,ts(["["+i+"]  "+t.name+":"],n));break;case $a.ERROR:console.error.apply(console,ts(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var ns,rs=$a.INFO,is=(Object.defineProperty(os.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in $a))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(os.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),os.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ts([this,$a.DEBUG],t))},os.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ts([this,$a.VERBOSE],t))},os.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ts([this,$a.INFO],t))},os.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ts([this,$a.WARN],t))},os.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ts([this,$a.ERROR],t))},os);function os(t){this.name=t,this._logLevel=rs,this._logHandler=es}var as=((ns={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",ns["bad-app-name"]="Illegal App name: '{$appName}",ns["duplicate-app"]="Firebase App named '{$appName}' already exists",ns["app-deleted"]="Firebase App named '{$appName}' already deleted",ns["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",ns),ss=new Ra("app","Firebase",as),us="[DEFAULT]",cs=(Object.defineProperty(hs.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(hs.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(hs.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),hs.prototype.delete=function(){var s=this;return new Promise(function(t){s.checkDestroyed_(),t()}).then(function(){s.firebase_.INTERNAL.removeApp(s.name_);for(var t=[],e=0,n=Object.keys(s.services_);e<n.length;e++)for(var r=n[e],i=0,o=Object.keys(s.services_[r]);i<o.length;i++){var a=o[i];t.push(s.services_[r][a])}return Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){s.isDeleted_=!0,s.services_={}})},hs.prototype._getService=function(t,e){if(void 0===e&&(e=us),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==us?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},hs.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=us),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},hs.prototype.extendApp=function(t){if(_a(this,t),t.INTERNAL){if(t.INTERNAL.addAuthTokenListener){for(var e=0,n=this.tokenListeners_;e<n.length;e++){var r=n[e];this.INTERNAL.addAuthTokenListener(r)}this.tokenListeners_=[]}if(t.INTERNAL.analytics){for(var i=0,o=this.analyticsEventRequests_;i<o.length;i++){var a=o[i];this.INTERNAL.analytics.logEvent.apply(void 0,a)}this.analyticsEventRequests_=[]}}},hs.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw ss.create("app-deleted",{appName:this.name_})},hs);function hs(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.services_={},this.tokenListeners_=[],this.analyticsEventRequests_=[],this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=wa(t);var i=this;this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){r.tokenListeners_.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){r.tokenListeners_=r.tokenListeners_.filter(function(t){return t!==e})},analytics:{logEvent:function(){i.analyticsEventRequests_.push(arguments)}}}}cs.prototype.name&&cs.prototype.options||cs.prototype.delete||console.log("dc");var ls="7.5.0",fs=new is("@firebase/app");function ps(a){var o={},s={},u={},c={__esModule:!0,initializeApp:function(t,e){void 0===e&&(e={});if("object"!=typeof e||null===e){e={name:e}}var n=e;void 0===n.name&&(n.name=us);var r=n.name;if("string"!=typeof r||!r)throw ss.create("bad-app-name",{appName:String(r)});if(Fa(o,r))throw ss.create("duplicate-app",{appName:r});var i=new a(t,n,c);return f(o[r]=i,"create"),i},app:h,apps:null,SDK_VERSION:ls,INTERNAL:{registerService:function(n,t,e,r,i){void 0===i&&(i=!1);if(s[n])return fs.debug("There were multiple attempts to register service "+n+"."),c[n];s[n]=t,r&&(u[n]=r,l().forEach(function(t){r("create",t)}));function o(t){if(void 0===t&&(t=h()),"function"!=typeof t[n])throw ss.create("invalid-app-argument",{appName:n});return t[n]()}void 0!==e&&_a(o,e);return c[n]=o,a.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},removeApp:function(t){f(o[t],"delete"),delete o[t]},factories:s,useAsService:p}};function h(t){if(!Fa(o,t=t||us))throw ss.create("no-app",{appName:t});return o[t]}function l(){return Object.keys(o).map(function(t){return o[t]})}function f(t,e){for(var n=0,r=Object.keys(s);n<r.length;n++){var i=p(t,r[n]);if(null===i)return;u[i]&&u[i](e,t)}}function p(t,e){return"serverAuth"===e?null:e}return c.default=c,Object.defineProperty(c,"apps",{get:l}),h.App=a,c}if("object"==typeof self&&self.self===self&&void 0!==self.firebase){fs.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var ds=self.firebase.SDK_VERSION;ds&&0<=ds.indexOf("LITE")&&fs.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var ys=function t(){var e=ps(cs);return e.INTERNAL=sa(sa({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){_a(e,t)},createSubscribe:Wa,ErrorFactory:Ra,deepExtend:_a}),e}(),ms=ys.initializeApp;ys.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&fs.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),ms.apply(void 0,t)};var fl=ys;(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.m),reject:t(this.g)}},s.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.o(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.u(t):this.h(t)}},s.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},s.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.o=function(t){var e=this.f();t.La(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.La(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.La=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).La(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).La(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},l=this||self;function h(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var s=/^[\w+/_-]+[=]{0,2}$/,f=null;function p(){}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function i(t){return null===t}function d(t){return"array"==r(t)}function y(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==r(t)}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),v=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function T(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var E=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.qb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).gd=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}function M(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||l).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(g(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var L=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(h(t))return h(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},x=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=h(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=h(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function V(t,e){return 0<=L(t,e)}function q(t,e){var n;return(n=0<=(e=L(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(n,r){!function(t,e){for(var n=h(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function Q(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<G.length;o++)n=G[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.qa=!0,Y.prototype.pa=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+r(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var r=X(t);if(!it.test(r))throw Error("Invalid TrustedResourceUrl format: "+r);return at(t=r.replace(rt,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+r+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?X(t):encodeURIComponent(String(t))}))}tt.prototype.qa=!0,tt.prototype.pa=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,pt=/\x00/g,dt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function mt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Tt}function vt(t){return t instanceof gt&&t.constructor===gt&&t.b===Tt?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+r(t)),"type_error:SafeUrl")}gt.prototype.qa=!0,gt.prototype.pa=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var bt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof gt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),bt.test(t)||(t="about:invalid#zClosurez"),Et(t))}var _t,Tt={};function Et(t){var e=new gt;return e.a=t,e}Et("about:blank");t:{var St=l.navigator;if(St){var It=St.userAgent;if(It){_t=It;break t}}_t=""}function Ct(t){return yt(_t,t)}function Nt(){this.a="",this.b=kt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===kt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+r(t)),"type_error:SafeHtml")}Nt.prototype.qa=!0,Nt.prototype.pa=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kt={};function Dt(t){var e=new Nt;return e.a=t,e}Dt("<!DOCTYPE html>");var Rt,Ot,Pt=Dt("");function Mt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Lt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(pt,"&#0;"))),t}function xt(t){l.setTimeout(function(){throw t},0)}function Ft(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ct("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(X(Z));M(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(At(Pt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Ct("Trident")||Ct("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}function Ut(t,e){Ot||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}else Ot=function(){var t=Bt;!m(l.setImmediate)||l.Window&&l.Window.prototype&&!Ct("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(Rt=Rt||Ft())(t):l.setImmediate(t)}}(),Vt||(Ot(),Vt=!0),qt.add(t,e)}Dt("<br>");var Vt=!1,qt=new R;function Bt(){for(var t;n=e=void 0,n=null,(e=qt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){xt(t)}D(O,t)}var e,n;Vt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=p)try{var n=this;t.call(e,function(t){ee(n,Kt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Qt,t)})}catch(t){ee(this,Qt,t)}}var Wt=0,Kt=2,Qt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new k(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(p);return ee(e,Kt,t),e}function Xt(n){return new jt(function(t,e){e(n)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(T(e,t))}function $t(n){return new jt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Gb:!0,value:n}:{Gb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Jt(n[e],T(t,e,!0),T(t,e,!1));else r(o)})}function Zt(t,e){t.b||t.a!=Kt&&t.a!=Qt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,i,o,a){var e=zt(null,null,null);return e.a=new jt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?r(t):n(e)}catch(t){r(t)}}:r}),Zt(e.a.c=t,e),e.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Qt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||p,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(g(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Zb,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}D(Gt,e)}function ae(t,e,n){e==Kt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,m(t)?t:null,m(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ka=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Qt,n)))}e.c=null}else ee(e,Qt,n)}(this,new ue(t))},this)},t.Oc=function(t){this.a=Wt,ee(this,Kt,t)},t.Pc=function(t){this.a=Wt,ee(this,Qt,t)},t.Zb=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=xt;function ue(t){C.call(this,t)}function ce(){this.va=this.va,this.la=this.la}S(ue,C);var he=0;function le(t){if(!t.va&&(t.va=!0,t.za(),0!=he))t[e]||(t[e]=++v)}function fe(t){return fe[" "](t),t}ce.prototype.va=!(ue.prototype.name="cancel"),ce.prototype.za=function(){if(this.la)for(;this.la.length;)this.la.shift()()},fe[" "]=p;var pe,de,ye=Ct("Opera"),me=Ct("Trident")||Ct("MSIE"),ge=Ct("Edge"),ve=ge||me,be=Ct("Gecko")&&!(yt(_t.toLowerCase(),"webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),we=yt(_t.toLowerCase(),"webkit")&&!Ct("Edge");function _e(){var t=l.document;return t?t.documentMode:void 0}t:{var Te="",Ee=(de=_t,be?/rv:([^\);]+)(\)|;)/.exec(de):ge?/Edge\/([\d\.]+)/.exec(de):me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):ye?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Ee&&(Te=Ee?Ee[1]:""),me){var Se=_e();if(null!=Se&&Se>parseFloat(Te)){pe=String(Se);break t}}pe=Te}var Ie,Ce={};function Ne(s){return function(t,e){var n=Ce;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=st(String(pe)).split("."),n=st(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=mt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||mt(0==o[2].length,0==a[2].length)||mt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}Ie=l.document&&me?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!me||9<=Number(Ie),De=me&&!Ne("9"),Re=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",p,e),l.removeEventListener("test",p,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=h(t.pointerType)?t.pointerType:Me[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Mb=!1},S(Pe,Oe);var Me=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var Le="closure_listenable_"+(1e6*Math.random()|0),xe=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Pa=i,this.key=++xe,this.ta=this.Ka=!1}function Ue(t){t.ta=!0,t.listener=null,t.proxy=null,t.src=null,t.Pa=null}function Ve(t){this.src=t,this.a={},this.b=0}function qe(t,e){var n=e.type;n in t.a&&q(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ta&&o.listener==e&&o.capture==!!n&&o.Pa==r)return i}return-1}Ve.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ka=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ka=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Ke(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=en(n),t&&t[Le]?rn(t,e,n,g(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=g(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new Ve(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var e=$e,n=ke?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[Le]?on(t,e,n,g(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=g(r)?!!r.capture:!!r,n=en(n),t&&t[Le]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.ta){var e=t.src;if(e&&e[Le])qe(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(qe(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ta&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.Pa||t.src;return t.Ka&&ze(t),n.call(r,e)}function $e(t,e){if(t.ta)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof Ve?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return m(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.u=new Ve(this),(this.Sb=this).Xa=null}function rn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ta&&a.capture==n){var s=a.listener,u=a.Pa||a.src;a.Ka&&qe(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function sn(t,e,n){if(m(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function un(n){var r=null;return new jt(function(t,e){-1==(r=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(r),t})}function cn(t){if(t.U&&"function"==typeof t.U)return t.U();if(h(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(y(t)||h(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(nn,ce),nn.prototype[Le]=!0,nn.prototype.addEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Xa;if(n)for(e=[];n;n=n.Xa)e.push(n);n=this.Sb;var r=t.type||t;if(h(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;z(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.za=function(){if(nn.qb.za.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Xa=null},(t=ln.prototype).U=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,mn(this,t.f),this.i=t.i,this.b=t.b,gn(this,t.l),this.c=t.c,vn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,mn(this,n[1]||"",!0),this.i=En(n[2]||""),this.b=En(n[3]||"",!0),gn(this,n[4]),this.c=En(n[5]||"",!0),vn(this,n[6]||"",!0),this.g=En(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function mn(t,e,n){t.f=n?En(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function gn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function vn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Mn(this,e),xn(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function Tn(t,e){var n=new yn(null,void 0);return mn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function En(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return h(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?mn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)gn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?vn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?xn(n,i,o):n.add(i,o)}return n}function Mn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function Ln(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function xn(t,e,n){Mn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),W(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){On(this),this.a.forEach(function(t,e){x(t,function(t){n.call(r,t,e,this)},this)},this)},t.X=function(){On(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){On(this);var e=[];if(h(t))Ln(this,t)&&(e=j(e,this.a.get(Un(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,Ln(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var Vn=!me||9<=Number(Ie);function qn(t){var e=document;return h(t)?e.getElementById(t):t}function Bn(n,t){K(t,function(t,e){t&&"object"==typeof t&&t.qa&&(t=t.pa()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:jn.hasOwnProperty(e)?n.setAttribute(jn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!Vn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Lt(a.name),'"'),a.type){o.push(' type="',Lt(a.type),'"');var s={};z(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(h(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(h(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!y(o)||g(o)&&0<o.nodeType?r(o):x(Kn(o)?W(o):o,r)}}(i,o,r),o}function Kn(t){if(t&&"number"==typeof t.length){if(g(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Yn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Gn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},zn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(zn,function(t){var e=Gn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Gn[t]=e),e}),'"')}function Xn(){var t=yr();return me&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Jn(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||l.window;var n="about:blank";t&&(n=vt(wt(t)).toString()),e.location.href=n}function Zn(t){return!!((t=(t||yr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function tr(t){t=t||l.window;try{t.close()}catch(t){}}function er(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=yr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),fr(yr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof gt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ct("iPhone")&&!Ct("iPod")&&!Ct("iPad")||Ct("iPad")||Ct("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(M(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.qa?e.pa():String(e),bt.test(e)||(e="about:invalid#zClosurez"),e=Et(e)),a.href=vt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=vt(e).toString(),a&&(ve&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Lt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(vt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^[^@]+@[^@]+$/;function ir(){var e=null;return new jt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},He(window,"load",e))}).s(function(t){throw Ge(window,"load",e),t})}function or(t){return t=t||yr(),!("file:"!==wr()&&"ionic:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ar(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function sr(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function ur(){return fl.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":fl.INTERNAL.hasOwnProperty("node")?"Node":sr()?"Worker":"Browser"}function cr(){var t=ur();return"ReactNative"===t||"Node"===t}var hr="Firefox",lr="Chrome";function fr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?hr:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":lr:"Safari"}var pr={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function dr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ur())?r=fr(i=yr()):"Worker"===r&&(r=fr(i=yr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function yr(){return l.navigator&&l.navigator.userAgent||""}function mr(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function gr(){try{var t=l.localStorage,e=Ir();if(t)return t.setItem(e,"1"),t.removeItem(e),!Xn()||!!l.indexedDB}catch(t){return sr()&&!!l.indexedDB}return!1}function vr(){return(br()||"chrome-extension:"===wr()||or())&&!cr()&&gr()&&!sr()}function br(){return"http:"===wr()||"https:"===wr()}function wr(){return l.location&&l.location.protocol||null}function _r(t){return!Zn(t=t||yr())&&fr(t)!=hr}function Tr(t){return void 0===t?null:Qn(t)}function Er(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Sr(t){if(null!==t)return JSON.parse(t)}function Ir(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=fr(t=t||yr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Nr(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ar(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=yr(),e=ur(),this.b=Zn(t)||"ReactNative"===e}function kr(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Dr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Rr(){return!(!mr("fireauth.oauthhelper",l)&&!mr("fireauth.iframe",l))}Ar.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!br()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Or,Pr={};function Mr(t){Pr[t]||(Pr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Lr={};Object.defineProperty(Lr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Lr,"abcd",{configurable:!0,enumerable:!0,value:2}),Or=2==Lr.abcd}catch(t){Or=!1}function xr(t,e,n){Or?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&xr(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function Vr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)xr(e,n,Vr(t[n]));return e}function qr(t){var e={},n=t[jr],r=t[Wr];if(!(t=t[Kr])||t!=Br&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[Qr]=n||null,xr(this,zr,t),xr(this,Gr,Vr(e))}var Br="EMAIL_SIGNIN",jr="email",Wr="newEmail",Kr="requestType",Qr="email",Hr="fromEmail",Gr="data",zr="operation";function Yr(t,e){this.code=Jr+t,this.message=e||$r[t]||""}function Xr(t){var e=t&&t.code;return e?new Yr(e.substring(Jr.length),t.message):null}S(Yr,Error),Yr.prototype.A=function(){return{code:this.code,message:this.message}},Yr.prototype.toJSON=function(){return this.A()};var Jr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Zr(t){var e=wn(t=_n(t),ti)||null,n=wn(t,ei)||null,r=wn(t,ii)||null;if(r=r&&ai[r]||null,!e||!n||!r)throw new Yr("argument-error",ti+", "+ei+"and "+ii+" are required in a valid action code URL.");Fr(this,{apiKey:e,operation:r,code:n,continueUrl:wn(t,ni)||null,languageCode:wn(t,ri)||null,tenantId:wn(t,oi)||null})}var ti="apiKey",ei="oobCode",ni="continueUrl",ri="languageCode",ii="mode",oi="tenantId",ai={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Br,verifyEmail:"VERIFY_EMAIL"};function si(t){try{return new Zr(t)}catch(t){return null}}function ui(t){var e=t[pi];if(void 0===e)throw new Yr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ci];if(n&&"object"==typeof n){e=n[mi];var r=n[di];if(n=n[yi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Yr("argument-error",di+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yr("argument-error",yi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yr("argument-error",mi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Yr("missing-android-pkg-name")}}else if(void 0!==n)throw new Yr("argument-error",ci+" property must be a non null object when specified.");if(this.f=null,(e=t[fi])&&"object"==typeof e){if("string"==typeof(e=e[gi])&&e.length)this.f=e;else if(void 0!==e)throw new Yr("argument-error",gi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yr("argument-error",fi+" property must be a non null object when specified.");if(void 0!==(e=t[li])&&"boolean"!=typeof e)throw new Yr("argument-error",li+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[hi])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yr("argument-error",hi+" property must be a non empty string when specified.");this.i=t||null}var ci="android",hi="dynamicLinkDomain",li="handleCodeInApp",fi="iOS",pi="url",di="installApp",yi="minimumVersion",mi="packageName",gi="bundleId";function vi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var bi=null,wi=null;function _i(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=wi[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!bi){bi={},wi={};for(var t=0;t<65;t++)bi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(wi[bi[t]]=t)&&(wi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Ti(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Ei(t){return(t=Si(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ti(t):null}function Si(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(_i(t))}catch(t){}return null}Ti.prototype.R=function(){return this.c},Ti.prototype.g=function(){return this.b};var Ii,Ci={bd:{cb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{cb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{cb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ni(t){for(var e in Ci)if(Ci[e].id===t)return{firebaseEndpoint:(t=Ci[e]).cb,secureTokenEndpoint:t.ib};return null}Ii=Ni("__EID__")?"__EID__":void 0;var Ai="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),ki=["client_id","response_type","scope","redirect_uri","state"],Di={Xc:{Ea:"locale",sa:700,ra:600,Fa:"facebook.com",Qa:ki},Zc:{Ea:null,sa:500,ra:750,Fa:"github.com",Qa:ki},$c:{Ea:"hl",sa:515,ra:680,Fa:"google.com",Qa:ki},fd:{Ea:"lang",sa:485,ra:705,Fa:"twitter.com",Qa:Ai},Vc:{Ea:"locale",sa:600,ra:600,Fa:"apple.com",Qa:[]}};function Ri(t){for(var e in Di)if(Di[e].Fa==t)return Di[e];return null}function Oi(t){var e={};e["facebook.com"]=Fi,e["google.com"]=Vi,e["github.com"]=Ui,e["twitter.com"]=qi;var n=t&&t[Mi];try{if(n)return e[n]?new e[n](t):new xi(t);if(void 0!==t[Pi])return new Li(t)}catch(t){}return null}var Pi="idToken",Mi="providerId";function Li(t){var e=t[Mi];if(!e&&t[Pi]){var n=Ei(t[Pi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),xr(this,"providerId",e),xr(this,"isNewUser",n)}function xi(t){Li.call(this,t),xr(this,"profile",Vr((t=Sr(t.rawUserInfo||"{}"))||{}))}function Fi(t){if(xi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ui(t){if(xi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",this.profile&&this.profile.login||null)}function Vi(t){if(xi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function qi(t){if(xi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");xr(this,"username",t.screenName||null)}function Bi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function ji(){}function Wi(t,n){return t.then(function(t){if(t[Oa]){var e=Ei(t[Oa]);if(!e||n!=e.f)throw new Yr("user-mismatch");return t}throw new Yr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Jr+"user-not-found"?new Yr("user-mismatch"):t})}function Ki(t,e){if(!e)throw new Yr("internal-error","failed to construct a credential");this.a=e,xr(this,"providerId",t),xr(this,"signInMethod",t)}function Qi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Hi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Ki(t.providerId,t.pendingToken)}catch(t){}return null}function Gi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&xr(this,"idToken",e.idToken),e.accessToken&&xr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&xr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yr("internal-error","failed to construct a credential");xr(this,"accessToken",e.oauthToken),xr(this,"secret",e.oauthTokenSecret)}xr(this,"providerId",t),xr(this,"signInMethod",n)}function zi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Yi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Gi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Xi(t,e){this.Fc=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(Ri(t)||{}).Ea||null,this.bb=null}function Ji(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yr("argument-error",'SAML provider IDs must be prefixed with "saml."');Xi.call(this,t,[])}function $i(t){Xi.call(this,t,ki),this.a=[]}function Zi(){$i.call(this,"facebook.com")}function to(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Zi).credential({accessToken:e})}function eo(){$i.call(this,"github.com")}function no(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new eo).credential({accessToken:e})}function ro(){$i.call(this,"google.com"),this.ya("profile")}function io(t,e){var n=t;return g(t)&&(n=t.idToken,e=t.accessToken),(new ro).credential({idToken:n,accessToken:e})}function oo(){Xi.call(this,"twitter.com",Ai)}function ao(t,e){var n=t;if(g(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Gi("twitter.com",n,"twitter.com")}function so(t,e,n){this.a=t,this.c=e,xr(this,"providerId","password"),xr(this,"signInMethod",n===co.EMAIL_LINK_SIGN_IN_METHOD?co.EMAIL_LINK_SIGN_IN_METHOD:co.EMAIL_PASSWORD_SIGN_IN_METHOD)}function uo(t){return t&&t.email&&t.password?new so(t.email,t.password,t.signInMethod):null}function co(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function ho(t,e){if(!(e=lo(e)))throw new Yr("argument-error","Invalid email link!");return new so(t,e.code,co.EMAIL_LINK_SIGN_IN_METHOD)}function lo(t){return(t=si(t=Bi(t)))&&t.operation===Br?t:null}function fo(t){if(!(t.Va&&t.Ua||t.Ha&&t.ba))throw new Yr("internal-error");this.a=t,xr(this,"providerId","phone"),xr(this,"signInMethod","phone")}function po(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return x(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new fo(n)}return null}function yo(t){return t.a.Ha&&t.a.ba?{temporaryProof:t.a.Ha,phoneNumber:t.a.ba}:{sessionInfo:t.a.Va,code:t.a.Ua}}function mo(t){try{this.a=t||fl.auth()}catch(t){throw new Yr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function go(t,e){if(!t)throw new Yr("missing-verification-id");if(!e)throw new Yr("missing-verification-code");return new fo({Va:t,Ua:e})}function vo(t){if(t.temporaryProof&&t.phoneNumber)return new fo({Ha:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return io(o,n);case"facebook.com":return to(n);case"github.com":return no(n);case"twitter.com":return ao(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Ki(e,a):new Gi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new $i(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function bo(t){if(!t.isOAuthProvider)throw new Yr("invalid-oauth-provider")}function wo(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new Yr("invalid-auth-event");if(this.g&&this.a)throw new Yr("invalid-auth-event");if(this.g&&!this.f)throw new Yr("invalid-auth-event")}function _o(t){return(t=t||{}).type?new wo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Xr(t.error),t.postBody,t.tenantId):null}function To(){this.b=null,this.a=[]}S(xi,Li),S(Fi,xi),S(Ui,xi),S(Vi,xi),S(qi,xi),Ki.prototype.na=function(t){return Xa(t,Qi(this))},Ki.prototype.b=function(t,e){var n=Qi(this);return n.idToken=e,Ja(t,n)},Ki.prototype.f=function(t,e){return Wi($a(t,Qi(this)),e)},Ki.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Gi.prototype.na=function(t){return Xa(t,zi(this))},Gi.prototype.b=function(t,e){var n=zi(this);return n.idToken=e,Ja(t,n)},Gi.prototype.f=function(t,e){return Wi($a(t,zi(this)),e)},Gi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Xi.prototype.Ga=function(t){return this.zb=H(t),this},S(Ji,Xi),S($i,Xi),$i.prototype.ya=function(t){return V(this.a,t)||this.a.push(t),this},$i.prototype.Hb=function(){return W(this.a)},$i.prototype.credential=function(t,e){var n;if(!(n=g(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Gi(this.providerId,n,this.providerId)},S(Zi,$i),xr(Zi,"PROVIDER_ID","facebook.com"),xr(Zi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(eo,$i),xr(eo,"PROVIDER_ID","github.com"),xr(eo,"GITHUB_SIGN_IN_METHOD","github.com"),S(ro,$i),xr(ro,"PROVIDER_ID","google.com"),xr(ro,"GOOGLE_SIGN_IN_METHOD","google.com"),S(oo,Xi),xr(oo,"PROVIDER_ID","twitter.com"),xr(oo,"TWITTER_SIGN_IN_METHOD","twitter.com"),so.prototype.na=function(t){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,as,{email:this.a,oobCode:this.c}):Ns(t,Es,{email:this.a,password:this.c})},so.prototype.b=function(t,e){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,ss,{idToken:e,email:this.a,oobCode:this.c}):Ns(t,gs,{idToken:e,email:this.a,password:this.c})},so.prototype.f=function(t,e){return Wi(this.na(t),e)},so.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(co,{PROVIDER_ID:"password"}),Fr(co,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(co,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),fo.prototype.na=function(t){return t.Wa(yo(this))},fo.prototype.b=function(t,e){var n=yo(this);return n.idToken=e,Ns(t,Is,n)},fo.prototype.f=function(t,e){var n=yo(this);return n.operation="REAUTH",Wi(t=Ns(t,Cs,n),e)},fo.prototype.A=function(){var t={providerId:"phone"};return this.a.Va&&(t.verificationId=this.a.Va),this.a.Ua&&(t.verificationCode=this.a.Ua),this.a.Ha&&(t.temporaryProof=this.a.Ha),this.a.ba&&(t.phoneNumber=this.a.ba),t},mo.prototype.Wa=function(e,n){var r=this.a.b;return Yt(n.verify()).then(function(t){if(!h(t))throw new Yr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(n.type){case"recaptcha":return function(t,e){return Ns(t,ys,e)}(r,{phoneNumber:e,recaptchaToken:t}).then(function(t){return"function"==typeof n.reset&&n.reset(),t},function(t){throw"function"==typeof n.reset&&n.reset(),t});default:throw new Yr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Fr(mo,{PROVIDER_ID:"phone"}),Fr(mo,{PHONE_SIGN_IN_METHOD:"phone"}),wo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},wo.prototype.R=function(){return this.h},wo.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var Eo,So=null;function Io(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=Mt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=Mt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yr.call(this,e,n)}function Co(t,e,n){Yr.call(this,t,n),(t=e||{}).Ab&&xr(this,"email",t.Ab),t.ba&&xr(this,"phoneNumber",t.ba),t.credential&&xr(this,"credential",t.credential),t.Qb&&xr(this,"tenantId",t.Qb)}function No(t){if(t.code){var e=t.code||"";0==e.indexOf(Jr)&&(e=e.substring(Jr.length));var n={credential:vo(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Yr(e,t.message||void 0);return new Co(e,n,t.message)}return null}function Ao(){}function ko(t){return t.c||(t.c=t.b())}function Do(){}function Ro(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function Oo(){}function Po(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.fc,this),this.a.onerror=_(this.Ib,this),this.a.onprogress=_(this.gc,this),this.a.ontimeout=_(this.kc,this)}function Mo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Lo(t,e,n){this.reset(t,e,n,void 0,void 0)}function xo(t){this.f=t,this.b=this.c=this.a=null}function Fo(t,e){this.name=t,this.value=e}S(Io,Yr),S(Co,Yr),Co.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&z(t,e),t},Co.prototype.toJSON=function(){return this.A()},Ao.prototype.c=null,S(Do,Ao),Do.prototype.a=function(){var t=Ro(this);return t?new ActiveXObject(t):new XMLHttpRequest},Do.prototype.b=function(){var t={};return Ro(this)&&(t[0]=!0,t[1]=!0),t},Eo=new Do,S(Oo,Ao),Oo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Po;throw Error("Unsupported browser")},Oo.prototype.b=function(){return{}},(t=Po.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Mo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",Mo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,Mo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Lo.prototype.a=null,Lo.prototype.reset=function(t,e,n,r,i){delete this.a},Fo.prototype.toString=function(){return this.name};var Uo=new Fo("SEVERE",1e3),Vo=new Fo("WARNING",900),qo=new Fo("CONFIG",700),Bo=new Fo("FINE",500);xo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new Lo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var jo,Wo={},Ko=null;function Qo(t){var e;if(Ko||(Ko=new xo(""),(Wo[""]=Ko).c=qo),!(e=Wo[t])){e=new xo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Qo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Wo[t]=e}return e}function Ho(t,e){t&&t.log(Bo,e,void 0)}function Go(t){this.f=t}function zo(t){nn.call(this),this.o=t,this.readyState=Yo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Qo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(Go,Ao),Go.prototype.a=function(){return new zo(this.f)},Go.prototype.b=(jo={},function(){return jo}),S(zo,nn);var Yo=0;function Xo(t){t.c.read().then(t.ec.bind(t)).catch(t.Oa.bind(t))}function Jo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,$o(t)}function $o(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Zo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=ta,this.v=this.P=!1}(t=zo.prototype).open=function(t,e){if(this.readyState!=Yo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,$o(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Oa.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Jo(this,!1)),this.readyState=Yo},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,$o(this)),this.a&&(this.readyState=3,$o(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Oa.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Xo(this)):t.text().then(this.ic.bind(this),this.Oa.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Jo(this,!0):$o(this),3==this.readyState&&Xo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Jo(this,!0))},t.hc=function(t){this.a&&(this.response=t,Jo(this,!0))},t.Oa=function(t){var e=this.h;e&&e.log(Vo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Jo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Vo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Vo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Zo,nn);var ta="";Zo.prototype.b=Qo("goog.net.XhrIo");var ea=/^https?$/i,na=["POST","PUT"];function ra(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.O=n,e.I=!1,e.c=!0,e.a=e.B?e.B.a():Eo.a(),e.w=e.B?ko(e.B):ko(Eo),e.a.onreadystatechange=_(e.Lb,e);try{Ho(e.b,fa(e,"Opening Xhr")),e.J=!0,e.a.open(n,String(t),!0),e.J=!1}catch(t){return Ho(e.b,fa(e,"Error opening Xhr: "+t.message)),void oa(e,t)}t=r||"";var o=new ln(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||h(t))x(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=ia,n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:h(t)?t.charAt(e):t[e]}(o.X()),r=l.FormData&&t instanceof l.FormData,!V(na,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.P&&(e.a.withCredentials=e.P);try{ca(e),0<e.g&&(e.v=function(t){return me&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(e.a),Ho(e.b,fa(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ia,e)):e.o=sn(e.Ia,e.g,e)),Ho(e.b,fa(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Ho(e.b,fa(e,"Send error: "+t.message)),oa(e,t)}}function ia(t){return"content-type"==t.toLowerCase()}function oa(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,aa(t),ua(t)}function aa(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function sa(e){if(e.c&&void 0!==u)if(e.w[1]&&4==ha(e)&&2==la(e))Ho(e.b,fa(e,"Local request error detected and ignored"));else if(e.i&&4==ha(e))sn(e.Lb,0,e);else if(e.dispatchEvent("readystatechange"),4==ha(e)){Ho(e.b,fa(e,"Request complete")),e.c=!1;try{var t,n=la(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(dn)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!ea.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<ha(e)?e.a.statusText:""}catch(t){Ho(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+la(e)+"]",aa(e)}}finally{ua(e)}}}function ua(e,t){if(e.a){ca(e);var n=e.a,r=e.w[0]?p:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Uo,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ca(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(l.clearTimeout(t.o),t.o=null)}function ha(t){return t.a?t.a.readyState:0}function la(t){try{return 2<ha(t)?t.a.status:-1}catch(t){return-1}}function fa(t,e){return e+" ["+t.O+" "+t.l+" "+la(t)+"]"}function pa(t){var e=Sa;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function da(t,e,n){t.a=!0,t.c=n,t.f=!e,va(t)}function ya(t){if(t.a){if(!t.u)throw new ba(t);t.u=!1}}function ma(t,e,n,r){t.g.push([e,n,r]),t.a&&va(t)}function ga(t){return U(t.g,function(t){return m(t[1])})}function va(e){if(e.h&&e.a&&ga(e)){var n=e.h,r=Ta[n];r&&(l.clearTimeout(r.a),delete Ta[n]),e.h=0}e.b&&(e.b.l--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.o,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,ga(e)||(r=!0)}}e.c=n,t&&(s=_(e.m,e,!0),t=_(e.m,e,!1),n instanceof pa?(ma(n,s,t),n.w=!0):n.then(s,t)),r&&(n=new _a(n),Ta[n.a]=n,e.h=n.a)}function ba(){C.call(this)}function wa(){C.call(this)}function _a(t){this.a=l.setTimeout(_(this.c,this),0),this.b=t}(t=Zo.prototype).Ia=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Ho(this.b,fa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Ho(this.b,fa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ua(this))},t.za=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ua(this,!0)),Zo.qb.za.call(this)},t.Lb=function(){this.va||(this.J||this.i||this.f?sa(this):this.yc())},t.yc=function(){sa(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ta:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Uo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Ho(this.b,"Can not get response: "+t.message),null}},pa.prototype.cancel=function(t){if(this.a)this.c instanceof pa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new wa(this),ya(this),da(this,!1,t))}},pa.prototype.m=function(t,e){this.i=!1,da(this,t,e)},pa.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return ma(this,r,function(t){t instanceof wa?o.cancel():i(t)}),o.then(t,e,n)},pa.prototype.$goog_Thenable=!0,S(ba,C),ba.prototype.message="Deferred has already fired",ba.prototype.name="AlreadyCalledError",S(wa,C),wa.prototype.message="Deferred was canceled",wa.prototype.name="CanceledError",_a.prototype.c=function(){throw delete Ta[this.a],this.b};var Ta={};function Ea(t){var e,n=document,r=et(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ia:void 0},a=new pa(o);return e=window.setTimeout(function(){Ia(i,!0);var t=new Aa(Na,"Timeout reached for loading script "+r);ya(a),da(a,!1,t)},5e3),o.Ia=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ia(i,!1,e),ya(a),da(a,!0,null))},i.onerror=function(){Ia(i,!0,e);var t=new Aa(Ca,"Error while loading script "+r);ya(a),da(a,!1,t)},z(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){M(t,"HTMLScriptElement"),t.src=et(e),null===f&&(f=(e=(e=l.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&s.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function Sa(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Ia(t,!0,this.Ia)}}function Ia(t,e,n){null!=n&&l.clearTimeout(n),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Ca=0,Na=1;function Aa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function ka(t){this.f=t}function Da(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Pa,this.g=H(t.secureTokenHeaders||Ma),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||La,this.a=H(t.firebaseHeaders||xa),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==ur(),!(n=l.XMLHttpRequest||n&&fl.INTERNAL.node&&fl.INTERNAL.node.XMLHttpRequest)&&!sr())throw new Yr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,sr()?this.f=new Go(self):cr()?this.f=new ka(n):this.f=new Oo,this.b=null}S(Aa,C),S(ka,Ao),ka.prototype.a=function(){return new this.f},ka.prototype.b=function(){return{}};var Ra,Oa="idToken",Pa=new Ar(3e4,6e4),Ma={"Content-Type":"application/x-www-form-urlencoded"},La=new Ar(3e4,6e4),xa={"Content-Type":"application/json"};function Fa(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ua(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function Va(t,e,n,r,i,o,a){(t=function(){var t=yr();return!((t=fr(t)!=lr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30)&&(!me||!Ie||9<Ie)}()||sr()?_(t.o,t):(Ra=Ra||new jt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[Ba]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){ma(t,null,e,void 0)}(Ea(nt(qa,{onload:Ba})),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)}),_(t.m,t)))(e,n,r,i,o,a)}Da.prototype.R=function(){return this.b},Da.prototype.o=function(t,n,e,r,i,o){if(sr()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Yr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Zo(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Ho(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),ra(a,t,e,r,i)};var qa=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Ba="__fcb"+Math.floor(1e6*Math.random()).toString();function ja(t){if(!h(t=t.email)||!rr.test(t))throw new Yr("invalid-email")}function Wa(t){"email"in t&&ja(t)}function Ka(t){if(!t[Oa])throw new Yr("internal-error")}function Qa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yr("internal-error")}else{if(!t.sessionInfo)throw new Yr("missing-verification-id");if(!t.code)throw new Yr("missing-verification-code")}}Da.prototype.m=function(t,n,r,i,o){var a=this;Ra.then(function(){window.gapi.client.setApiKey(a.c);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Da.prototype.ob=function(){return Ns(this,vs,{})},Da.prototype.rb=function(t,e){return Ns(this,ms,{idToken:t,email:e})},Da.prototype.sb=function(t,e){return Ns(this,gs,{idToken:t,password:e})};var Ha={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ga(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yr("internal-error")}function za(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Ln(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ya(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=No(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=No(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=No(t)):t.errorMessage&&(e=As(t.errorMessage)),e)throw e;if(!t[Oa])throw new Yr("internal-error")}function Xa(t,e){return e.returnIdpCredential=!0,Ns(t,bs,e)}function Ja(t,e){return e.returnIdpCredential=!0,Ns(t,_s,e)}function $a(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Ns(t,ws,e)}function Za(t){if(!t.oobCode)throw new Yr("invalid-action-code")}(t=Da.prototype).tb=function(t,r){var i={idToken:t},o=[];return K(Ha,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),Ns(this,ms,i)},t.kb=function(t,e){return z(t={requestType:"PASSWORD_RESET",email:t},e),Ns(this,ls,t)},t.lb=function(t,e){return z(t={requestType:"EMAIL_SIGNIN",email:t},e),Ns(this,cs,t)},t.jb=function(t,e){return z(t={requestType:"VERIFY_EMAIL",idToken:t},e),Ns(this,hs,t)},t.Wa=function(t){return Ns(this,Ss,t)},t.ab=function(t,e){return Ns(this,ds,{oobCode:t,newPassword:e})},t.Ma=function(t){return Ns(this,es,{oobCode:t})},t.Ya=function(t){return Ns(this,ts,{oobCode:t})};var ts={endpoint:"setAccountInfo",D:Za,fa:"email",F:!0},es={endpoint:"resetPassword",D:Za,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yr("internal-error")},F:!0},ns={endpoint:"signupNewUser",D:function(t){if(ja(t),!t.password)throw new Yr("weak-password")},K:Ka,T:!0,F:!0},rs={endpoint:"createAuthUri",F:!0},is={endpoint:"deleteAccount",V:["idToken"]},os={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new Yr("internal-error")}},as={endpoint:"emailLinkSignin",V:["email","oobCode"],D:ja,K:Ka,T:!0,F:!0},ss={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:ja,K:Ka,T:!0},us={endpoint:"getAccountInfo"},cs={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},hs={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yr("internal-error")},fa:"email",F:!0},ls={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},fs={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ps={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Yr("internal-error")}},ds={endpoint:"resetPassword",D:Za,fa:"email",F:!0},ys={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ms={endpoint:"setAccountInfo",V:["idToken"],D:Wa,T:!0},gs={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Wa(t),!t.password)throw new Yr("weak-password")},K:Ka,T:!0},vs={endpoint:"signupNewUser",K:Ka,T:!0,F:!0},bs={endpoint:"verifyAssertion",D:Ga,Ra:za,K:Ya,T:!0,F:!0},ws={endpoint:"verifyAssertion",D:Ga,Ra:za,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yr("user-not-found");if(t.errorMessage)throw As(t.errorMessage);if(!t[Oa])throw new Yr("internal-error")},T:!0,F:!0},_s={endpoint:"verifyAssertion",D:function(t){if(Ga(t),!t.idToken)throw new Yr("internal-error")},Ra:za,K:Ya,T:!0},Ts={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Yr("invalid-custom-token")},K:Ka,T:!0,F:!0},Es={endpoint:"verifyPassword",D:function(t){if(ja(t),!t.password)throw new Yr("wrong-password")},K:Ka,T:!0,F:!0},Ss={endpoint:"verifyPhoneNumber",D:Qa,K:Ka,F:!0},Is={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Yr("internal-error");Qa(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",No(t);Ka(t)}},Cs={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Qa,K:Ka,F:!0};function Ns(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Xt(new Yr("internal-error"));var r,i=e.Kb||"POST";return Yt(n).then(e.D).then(function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,r,i,o,n){var a=_n(t.h+e);bn(a,"key",t.c),n&&bn(a,"cb",E().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&bn(a,u,i[u]);return new jt(function(e,n){Va(t,a.toString(),function(t){t?t.error?n(ks(t,o||{})):e(t):n(new Yr("network-request-failed"))},r,s?void 0:Qn(Er(i)),t.a,t.i.get())})}(t,e.endpoint,i,n,e.Yb,e.wb||!1)}).then(function(t){return r=t,e.Ra?e.Ra(n,r):r}).then(e.K).then(function(){if(!e.fa)return r;if(!(e.fa in r))throw new Yr("internal-error");return r[e.fa]})}function As(t){return ks({error:{errors:[{message:t}],code:400,message:t}})}function ks(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Yr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",z(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Yr(r[i],e);return!e&&t&&(e=Tr(t)),new Yr("internal-error",e)}function Ds(t){this.b=t,this.a=null,this.gb=function(o){return(Ms=Ms||new jt(function(t,e){function n(){Nr(),mr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Nr(),e(Error("Network Error"))},timeout:Os.get()})}if(mr("gapi.iframes.Iframe"))t();else if(mr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){mr("gapi.load")?n():e(Error("Network Error"))},Yt(Ea(r=nt(Rs,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Ms=null,t})).then(function(){return new jt(function(r,i){mr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},Ps.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})})}(this)}var Rs=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Os=new Ar(3e4,6e4),Ps=new Ar(5e3,15e3),Ms=null;function Ls(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Tn(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function xs(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Fs(t){try{return fl.app(t).auth().Ca()}catch(t){return[]}}function Us(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Vs(t){var s=Jn();return function(t){return Ns(t,fs,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var e=_n(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?_n(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(nr.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new Io(Jn())})}function qs(i){return i.l||(i.l=ir().then(function(){if(!i.o){var t=i.c,e=i.h,n=Fs(i.b),r=new Ls(i.u,i.f,i.b);r.f=t,r.b=e,r.c=W(n||[]),i.o=r.toString()}i.i=new Ds(i.o),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then(function(){t.a.register("authEvent",e,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(r.i,function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=_o(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)})}(i)})),i.l}function Bs(t){return t.m||(t.v=t.c?dr(t.c,Fs(t.b)):null,t.m=new Da(t.f,Ni(t.h),t.v)),t.m}function js(t,e,n,r,i,o,a,s,u,c,h){return(t=new xs(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=H(u||null),t.f=c,t.nb(h).toString()}function Ws(t){if(this.a=t||fl.INTERNAL.reactNative&&fl.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ks(t){this.b=t,this.a={},this.f=_(this.c,this)}Ls.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):Mn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):Mn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):Mn(this.a.a,"fw"),this.a.toString()},xs.prototype.nb=function(t){return this.h=t,this},xs.prototype.toString=function(){var t=Tn(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.m),bn(t,"appName",this.c),bn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=fl.app(this.c).auth().ha()}catch(t){n=null}for(var r in e.bb=n,bn(t,"providerId",this.a.providerId),n=Er((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.bb&&!n[e.eb]&&(n[e.eb]=e.bb),Q(n)||bn(t,"customParameters",Tr(n))}if("function"==typeof this.a.Hb&&((e=this.a.Hb()).length&&bn(t,"scopes",e.join(","))),this.l?bn(t,"redirectUrl",this.l):Mn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):Mn(t.a,"eventId"),this.i?bn(t,"v",this.i):Mn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.h?bn(t,"tid",this.h):Mn(t.a,"tid"),this.f?bn(t,"eid",this.f):Mn(t.a,"eid"),(a=Fs(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Us.prototype).Fb=function(e,n,t){var r=new Yr("popup-closed-by-user"),i=new Yr("web-storage-unsupported"),o=this,a=!1;return this.ia().then(function(){(function(t){var e={type:"webStorageSupport"};return qs(t).then(function(){return function(e,n){return e.gb.then(function(){return new jt(function(t){e.a.send(n.type,n,t,mr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(t){t||(e&&tr(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(n){return new jt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()})}(e)}).then(function(){if(!a)return un(t).then(function(){n(r)})})},t.Ob=function(){var t=yr();return!_r(t)&&!Cr(t)},t.Jb=function(){return!1},t.Db=function(e,t,n,r,i,o,a,s){if(!e)return Xt(new Yr("popup-blocked"));if(a&&!_r())return this.ia().s(function(t){tr(e),i(t)}),r(),Yt();this.a||(this.a=Vs(Bs(this)));var u=this;return this.a.then(function(){var t=u.ia().s(function(t){throw tr(e),i(t),t});return r(),t}).then(function(){bo(n),a||$n(js(u.u,u.f,u.b,t,n,null,o,u.c,void 0,u.h,s),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},t.Eb=function(t,e,n,r){this.a||(this.a=Vs(Bs(this)));var i=this;return this.a.then(function(){bo(e),$n(js(i.u,i.f,i.b,t,e,Jn(),n,i.c,void 0,i.h,r))}).s(function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t})},t.ia=function(){var t=this;return qs(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new Yr("network-request-failed")})},t.Rb=function(){return!0},t.Aa=function(t){this.g.push(t)},t.Na=function(e){B(this.g,function(t){return t==e})},(t=Ws.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Sr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Tr(e)))},t.S=function(t){return Yt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Qs,Hs=[];function Gs(t,e,n){Q(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function zs(t){this.a=t}function Ys(t){this.c=t,this.b=!1,this.a=[]}function Xs(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Xt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Js(r,c),t}).s(function(t){throw Js(r,c),t})}function Js(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),B(t.a,function(t){return t==e})}}function $s(){if(!eu())throw new Yr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=l.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var r=this;sr()&&self?(this.l=function(){var e=sr()?self:null;if(x(Hs,function(t){t.b==e&&(n=t)}),!n){var n=new Ks(e);Hs.push(n)}return n}(),Gs(this.l,"keyChanged",function(t,n){return au(r).then(function(e){return 0<e.length&&x(r.a,function(t){t(e)}),{keyProcessed:V(e,n.key)}})}),Gs(this.l,"ping",function(){return Yt(["keyChanged"])})):function(){var t=l.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(t){(r.h=t)&&(r.g=new Ys(new zs(t)),Xs(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&V(t[0].value,"keyChanged")&&(r.o=!0)}).s(function(){}))})}function Zs(r){return new jt(function(e,n){var t=r.u.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):function(r){return new jt(function(t,e){var n=r.u.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})}(r).then(function(){return Zs(r)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function tu(t){return t.m||(t.m=Zs(t)),t.m}function eu(){try{return!!l.indexedDB}catch(t){return!1}}function nu(t){return t.objectStore("firebaseLocalStorage")}function ru(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function iu(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function ou(t,e){return t.g&&t.h&&function(){var t=l.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Xs(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):Yt()}function au(r){return tu(r).then(function(t){var i=nu(ru(t,!1));return i.getAll?iu(i.getAll()):new jt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function su(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function uu(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(eu()){var e=Ir(),n="__sak"+e;return Qs=Qs||new $s,(i=Qs).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.S(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.$(function(e){x(r.a,function(t){t(e)})}),t})}function cu(){this.a={},this.type="inMemory"}function hu(){if(!function(){var t="Node"==ur();if(!(t=lu()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The LocalStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=lu()||fl.INTERNAL.node.localStorage,this.type="localStorage"}function lu(){try{var t=l.localStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function fu(){this.type="nullStorage"}function pu(){if(!function(){var t="Node"==ur();if(!(t=du()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The SessionStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=du()||fl.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function du(){try{var t=l.sessionStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function yu(){var t={};t.Browser=vu,t.Node=bu,t.ReactNative=wu,t.Worker=_u,this.a=t[ur()]}Ks.prototype.c=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];x(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),$t(e).then(function(t){var e=[];x(t,function(t){e.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})}),x(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},zs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ys.prototype.close=function(){for(;0<this.a.length;)Js(this,this.a[0]);this.b=!0},(t=$s.prototype).set=function(n,r){var i,o=!1,a=this;return tu(this).then(function(t){return iu((t=nu(ru(i=t,!0))).get(n))}).then(function(t){var e=nu(ru(i,!0));return t?(t.value=r,iu(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,iu(e.add(t)))}).then(function(){return a.c[n]=r,ou(a,n)}).ka(function(){o&&a.b--})},t.get=function(e){return tu(this).then(function(t){return iu(nu(ru(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.S=function(e){var n=!1,r=this;return tu(this).then(function(t){return n=!0,r.b++,iu(nu(ru(t,!0)).delete(e))}).then(function(){return delete r.c[e],ou(r,e)}).ka(function(){n&&r.b--})},t.$=function(t){0==this.a.length&&function(t){su(t),function e(){t.f=setTimeout(function(){t.i=au(t).then(function(e){0<e.length&&x(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e}),0==this.a.length&&su(this)},(t=uu.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.S=function(e){return this.b.then(function(t){return t.S(e)})},t.$=function(t){this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e})},(t=cu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.S=function(t){return delete this.a[t],Yt()},t.$=function(){},t.ea=function(){},(t=hu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Tr(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(t){l.window&&Ke(l.window,"storage",t)},t.ea=function(t){l.window&&Ge(l.window,"storage",t)},(t=fu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.S=function(){return Yt()},t.$=function(){},t.ea=function(){},(t=pu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Tr(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(){},t.ea=function(){};var mu,gu,vu={C:hu,Ta:pu},bu={C:hu,Ta:pu},wu={C:Ws,Ta:fu},_u={C:hu,Ta:fu},Tu={ad:"local",NONE:"none",cd:"session"};function Eu(){var t=!(Cr(yr())||!ar()),e=_r(),n=gr();this.m=t,this.h=e,this.l=n,this.a={},t=mu=mu||new yu;try{this.g=!Xn()&&Rr()||!l.indexedDB?new t.a.C:new uu(sr()?new cu:new t.a.C)}catch(t){this.g=new cu,this.h=!0}try{this.i=new t.a.Ta}catch(t){this.i=new cu}this.u=new cu,this.f=_(this.Pb,this),this.b={}}function Su(){return gu=gu||new Eu}function Iu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Cu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Nu(t,e,n){return n=Cu(e,n),"local"==e.C&&(t.b[n]=null),Iu(t,e.C).S(n)}function Au(t){t.c&&(clearInterval(t.c),t.c=null)}function ku(t){this.a=t,this.b=Su()}(t=Eu.prototype).get=function(t,e){return Iu(this,t.C).get(Cu(t,e))},t.set=function(e,t,n){var r=Cu(e,n),i=this,o=Iu(this,e.C);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.C&&(i.b[r]=t)})},t.addListener=function(t,e,n){t=Cu(t,e),this.l&&(this.b[t]=l.localStorage.getItem(t)),Q(this.a)&&(Iu(this,"local").$(this.f),this.h||(Xn()||!Rr())&&l.indexedDB||!this.l||function(r){Au(r),r.c=setInterval(function(){for(var t in r.a){var e=l.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new Pe({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Pb(e))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Cu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),Q(this.a)&&(Iu(this,"local").ea(this.f),Au(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.$a(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Iu(this,"local").ea(this.f):Au(this),this.m)if(n=l.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?l.localStorage.setItem(e,r):l.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.$a(e))},me&&Ie&&10==Ie&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else x(t,_(this.$a,this))},t.$a=function(t){this.a[t]&&x(this.a[t],function(t){t()})};var Du,Ru={name:"authEvent",C:"local"};function Ou(){this.a=Su()}function Pu(t,e){this.b=Mu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=l.Int32Array?new Int32Array(64):Array(64),void 0!==Du||(Du=l.Int32Array?new Int32Array(Bu):Bu),this.reset()}S(Pu,function(){this.b=-1});for(var Mu=64,Lu=Mu-1,xu=[],Fu=0;Fu<Lu;Fu++)xu[Fu]=0;var Uu=j(128,xu);function Vu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Du[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function qu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(h(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Vu(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Vu(t),i=0)}}t.c=i,t.g+=n}Pu.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):W(this.h)};var Bu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function ju(){Pu.call(this,8,Wu)}S(ju,Pu);var Wu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Ku(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Ou,this.g=new ku(this.h),this.f=null,this.b=[],this.a=this.c=null}function Qu(t){return new Yr("invalid-cordova-configuration",t)}function Hu(t){var e=new ju;qu(e,t),t=[];var n=8*e.g;e.c<56?qu(e,Uu,56-e.c):qu(e,Uu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Vu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return F(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Gu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function zu(r){return r.f||(r.f=r.ia().then(function(){return new jt(function(n){r.Aa(function t(e){return n(e),r.Na(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Yu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Bi(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=Sr(wn(n=_n(e),"firebaseError")||null))?Xr(n):null)?new wo(t.c,t.b,null,null,n,null,t.R()):new wo(t.c,t.b,e,t.f,null,null,t.R())),e=n||o}Gu(i,e)})}var o=new wo("unknown",null,null,null,new Yr("no-auth-event")),t=!1,n=un(500).then(function(){return Yu(i).then(function(){t||Gu(i,o)})}),r=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(mr("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},So=So||new To,function(t){var n=So;n.a.push(t),n.b||(n.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=mr("universalLinks.subscribe",l))&&t(null,n.b))}(e)}(r)})})),r.f}function Yu(e){var n=null;return function(t){return t.b.get(Ru,t.a).then(function(t){return _o(t)})}(e.g).then(function(t){return n=t,Nu((t=e.g).b,Ru,t.a)}).then(function(){return n})}function Xu(t){this.a=t,this.b=Su()}(t=Ku.prototype).ia=function(){return this.Da?this.Da:this.Da=(or(void 0)?ir().then(function(){return new jt(function(t,e){var n=l.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof mr("universalLinks.subscribe",l))throw Qu("cordova-universal-links-plugin-fix is not installed");if(void 0===mr("BuildInfo.packageName",l))throw Qu("cordova-plugin-buildinfo is not installed");if("function"!=typeof mr("cordova.plugins.browsertab.openUrl",l))throw Qu("cordova-plugin-browsertab is not installed");if("function"!=typeof mr("cordova.InAppBrowser.open",l))throw Qu("cordova-plugin-inappbrowser is not installed")},function(){throw new Yr("cordova-not-ready")})},t.Fb=function(t,e){return e(new Yr("operation-not-supported-in-this-environment")),Yt()},t.Db=function(){return Xt(new Yr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Xt(new Yr("redirect-operation-pending"));var i=this,o=l.document,a=null,s=null,u=null,c=null;return this.c=Yt().then(function(){return bo(e),zu(i)}).then(function(){return function(n,t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new wo(t,r,null,o,new Yr("no-auth-event"),null,i),s=mr("BuildInfo.packageName",l);if("string"!=typeof s)throw new Yr("invalid-cordova-configuration");var u=mr("BuildInfo.displayName",l),c={};if(yr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!yr().toLowerCase().match(/android/))return Xt(new Yr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),o=Hu(o),c.sessionId=o;var h=js(n.u,n.i,n.l,t,e,null,r,n.m,c,n.o,i);return n.ia().then(function(){var t=n.h;return n.v.a.set(Ru,a.A(),t)}).then(function(){var t=mr("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Yr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=mr("cordova.plugins.browsertab.openUrl",l)))throw new Yr("invalid-cordova-configuration");e(h)}else{if("function"!=typeof(e=mr("cordova.InAppBrowser.open",l)))throw new Yr("invalid-cordova-configuration");t=yr(),n.a=e(h,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(i,t,e,n,r)}).then(function(){return new jt(function(e,t){s=function(){var t=mr("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Aa(s),u=function(){a=a||un(2e3).then(function(){t(new Yr("redirect-cancelled-by-user"))})},c=function(){kr()&&u()},o.addEventListener("resume",u,!1),yr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Yu(i).then(function(){throw t})})}).ka(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),a&&a.cancel(),s&&i.Na(s),i.c=null})},t.Aa=function(e){this.b.push(e),zu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new wo("unknown",null,null,null,new Yr("no-auth-event")),e(t))})},t.Na=function(e){B(this.b,function(t){return t==e})};var Ju={name:"pendingRedirect",C:"session"};function $u(t){return Nu(t.b,Ju,t.a)}function Zu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=_(this.o,this),this.b=new pc,this.w=new vc,this.g=new Xu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=tc(this.B,this.u,this.m,Ii)}function tc(t,e,n,r){var i=fl.SDK_VERSION||null;return or()?new Ku(t,e,n,i,r):new Us(t,e,n,i,r)}function ec(e){e.f||(e.f=!0,e.a.Aa(e.l));var n=e.a;return e.a.ia().s(function(t){throw e.a==n&&e.reset(),t})}function nc(n){n.a.Ob()&&ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)}),n.a.Jb()||dc(n.b)}function rc(n,t){V(n.h,t)||n.h.push(t),n.f||function(t){return t.b.get(Ju,t.a).then(function(t){return"pending"==t})}(n.g).then(function(t){t?$u(n.g).then(function(){ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)})}):nc(n)}).s(function(){nc(n)})}function ic(t,e){B(t.h,function(t){return t==e})}Zu.prototype.reset=function(){this.f=!1,this.a.Na(this.l),this.a=tc(this.B,this.u,this.m),this.i={}},Zu.prototype.o=function(t){if(!t)throw new Yr("invalid-auth-event");if(6e5<=E()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=E())),e=!0;break}}return dc(this.b),e};var oc=new Ar(2e3,1e4),ac=new Ar(3e4,6e4);function sc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.Aa(t.l))},function(){t.reset()},i,o,a)}function uc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function cc(e,t,n,r,i){var o;return function(t){return t.b.set(Ju,"pending",t.a)}(e.g).then(function(){return e.a.Eb(t,n,r,i).s(function(t){if(uc(t))throw new Yr("operation-not-supported-in-this-environment");return o=t,$u(e.g).then(function(){throw o})}).then(function(){return e.a.Rb()?new jt(function(){}):$u(e.g).then(function(){return e.oa()}).then(function(){}).s(function(){})})})}function hc(t,e,n,r,i){return t.a.Fb(r,function(t){e.ja(n,null,t,i)},oc.get())}Zu.prototype.oa=function(){return this.b.oa()};var lc={};function fc(t,e,n){var r=e+":"+n;return lc[r]||(lc[r]=new Zu(t,e,n)),lc[r]}function pc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function dc(t){t.g||(t.g=!0,gc(t,!1,null,null))}function yc(t){t.g&&!t.i&&gc(t,!1,null,null)}function mc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function gc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):mc(t,n):mc(t,{user:null}),t.f=[],t.c=[]}function vc(){}function bc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function wc(t,e){this.a=e,xr(this,"verificationId",t)}function _c(t,e,n,r){return new mo(t).Wa(e,n).then(function(t){return new wc(t,r)})}function Tc(t){var e=Si(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Dr(1e3*e.exp),authTime:Dr(1e3*e.auth_time),issuedAtTime:Dr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Ec(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Sc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function Ic(t){this.f=t,this.b=this.a=null,this.c=0}function Cc(t,e){var n=e[Oa],r=e.refreshToken;e=Nc(e.expiresIn),t.b=n,t.c=e,t.a=r}function Nc(t){return E()+1e3*parseInt(t,10)}function Ac(e,t){return function(t,r){return new jt(function(e,n){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?Va(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?n(ks(t)):t.access_token&&t.refresh_token?e(t):n(new Yr("internal-error")):n(new Yr("network-request-failed"))},"POST",Pn(r).toString(),t.g,t.u.get()):n(new Yr("internal-error"))})}(e.f,t).then(function(t){return e.b=t.access_token,e.c=Nc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t})}function kc(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Dr(e||null),creationTime:Dr(t||null)})}function Dc(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Rc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function Oc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.a=new Da(this.l,Ni(Ii),t),this.b=new Ic(this.a),Vc(this,e[Oa]),Cc(this.b,e),xr(this,"refreshToken",this.b.a),jc(this,n||{}),nn.call(this),this.J=!1,this.o&&vr()&&(this.i=fc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(e){return new Ec(function(){return e.G(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=e.b.c-E()-3e5;return 0<t?t:0})}(this),this.W=_(this.Ja,this);var r=this;this.ga=null,this.xa=function(t){r.ua(t.g)},this.Z=null,this.P=[],this.wa=function(t){Mc(r,t.c)},this.Y=null}function Pc(t,e){t.Z&&Ge(t.Z,"languageCodeChanged",t.xa),(t.Z=e)&&Ke(e,"languageCodeChanged",t.xa)}function Mc(t,e){t.P=e,Ua(t.a,fl.SDK_VERSION?dr(fl.SDK_VERSION,t.P):null)}function Lc(t,e){t.Y&&Ge(t.Y,"frameworkChanged",t.wa),(t.Y=e)&&Ke(e,"frameworkChanged",t.wa)}function xc(e){try{return fl.app(e.m).auth()}catch(t){throw new Yr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Fc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.W),Ke(t,"tokenChanged",t.W))}function Uc(t){Ge(t,"tokenChanged",t.W),t.w.stop()}function Vc(t,e){t.ma=e,xr(t,"_lat",e)}function qc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return $t(e).then(function(){return t})}function Bc(t){t.i&&!t.J&&(t.J=!0,rc(t.i,t))}function jc(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new kc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Wc(){}function Kc(t){return Yt().then(function(){if(t.B)throw new Yr("app-deleted")})}function Qc(t){return F(t.providerData,function(t){return t.providerId})}function Hc(t,e){e&&(Gc(t,e.providerId),t.providerData.push(e))}function Gc(t,e){B(t.providerData,function(t){return t.providerId==e})}function zc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&xr(t,e,n)}function Yc(e,t){e!=t&&(Fr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?xr(e,"metadata",function(t){return new kc(t.a,t.b)}(t.metadata)):xr(e,"metadata",new kc),x(t.providerData,function(t){Hc(e,t)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(e.b,t.b),xr(e,"refreshToken",e.b.a))}function Xc(n){return n.G().then(function(t){var e=n.isAnonymous;return function(t,e){return Ns(t.a,us,{idToken:e}).then(_(t.zc,t))}(n,t).then(function(){return e||zc(n,"isAnonymous",!1),t})})}function Jc(t,e){e[Oa]&&t.ma!=e[Oa]&&(Cc(t.b,e),t.dispatchEvent(new Rc("tokenChanged")),Vc(t,e[Oa]),zc(t,"refreshToken",t.b.a))}function $c(t,e){return Xc(t).then(function(){if(V(Qc(t),e))return qc(t).then(function(){throw new Yr("provider-already-linked")})})}function Zc(t,e,n){return Ur({user:t,credential:vo(e),additionalUserInfo:e=Oi(e),operationType:n})}function th(t,e){return Jc(t,e),t.reload().then(function(){return t})}function eh(n,r,t,e,i){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(n.h&&!i)return Xt(n.h);var o=Ri(t.providerId),a=Ir(n.uid+":::"),s=null;(!_r()||ar())&&n.o&&t.isOAuthProvider&&(s=js(n.o,n.l,n.m,r,t,null,a,fl.SDK_VERSION||null,null,null,n.tenantId));var u=er(s,o&&o.sa,o&&o.ra);return e=e().then(function(){if(rh(n),!i)return n.G().then(function(){})}).then(function(){return sc(n.i,u,r,t,a,!!s,n.tenantId)}).then(function(){return new jt(function(t,e){n.ja(r,null,new Yr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.c=hc(n.i,n,r,u,a)})}).then(function(t){return u&&tr(u),t?Ur(t):null}).s(function(t){throw u&&tr(u),t}),ih(n,e,i)}function nh(e,t,n,r,i){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(e.h&&!i)return Xt(e.h);var o=null,a=Ir(e.uid+":::");return r=r().then(function(){if(rh(e),!i)return e.G().then(function(){})}).then(function(){return e.ca=a,qc(e)}).then(function(t){return e.da&&(t=(t=e.da).b.set(sh,e.A(),t.a)),t}).then(function(){return cc(e.i,t,n,a,e.tenantId)}).s(function(t){if(o=t,e.da)return uh(e.da);throw o}).then(function(){if(o)throw o}),ih(e,r,i)}function rh(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Yr("internal-error");throw new Yr("auth-domain-config-required")}}function ih(t,e,n){var r=function(e,t,n){return e.h&&!n?(t.cancel(),Xt(e.h)):t.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new Rc("userInvalidated")),e.h=t),t})}(t,e,n);return t.I.push(r),r.ka(function(){q(t.I,r)}),r}function oh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Oa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-E())/1e3;var r=new Oc(e,n,t);return t.providerData&&x(t.providerData,function(t){t&&Hc(r,Ur(t))}),t.redirectEventId&&(r.ca=t.redirectEventId),r}function ah(t){this.a=t,this.b=Su()}pc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},pc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(gc(this,!0,null,t.a),Yt()):e.Ba(n,r)?function(e,t,n){n=n.Ba(t.c,t.b);var r=t.g,i=t.f,o=t.i,a=t.R(),s=!!t.c.match(/Redirect$/);n(r,i,a,o).then(function(t){gc(e,s,t,null)}).s(function(t){gc(e,s,null,t)})}(this,t,e):Xt(new Yr("invalid-auth-event")):(gc(this,!1,null,null),Yt())}else Xt(new Yr("invalid-auth-event"))},pc.prototype.oa=function(){var n=this;return new jt(function(t,e){n.b?n.b().then(t,e):(n.f.push(t),n.c.push(e),function(t){var e=new Yr("timeout");t.a&&t.a.cancel(),t.a=un(ac.get()).then(function(){t.b||(t.g=!0,gc(t,!0,null,e))})}(n))})},vc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Yt()):e.Ba(n,r)?function(t,e){var n=t.b,r=t.c;e.Ba(r,n)(t.g,t.f,t.R(),t.i).then(function(t){e.ja(r,t,null,n)}).s(function(t){e.ja(r,null,t,n)})}(t,e):Xt(new Yr("invalid-auth-event"))}else Xt(new Yr("invalid-auth-event"))},wc.prototype.confirm=function(t){return t=go(this.verificationId,t),this.a(t)},Ec.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(Sc(n,t)).then(function(){return e=l.document,n=null,kr()||!e?Yt():new jt(function(t){n=function(){kr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},Ec.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Ic.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Ic.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new Yr("user-token-expired")):t||!this.b||E()>this.c-3e4?this.a?Ac(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},kc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(Rc,Oe),S(Oc,nn),Oc.prototype.ua=function(t){this.ga=t,Fa(this.a,t)},Oc.prototype.ha=function(){return this.ga},Oc.prototype.Ca=function(){return W(this.P)},Oc.prototype.Ja=function(){this.w.b&&(this.w.stop(),this.w.start())},xr(Oc.prototype,"providerId","firebase"),(t=Oc.prototype).reload=function(){var t=this;return ih(this,Kc(this).then(function(){return Xc(t).then(function(){return qc(t)}).then(Wc)}))},t.dc=function(t){return this.G(t).then(function(t){return new Tc(t)})},t.G=function(t){var e=this;return ih(this,Kc(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new Yr("internal-error");return t.accessToken!=e.ma&&(Vc(e,t.accessToken),e.dispatchEvent(new Rc("tokenChanged"))),zc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Yr("internal-error");jc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?F(t,function(t){return new Dc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Hc(this,e[n]);zc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Mr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return ih(this,t.f(this.a,this.uid).then(function(t){return Jc(e,t),n=Zc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.rc=function(t){return Mr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(e){var n=this,r=null;return ih(this,$c(this,e.providerId).then(function(){return n.G()}).then(function(t){return e.b(n.a,t)}).then(function(t){return r=Zc(n,t,"link"),th(n,t)}).then(function(){return r}))},t.sc=function(t,e){var n=this;return ih(this,$c(this,"phone").then(function(){return _c(xc(n),t,e,_(n.fb,n))}))},t.Bc=function(t,e){var n=this;return ih(this,Yt().then(function(){return _c(xc(n),t,e,_(n.hb,n))}),!0)},t.rb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.rb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.Sc=function(e){var n=this;return ih(this,this.G().then(function(t){return e.b(n.a,t)}).then(function(t){return Jc(n,t),n.reload()}))},t.sb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.sb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.tb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Kc(this);var n=this;return ih(this,this.G().then(function(t){return n.a.tb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Jc(n,t),zc(n,"displayName",t.displayName||null),zc(n,"photoURL",t.photoUrl||null),x(n.providerData,function(t){"password"===t.providerId&&(xr(t,"displayName",n.displayName),xr(t,"photoURL",n.photoURL))}),qc(n)}).then(Wc))},t.Qc=function(e){var n=this;return ih(this,Xc(this).then(function(t){return V(Qc(n),e)?function(t,e,n){return Ns(t,os,{idToken:e,deleteProvider:n})}(n.a,t,[e]).then(function(t){var e={};return x(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),x(Qc(n),function(t){e[t]||Gc(n,t)}),e[mo.PROVIDER_ID]||xr(n,"phoneNumber",null),qc(n)}):qc(n).then(function(){throw new Yr("no-such-provider")})}))},t.delete=function(){var e=this;return ih(this,this.G().then(function(t){return Ns(e.a,is,{idToken:t})}).then(function(){e.dispatchEvent(new Rc("userDeleted"))})).then(function(){for(var t=0;t<e.I.length;t++)e.I[t].cancel("app-deleted");Pc(e,null),Lc(e,null),e.I=[],e.B=!0,Uc(e),xr(e,"refreshToken",null),e.i&&ic(e.i,e)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?_(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?_(this.Cb,this):null},t.tc=function(t){var e=this;return eh(this,"linkViaPopup",t,function(){return $c(e,t.providerId).then(function(){return qc(e)})},!1)},t.Cc=function(t){return eh(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.uc=function(t){var e=this;return nh(this,"linkViaRedirect",t,function(){return $c(e,t.providerId)},!1)},t.Dc=function(t){return nh(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.Bb=function(e,n,t,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return t=this.G().then(function(t){return Ja(i.a,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=Zc(i,t,"link"),th(i,t)}).then(function(){return o}),ih(this,t)},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return ih(this,Yt().then(function(){return Wi($a(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)}).then(function(t){return o=Zc(i,t,"reauthenticate"),Jc(i,t),i.h=null,i.reload()}).then(function(){return o}),!0)},t.jb=function(e){var n=this,r=null;return ih(this,this.G().then(function(t){return r=t,void 0===e||Q(e)?{}:vi(new ui(e))}).then(function(t){return n.a.jb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&z(e,this.metadata.A()),x(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var sh={name:"redirectUser",C:"session"};function uh(t){return Nu(t.b,sh,t.a)}function ch(t){this.a=t,this.b=Su(),this.c=null,this.f=function(e){var n=fh("local"),r=fh("session"),i=fh("none");return function(n,r,i){var o=Cu(r,i),a=Iu(n,r.C);return n.get(r,i).then(function(t){var e=null;try{e=Sr(l.localStorage.getItem(o))}catch(t){}if(e&&!t)return l.localStorage.removeItem(o),n.set(r,e,i);e&&t&&"localStorage"!=a.type&&l.localStorage.removeItem(o)})}(e.b,n,e.a).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(lh,e.a).then(function(t){return t?fh(t):n})})})}).then(function(t){return e.c=t,hh(e,t.C)}).s(function(){e.c||(e.c=n)})}(this),this.b.addListener(fh("local"),this.a,_(this.g,this))}function hh(t,e){var n,r=[];for(n in Tu)Tu[n]!==e&&r.push(Nu(t.b,fh(Tu[n]),t.a));return r.push(Nu(t.b,lh,t.a)),function(s){return new jt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Jt(s[a],T(t,a),o);else n(i)})}(r)}ch.prototype.g=function(){var e=this,n=fh("local");mh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.C?e.b.get(n,e.a):null}).then(function(t){if(t)return hh(e,"local").then(function(){e.c=n})})})};var lh={name:"persistence",C:"session"};function fh(t){return{name:"authUser",C:t}}function ph(t,e){return mh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function dh(t){return mh(t,function(){return Nu(t.b,t.c,t.a)})}function yh(t,e){return mh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})})}function mh(t,e){return t.f=t.f.then(e,e),t.f}function gh(t){if(this.l=!1,xr(this,"settings",new bc),xr(this,"app",t),!Ih(this).options||!Ih(this).options.apiKey)throw new Yr("invalid-api-key");t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.b=new Da(Ih(this).options&&Ih(this).options.apiKey,Ni(Ii),t),this.O=[],this.m=[],this.J=[],this.Ub=fl.INTERNAL.createSubscribe(_(this.oc,this)),this.W=void 0,this.Vb=fl.INTERNAL.createSubscribe(_(this.pc,this)),Eh(this,null),this.h=new ch(Ih(this).options.apiKey+":"+Ih(this).name),this.w=new ah(Ih(this).options.apiKey+":"+Ih(this).name),this.Y=kh(this,function(n){var t=Ih(n).options.authDomain,e=function(e){var t=function(t,e){return t.b.get(sh,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})}(e.w,Ih(e).options.authDomain).then(function(t){return(e.B=t)&&(t.da=e.w),uh(e.w)});return kh(e,t)}(n).then(function(){return yh(n.h,t)}).then(function(e){return e?(e.da=n.w,n.B&&(n.B.ca||null)==(e.ca||null)?e:e.reload().then(function(){return ph(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:dh(n.h)})):null}).then(function(t){Eh(n,t||null)});return kh(n,e)}(this)),this.i=kh(this,function(e){return e.Y.then(function(){return _h(e)}).s(function(){}).then(function(){if(!e.l)return e.ma()}).s(function(){}).then(function(){if(!e.l){e.ga=!0;var t=e.h;t.b.addListener(fh("local"),t.a,e.ma)}})}(this)),this.ga=!1,this.ma=_(this.Nc,this),this.ub=_(this.aa,this),this.wa=_(this.bc,this),this.xa=_(this.mc,this),this.Ja=_(this.nc,this),this.a=null,function(e){var n=Ih(e).options.authDomain,r=Ih(e).options.apiKey;n&&vr()&&(e.Tb=e.Y.then(function(){if(!e.l){if(e.a=fc(n,r,Ih(e).name),rc(e.a,e),Ch(e)&&Bc(Ch(e)),e.B){Bc(e.B);var t=e.B;t.ua(e.ha()),Pc(t,e),Mc(t=e.B,e.I),Lc(t,e),e.B=null}return e.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.vc,this),this.o=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.ua(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function vh(t){Oe.call(this,"languageCodeChanged"),this.g=t}function bh(t){Oe.call(this,"frameworkChanged"),this.c=t}function wh(t){return t.Tb||Xt(new Yr("auth-domain-config-required"))}function _h(t){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=wh(t).then(function(){return t.a.oa()}).then(function(t){return t?Ur(t):null});return kh(t,e)}function Th(e,t){var n={};return n.apiKey=Ih(e).options.apiKey,n.authDomain=Ih(e).options.authDomain,n.appName=Ih(e).name,e.Y.then(function(){return function(t,e,n,r){var i=new Oc(t,e);return n&&(i.da=n),r&&Mc(i,r),i.reload().then(function(){return i})}(n,t,e.w,e.Ca())}).then(function(t){return Ch(e)&&t.uid==Ch(e).uid?Yc(Ch(e),t):(Eh(e,t),Bc(t)),e.aa(t)}).then(function(){Ah(e)})}function Eh(t,e){Ch(t)&&(function(t,e){B(t.O,function(t){return t==e})}(Ch(t),t.ub),Ge(Ch(t),"tokenChanged",t.wa),Ge(Ch(t),"userDeleted",t.xa),Ge(Ch(t),"userInvalidated",t.Ja),Uc(Ch(t))),e&&(e.O.push(t.ub),Ke(e,"tokenChanged",t.wa),Ke(e,"userDeleted",t.xa),Ke(e,"userInvalidated",t.Ja),0<t.o&&Fc(e)),xr(t,"currentUser",e),e&&(e.ua(t.ha()),Pc(e,t),Mc(e,t.I),Lc(e,t))}function Sh(e,t){var n=null,r=null;return kh(e,t.then(function(t){return n=vo(t),r=Oi(t),Th(e,t)}).then(function(){return Ur({user:Ch(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Ih(t){return t.app}function Ch(t){return t.currentUser}function Nh(t){return Ch(t)&&Ch(t)._lat||null}function Ah(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Nh(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Nh(t))}}function kh(t,e){return t.O.push(e),e.ka(function(){q(t.O,e)}),e}function Dh(){}function Rh(){this.a={},this.b=1e12}ch.prototype.mb=function(e){var n=null,r=this;return function(t){var e=new Yr("invalid-persistence-type"),n=new Yr("unsupported-persistence-type");t:{for(r in Tu)if(Tu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ur()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!gr()&&"none"!==t)throw n}}(e),mh(this,function(){return e!=r.c.C?r.b.get(r.c,r.a).then(function(t){return n=t,hh(r,e)}).then(function(){if(r.c=fh(e),n)return r.b.set(r.c,n,r.a)}):Yt()})},S(gh,nn),S(vh,Oe),S(bh,Oe),(t=gh.prototype).mb=function(t){return t=this.h.mb(t),kh(this,t)},t.ua=function(t){this.Z===t||this.l||(this.Z=t,Fa(this.b,this.Z),this.dispatchEvent(new vh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=l.navigator;this.ua(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Ua(this.b,fl.SDK_VERSION?dr(fl.SDK_VERSION,this.I):null),this.dispatchEvent(new bh(this.I))},t.Ca=function(){return W(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:Ih(this).options.apiKey,authDomain:Ih(this).options.authDomain,appName:Ih(this).name,currentUser:Ch(this)&&Ch(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Xa(i.b,t).then(function(t){return o=vo(t),a=Oi(t),t});return kh(this,t=i.Y.then(function(){return s}).then(function(t){return Th(i,t)}).then(function(){return Ur({user:Ch(i),credential:o,additionalUserInfo:a,operationType:"signIn"})}))},t.Lc=function(e){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var n=this,t=Ri(e.providerId),r=Ir(),i=null;(!_r()||ar())&&Ih(this).options.authDomain&&e.isOAuthProvider&&(i=js(Ih(this).options.authDomain,Ih(this).options.apiKey,Ih(this).name,"signInViaPopup",e,null,r,fl.SDK_VERSION||null,null,null,this.R()));var o=er(i,t&&t.sa,t&&t.ra);return kh(this,t=wh(this).then(function(t){return sc(t,o,"signInViaPopup",e,r,!!i,n.R())}).then(function(){return new jt(function(t,e){n.ja("signInViaPopup",null,new Yr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.c=hc(n.a,n,"signInViaPopup",o,r)})}).then(function(t){return o&&tr(o),t?Ur(t):null}).s(function(t){throw o&&tr(o),t}))},t.Mc=function(t){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=this;return kh(this,wh(this).then(function(){return function(t){return mh(t,function(){return t.b.set(lh,t.c.C,t.a)})}(e.h)}).then(function(){return cc(e.a,"signInViaRedirect",t,void 0,e.R())}))},t.oa=function(){var e=this;return _h(this).then(function(t){return e.a&&yc(e.a.b),t}).s(function(t){throw e.a&&yc(e.a.b),t})},t.Rc=function(t){if(!t)return Xt(new Yr("null-user"));if(this.P!=t.tenantId)return Xt(new Yr("tenant-id-mismatch"));var e=this,n={};n.apiKey=Ih(this).options.apiKey,n.authDomain=Ih(this).options.authDomain,n.appName=Ih(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Oa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-E())/1e3,e=new Oc(e,o),n&&(e.da=n),r&&Mc(e,r),Yc(e,t),e}(t,n,e.w,e.Ca());return kh(this,this.i.then(function(){if(Ih(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Ch(e)&&t.uid==Ch(e).uid?(Yc(Ch(e),t),e.aa(t)):(Eh(e,r),Bc(r),e.aa(r))}).then(function(){Ah(e)}))},t.pb=function(){var t=this,e=this.i.then(function(){return t.a&&yc(t.a.b),Ch(t)?(Eh(t,null),dh(t.h).then(function(){Ah(t)})):Yt()});return kh(this,e)},t.Nc=function(){var r=this;return yh(this.h,Ih(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=Ch(r)&&t){e=Ch(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Yc(Ch(r),t),Ch(r).G();(Ch(r)||t)&&(Eh(r,t),t&&(Bc(t),t.da=r.w),r.a&&rc(r.a,r),Ah(r))}})},t.aa=function(t){return ph(this.h,t)},t.bc=function(){Ah(this),this.aa(Ch(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Ch(e))})},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),kh(t,t.i.then(function(){!t.l&&V(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Nh(t)))}))}(this,function(){t.next(Ch(e))})},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){m(t)?t(Ch(r)):m(t.next)&&t.next(Ch(r))}),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){r.W=r.getUid(),m(t)?t(Ch(r)):m(t.next)&&t.next(Ch(r))}),this.Vb(t,e,n)},t.cc=function(t){var e=this,n=this.i.then(function(){return Ch(e)?Ch(e).G(t).then(function(t){return{accessToken:t}}):null});return kh(this,n)},t.Hc=function(t){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Ts,{token:t}))}).then(function(t){var e=t.user;return zc(e,"isAnonymous",!1),n.aa(e),t})},t.Ic=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Es,{email:t,password:e}))})},t.Xb=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,ns,{email:t,password:e}))})},t.Sa=function(t){var e=this;return this.i.then(function(){return Sh(e,t.na(e.b))})},t.Gc=function(t){return Mr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Sa(t)},t.ob=function(){var n=this;return this.i.then(function(){var t=Ch(n);return t&&t.isAnonymous?Ur({user:t,credential:null,additionalUserInfo:Ur({providerId:null,isNewUser:!1}),operationType:"signIn"}):Sh(n,n.b.ob()).then(function(t){var e=t.user;return zc(e,"isAnonymous",!0),n.aa(e),t})})},t.getUid=function(){return Ch(this)&&Ch(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Ch(this)&&Fc(Ch(this))},t.Ec=function(e){var n=this;x(this.m,function(t){t==e&&n.o--}),this.o<0&&(this.o=0),0==this.o&&Ch(this)&&Uc(Ch(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),kh(this,this.i.then(function(){e.l||V(e.m,t)&&t(Nh(e))}))},t.removeAuthTokenListener=function(e){B(this.m,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(fh("local"),t.a,this.ma),this.a&&(ic(this.a,this),yc(this.a.b)),Promise.resolve()},t.$b=function(t){return kh(this,function(t,e){return Ns(t,rs,{identifier:e,continueUri:br()?Jn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!lo(t)},t.lb=function(e,n){var r=this;return kh(this,Yt().then(function(){var t=new ui(n);if(!t.c)throw new Yr("argument-error",li+" must be true when sending sign in link to email");return vi(t)}).then(function(t){return r.b.lb(e,t)}).then(function(){}))},t.Uc=function(t){return this.Ma(t).then(function(t){return t.data.email})},t.ab=function(t,e){return kh(this,this.b.ab(t,e).then(function(){}))},t.Ma=function(t){return kh(this,this.b.Ma(t).then(function(t){return new qr(t)}))},t.Ya=function(t){return kh(this,this.b.Ya(t).then(function(){}))},t.kb=function(e,t){var n=this;return kh(this,Yt().then(function(){return void 0===t||Q(t)?{}:vi(new ui(t))}).then(function(t){return n.b.kb(e,t)}).then(function(){}))},t.Kc=function(t,e){return kh(this,_c(this,t,e,_(this.Sa,this)))},t.Jc=function(n,r){var i=this;return kh(this,Yt().then(function(){var t=r||Jn(),e=ho(n,t);if(!(t=lo(t)))throw new Yr("argument-error","Invalid email link!");if(t.tenantId!==i.R())throw new Yr("tenant-id-mismatch");return i.Sa(e)}))},Dh.prototype.render=function(){},Dh.prototype.reset=function(){},Dh.prototype.getResponse=function(){},Dh.prototype.execute=function(){};var Oh=null;function Ph(t,e){return(e=Mh(e))&&t.a[e]||null}function Mh(t){return(t=void 0===t?1e12:t)?t.toString():null}function Lh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=qn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ke(this.f,"click",this.i)}function xh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Fh(){}Rh.prototype.render=function(t,e){return this.a[this.b.toString()]=new Lh(t,e),this.b++},Rh.prototype.reset=function(t){var e=Ph(this,t);t=Mh(t),e&&t&&(e.delete(),delete this.a[t])},Rh.prototype.getResponse=function(t){return(t=Ph(this,t))?t.getResponse():null},Rh.prototype.execute=function(t){(t=Ph(this,t))&&t.execute()},Lh.prototype.getResponse=function(){return xh(this),this.b},Lh.prototype.execute=function(){xh(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},Lh.prototype.delete=function(){xh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Fh.prototype.g=function(){return Yt(Oh=Oh||new Rh)},Fh.prototype.c=function(){};var Uh=null;function Vh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var qh=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Bh=new Ar(3e4,6e4);Vh.prototype.g=function(i){var o=this;return new jt(function(t,e){var r=setTimeout(function(){e(new Yr("network-request-failed"))},Bh.get());!l.grecaptcha||i!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=i;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(l.grecaptcha)}else clearTimeout(r),e(new Yr("internal-error"));delete l[o.a]},Yt(Ea(nt(qh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Yr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(l.grecaptcha))})},Vh.prototype.c=function(){this.b--};var jh=null;function Wh(t,e,n,r,i,o,a){if(xr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,a=a?Uh=Uh||new Fh:jh=jh||new Vh,this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Hh])throw new Yr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Gh],!l.document)throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!qn(e)||!this.i&&qn(e).hasChildNodes())throw new Yr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Da(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.l=[];var u=this.a[Kh];this.a[Kh]=function(t){if(zh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=mr(u,l);"function"==typeof e&&e(t)}};var c=this.a[Qh];this.a[Qh]=function(){if(zh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=mr(c,l);"function"==typeof t&&t()}}}var Kh="callback",Qh="expired-callback",Hh="sitekey",Gh="size";function zh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Yh(t,e){return t.h.push(e),e.ka(function(){q(t.h,e)}),e}function Xh(t){if(t.B)throw new Yr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Jh(t,e,n){var r=!1;try{this.b=n||fl.app()}catch(t){throw new Yr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Ca()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=fl.SDK_VERSION?dr(fl.SDK_VERSION,o):null,Wh.call(this,n,t,e,function(){try{var e=i.b.auth().ha()}catch(t){e=null}return e},o,Ni(Ii),r)}function $h(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],i<0||i>=Zh.length)throw new Yr("internal-error","Argument validator received an unsupported number of arguments.");n=Zh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new Yr("argument-error",t+" failed: "+r)}(t=Wh.prototype).Da=function(){var e=this;return this.f?this.f:this.f=Yh(this,Yt().then(function(){if(br()&&!sr())return ir();throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.m.g(e.v())}).then(function(t){return e.g=t,Ns(e.o,ps,{})}).then(function(t){e.a[Hh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){Xh(this);var n=this;return Yh(this,this.Da().then(function(){if(null===n.c){var t=n.u;if(!n.i){var e=qn(t);t=Wn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){Xh(this);var i=this;return Yh(this,this.render().then(function(r){return new jt(function(e){var t=i.g.getResponse(r);if(t)e(t);else{var n=function(t){t&&(function(t,e){B(t.l,function(t){return t==e})}(i,n),e(t))};i.l.push(n),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){Xh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Xh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=qn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Jh,Wh);var Zh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function tl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:h}}function el(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:n}}function nl(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:g}}function rl(t,e){return{name:t||"",M:"a function",optional:!!e,N:m}}function il(t,e){return{name:t||"",M:"null",optional:!!e,N:i}}function ol(n){return{name:n?n+"Credential":"credential",M:n?"a valid "+n+" credential":"a valid credential",optional:!1,N:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.na||!e)}}}function al(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&h(t.type)&&m(t.verify))}}}function sl(e,n,t,r){return{name:t||"",M:e.M+" or "+n.M,optional:!!r,N:function(t){return e.N(t)||n.N(t)}}}function ul(t,e){for(var n in e){var r=e[n].name;t[r]=ll(r,t[n],e[n].j)}}function cl(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:T(function(t){return this[t]},n),set:T(function(t,e,n,r){$h(t,[n],[r],!0),this[e]=r},r,n,e[n].Za),enumerable:!0})}}function hl(t,e,n,r){t[e]=ll(e,n,r)}function ll(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return $h(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}ul(gh.prototype,{Ya:{name:"applyActionCode",j:[tl("code")]},Ma:{name:"checkActionCode",j:[tl("code")]},ab:{name:"confirmPasswordReset",j:[tl("code"),tl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[tl("email"),tl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[tl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[tl("emailLink")]},wc:{name:"onAuthStateChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[tl("email"),sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[tl("email"),nl("actionCodeSettings")]},mb:{name:"setPersistence",j:[tl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[ol()]},ob:{name:"signInAnonymously",j:[]},Sa:{name:"signInWithCredential",j:[ol()]},Hc:{name:"signInWithCustomToken",j:[tl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[tl("email"),tl("password")]},Jc:{name:"signInWithEmailLink",j:[tl("email"),tl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[tl("phoneNumber"),al()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[sl({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Oc)}},il(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[tl("code")]}}),cl(gh.prototype,{lc:{name:"languageCode",Za:sl(tl(),il(),"languageCode")},ti:{name:"tenantId",Za:sl(tl(),il(),"tenantId")}}),(gh.Persistence=Tu).LOCAL="local",gh.Persistence.SESSION="session",gh.Persistence.NONE="none",ul(Oc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[el("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[el("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[ol()]},fb:{name:"linkWithCredential",j:[ol()]},sc:{name:"linkWithPhoneNumber",j:[tl("phoneNumber"),al()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[ol()]},hb:{name:"reauthenticateWithCredential",j:[ol()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[tl("phoneNumber"),al()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Qc:{name:"unlink",j:[tl("provider")]},rb:{name:"updateEmail",j:[tl("email")]},sb:{name:"updatePassword",j:[tl("password")]},Sc:{name:"updatePhoneNumber",j:[ol("phone")]},tb:{name:"updateProfile",j:[nl("profile")]}}),ul(Rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(Dh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(jt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),cl(bc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Za:el("appVerificationDisabledForTesting")}}),ul(wc.prototype,{confirm:{name:"confirm",j:[tl("verificationCode")]}}),hl(ji,"fromJSON",function(t){t=h(t)?JSON.parse(t):t;for(var e,n=[Yi,uo,po,Hi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[sl(tl(),nl(),"json")]),hl(co,"credential",function(t,e){return new so(t,e)},[tl("email"),tl("password")]),ul(so.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Zi.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(Zi,"credential",to,[sl(tl(),nl(),"token")]),hl(co,"credentialWithLink",ho,[tl("email"),tl("emailLink")]),ul(eo.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(eo,"credential",no,[sl(tl(),nl(),"token")]),ul(ro.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(ro,"credential",io,[sl(tl(),sl(nl(),il()),"idToken"),sl(tl(),il(),"accessToken",!0)]),ul(oo.prototype,{Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(oo,"credential",ao,[sl(tl(),nl(),"token"),tl("secret",!0)]),ul($i.prototype,{ya:{name:"addScope",j:[tl("scope")]},credential:{name:"credential",j:[sl(tl(),sl(nl(),il()),"optionsOrIdToken"),sl(tl(),il(),"accessToken",!0)]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),ul(Gi.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Ki.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),hl(mo,"credential",go,[tl("verificationId"),tl("verificationCode")]),ul(mo.prototype,{Wa:{name:"verifyPhoneNumber",j:[tl("phoneNumber"),al()]}}),ul(fo.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Yr.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Co.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Io.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Jh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),hl(Zr,"parseLink",si,[tl("link")]),function(){if(void 0===fl||!fl.INTERNAL||!fl.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Br,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:gh,AuthCredential:ji,Error:Yr};hl(t,"EmailAuthProvider",co,[]),hl(t,"FacebookAuthProvider",Zi,[]),hl(t,"GithubAuthProvider",eo,[]),hl(t,"GoogleAuthProvider",ro,[]),hl(t,"TwitterAuthProvider",oo,[]),hl(t,"OAuthProvider",$i,[tl("providerId")]),hl(t,"SAMLAuthProvider",Ji,[tl("providerId")]),hl(t,"PhoneAuthProvider",mo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof gh)}}]),hl(t,"RecaptchaVerifier",Jh,[sl(tl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),nl("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof fl.app.App)}}]),hl(t,"ActionCodeURL",Zr,[]),fl.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new gh(t)).getUid,t),getToken:_(t.cc,t),addAuthTokenListener:_(t.Wb,t),removeAuthTokenListener:_(t.Ec,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),fl.INTERNAL.extendNamespace({User:Oc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var gs=(vs.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),La(e))},vs.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Ma(e)},vs.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},vs.prototype.prefixedName_=function(t){return this.prefix_+t},vs.prototype.toString=function(){return this.domStorage_.toString()},vs);function vs(t){this.domStorage_=t,this.prefix_="firebase:"}var bs=(ws.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},ws.prototype.get=function(t){return Fa(this.cache_,t)?this.cache_[t]:null},ws.prototype.remove=function(t){delete this.cache_[t]},ws);function ws(){this.cache_={},this.isInMemoryStorage=!0}function _s(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new gs(e)}}catch(t){}return new bs}function Ts(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;ga(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new Ba;n.update(e);var r=n.digest();return ba.encodeByteArray(r)}function Es(t,e){ga(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(xs.logLevel=$a.VERBOSE,Vs=xs.log.bind(xs),e&&Ls.set("logging_enabled",!0)):"function"==typeof t?Vs=t:(Vs=null,Ls.remove("logging_enabled"))}function Ss(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===qs&&(qs=!1,null===Vs&&!0===Ls.get("logging_enabled")&&Es(!0)),Vs){var n=Us.apply(null,t);Vs(n)}}function Is(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ss.apply(void 0,fa([n],t))}}function Cs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+Us.apply(void 0,fa(t));xs.error(n)}function Ns(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+Us.apply(void 0,fa(t));throw xs.error(n),new Error(n)}function As(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+Us.apply(void 0,fa(t));xs.warn(n)}function ks(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function Ds(t,e){return t===e?0:t<e?-1:1}function Rs(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+La(e))}function Os(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var Ps,Ms=_s("localStorage"),Ls=_s("sessionStorage"),xs=new is("@firebase/database"),Fs=(Ps=1,function(){return Ps++}),Us=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=Us.apply(null,t[r]):"object"==typeof t[r]?n+=La(t[r]):n+=t[r],n+=" ";return n},Vs=null,qs=!0,Bs="[MIN_NAME]",js="[MAX_NAME]",Ws=function(t,e){if(t===e)return 0;if(t===Bs||e===js)return-1;if(e===Bs||t===js)return 1;var n=Xs(t),r=Xs(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Ks=function(t){if("object"!=typeof t||null===t)return La(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=La(e[i]),r+=":",r+=Ks(t[e[i]]);return r+="}"};function Qs(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function Hs(t){var e,n,r,i,o,a,s;for(ga(!ks(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function Gs(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw As("Exception was thrown by user callback.",t),e},Math.floor(0))}}function zs(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var Ys=new RegExp("^-?(0*)\\d{1,10}$"),Xs=function(t){if(Ys.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Js=(Object.defineProperty($s,"Empty",{get:function(){return new $s("")},enumerable:!0,configurable:!0}),$s.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},$s.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},$s.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new $s(this.pieces_,t)},$s.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},$s.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},$s.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},$s.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},$s.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new $s(t,0)},$s.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof $s)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new $s(e,0)},$s.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},$s.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return $s.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},$s.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Ws(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},$s.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},$s.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},$s);function $s(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var Zs=(Object.defineProperty(tu,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(tu,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),tu.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Ja(t),this.checkValid_()},tu.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Ja(t),0<this.parts_.length&&(this.byteLength_-=1)},tu.prototype.checkValid_=function(){if(this.byteLength_>tu.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+tu.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>tu.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+tu.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},tu.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},tu);function tu(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Ja(this.parts_[n]);this.checkValid_()}var eu="firebaseio.com",nu="websocket",ru="long_polling",iu=(ou.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},ou.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},ou.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},ou.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},ou.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ms.set("host:"+this.host,this.internalHost))},ou.prototype.connectionURL=function(t,e){var n;if(ga("string"==typeof t,"typeof type must == string"),ga("object"==typeof e,"typeof params must == object"),t===nu)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==ru)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Qs(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},ou.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},ou.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},ou);function ou(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Ms.get("host:"+t)||this.host}function au(t){var e=vu(t),n=e.namespace;"firebase"===e.domain&&Ns(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||Ns("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&As("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new iu(e.host,e.secure,n,r,"",n!=e.subdomain),path:new Js(e.pathString)}}function su(t){return"string"==typeof t&&0!==t.length&&!bu.test(t)}function uu(t){return"string"==typeof t&&0!==t.length&&!wu.test(t)}function cu(t){return null===t||"string"==typeof t||"number"==typeof t&&!ks(t)||t&&"object"==typeof t&&Fa(t,".sv")}function hu(t,e,n,r,i){i&&void 0===n||Tu(za(t,e,i),n,r)}function lu(t,e,n,r,i){if(!i||void 0!==n){var o=za(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Qs(n,function(t,e){var n=new Js(t);if(Tu(o,e,r.child(n)),".priority"===n.getBack()&&!cu(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!su(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Js.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function fu(t,e,n,r){if(!r||void 0!==n){if(ks(n))throw new Error(za(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!cu(n))throw new Error(za(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function pu(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(za(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function du(t,e,n,r){if(!(r&&void 0===n||su(n)))throw new Error(za(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function yu(t,e,n,r){if(!(r&&void 0===n||uu(n)))throw new Error(za(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function mu(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function gu(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!su(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t=t&&t.replace(/^\/*\.info(\/|$)/,"/"),uu(t)}(r))throw new Error(za(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var vu=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=ha(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):As("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},bu=/[\[\].#$\/\u0000-\u001F\u007F]/,wu=/[\[\].#$\u0000-\u001F\u007F]/,_u=10485760,Tu=function(n,t,e){var r=e instanceof Js?new Zs(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(ks(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>_u/3&&Ja(t)>_u)throw new Error(n+"contains a string greater than "+_u+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Qs(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!su(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),Tu(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Eu=(Su.prototype.cancel=function(t){Ga("OnDisconnect.cancel",0,1,arguments.length),Ya("OnDisconnect.cancel",1,t,!0);var e=new Ta;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Su.prototype.remove=function(t){Ga("OnDisconnect.remove",0,1,arguments.length),mu("OnDisconnect.remove",this.path_),Ya("OnDisconnect.remove",1,t,!0);var e=new Ta;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Su.prototype.set=function(t,e){Ga("OnDisconnect.set",1,2,arguments.length),mu("OnDisconnect.set",this.path_),hu("OnDisconnect.set",1,t,this.path_,!1),Ya("OnDisconnect.set",2,e,!0);var n=new Ta;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Su.prototype.setWithPriority=function(t,e,n){Ga("OnDisconnect.setWithPriority",2,3,arguments.length),mu("OnDisconnect.setWithPriority",this.path_),hu("OnDisconnect.setWithPriority",1,t,this.path_,!1),fu("OnDisconnect.setWithPriority",2,e,!1),Ya("OnDisconnect.setWithPriority",3,n,!0);var r=new Ta;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Su.prototype.update=function(t,e){if(Ga("OnDisconnect.update",1,2,arguments.length),mu("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,As("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}lu("OnDisconnect.update",1,t,this.path_,!1),Ya("OnDisconnect.update",2,e,!0);var i=new Ta;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Su);function Su(t,e){this.repo_=t,this.path_=e}var Iu=(Cu.prototype.toJSON=function(){return Ga("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Cu);function Cu(t,e){this.committed=t,this.snapshot=e}var Nu,Au,ku,Du=(Nu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Au=0,ku=[],function(t){var e,n=t===Au;Au=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Nu.charAt(t%64),t=Math.floor(t/64);ga(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===ku[e];e--)ku[e]=0;ku[e]++}else for(e=0;e<12;e++)ku[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Nu.charAt(ku[e]);return ga(20===i.length,"nextPushId: Length should be 20."),i}),Ru=(Ou.Wrap=function(t,e){return new Ou(t,e)},Ou);function Ou(t,e){this.name=t,this.node=e}var Pu,Mu=(Lu.prototype.getCompare=function(){return this.compare.bind(this)},Lu.prototype.indexedValueChanged=function(t,e){var n=new Ru(Bs,t),r=new Ru(Bs,e);return 0!==this.compare(n,r)},Lu.prototype.minPost=function(){return Ru.MIN},Lu);function Lu(){}var xu,Fu=(aa(Uu,xu=Mu),Object.defineProperty(Uu,"__EMPTY_NODE",{get:function(){return Pu},set:function(t){Pu=t},enumerable:!0,configurable:!0}),Uu.prototype.compare=function(t,e){return Ws(t.name,e.name)},Uu.prototype.isDefinedOn=function(t){throw va("KeyIndex.isDefinedOn not expected to be called.")},Uu.prototype.indexedValueChanged=function(t,e){return!1},Uu.prototype.minPost=function(){return Ru.MIN},Uu.prototype.maxPost=function(){return new Ru(js,Pu)},Uu.prototype.makePost=function(t,e){return ga("string"==typeof t,"KeyIndex indexValue must always be a string."),new Ru(t,Pu)},Uu.prototype.toString=function(){return".key"},Uu);function Uu(){return null!==xu&&xu.apply(this,arguments)||this}var Vu,qu=new Fu;function Bu(t){return"number"==typeof t?"number:"+Hs(t):"string:"+t}function ju(t){if(t.isLeafNode()){var e=t.val();ga("string"==typeof e||"number"==typeof e||"object"==typeof e&&Fa(e,".sv"),"Priority must be a string or number.")}else ga(t===Vu||t.isEmpty(),"priority of unexpected type.");ga(t===Vu||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var Wu,Ku,Qu,Hu,Gu=(Object.defineProperty(zu,"__childrenNodeConstructor",{get:function(){return Wu},set:function(t){Wu=t},enumerable:!0,configurable:!0}),zu.prototype.isLeafNode=function(){return!0},zu.prototype.getPriority=function(){return this.priorityNode_},zu.prototype.updatePriority=function(t){return new zu(this.value_,t)},zu.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:zu.__childrenNodeConstructor.EMPTY_NODE},zu.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:zu.__childrenNodeConstructor.EMPTY_NODE},zu.prototype.hasChild=function(){return!1},zu.prototype.getPredecessorChildName=function(t,e){return null},zu.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:zu.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},zu.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(ga(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,zu.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},zu.prototype.isEmpty=function(){return!1},zu.prototype.numChildren=function(){return 0},zu.prototype.forEachChild=function(t,e){return!1},zu.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},zu.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Bu(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?Hs(this.value_):this.value_,this.lazyHash_=Ts(t)}return this.lazyHash_},zu.prototype.getValue=function(){return this.value_},zu.prototype.compareTo=function(t){return t===zu.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof zu.__childrenNodeConstructor?-1:(ga(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},zu.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=zu.VALUE_TYPE_ORDER.indexOf(e),i=zu.VALUE_TYPE_ORDER.indexOf(n);return ga(0<=r,"Unknown leaf type: "+e),ga(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},zu.prototype.withIndex=function(){return this},zu.prototype.isIndexed=function(){return!0},zu.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},zu.VALUE_TYPE_ORDER=["object","boolean","number","string"],zu);function zu(t,e){void 0===e&&(e=zu.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,ga(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ju(this.priorityNode_)}function Yu(){return null!==Hu&&Hu.apply(this,arguments)||this}var Xu=new(aa(Yu,Hu=Mu),Yu.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Ws(t.name,e.name):i},Yu.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},Yu.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},Yu.prototype.minPost=function(){return Ru.MIN},Yu.prototype.maxPost=function(){return new Ru(js,new Gu("[PRIORITY-POST]",Qu))},Yu.prototype.makePost=function(t,e){var n=Ku(t);return new Ru(e,new Gu("[PRIORITY-POST]",n))},Yu.prototype.toString=function(){return".priority"},Yu),Ju=($u.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},$u.prototype.hasNext=function(){return 0<this.nodeStack_.length},$u.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},$u);function $u(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var Zu=(tc.prototype.copy=function(t,e,n,r,i){return new tc(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},tc.prototype.count=function(){return this.left.count()+1+this.right.count()},tc.prototype.isEmpty=function(){return!1},tc.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},tc.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},tc.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},tc.prototype.minKey=function(){return this.min_().key},tc.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},tc.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},tc.prototype.removeMin_=function(){if(this.left.isEmpty())return rc.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},tc.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return rc.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},tc.prototype.isRed_=function(){return this.color},tc.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},tc.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},tc.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},tc.prototype.rotateLeft_=function(){var t=this.copy(null,null,tc.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},tc.prototype.rotateRight_=function(){var t=this.copy(null,null,tc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},tc.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},tc.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},tc.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},tc.RED=!0,tc.BLACK=!1,tc);function tc(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:tc.RED,this.left=null!=r?r:rc.EMPTY_NODE,this.right=null!=i?i:rc.EMPTY_NODE}var ec=(nc.prototype.copy=function(t,e,n,r,i){return this},nc.prototype.insert=function(t,e,n){return new Zu(t,e,null)},nc.prototype.remove=function(t,e){return this},nc.prototype.count=function(){return 0},nc.prototype.isEmpty=function(){return!0},nc.prototype.inorderTraversal=function(t){return!1},nc.prototype.reverseTraversal=function(t){return!1},nc.prototype.minKey=function(){return null},nc.prototype.maxKey=function(){return null},nc.prototype.check_=function(){return 0},nc.prototype.isRed_=function(){return!1},nc);function nc(){}var rc=(ic.prototype.insert=function(t,e){return new ic(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Zu.BLACK,null,null))},ic.prototype.remove=function(t){return new ic(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Zu.BLACK,null,null))},ic.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},ic.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},ic.prototype.isEmpty=function(){return this.root_.isEmpty()},ic.prototype.count=function(){return this.root_.count()},ic.prototype.minKey=function(){return this.root_.minKey()},ic.prototype.maxKey=function(){return this.root_.maxKey()},ic.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},ic.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},ic.prototype.getIterator=function(t){return new Ju(this.root_,null,this.comparator_,!1,t)},ic.prototype.getIteratorFrom=function(t,e){return new Ju(this.root_,t,this.comparator_,!1,e)},ic.prototype.getReverseIteratorFrom=function(t,e){return new Ju(this.root_,t,this.comparator_,!0,e)},ic.prototype.getReverseIterator=function(t){return new Ju(this.root_,null,this.comparator_,!0,t)},ic.EMPTY_NODE=new ec,ic);function ic(t,e){void 0===e&&(e=ic.EMPTY_NODE),this.comparator_=t,this.root_=e}var oc=Math.log(2),ac=(sc.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},sc);function sc(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/oc,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var uc,cc,hc=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new Zu(r,n.node,Zu.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new Zu(r,n.node,Zu.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(1+n,r),o=c[n],a=h?h(o):o;u(new Zu(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,Zu.BLACK):(r(a,Zu.BLACK),r(a,Zu.RED))}return n}(new ac(c.length));return new rc(e||t,n)},lc={},fc=(Object.defineProperty(pc,"Default",{get:function(){return ga(Xu,"ChildrenNode.ts has not been loaded"),uc=uc||new pc({".priority":lc},{".priority":Xu})},enumerable:!0,configurable:!0}),pc.prototype.get=function(t){var e=Ua(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof rc?e:null},pc.prototype.hasIndex=function(t){return Fa(this.indexSet_,t.toString())},pc.prototype.addIndex=function(t,e){ga(t!==qu,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(Ru.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?hc(r,t.getCompare()):lc;var s=t.toString(),u=sa({},this.indexSet_);u[s]=t;var c=sa({},this.indexes_);return c[s]=n,new pc(c,u)},pc.prototype.addToIndexes=function(u,c){var h=this;return new pc(qa(this.indexes_,function(t,e){var n=Ua(h.indexSet_,e);if(ga(n,"Missing index implementation for "+e),t===lc){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(Ru.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),hc(r,n.getCompare())}return lc}var a=c.get(u.name),s=t;return a&&(s=s.remove(new Ru(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},pc.prototype.removeFromIndexes=function(n,r){return new pc(qa(this.indexes_,function(t){if(t===lc)return t;var e=r.get(n.name);return e?t.remove(new Ru(n.name,e)):t}),this.indexSet_)},pc);function pc(t,e){this.indexes_=t,this.indexSet_=e}function dc(t,e){return Ws(t.name,e.name)}function yc(t,e){return Ws(t,e)}var mc,gc=(Object.defineProperty(vc,"EMPTY_NODE",{get:function(){return cc=cc||new vc(new rc(yc),null,fc.Default)},enumerable:!0,configurable:!0}),vc.prototype.isLeafNode=function(){return!1},vc.prototype.getPriority=function(){return this.priorityNode_||cc},vc.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new vc(this.children_,t,this.indexMap_)},vc.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?cc:e},vc.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},vc.prototype.hasChild=function(t){return null!==this.children_.get(t)},vc.prototype.updateImmediateChild=function(t,e){if(ga(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n,r=new Ru(t,e),i=void 0,o=void 0;return o=e.isEmpty()?(i=this.children_.remove(t),this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,e),this.indexMap_.addToIndexes(r,this.children_)),n=i.isEmpty()?cc:this.priorityNode_,new vc(i,n,o)},vc.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;ga(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},vc.prototype.isEmpty=function(){return this.children_.isEmpty()},vc.prototype.numChildren=function(){return this.children_.count()},vc.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(Xu,function(t,e){r[t]=e.val(n),i++,a&&vc.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},vc.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Bu(this.getPriority().val())+":"),this.forEachChild(Xu,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":Ts(r)}return this.lazyHash_},vc.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Ru(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},vc.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},vc.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Ru(e,this.children_.get(e)):null},vc.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},vc.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Ru(e,this.children_.get(e)):null},vc.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},vc.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},vc.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Ru.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},vc.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},vc.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Ru.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},vc.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===wc?-1:0},vc.prototype.withIndex=function(t){if(t===qu||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new vc(this.children_,this.priorityNode_,e)},vc.prototype.isIndexed=function(t){return t===qu||this.indexMap_.hasIndex(t)},vc.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Xu),r=e.getIterator(Xu),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},vc.prototype.resolveIndex_=function(t){return t===qu?null:this.indexMap_.get(t.toString())},vc.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,vc);function vc(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ju(this.priorityNode_),this.children_.isEmpty()&&ga(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function bc(){return mc.call(this,new rc(yc),gc.EMPTY_NODE,fc.Default)||this}var wc=new(aa(bc,mc=gc),bc.prototype.compareTo=function(t){return t===this?0:1},bc.prototype.equals=function(t){return t===this},bc.prototype.getPriority=function(){return this},bc.prototype.getImmediateChild=function(t){return gc.EMPTY_NODE},bc.prototype.isEmpty=function(){return!1},bc);Object.defineProperties(Ru,{MIN:{value:new Ru(Bs,gc.EMPTY_NODE)},MAX:{value:new Ru(js,wc)}}),Fu.__EMPTY_NODE=gc.EMPTY_NODE,Gu.__childrenNodeConstructor=gc,Vu=wc,Qu=wc;var _c,Tc=!0;function Ec(r,t){if(void 0===t&&(t=null),null===r)return gc.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),ga(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new Gu(r,Ec(t));if(r instanceof Array||!Tc){var i=gc.EMPTY_NODE;return Qs(r,function(t,e){if(Fa(r,t)&&"."!==t.substring(0,1)){var n=Ec(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(Ec(t))}var o=[],a=!1;if(Qs(r,function(t,e){if("."!==t.substring(0,1)){var n=Ec(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new Ru(t,n)))}}),0==o.length)return gc.EMPTY_NODE;var e=hc(o,dc,function(t){return t.name},yc);if(a){var n=hc(o,Xu.getCompare());return new gc(e,Ec(t),new fc({".priority":n},{".priority":Xu}))}return new gc(e,Ec(t),fc.Default)}function Sc(){return null!==_c&&_c.apply(this,arguments)||this}Ku=Ec;var Ic,Cc=new(aa(Sc,_c=Mu),Sc.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Ws(t.name,e.name):n},Sc.prototype.isDefinedOn=function(t){return!0},Sc.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Sc.prototype.minPost=function(){return Ru.MIN},Sc.prototype.maxPost=function(){return Ru.MAX},Sc.prototype.makePost=function(t,e){var n=Ec(t);return new Ru(e,n)},Sc.prototype.toString=function(){return".value"},Sc),Nc=(aa(Ac,Ic=Mu),Ac.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},Ac.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},Ac.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Ws(t.name,e.name):i},Ac.prototype.makePost=function(t,e){var n=Ec(t),r=gc.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ru(e,r)},Ac.prototype.maxPost=function(){var t=gc.EMPTY_NODE.updateChild(this.indexPath_,wc);return new Ru(js,t)},Ac.prototype.toString=function(){return this.indexPath_.slice().join("/")},Ac);function Ac(t){var e=Ic.call(this)||this;return e.indexPath_=t,ga(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var kc=(Dc.prototype.val=function(){return Ga("DataSnapshot.val",0,0,arguments.length),this.node_.val()},Dc.prototype.exportVal=function(){return Ga("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},Dc.prototype.toJSON=function(){return Ga("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},Dc.prototype.exists=function(){return Ga("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},Dc.prototype.child=function(t){Ga("DataSnapshot.child",0,1,arguments.length),t=String(t),yu("DataSnapshot.child",1,t,!1);var e=new Js(t),n=this.ref_.child(e);return new Dc(this.node_.getChild(e),n,Xu)},Dc.prototype.hasChild=function(t){Ga("DataSnapshot.hasChild",1,1,arguments.length),yu("DataSnapshot.hasChild",1,t,!1);var e=new Js(t);return!this.node_.getChild(e).isEmpty()},Dc.prototype.getPriority=function(){return Ga("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},Dc.prototype.forEach=function(n){var r=this;return Ga("DataSnapshot.forEach",1,1,arguments.length),Ya("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new Dc(e,r.ref_.child(t),Xu))})},Dc.prototype.hasChildren=function(){return Ga("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(Dc.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),Dc.prototype.numChildren=function(){return Ga("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},Dc.prototype.getRef=function(){return Ga("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(Dc.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Dc);function Dc(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var Rc=(Oc.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},Oc.prototype.getEventType=function(){return this.eventType},Oc.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Oc.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+La(this.snapshot.exportVal())},Oc);function Oc(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var Pc=(Mc.prototype.getPath=function(){return this.path},Mc.prototype.getEventType=function(){return"cancel"},Mc.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},Mc.prototype.toString=function(){return this.path.toString()+":cancel"},Mc);function Mc(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var Lc=(xc.prototype.respondsTo=function(t){return"value"===t},xc.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Rc("value",this,new kc(t.snapshotNode,e.getRef(),n))},xc.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){ga(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},xc.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Pc(this,t,e):null},xc.prototype.matches=function(t){return t instanceof xc&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},xc.prototype.hasAnyCallback=function(){return null!==this.callback_},xc);function xc(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var Fc,Uc=(Vc.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Fa(this.callbacks_,e)},Vc.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Pc(this,t,e):null},Vc.prototype.createEvent=function(t,e){ga(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Rc(t.type,this,new kc(t.snapshotNode,n,r),t.prevName)},Vc.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){ga(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},Vc.prototype.matches=function(e){var n=this;if(e instanceof Vc){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},Vc.prototype.hasAnyCallback=function(){return null!==this.callbacks_},Vc);function Vc(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var qc=(Object.defineProperty(Bc,"__referenceConstructor",{get:function(){return ga(Fc,"Reference.ts has not been loaded"),Fc},set:function(t){Fc=t},enumerable:!0,configurable:!0}),Bc.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===qu){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Bs)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=js)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Xu){if(null!=e&&!cu(e)||null!=n&&!cu(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(ga(t.getIndex()instanceof Nc||t.getIndex()===Cc,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},Bc.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},Bc.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},Bc.prototype.getQueryParams=function(){return this.queryParams_},Bc.prototype.getRef=function(){return Ga("Query.ref",0,0,arguments.length),new Bc.__referenceConstructor(this.repo,this.path)},Bc.prototype.on=function(t,e,n,r){Ga("Query.on",2,4,arguments.length),pu("Query.on",1,t,!1),Ya("Query.on",2,e,!1);var i=Bc.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},Bc.prototype.onValueEvent=function(t,e,n){var r=new Lc(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},Bc.prototype.onChildEvent=function(t,e,n){var r=new Uc(t,e,n);this.repo.addEventCallbackForQuery(this,r)},Bc.prototype.off=function(t,e,n){Ga("Query.off",0,3,arguments.length),pu("Query.off",1,t,!0),Ya("Query.off",2,e,!0),Xa("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Lc(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Uc(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},Bc.prototype.once=function(e,n,t,r){var i=this;Ga("Query.once",1,4,arguments.length),pu("Query.once",1,e,!1),Ya("Query.once",2,n,!0);var o=Bc.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new Ta;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},Bc.prototype.limitToFirst=function(t){if(Ga("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Bc(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},Bc.prototype.limitToLast=function(t){if(Ga("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new Bc(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},Bc.prototype.orderByChild=function(t){if(Ga("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');yu("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Js(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Nc(e),r=this.queryParams_.orderBy(n);return Bc.validateQueryEndpoints_(r),new Bc(this.repo,this.path,r,!0)},Bc.prototype.orderByKey=function(){Ga("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(qu);return Bc.validateQueryEndpoints_(t),new Bc(this.repo,this.path,t,!0)},Bc.prototype.orderByPriority=function(){Ga("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Xu);return Bc.validateQueryEndpoints_(t),new Bc(this.repo,this.path,t,!0)},Bc.prototype.orderByValue=function(){Ga("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Cc);return Bc.validateQueryEndpoints_(t),new Bc(this.repo,this.path,t,!0)},Bc.prototype.startAt=function(t,e){void 0===t&&(t=null),Ga("Query.startAt",0,2,arguments.length),hu("Query.startAt",1,t,this.path,!0),du("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(Bc.validateLimit_(n),Bc.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new Bc(this.repo,this.path,n,this.orderByCalled_)},Bc.prototype.endAt=function(t,e){void 0===t&&(t=null),Ga("Query.endAt",0,2,arguments.length),hu("Query.endAt",1,t,this.path,!0),du("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(Bc.validateLimit_(n),Bc.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new Bc(this.repo,this.path,n,this.orderByCalled_)},Bc.prototype.equalTo=function(t,e){if(Ga("Query.equalTo",1,2,arguments.length),hu("Query.equalTo",1,t,this.path,!1),du("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},Bc.prototype.toString=function(){return Ga("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},Bc.prototype.toJSON=function(){return Ga("Query.toJSON",0,1,arguments.length),this.toString()},Bc.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},Bc.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Ks(t);return"{}"===e?"default":e},Bc.prototype.isEqual=function(t){if(Ga("Query.isEqual",1,1,arguments.length),!(t instanceof Bc))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},Bc.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Ya(t,3,r.cancel,!0),r.context=n,Xa(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(za(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(Bc.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),Bc);function Bc(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var jc=(Wc.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},Wc.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new Wc);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},Wc.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(Xu,function(t,e){n.remember(new Js(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},Wc.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new Js(r.toString()+"/"+t);e.forEachTree(n,i)})},Wc.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},Wc);function Wc(){this.value=null,this.children=new Map}function Kc(t,e,n){return t&&"object"==typeof t?(ga(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?Gc(t[".sv"],e,n):"object"==typeof t[".sv"]?zc(t[".sv"],e):void ga(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t}var Qc,Hc,Gc=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ga(!1,"Unexpected server value: "+t)}},zc=function(t,e,n){t.hasOwnProperty("increment")||ga(!1,"Unexpected server value: "+JSON.stringify(t,null,2));var r=t.increment;if("number"!=typeof r&&ga(!1,"Unexpected increment value: "+r),!e.isLeafNode())return r;var i=e.getValue();return"number"!=typeof i?r:i+r},Yc=function(t,r,i){var o,e=t.getPriority().val(),n=Kc(e,r.getPriority(),i);if(t.isLeafNode()){var a=t,s=Kc(a.getValue(),r,i);return s!==a.getValue()||n!==a.getPriority().val()?new Gu(s,Ec(n)):t}var u=t;return n!==(o=u).getPriority().val()&&(o=o.updatePriority(new Gu(n))),u.forEachChild(Xu,function(t,e){var n=Yc(e,r.getImmediateChild(t),i);n!==e&&(o=o.updateImmediateChild(t,n))}),o};(Hc=Qc=Qc||{})[Hc.OVERWRITE=0]="OVERWRITE",Hc[Hc.MERGE=1]="MERGE",Hc[Hc.ACK_USER_WRITE=2]="ACK_USER_WRITE",Hc[Hc.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Xc=(Jc.User=new Jc(!0,!1,null,!1),Jc.Server=new Jc(!1,!0,null,!1),Jc.forServerTaggedQuery=function(t){return new Jc(!1,!0,t,!0)},Jc);function Jc(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,ga(!r||e,"Tagged queries must be from server.")}var $c,Zc=(th.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return ga(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Js(t));return new th(Js.Empty,e,this.revert)}return ga(this.path.getFront()===t,"operationForChild called for unrelated child."),new th(this.path.popFront(),this.affectedTree,this.revert)},th);function th(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Qc.ACK_USER_WRITE,this.source=Xc.User}var eh=(nh.fromObject=function(t){var n=nh.Empty;return Qs(t,function(t,e){n=n.set(new Js(t),e)}),n},nh.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},nh.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Js.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Js(n).child(i.path),value:i.value}},nh.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},nh.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):nh.Empty},nh.prototype.set=function(t,e){if(t.isEmpty())return new nh(e,this.children);var n=t.getFront(),r=(this.children.get(n)||nh.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new nh(this.value,i)},nh.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?nh.Empty:new nh(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?nh.Empty:new nh(this.value,i)}return this},nh.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},nh.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||nh.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new nh(this.value,i)},nh.prototype.fold=function(t){return this.fold_(Js.Empty,t)},nh.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},nh.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Js.Empty,e)},nh.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},nh.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Js.Empty,e)},nh.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):nh.Empty},nh.prototype.foreach=function(t){this.foreach_(Js.Empty,t)},nh.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},nh.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},nh.Empty=new nh(null),nh);function nh(t,e){void 0===e&&(e=$c=$c||new rc(Ds)),this.value=t,this.children=e}var rh=(ih.prototype.operationForChild=function(t){return this.path.isEmpty()?new ih(this.source,Js.Empty):new ih(this.source,this.path.popFront())},ih);function ih(t,e){this.source=t,this.path=e,this.type=Qc.LISTEN_COMPLETE}var oh=(ah.prototype.operationForChild=function(t){return this.path.isEmpty()?new ah(this.source,Js.Empty,this.snap.getImmediateChild(t)):new ah(this.source,this.path.popFront(),this.snap)},ah);function ah(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Qc.OVERWRITE}var sh=(uh.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Js(t));return e.isEmpty()?null:e.value?new oh(this.source,Js.Empty,e.value):new uh(this.source,Js.Empty,e)}return ga(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new uh(this.source,this.path.popFront(),this.children)},uh.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},uh);function uh(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Qc.MERGE}var ch=(hh.prototype.isFullyInitialized=function(){return this.fullyInitialized_},hh.prototype.isFiltered=function(){return this.filtered_},hh.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},hh.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},hh.prototype.getNode=function(){return this.node_},hh);function hh(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var lh=(fh.prototype.updateEventSnap=function(t,e,n){return new fh(new ch(t,e,n),this.serverCache_)},fh.prototype.updateServerSnap=function(t,e,n){return new fh(this.eventCache_,new ch(t,e,n))},fh.prototype.getEventCache=function(){return this.eventCache_},fh.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},fh.prototype.getServerCache=function(){return this.serverCache_},fh.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},fh.Empty=new fh(new ch(gc.EMPTY_NODE,!1,!1),new ch(gc.EMPTY_NODE,!1,!1)),fh);function fh(t,e){this.eventCache_=t,this.serverCache_=e}var ph=(dh.valueChange=function(t){return new dh(dh.VALUE,t)},dh.childAddedChange=function(t,e){return new dh(dh.CHILD_ADDED,e,t)},dh.childRemovedChange=function(t,e){return new dh(dh.CHILD_REMOVED,e,t)},dh.childChangedChange=function(t,e,n){return new dh(dh.CHILD_CHANGED,e,t,n)},dh.childMovedChange=function(t,e){return new dh(dh.CHILD_MOVED,e,t)},dh.CHILD_ADDED="child_added",dh.CHILD_REMOVED="child_removed",dh.CHILD_CHANGED="child_changed",dh.CHILD_MOVED="child_moved",dh.VALUE="value",dh);function dh(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var yh=(mh.prototype.updateChild=function(t,e,n,r,i,o){ga(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(ph.childRemovedChange(e,a)):ga(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ph.childAddedChange(e,n)):o.trackChildChange(ph.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},mh.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Xu,function(t,e){n.hasChild(t)||i.trackChildChange(ph.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(Xu,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(ph.childChangedChange(t,e,n))}else i.trackChildChange(ph.childAddedChange(t,e))})),n.withIndex(this.index_)},mh.prototype.updatePriority=function(t,e){return t.isEmpty()?gc.EMPTY_NODE:t.updatePriority(e)},mh.prototype.filtersNodes=function(){return!1},mh.prototype.getIndexedFilter=function(){return this},mh.prototype.getIndex=function(){return this.index_},mh);function mh(t){this.index_=t}var gh=(vh.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;ga(e==ph.CHILD_ADDED||e==ph.CHILD_CHANGED||e==ph.CHILD_REMOVED,"Only child changes supported for tracking"),ga(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e==ph.CHILD_ADDED&&i==ph.CHILD_REMOVED)this.changeMap.set(n,ph.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e==ph.CHILD_REMOVED&&i==ph.CHILD_ADDED)this.changeMap.delete(n);else if(e==ph.CHILD_REMOVED&&i==ph.CHILD_CHANGED)this.changeMap.set(n,ph.childRemovedChange(n,r.oldSnap));else if(e==ph.CHILD_CHANGED&&i==ph.CHILD_ADDED)this.changeMap.set(n,ph.childAddedChange(n,t.snapshotNode));else{if(e!=ph.CHILD_CHANGED||i!=ph.CHILD_CHANGED)throw va("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,ph.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},vh.prototype.getChanges=function(){return Array.from(this.changeMap.values())},vh);function vh(){this.changeMap=new Map}function bh(){}var wh=new(bh.prototype.getCompleteChild=function(t){return null},bh.prototype.getChildAfterChild=function(t,e,n){return null},bh),_h=(Th.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new ch(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},Th.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},Th);function Th(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var Eh=function(t,e){this.viewCache=t,this.changes=e},Sh=(Ih.prototype.assertIndexed=function(t){ga(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),ga(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},Ih.prototype.applyOperation=function(t,e,n,r){var i,o,a=new gh;if(e.type===Qc.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(ga(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Qc.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(ga(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Qc.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Qc.LISTEN_COMPLETE)throw va("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return Ih.maybeAddValueEvent_(t,i,h),new Eh(i,h)},Ih.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(ph.valueChange(e.getCompleteEventSnap()))}},Ih.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(ga(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof gc?u:gc.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){ga(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=g?o.getNode().getImmediateChild(f).updateChild(y,g):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},Ih.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,wh,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new _h(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},Ih.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new _h(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):gc.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},Ih.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},Ih.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);Ih.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);Ih.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},Ih.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},Ih.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:eh.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new Js(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new Js(t),i,a,s,u,c)}}),l},Ih.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=eh.Empty;return s.getNode().forEachChild(qu,function(t,e){u=u.set(new Js(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=eh.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},Ih.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,wh,r)},Ih.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new _h(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();ga(h instanceof gc,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,gc.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Js.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},Ih);function Ih(t){this.filter_=t}var Ch=(Nh.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===ph.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(ph.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,ph.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,ph.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,ph.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,ph.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,ph.VALUE,t,n,e),i},Nh.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},Nh.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Nh.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw va("Should only compare child_ events.");var n=new Ru(t.childName,t.snapshotNode),r=new Ru(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Nh);function Nh(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var Ah,kh=(Dh.prototype.getQuery=function(){return this.query_},Dh.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},Dh.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},Dh.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},Dh.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},Dh.prototype.removeEventRegistration=function(t,n){var r=[];if(n){ga(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},Dh.prototype.applyOperation=function(t,e,n){t.type===Qc.MERGE&&null!==t.source.queryId&&(ga(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),ga(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),ga(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},Dh.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Xu,function(t,e){n.push(ph.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(ph.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},Dh.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},Dh);function Dh(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new yh(n.getIndex()),i=n.getNodeFilter();this.processor_=new Sh(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(gc.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(gc.EMPTY_NODE,a.getNode(),null),c=new ch(s,o.isFullyInitialized(),r.filtersNodes()),h=new ch(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new lh(h,c),this.eventGenerator_=new Ch(this.query_)}var Rh=(Object.defineProperty(Oh,"__referenceConstructor",{get:function(){return ga(Ah,"Reference.ts has not been loaded"),Ah},set:function(t){ga(!Ah,"__referenceConstructor has already been defined"),Ah=t},enumerable:!0,configurable:!0}),Oh.prototype.isEmpty=function(){return 0===this.views.size},Oh.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return ga(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=ha(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},Oh.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof gc?n.calcCompleteEventChildren(r):gc.EMPTY_NODE,!1);var c=new lh(new ch(s,u,!1),new ch(r,i,!1));a=new kh(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},Oh.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=ha(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=la(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new Oh.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},Oh.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=ha(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},Oh.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=ha(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},Oh.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},Oh.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},Oh.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},Oh.prototype.getCompleteView=function(){var e,t;try{for(var n=ha(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},Oh);function Oh(){this.views=new Map}var Ph=(Mh.prototype.addWrite=function(t,e){if(t.isEmpty())return new Mh(new eh(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Js.relativePath(r,t);return i=i.updateChild(o,e),new Mh(this.writeTree_.set(r,i))}var a=new eh(e);return new Mh(this.writeTree_.setTree(t,a))},Mh.prototype.addWrites=function(n,t){var r=this;return Qs(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},Mh.prototype.removeWrite=function(t){return t.isEmpty()?Mh.Empty:new Mh(this.writeTree_.setTree(t,eh.Empty))},Mh.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},Mh.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Js.relativePath(e.path,t)):null},Mh.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Xu,function(t,e){n.push(new Ru(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new Ru(t,e.value))}),n},Mh.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new Mh(null!=e?new eh(e):this.writeTree_.subtree(t))},Mh.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},Mh.prototype.apply=function(t){return function n(r,t,i){if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(ga(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}(Js.Empty,this.writeTree_,t)},Mh.Empty=new Mh(new eh(null)),Mh);function Mh(t){this.writeTree_=t}var Lh=(xh.prototype.childWrites=function(t){return new Fh(t,this)},xh.prototype.addOverwrite=function(t,e,n,r){ga(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},xh.prototype.addMerge=function(t,e,n){ga(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},xh.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},xh.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});ga(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):Qs(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))}),!0)},xh.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},xh.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Js.Empty)){var o=xh.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return u=t||gc.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(Js.Empty)){var u=t||gc.EMPTY_NODE;return s.apply(u)}return null},xh.prototype.calcCompleteEventChildren=function(t,e){var r=gc.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(Xu,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Xu,function(t,e){var n=i.childCompoundWrite(new Js(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},xh.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){ga(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},xh.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},xh.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},xh.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Js.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},xh.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},xh.prototype.resetTree_=function(){this.visibleWrites_=xh.layerTree_(this.allWrites_,xh.DefaultFilter_,Js.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},xh.DefaultFilter_=function(t){return t.visible},xh.layerTree_=function(t,e,n){for(var r=Ph.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Js.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Js.relativePath(a,n),r=r.addWrite(Js.Empty,o.snap.getChild(s)));else{if(!o.children)throw va("WriteRecord should have .snap or .children");if(n.contains(a))s=Js.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Js.relativePath(a,n)).isEmpty())r=r.addWrites(Js.Empty,o.children);else{var u=Ua(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Js.Empty,c)}}}}}return r},xh);function xh(){this.visibleWrites_=Ph.Empty,this.allWrites_=[],this.lastWriteId_=-1}var Fh=(Uh.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},Uh.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},Uh.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},Uh.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},Uh.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},Uh.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},Uh.prototype.child=function(t){return new Uh(this.treePath_.child(t),this.writeTree_)},Uh);function Uh(t,e){this.treePath_=t,this.writeTree_=e}var Vh=(qh.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new oh(Xc.User,t,e)):[]},qh.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=eh.fromObject(e);return this.applyOperationToSyncPoints_(new sh(Xc.User,t,r))},qh.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=eh.Empty;return null!=n.snap?r=r.set(Js.Empty,!0):Qs(n.children,function(t,e){r=r.set(new Js(t),e)}),this.applyOperationToSyncPoints_(new Zc(n.path,r,e))}return[]},qh.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new oh(Xc.Server,t,e))},qh.prototype.applyServerMerge=function(t,e){var n=eh.fromObject(e);return this.applyOperationToSyncPoints_(new sh(Xc.Server,t,n))},qh.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new rh(Xc.Server,t))},qh.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=qh.parseQueryKey_(r),o=i.path,a=i.queryId,s=Js.relativePath(o,t),u=new oh(Xc.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},qh.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=qh.parseQueryKey_(r),o=i.path,a=i.queryId,s=Js.relativePath(o,t),u=eh.fromObject(e),c=new sh(Xc.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},qh.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=qh.parseQueryKey_(n),i=r.path,o=r.queryId,a=Js.relativePath(i,t),s=new rh(Xc.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},qh.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Js.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Js.Empty)):(a=new Rh,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?n=!0:(n=!1,i=gc.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Js.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=qh.makeQueryKey_(t);ga(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=qh.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},qh.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(qh.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(qh.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(qh.makeQueryKey_(t));r.listenProvider_.stopListening(qh.queryForListening_(t),e)})),this.removeTags_(u)}return a},qh.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=Js.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},qh.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Qs(n,function(t,e){r=r.concat(e)}),r})},qh.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=qh.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},qh.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},qh.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(qh.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)ga(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Qs(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(qh.queryForListening_(c),this.tagForQuery_(c))}return o},qh.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||gc.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},qh.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},qh.parseQueryKey_=function(t){var e=t.indexOf("$");return ga(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Js(t.substr(0,e))}},qh.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},qh.prototype.tagForQuery_=function(t){var e=qh.makeQueryKey_(t);return this.queryToTagMap.get(e)},qh.getNextQueryTag_=function(){return qh.nextQueryTag_++},qh.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);ga(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},qh.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Js.Empty))},qh.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Js.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Js.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},qh.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(Js.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(Js.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},qh.nextQueryTag_=1,qh);function qh(t){this.listenProvider_=t,this.syncPointTree_=eh.Empty,this.pendingWriteTree_=new Lh,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var Bh=(jh.prototype.getNode=function(t){return this.rootNode_.getChild(t)},jh.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},jh);function jh(){this.rootNode_=gc.EMPTY_NODE}var Wh=(Kh.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(Ss("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},Kh.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},Kh.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},Kh.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',As(t)},Kh);function Kh(t){this.app_=t}var Qh=(Hh.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Fa(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},Hh.prototype.get=function(){return wa(this.counters_)},Hh);function Hh(){this.counters_={}}var Gh=(zh.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Qh),this.collections_[e]},zh.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},zh.collections_={},zh.reporters_={},zh);function zh(){}var Yh=(Xh.prototype.get=function(){var t=this.collection_.get(),n=sa({},t);return this.last_&&Qs(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},Xh);function Xh(t){this.collection_=t,this.last_=null}var Jh=($h.prototype.includeStat=function(t){this.statsToReport_[t]=!0},$h.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;Qs(t,function(t,e){0<e&&Fa(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),zs(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},$h);function $h(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Yh(t);var n=1e4+2e4*Math.random();zs(this.reportStats_.bind(this),Math.floor(n))}var Zh=(tl.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new el(i)),e.add(r)}e&&this.eventLists_.push(e)},tl.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},tl.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},tl.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},tl);function tl(){this.eventLists_=[],this.recursionDepth_=0}var el=(nl.prototype.add=function(t){this.events_.push(t)},nl.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Vs&&Ss("event: "+e.toString()),Gs(n)}}},nl.prototype.getPath=function(){return this.path_},nl);function nl(t){this.path_=t,this.events_=[]}var rl=(il.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=fa(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},il.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},il.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},il.prototype.validateEventType_=function(e){ga(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},il);function il(t){this.allowedEvents_=t,this.listeners_={},ga(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var ol,al=(aa(sl,ol=rl),sl.getInstance=function(){return new sl},sl.prototype.getInitialEvent=function(t){return ga("visible"===t,"Unknown event type: "+t),[this.visible_]},sl);function sl(){var e,t,n=ol.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}var ul,cl=(aa(hl,ul=rl),hl.getInstance=function(){return new hl},hl.prototype.getInitialEvent=function(t){return ga("online"===t,"Unknown event type: "+t),[this.online_]},hl.prototype.currentlyOnline=function(){return this.online_},hl);function hl(){var t=ul.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Ia()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var ll=(pl.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},pl.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Gs(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==n(););},pl);function pl(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var dl=(yl.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new ll(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new ml(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=la(t,5),r=n[0],i=n[1],o=n[2];if(n[3],n[4],a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"==r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=la(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(eu)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},yl.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},yl.forceAllow=function(){yl.forceAllow_=!0},yl.forceDisallow=function(){yl.forceDisallow_=!0},yl.isAvailable=function(){return!!yl.forceAllow_||!(yl.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},yl.prototype.markConnectionHealthy=function(){},yl.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},yl.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},yl.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},yl.prototype.send=function(t){var e=La(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=function(t){var e=da(t);return ba.encodeByteArray(e,!0)}(e),r=Os(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},yl.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},yl.prototype.incrementIncomingBytes_=function(t){var e=La(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},yl);function yl(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Is(t),this.stats_=Gh.getCollection(e),this.urlFn=function(t){return e.connectionURL(ru,t)}}var ml=(gl.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ss("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},gl.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},gl.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},gl.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},gl.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},gl.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},gl.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){Ss("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},gl);function gl(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=Fs(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=gl.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Ss("frame writing exception"),t.stack&&Ss(t.stack),Ss(t)}}var vl="";var bl=null;"undefined"!=typeof MozWebSocket?bl=MozWebSocket:"undefined"!=typeof WebSocket&&(bl=WebSocket);var wl=(_l.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(eu)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(nu,r)},_l.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ms.set("previous_websocket_failure",!0);try{if(Na()){var r=ma.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+vl+"/"+process.platform+"/"+r}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new bl(this.connURL,[],i)}else this.mySock=new bl(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},_l.prototype.start=function(){},_l.forceDisallow=function(){_l.forceDisallow_=!0},_l.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==bl&&!_l.forceDisallow_},_l.previouslyFailed=function(){return Ms.isInMemoryStorage||!0===Ms.get("previous_websocket_failure")},_l.prototype.markConnectionHealthy=function(){Ms.remove("previous_websocket_failure")},_l.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Ma(e);this.onMessage(n)}},_l.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},_l.prototype.extractFrameCount_=function(t){if(ga(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},_l.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},_l.prototype.send=function(t){this.resetKeepAlive();var e=La(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Os(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},_l.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},_l.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},_l.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},_l.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},_l.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},_l.responsesRequiredToBeHealthy=2,_l.healthyTimeout=3e4,_l);function _l(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Is(this.connId),this.stats_=Gh.getCollection(e),this.connURL=_l.connectionURL_(e,n,r)}var Tl=(Object.defineProperty(El,"ALL_TRANSPORTS",{get:function(){return[dl,wl]},enumerable:!0,configurable:!0}),El.prototype.initTransports_=function(t){var e,n,r=wl&&wl.isAvailable(),i=r&&!wl.previouslyFailed();if(t.webSocketOnly&&(r||As("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[wl];else{var o=this.transports_=[];try{for(var a=ha(El.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},El.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},El.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},El);function El(t){this.initTransports_(t)}var Sl=(Il.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=zs(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},Il.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Il.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},Il.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},Il.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},Il.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Il.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Il.prototype.onSecondaryMessageReceived_=function(t){var e=Rs("t",t),n=Rs("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},Il.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Il.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Il.prototype.onPrimaryMessageReceived_=function(t){var e=Rs("t",t),n=Rs("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},Il.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},Il.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Il.prototype.onControl_=function(t){var e=Rs("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?Cs("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Cs("Unknown control packet command: "+e)}},Il.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&As("Protocol version mismatch detected"),this.tryStartUpgrade_())},Il.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},Il.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),zs(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},Il.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},Il.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):zs(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},Il.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Il.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},Il.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ms.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Il.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},Il.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},Il.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Il.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Il);function Il(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Is("c:"+this.id+":"),this.transportManager_=new Tl(e),this.log_("Connection created"),this.start_()}var Cl=(Nl.prototype.put=function(t,e,n,r){},Nl.prototype.merge=function(t,e,n,r){},Nl.prototype.refreshAuthToken=function(t){},Nl.prototype.onDisconnectPut=function(t,e,n){},Nl.prototype.onDisconnectMerge=function(t,e,n){},Nl.prototype.onDisconnectCancel=function(t,e){},Nl.prototype.reportStats=function(t){},Nl);function Nl(){}var Al,kl=(aa(Dl,Al=Cl),Dl.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(La(i)),ga(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},Dl.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ga(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),ga(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},Dl.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;Dl.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},Dl.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Fa(t,"w")){var n=Ua(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();As("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},Dl.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},Dl.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=xa(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Dl.prototype.tryAuth=function(){var r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,t=function(t){var e=xa(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(i)?"auth":"gauth",e={cred:i};null===this.authOverride_?e.noauth=!0:"object"==typeof this.authOverride_&&(e.authvar=this.authOverride_),this.sendRequest(t,e,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},Dl.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),ga(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},Dl.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},Dl.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},Dl.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},Dl.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},Dl.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},Dl.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},Dl.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},Dl.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},Dl.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},Dl.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},Dl.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+La(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},Dl.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):Cs("Unrecognized action received from server: "+La(t)+"\nAre you using the latest client?")},Dl.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Dl.prototype.scheduleConnect_=function(t){var e=this;ga(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},Dl.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},Dl.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Dl.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},Dl.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Dl.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){ga(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?Ss("getToken() completed but was canceled"):(Ss("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new Sl(i,o.repoInfo_,e,n,r,function(t){As(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},Dl.prototype.interrupt=function(t){Ss("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Dl.prototype.resume=function(t){Ss("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Va(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},Dl.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},Dl.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Dl.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Ks(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},Dl.prototype.removeListen_=function(t,e){var n,r=new Js(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},Dl.prototype.onAuthRevoked_=function(t,e){Ss("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Dl.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},Dl.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=ha(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ha(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},Dl.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+vl.replace(/\./g,"-")]=1,Ia()?t["framework.cordova"]=1:Ca()&&(t["framework.reactnative"]=1),this.reportStats(t)},Dl.prototype.shouldReconnect_=function(){var t=cl.getInstance().currentlyOnline();return Va(this.interruptReasons_)&&t},Dl.nextPersistentConnectionId_=0,Dl.nextConnectionId_=0,Dl);function Dl(t,e,n,r,i,o){var a=Al.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=Dl.nextPersistentConnectionId_++,a.log_=Is("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Na())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),al.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&cl.getInstance().on("online",a.onOnline_,a),a}var Rl,Ol=(aa(Pl,Rl=Cl),Pl.prototype.reportStats=function(t){throw new Error("Method not implemented.")},Pl.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(ga(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},Pl.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=Pl.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),Ua(o.listens_,s)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},Pl.prototype.unlisten=function(t,e){var n=Pl.getListenId_(t,e);delete this.listens_[n]},Pl.prototype.refreshAuthToken=function(t){},Pl.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){for(var n=[],e=function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];e(o[0],o[1])}return n.length?"&"+n.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=Ma(r.responseText)}catch(t){As("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&As("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},Pl);function Pl(t,e,n){var r=Rl.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Is("p:rest:"),r.listens_={},r}var Ml="repo_interrupt",Ll=(xl.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},xl.prototype.name=function(){return this.repoInfo_.namespace},xl.prototype.serverTime=function(){var t=this.infoData_.getNode(new Js(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},xl.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},xl.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Js(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=qa(e,function(t){return Ec(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Ec(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=qa(e,function(t){return Ec(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Ec(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},xl.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},xl.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},xl.prototype.onServerInfoUpdate_=function(t){var n=this;Qs(t,function(t,e){n.updateInfo_(t,e)})},xl.prototype.updateInfo_=function(t,e){var n=new Js("/.info/"+t),r=Ec(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},xl.prototype.getNextWriteId_=function(){return this.nextWriteId_++},xl.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=Ec(t,e),s=this.serverSyncTree_.calcCompleteEventCache(i),u=Yc(r,s,n),c=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserOverwrite(i,u,c,!0);this.eventQueue_.queueEvents(h),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||As("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(c,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var l=this.abortTransactions_(i);this.rerunTransactions_(l),this.eventQueue_.raiseEventsForChangedPath(l,[])},xl.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(Qs(t,function(t,e){r=!1;var n=Ec(e);u[t]=Yc(n,s.serverSyncTree_.calcCompleteEventCache(o),i)}),r)Ss("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||As("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),Qs(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},xl.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),e=function(t,r,i){var o=new jc;return t.forEachTree(new Js(""),function(t,e){var n=r.calcCompleteEventCache(t);ga(null!=n,"Expected ChildrenNode.EMPTY_NODE for nulls"),o.remember(t,Yc(e,n,i))}),o}(this.onDisconnect_,this.serverSyncTree_,t),i=[];e.forEachTree(Js.Empty,function(t,e){i=i.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new jc,this.eventQueue_.raiseEventsForChangedPath(Js.Empty,i)},xl.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},xl.prototype.onDisconnectSet=function(n,t,r){var i=this,o=Ec(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},xl.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=Ec(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},xl.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Va(n))return Ss("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&Qs(n,function(t,e){var n=Ec(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},xl.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},xl.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},xl.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Ml)},xl.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Ml)},xl.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Yh(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Qs(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},xl.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},xl.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Ss.apply(void 0,fa([n],t))},xl.prototype.callOnCompleteCallback=function(r,i,o){r&&Gs(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(xl.prototype,"database",{get:function(){return this.__database||(this.__database=new ef(this))},enumerable:!0,configurable:!0}),xl);function xl(t,e,n){var a=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Zh,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new jc,this.persistentConnection_=null;var r=new Wh(n);if(this.stats_=Gh.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new Ol(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{La(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new kl(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=Gh.getOrCreateReporter(t,function(){return new Jh(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new Bh,this.infoSyncTree_=new Vh({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Vh({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}var Fl=(Ul.prototype.getStartPost=function(){return this.startPost_},Ul.prototype.getEndPost=function(){return this.endPost_},Ul.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},Ul.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Ru(e,n))||(n=gc.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},Ul.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=gc.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(gc.EMPTY_NODE);var i=this;return e.forEachChild(Xu,function(t,e){i.matches(new Ru(t,e))||(r=r.updateImmediateChild(t,gc.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},Ul.prototype.updatePriority=function(t,e){return t},Ul.prototype.filtersNodes=function(){return!0},Ul.prototype.getIndexedFilter=function(){return this.indexedFilter_},Ul.prototype.getIndex=function(){return this.index_},Ul.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},Ul.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},Ul);function Ul(t){this.indexedFilter_=new yh(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Ul.getStartPost_(t),this.endPost_=Ul.getEndPost_(t)}var Vl=(ql.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Ru(e,n))||(n=gc.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},ql.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=gc.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=gc.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(gc.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,gc.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},ql.prototype.updatePriority=function(t,e){return t},ql.prototype.filtersNodes=function(){return!0},ql.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},ql.prototype.getIndex=function(){return this.index_},ql.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;ga(s.numChildren()==this.limit_,"");var u=new Ru(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(ph.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(ph.childRemovedChange(e,l));var d=s.updateImmediateChild(e,gc.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(ph.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(ph.childRemovedChange(c.name,c.node)),i.trackChildChange(ph.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,gc.EMPTY_NODE)):t},ql);function ql(t){this.rangedFilter_=new Fl(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var Bl=(jl.prototype.hasStart=function(){return this.startSet_},jl.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===jl.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},jl.prototype.getIndexStartValue=function(){return ga(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},jl.prototype.getIndexStartName=function(){return ga(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Bs},jl.prototype.hasEnd=function(){return this.endSet_},jl.prototype.getIndexEndValue=function(){return ga(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},jl.prototype.getIndexEndName=function(){return ga(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:js},jl.prototype.hasLimit=function(){return this.limitSet_},jl.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},jl.prototype.getLimit=function(){return ga(this.limitSet_,"Only valid if limit has been set"),this.limit_},jl.prototype.getIndex=function(){return this.index_},jl.prototype.copy_=function(){var t=new jl;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},jl.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},jl.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=jl.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},jl.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=jl.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},jl.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},jl.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},jl.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},jl.prototype.getQueryObject=function(){var t=jl.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Xu&&(e[t.INDEX]=this.index_.toString()),e},jl.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},jl.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Xu},jl.prototype.getNodeFilter=function(){return this.loadsAllData()?new yh(this.getIndex()):this.hasLimit()?new Vl(this):new Fl(this)},jl.prototype.toRestQueryStringParameters=function(){var t,e=jl.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Xu?e.PRIORITY_INDEX:this.index_===Cc?e.VALUE_INDEX:this.index_===qu?e.KEY_INDEX:(ga(this.index_ instanceof Nc,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=La(t),this.startSet_&&(n[e.START_AT]=La(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+La(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=La(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+La(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},jl.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},jl.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},jl.DEFAULT=new jl,jl);function jl(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Xu}var Wl,Kl=(aa(Ql,Wl=qc),Ql.prototype.getKey=function(){return Ga("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},Ql.prototype.child=function(t){return Ga("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Js||(null===this.path.getFront()?function(t,e,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),yu(t,e,n,r)}("Reference.child",1,t,!1):yu("Reference.child",1,t,!1)),new Ql(this.repo,this.path.child(t))},Ql.prototype.getParent=function(){Ga("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new Ql(this.repo,t)},Ql.prototype.getRoot=function(){Ga("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},Ql.prototype.databaseProp=function(){return this.repo.database},Ql.prototype.set=function(t,e){Ga("Reference.set",1,2,arguments.length),mu("Reference.set",this.path),hu("Reference.set",1,t,this.path,!1),Ya("Reference.set",2,e,!0);var n=new Ta;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},Ql.prototype.update=function(t,e){if(Ga("Reference.update",1,2,arguments.length),mu("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,As("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}lu("Reference.update",1,t,this.path,!1),Ya("Reference.update",2,e,!0);var i=new Ta;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},Ql.prototype.setWithPriority=function(t,e,n){if(Ga("Reference.setWithPriority",2,3,arguments.length),mu("Reference.setWithPriority",this.path),hu("Reference.setWithPriority",1,t,this.path,!1),fu("Reference.setWithPriority",2,e,!1),Ya("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new Ta;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},Ql.prototype.remove=function(t){return Ga("Reference.remove",0,1,arguments.length),mu("Reference.remove",this.path),Ya("Reference.remove",1,t,!0),this.set(null,t)},Ql.prototype.transaction=function(t,r,e){if(Ga("Reference.transaction",1,3,arguments.length),mu("Reference.transaction",this.path),Ya("Reference.transaction",1,t,!1),Ya("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(za(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new Ta;return"function"==typeof r&&i.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new Iu(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},Ql.prototype.setPriority=function(t,e){Ga("Reference.setPriority",1,2,arguments.length),mu("Reference.setPriority",this.path),fu("Reference.setPriority",1,t,!1),Ya("Reference.setPriority",2,e,!0);var n=new Ta;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},Ql.prototype.push=function(t,e){Ga("Reference.push",0,2,arguments.length),mu("Reference.push",this.path),hu("Reference.push",1,t,this.path,!0),Ya("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=Du(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},Ql.prototype.onDisconnect=function(){return mu("Reference.onDisconnect",this.path),new Eu(this.repo,this.path)},Object.defineProperty(Ql.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(Ql.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(Ql.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(Ql.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Ql);function Ql(t,e){if(!(t instanceof Ll))throw new Error("new Reference() no longer supported - use app.database().");return Wl.call(this,t,e,Bl.DEFAULT,!1)||this}qc.__referenceConstructor=Kl,Rh.__referenceConstructor=Kl;var Hl,Gl,zl=function(){this.children={},this.childCount=0,this.value=null},Yl=(Xl.prototype.subTree=function(t){for(var e,n=t instanceof Js?t:new Js(t),r=this;null!==(e=n.getFront());)r=new Xl(e,r,Ua(r.node_.children,e)||new zl),n=n.popFront();return r},Xl.prototype.getValue=function(){return this.node_.value},Xl.prototype.setValue=function(t){ga(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},Xl.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},Xl.prototype.hasChildren=function(){return 0<this.node_.childCount},Xl.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},Xl.prototype.forEachChild=function(n){var r=this;Qs(this.node_.children,function(t,e){n(new Xl(t,r,e))})},Xl.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},Xl.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},Xl.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},Xl.prototype.path=function(){return new Js(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},Xl.prototype.name=function(){return this.name_},Xl.prototype.parent=function(){return this.parent_},Xl.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},Xl.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Fa(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},Xl);function Xl(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new zl),this.name_=t,this.parent_=e,this.node_=n}(Gl=Hl=Hl||{})[Gl.RUN=0]="RUN",Gl[Gl.SENT=1]="SENT",Gl[Gl.COMPLETED=2]="COMPLETED",Gl[Gl.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Gl[Gl.NEEDS_ABORT=4]="NEEDS_ABORT",Ll.MAX_TRANSACTION_RETRIES_=25,Ll.prototype.transactions_init_=function(){this.transactionQueueTree_=new Yl},Ll.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);function i(){}var o=new Kl(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:Fs(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new kc(a.currentInputSnapshot,new Kl(this,a.path),Xu);a.onComplete(null,!1,c)}}else{Tu("transaction failed: Data returned ",u,a.path),a.status=Hl.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&Fa(u,".priority"))f=Ua(u,".priority"),ga(cu(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||gc.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=Ec(u,f),y=Yc(d,s,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Ll.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||gc.EMPTY_NODE},Ll.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);ga(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===Hl.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Ll.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];ga(o.status===Hl.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=Hl.SENT,o.retryCount++;var a=Js.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=Hl.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new Kl(c,u[r].path),a=new kc(i,o,Xu);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)Gs(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===Hl.SENT_NEEDS_ABORT?u[r].status=Hl.NEEDS_ABORT:u[r].status=Hl.RUN;else{As("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=Hl.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},Ll.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Ll.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===Hl.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Js.relativePath(e,s.path),c=!1,h=void 0;if(ga(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===Hl.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===Hl.RUN)if(s.retryCount>=Ll.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){Tu("transaction failed: Data returned ",f,s.path);var p=Ec(f);"object"==typeof f&&null!=f&&Fa(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=Yc(p,l,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=Hl.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var g=new Kl(this,t[a].path),v=t[a].currentInputSnapshot,b=new kc(v,g,Xu);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)Gs(r[a]);this.sendReadyTransactions_()}},Ll.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Ll.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Ll.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Ll.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Hl.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Ll.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Ll.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===Hl.SENT_NEEDS_ABORT);else if(e[o].status===Hl.SENT)ga(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=Hl.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(ga(e[o].status===Hl.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)Gs(n[o])}};var Jl,$l="databaseURL",Zl=(tf.getInstance=function(){return Jl=Jl||new tf},tf.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},tf.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},tf.prototype.databaseFromApp=function(t,e){var n=e||t.options[$l];void 0===n&&Ns("Can't determine Firebase Database URL.  Be sure to include "+$l+" option when calling firebase.initializeApp().");var r=au(n),i=r.repoInfo,o=void 0;return"undefined"!=typeof process&&(o=process.env.FIREBASE_DATABASE_EMULATOR_HOST),o&&(n="http://"+o+"?ns="+i.namespace,i=(r=au(n)).repoInfo),gu("Invalid Firebase Database URL",1,r),r.path.isEmpty()||Ns("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},tf.prototype.deleteRepo=function(t){var e=Ua(this.repos_,t.app.name);e&&Ua(e,t.repoInfo_.toURLString())===t||Ns("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},tf.prototype.createRepo=function(t,e){var n=Ua(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Ua(n,t.toURLString());return r&&Ns("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Ll(t,this.useRestClient_,e),n[t.toURLString()]=r},tf.prototype.forceRestClient=function(t){this.useRestClient_=t},tf);function tf(){this.repos_={},this.useRestClient_=!1}var ef=(Object.defineProperty(nf.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),nf.prototype.ref=function(t){return this.checkDeleted_("ref"),Ga("database.ref",0,1,arguments.length),t instanceof Kl?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},nf.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Ga(e,1,1,arguments.length);var n=au(t);gu(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Ns(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},nf.prototype.checkDeleted_=function(t){null===this.repo_&&Ns("Cannot call "+t+" on a deleted database.")},nf.prototype.goOffline=function(){Ga("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},nf.prototype.goOnline=function(){Ga("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},nf.ServerValue={TIMESTAMP:{".sv":"timestamp"},_increment:function(t){return{".sv":{increment:t}}}},nf);function nf(t){(this.repo_=t)instanceof Ll||Ns("Don't call new Database() directly - please use firebase.database()."),this.root_=new Kl(t,Js.Empty),this.INTERNAL=new rf(this)}var rf=(of.prototype.delete=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){return this.database.checkDeleted_("delete"),Zl.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},of);function of(t){this.database=t}var af=Object.freeze({__proto__:null,forceLongPolling:function(){wl.forceDisallow(),dl.forceAllow()},forceWebSockets:function(){dl.forceDisallow()},isWebSocketsAvailable:function(){return wl.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),sf=kl;kl.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},kl.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var uf,cf,hf=Sl,lf=iu,ff=Object.freeze({__proto__:null,DataConnection:sf,RealTimeConnection:hf,hijackHash:function(i){var o=kl.prototype.put;return kl.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){kl.prototype.put=o}},ConnectionTarget:lf,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){Zl.getInstance().forceRestClient(t)}}),pf=ef.ServerValue;uf=(cf=fl).SDK_VERSION,vl=uf,cf.INTERNAL.registerService("database",function(t,e,n){return Zl.getInstance().databaseFromApp(t,n)},{Reference:Kl,Query:qc,Database:ef,DataSnapshot:kc,enableLogging:Es,INTERNAL:af,ServerValue:pf,TEST_ACCESS:ff},null,!0);var df,yf="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},mf=mf||{},gf=yf;function vf(t){return"string"==typeof t}function bf(t){return"number"==typeof t}function wf(t,e){t=t.split("."),e=e||gf;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function _f(){}function Tf(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Ef(t){return"array"==Tf(t)}function Sf(t){var e=Tf(t);return"array"==e||"object"==e&&"number"==typeof t.length}function If(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Cf="closure_uid_"+(1e9*Math.random()>>>0),Nf=0;function Af(t,e,n){return t.call.apply(t.bind,arguments)}function kf(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function Df(t,e,n){return(Df=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Af:kf).apply(null,arguments)}function Rf(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var Of=Date.now||function(){return+new Date};function Pf(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).yb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function Mf(){this.j=this.j,this.i=this.i}Mf.prototype.j=!1,Mf.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[Cf]||(this[Cf]=++Nf)},Mf.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Lf=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(vf(t))return vf(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},xf=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=vf(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Ff(){return Array.prototype.concat.apply([],arguments)}function Uf(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Vf(t){return/^[\s\xa0]*$/.test(t)}var qf,Bf=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function jf(t,e){return-1!=t.indexOf(e)}function Wf(t,e){return t<e?-1:e<t?1:0}t:{var Kf=gf.navigator;if(Kf){var Qf=Kf.userAgent;if(Qf){qf=Qf;break t}}qf=""}function Hf(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Gf(t){var e,n={};for(e in t)n[e]=t[e];return n}var zf="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Yf(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<zf.length;i++)e=zf[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function Xf(t){return Xf[" "](t),t}Xf[" "]=_f;var Jf,$f,Zf=jf(qf,"Opera"),tp=jf(qf,"Trident")||jf(qf,"MSIE"),ep=jf(qf,"Edge"),np=ep||tp,rp=jf(qf,"Gecko")&&!(jf(qf.toLowerCase(),"webkit")&&!jf(qf,"Edge"))&&!(jf(qf,"Trident")||jf(qf,"MSIE"))&&!jf(qf,"Edge"),ip=jf(qf.toLowerCase(),"webkit")&&!jf(qf,"Edge");function op(){var t=gf.document;return t?t.documentMode:void 0}t:{var ap="",sp=($f=qf,rp?/rv:([^\);]+)(\)|;)/.exec($f):ep?/Edge\/([\d\.]+)/.exec($f):tp?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec($f):ip?/WebKit\/(\S+)/.exec($f):Zf?/(?:Version)[ \/]?(\S+)/.exec($f):void 0);if(sp&&(ap=sp?sp[1]:""),tp){var up=op();if(null!=up&&up>parseFloat(ap)){Jf=String(up);break t}}Jf=ap}var cp,hp={};function lp(s){return function(t,e){var n=hp;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=Bf(String(Jf)).split("."),n=Bf(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Wf(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Wf(0==o[2].length,0==a[2].length)||Wf(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}var fp=gf.document;cp=fp&&tp?op()||("CSS1Compat"==fp.compatMode?parseInt(Jf,10):5):void 0;var pp=!tp||9<=Number(cp),dp=tp&&!lp("9"),yp=function(){if(!gf.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{gf.addEventListener("test",_f,e),gf.removeEventListener("test",_f,e)}catch(t){}return t}();function mp(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function gp(t,e){if(mp.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(rp){t:{try{Xf(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=vf(t.pointerType)?t.pointerType:vp[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}mp.prototype.b=function(){this.Ja=!1},Pf(gp,mp);var vp={2:"touch",3:"pen",4:"mouse"};gp.prototype.b=function(){gp.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,dp)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var bp="closure_listenable_"+(1e6*Math.random()|0),wp=0;function _p(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++wp,this.X=this.Z=!1}function Tp(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Ep(t){this.src=t,this.a={},this.b=0}function Sp(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=Lf(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Tp(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Ip(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Ep.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Ip(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new _p(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Cp="closure_lm_"+(1e6*Math.random()|0),Np={};function Ap(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Ef(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=xp(r);return e&&e[bp]?e.Ba(n,r,If(i)?!!i.capture:!!i,o):kp(e,n,r,!0,i,o)}(t,e,n,r,i);if(Ef(e)){for(var o=0;o<e.length;o++)Ap(t,e[o],n,r,i);return null}return n=xp(n),t&&t[bp]?t.Aa(e,n,If(r)?!!r.capture:!!r,i):kp(t,e,n,!1,r,i)}function kp(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=If(i)?!!i.capture:!!i;if(a&&!pp)return null;var s=Mp(t);if(s||(t[Cp]=s=new Ep(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var e=Pp,n=pp?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)yp||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rp(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Dp(t){if(!bf(t)&&t&&!t.X){var e=t.src;if(e&&e[bp])Sp(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rp(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Mp(e))?(Sp(n,t),0==n.b&&(n.src=null,e[Cp]=null)):Tp(t)}}}function Rp(t){return t in Np?Np[t]:Np[t]="on"+t}function Op(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Dp(t),n.call(r,e)}function Pp(t,e){return!!t.X||(pp?Op(t,new gp(e,this)):Op(t,e=new gp(e||wf("window.event"),this)))}function Mp(t){return(t=t[Cp])instanceof Ep?t:null}var Lp="__closure_events_fn_"+(1e9*Math.random()>>>0);function xp(e){return"function"==Tf(e)?e:(e[Lp]||(e[Lp]=function(t){return e.handleEvent(t)}),e[Lp])}function Fp(){Mf.call(this),this.c=new Ep(this),(this.J=this).B=null}function Up(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Sp(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}Pf(Fp,Mf),Fp.prototype[bp]=!0,(df=Fp.prototype).addEventListener=function(t,e,n,r){Ap(this,t,e,n,r)},df.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Ef(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=If(i)?!!i.capture:!!i,r=xp(r),e&&e[bp]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Ip(a=e.a[n],r,i,o))&&(Tp(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&Mp(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Ip(n,r,i,o)),(r=-1<e?n[e]:null)&&Dp(r))}(this,t,e,n,r)},df.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(vf(t))t=new mp(t,n);else if(t instanceof mp)t.target=t.target||n;else{var i=t;Yf(t=new mp(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Up(a,r,!0,t)&&i}if(i=Up(a=t.a=n,r,!0,t)&&i,i=Up(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Up(a=t.a=e[o],r,!1,t)&&i;return i},df.G=function(){if(Fp.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Tp(n[r]);delete e.a[t],e.b--}}this.B=null},df.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},df.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Vp=gf.JSON.stringify;function qp(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Bp(){this.b=this.a=null}qp.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var jp,Wp=new qp(function(){return new Kp},function(t){t.reset()});function Kp(){this.next=this.b=this.a=null}function Qp(t){gf.setTimeout(function(){throw t},0)}function Hp(t,e){jp||function(){var t=gf.Promise.resolve(void 0);jp=function(){t.then(Yp)}}(),Gp||(jp(),Gp=!0),zp.add(t,e)}Bp.prototype.add=function(t,e){var n=Wp.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Kp.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Gp=!(Kp.prototype.reset=function(){this.next=this.b=this.a=null}),zp=new Bp;function Yp(){for(var t;r=n=void 0,r=null,(n=zp).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Qp(t)}var e=Wp;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;Gp=!1}function Xp(t,e){Fp.call(this),this.b=t||1,this.a=e||gf,this.f=Df(this.gb,this),this.g=Of()}function Jp(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function $p(t,e,n){if("function"==Tf(t))n&&(t=Df(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Df(t.handleEvent,t)}return 2147483647<Number(e)?-1:gf.setTimeout(t,e||0)}function Zp(t,e,n){Mf.call(this),this.f=null!=n?Df(t,n):t,this.c=e,this.b=Df(this.ab,this),this.a=[]}function td(t){t.U=$p(t.b,t.c),t.f.apply(null,t.a)}function ed(t){Mf.call(this),this.b=t,this.a={}}Pf(Xp,Fp),(df=Xp.prototype).ba=!1,df.L=null,df.gb=function(){if(this.ba){var t=Of()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Jp(this),this.start()))}},df.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Of())},df.G=function(){Xp.N.G.call(this),Jp(this),delete this.a},Pf(Zp,Mf),(df=Zp.prototype).ea=!1,df.U=null,df.Ua=function(t){this.a=arguments,this.U?this.ea=!0:td(this)},df.G=function(){Zp.N.G.call(this),this.U&&(gf.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},df.ab=function(){this.U=null,this.ea&&(this.ea=!1,td(this))},Pf(ed,Mf);var nd=[];function rd(t,e,n,r){Ef(n)||(n&&(nd[0]=n.toString()),n=nd);for(var i=0;i<n.length;i++){var o=Ap(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function id(t){Hf(t.a,function(t,e){this.a.hasOwnProperty(e)&&Dp(t)},t),t.a={}}function od(){}ed.prototype.G=function(){ed.N.G.call(this),id(this)},ed.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ad=new Fp;function sd(t){mp.call(this,"serverreachability",t)}function ud(t){ad.dispatchEvent(new sd(ad,t))}function cd(t){mp.call(this,"statevent",t)}function hd(t){ad.dispatchEvent(new cd(ad,t))}function ld(t){mp.call(this,"timingevent",t)}function fd(t,e){if("function"!=Tf(t))throw Error("Fn must not be null and must be a function");return gf.setTimeout(function(){t()},e)}Pf(sd,mp),Pf(cd,mp),Pf(ld,mp);var pd={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},dd={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function yd(){}function md(t){var e;return(e=t.a)||(e=t.a={}),e}function gd(){}yd.prototype.a=null;var vd,bd={OPEN:"a",ib:"b",Na:"c",rb:"d"};function wd(){mp.call(this,"d")}function _d(){mp.call(this,"c")}function Td(){}function Ed(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new ed(this),this.O=Sd,t=np?125:void 0,this.P=new Xp(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Pf(wd,mp),Pf(_d,mp),Pf(Td,yd),vd=new Td;var Sd=45e3,Id={},Cd={};function Nd(t,e,n){t.F=1,t.f=$d(Qd(e)),t.l=n,t.H=!0,kd(t,null)}function Ad(t,e,n,r){t.F=1,t.f=$d(Qd(e)),t.l=null,t.H=n,kd(t,r)}function kd(t,e){t.v=Of(),Od(t),t.D=Qd(t.f),Jd(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Zp(Df(t.Ka,t,t.a),t.J)),rd(t.I,t.a,"readystatechange",t.eb),e=t.h?Gf(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ud(1)}function Dd(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Rd(t,n);if(i==Cd){4==e&&(t.c=4,hd(14),r=!1);break}if(i==Id){t.c=4,hd(15),r=!1;break}Fd(t,i)}4==e&&0==n.length&&(t.c=1,hd(16),r=!1),t.b=t.b&&r,r||(xd(t),Ld(t))}function Rd(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Cd:(n=Number(e.substring(n,r)),isNaN(n)?Id:(r+=1)+n>e.length?Cd:(e=e.substr(r,n),t.A=r+n,e))}function Od(t){t.R=Of()+t.O,Pd(t,t.O)}function Pd(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=fd(Df(t.bb,t),e)}function Md(t){t.i&&(gf.clearTimeout(t.i),t.i=null)}function Ld(t){t.g.Da()||t.m||t.g.na(t)}function xd(t){Md(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Jp(t.P),id(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Fd(t,e){try{t.g.Ga(t,e),ud(4)}catch(t){}}function Ud(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Sf(t)||vf(t))xf(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(Sf(t)||vf(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(vf(t))return t.split("");if(Sf(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Vd(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Vd)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qd(t,e){jd(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Bd(t))}function Bd(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];jd(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)jd(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function jd(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(df=Ed.prototype).setTimeout=function(t){this.O=t},df.eb=function(t){t=t.target;var e=this.B;e&&3==Ky(t)?e.Ua():this.Ka(t)},df.Ka=function(t){try{if(t==this.a)t:{var e=Ky(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!np&&!this.a.aa())){this.m||4!=e||7==n||ud(8==n||r<=0?3:2),Md(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Qy(this.a,"X-HTTP-Initial-Response");if(a&&!Vf(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,hd(12),xd(this),Ld(this);break t}this.s=!0,Fd(this,s)}this.H?(Dd(this,e,o),np&&this.b&&3==e&&(rd(this.I,this.P,"tick",this.cb),this.P.start())):Fd(this,o),4==e&&xd(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Od(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,hd(12)):(this.c=0,hd(13)),xd(this),Ld(this)}}}catch(t){}},df.cb=function(){if(this.a){var t=Ky(this.a),e=this.a.aa();this.A<e.length&&(Md(this),Dd(this,t,e),this.b&&4!=t&&Od(this))}},df.cancel=function(){this.m=!0,xd(this)},df.bb=function(){this.i=null;var t=Of();0<=t-this.R?(2!=this.F&&(ud(3),hd(17)),xd(this),this.c=2,Ld(this)):Pd(this,this.R-t)},(df=Vd.prototype).C=function(){Bd(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},df.K=function(){return Bd(this),this.a.concat()},df.get=function(t,e){return jd(this.b,t)?this.b[t]:e},df.set=function(t,e){jd(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},df.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Wd=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Kd(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Kd?(this.h=void 0!==e?e:t.h,Hd(this,t.f),this.j=t.j,Gd(this,t.b),zd(this,t.i),this.a=t.a,Yd(this,fy(t.c)),this.g=t.g):t&&(n=String(t).match(Wd))?(this.h=!!e,Hd(this,n[1]||"",!0),this.j=Zd(n[2]||""),Gd(this,n[3]||"",!0),zd(this,n[4]),this.a=Zd(n[5]||"",!0),Yd(this,n[6]||"",!0),this.g=Zd(n[7]||"")):(this.h=!!e,this.c=new sy(null,this.h))}function Qd(t){return new Kd(t)}function Hd(t,e,n){t.f=n?Zd(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Gd(t,e,n){t.b=n?Zd(e,!0):e}function zd(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Yd(t,e,n){e instanceof sy?(t.c=e,function(t,e){e&&!t.f&&(uy(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cy(this,e),ly(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=ty(e,oy)),t.c=new sy(e,t.h))}function Xd(t,e,n){t.c.set(e,n)}function Jd(t,e,n){Ef(n)||(n=[String(n)]),ly(t.c,e,n)}function $d(t){return Xd(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Of()).toString(36)),t}function Zd(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ty(t,e,n){return vf(t)?(t=encodeURI(t).replace(e,ey),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ey(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Kd.prototype.toString=function(){var t=[],e=this.f;e&&t.push(ty(e,ny,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(ty(e,ny,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(ty(n,"/"==n.charAt(0)?iy:ry,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",ty(n,ay)),t.join("")},Kd.prototype.resolve=function(t){var e=Qd(this),n=!!t.f;n?Hd(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Gd(e,t.b):n=null!=t.i;var r=t.a;if(n)zd(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(jf(i,"./")||jf(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Yd(e,fy(t.c)):n=!!t.g,n&&(e.g=t.g),e};var ny=/[#\/\?@]/g,ry=/[#\?:]/g,iy=/[#\?]/g,oy=/[#\?@]/g,ay=/#/g;function sy(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function uy(n){n.a||(n.a=new Vd,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function cy(t,e){uy(t),e=py(t,e),jd(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,qd(t.a,e))}function hy(t,e){return uy(t),e=py(t,e),jd(t.a.b,e)}function ly(t,e,n){cy(t,e),0<n.length&&(t.c=null,t.a.set(py(t,e),Uf(n)),t.b+=n.length)}function fy(t){var e=new sy;return e.c=t.c,t.a&&(e.a=new Vd(t.a),e.b=t.b),e}function py(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function dy(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function yy(t){var e=t.a.F.a;if(null!=e)hd(4),e?(hd(10),rm(t.a,t,!1)):(hd(11),rm(t.a,t,!0));else{t.b=new Ed(t,void 0,void 0),t.b.h=t.h,e=um(e=t.a,e.Y()?t.f:null,t.i),hd(4),Jd(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Xd(e,n,r),Ad(t.b,e,!1,t.f)}}function my(){this.a=this.b=null}function gy(){this.a=new Vd}function vy(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Cf]||(t[Cf]=++Nf)):e.charAt(0)+t}function by(t,e){this.b=t,this.a=e}function wy(t){this.g=t||_y,t=gf.PerformanceNavigationTiming?0<(t=gf.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(gf.ka&&gf.ka.Ea&&gf.ka.Ea()&&gf.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new gy),this.b=null,this.c=[]}(df=sy.prototype).add=function(t,e){uy(this),this.c=null,t=py(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},df.forEach=function(n,r){uy(this),this.a.forEach(function(t,e){xf(t,function(t){n.call(r,t,e,this)},this)},this)},df.K=function(){uy(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},df.C=function(t){uy(this);var e=[];if(vf(t))hy(this,t)&&(e=Ff(e,this.a.get(py(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Ff(e,t[n])}return e},df.set=function(t,e){return uy(this),this.c=null,hy(this,t=py(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},df.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},df.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Pf(function(){},function(){}),(df=dy.prototype).M=null,df.$=function(t){return this.a.$(t)},df.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},df.Da=function(){return!1},df.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Qy(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Qy(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void am(e,2)}this.f=r[0]}else(e=this.a).m=this.c,am(e,2)}else 1==this.M&&(this.g?hd(6):"11111"==e?(hd(5),this.g=!0,(!tp||10<=Number(cp))&&(this.c=200,this.b.cancel(),hd(11),rm(this.a,this,!0))):(hd(7),this.g=!1))},df.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,yy(this)):1==this.M&&(this.g?(hd(11),rm(this.a,this,!0)):(hd(10),rm(this.a,this,!1)));else{0==this.M?hd(8):1==this.M&&hd(9);var t=this.a;t.m=this.c,am(t,2)}},df.Y=function(){return this.a.Y()},df.ma=function(){return this.a.ma()},gy.prototype.add=function(t){this.a.set(vy(t),t)},gy.prototype.C=function(){return this.a.C()};var _y=10;function Ty(t,e){!t.a&&(jf(e,"spdy")||jf(e,"quic")||jf(e,"h2"))&&(t.f=t.g,t.a=new gy,t.b&&(Cy(t,t.b),t.b=null))}function Ey(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Sy(t){return t.b?1:t.a?t.a.a.c:0}function Iy(t,e){return t=t.b?t.b==e:!!t.a&&(e=vy(e),jd(t.a.a.b,e))}function Cy(t,e){t.a?t.a.add(e):t.b=e}function Ny(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=vy(e),n=jd(t.a.a.b,n)),n&&qd(t.a.a,vy(e)))}function Ay(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Uf(t.c);var e=t.c;return xf(t.a.C(),function(t){e=e.concat(t.j)}),e}function ky(){}function Dy(){this.a=new ky}function Ry(t,r,e){var i=e||"";try{Ud(t,function(t,e){var n=t;If(t)&&(n=Vp(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Oy(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}wy.prototype.cancel=function(){this.c=Ay(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(xf(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},ky.prototype.stringify=function(t){return gf.JSON.stringify(t,void 0)},ky.prototype.parse=function(t){return gf.JSON.parse(t,void 0)};var Py=gf.JSON.parse;function My(t){Fp.call(this),this.headers=new Vd,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Ly,this.D=this.F=!1}Pf(My,Fp);var Ly="",xy=/^https?$/i,Fy=["POST","PUT"];function Uy(t){return"content-type"==t.toLowerCase()}function Vy(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,qy(t),jy(t)}function qy(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function By(t){if(t.b&&void 0!==mf&&(!t.s[1]||4!=Ky(t)||2!=t.T()))if(t.l&&4==Ky(t))$p(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Ky(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Wd)[1]||null;if(!o&&gf.self&&gf.self.location){var a=gf.self.location.protocol;o=a.substr(0,a.length-1)}i=!xy.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",qy(t))}finally{jy(t)}}}function jy(t,e){if(t.a){Wy(t);var n=t.a,r=t.s[0]?_f:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Wy(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(gf.clearTimeout(t.m),t.m=null)}function Ky(t){return t.a?t.a.readyState:0}function Qy(t,e){return t.a?t.a.getResponseHeader(e):null}function Hy(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return Hf(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),vf(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Xd(t,e,n),t}function Gy(t){this.f=[],this.F=new my,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!wf("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=wf("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=wf("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=wf("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=wf("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new wy(t&&t.concurrentRequestLimit),this.ja=new Dy,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function zy(t){if(Yy(t),3==t.u){var e=t.P++,n=Qd(t.B);Xd(n,"SID",t.H),Xd(n,"RID",e),Xd(n,"TYPE","terminate"),Zy(t,n),(e=new Ed(t,e,void 0)).F=2,e.f=$d(Qd(n)),n=!1,gf.navigator&&gf.navigator.sendBeacon&&(n=gf.navigator.sendBeacon(e.f.toString(),"")),!n&&gf.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Of(),Od(e)}sm(t)}function Yy(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(gf.clearTimeout(t.l),t.l=null),im(t),t.b.cancel(),t.h&&(bf(t.h)&&gf.clearTimeout(t.h),t.h=null)}function Xy(t,e){t.f.push(new by(t.Ra++,e)),3==t.u&&Jy(t)}function Jy(t){Ey(t.b)||t.h||(t.h=!0,Hp(t.Ia,t),t.A=0)}function $y(t,e){var n;n=e?e.W:t.P++;var r=Qd(t.B);Xd(r,"SID",t.H),Xd(r,"RID",n),Xd(r,"AID",t.O),Zy(t,r),t.g&&t.i&&Hy(r,t.g,t.i),n=new Ed(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=tm(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Cy(t.b,n),Nd(n,r,e)}function Zy(t,n){t.c&&Ud({},function(t,e){Xd(n,e,t)})}function tm(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Df(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Ry(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function em(t){t.a||t.l||(t.S=1,Hp(t.Ha,t),t.v=0)}function nm(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=fd(Df(t.Ha,t),om(t,t.v)),t.v++,!0)}function rm(t,e,n){var r=e.l;r&&Ty(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=um(t,null,t.ha),Jy(t)}function im(t){null!=t.s&&(gf.clearTimeout(t.s),t.s=null)}function om(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function am(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Df(t.fb,t);n||(n=new Kd("//www.google.com/images/cleardot.gif"),gf.location&&"http"==gf.location.protocol||Hd(n,"https"),$d(n)),function(t,e){var n=new od;if(gf.Image){var r=new Image;r.onload=Rf(Oy,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Rf(Oy,n,r,"TestLoadImage: error",!1,e),r.onabort=Rf(Oy,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Rf(Oy,n,r,"TestLoadImage: timeout",!1,e),gf.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else hd(2);t.u=0,t.c&&t.c.ta(e),sm(t),Yy(t)}function sm(t){t.u=0,t.m=-1,t.c&&(0==Ay(t.b).length&&0==t.f.length||(t.b.c.length=0,Uf(t.f),t.f.length=0),t.c.sa())}function um(t,e,n){var r=function(t){return t instanceof Kd?Qd(t):new Kd(t,void 0)}(n);if(""!=r.b)e&&Gd(r,e+"."+r.b),zd(r,r.i);else{var i,o=gf.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Kd(null,void 0);return t&&Hd(i,t),e&&Gd(i,e),n&&zd(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&Hf(t.V,function(t,e){Xd(r,e,t)}),e=t.j,n=t.I,e&&n&&Xd(r,e,n),Xd(r,"VER",t.wa),Zy(t,r),r}function cm(){}function hm(){if(tp&&!(10<=Number(cp)))throw Error("Environmental error: no available transport.")}function lm(t,e){Fp.call(this),this.a=new Gy(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Vf(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Vf(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new dm(this)}function fm(t){wd.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function pm(){_d.call(this),this.status=1}function dm(t){this.a=t}(df=My.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?md(this.H):md(vd),this.a.onreadystatechange=Df(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Vy(this,t)}t=n||"";var i=new Vd(this.headers);r&&Ud(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Uy,n=t.length,r=vf(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:vf(t)?t.charAt(e):t[e]}(i.K()),n=gf.FormData&&t instanceof gf.FormData,0<=Lf(Fy,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Wy(this),0<this.o&&((this.D=function(t){return tp&&lp(9)&&bf(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Df(this.Ca,this)):this.m=$p(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Vy(this,t)}},df.Ca=function(){void 0!==mf&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},df.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jy(this))},df.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jy(this,!0)),My.N.G.call(this)},df.Fa=function(){this.j||(this.w||this.l||this.g?By(this):this.$a())},df.$a=function(){By(this)},df.T=function(){try{return 2<Ky(this)?this.a.status:-1}catch(t){return-1}},df.za=function(){try{return 2<Ky(this)?this.a.statusText:""}catch(t){return""}},df.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},df.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Py(e)}},df.ya=function(){return this.h},df.Ya=function(){return vf(this.f)?this.f:String(this.f)},(df=Gy.prototype).wa=8,df.u=1,df.Da=function(){return 0==this.u},df.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Ed(this,t,void 0),r=this.i;if(this.J&&(r?Yf(r=Gf(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&vf(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=tm(this,n,e),Xd(i=Qd(this.B),"RID",t),Xd(i,"CVER",22),this.o&&this.j&&Xd(i,"X-HTTP-Session-Id",this.j),Zy(this,i),this.g&&r&&Hy(i,this.g,r),Cy(this.b,n),this.W?(Xd(i,"$req",e),Xd(i,"SID","null"),n.S=!0,Nd(n,i,null)):Nd(n,i,e),this.u=2}}else 3==this.u&&(t?$y(this,t):0==this.f.length||Ey(this.b)||$y(this))},df.Ha=function(){this.l=null,this.a=new Ed(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Qd(this.pa);Xd(t,"RID","rpc"),Xd(t,"SID",this.H),Xd(t,"CI",this.ia?"0":"1"),Xd(t,"AID",this.O),Zy(this,t),Xd(t,"TYPE","xmlhttp"),this.g&&this.i&&Hy(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Ad(this.a,t,!0,this.ga)},df.Ga=function(t,e){if(0!=this.u&&(this.a==t||Iy(this.b,t)))if(this.m=t.o,!t.s&&Iy(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(Ef(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;im(this),this.a.cancel(),this.a=null}nm(this),hd(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=fd(Df(this.Za,this),6e3));if(Sy(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else am(this,11)}else if(!t.s&&this.a!=t||im(this),!Vf(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&bf(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Qy(r,"X-Client-Wire-Protocol"))&&Ty(this.b,i),this.j&&(r=Qy(r,"X-HTTP-Session-Id")))&&(this.I=r,Xd(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=um(this,this.Y()?this.ga:null,this.ha),r.s?(Ny(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Md(r),Od(r)),this.a=r):em(this),0<this.f.length&&Jy(this)}else"stop"!=r[0]&&"close"!=r[0]||am(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?am(this,7):zy(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},df.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,nm(this),hd(19))},df.na=function(t){var e=null;if(this.a==t){im(this),this.a=null;var n=2}else{if(!Iy(this.b,t))return;e=t.j,Ny(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Of()-t.v,ad.dispatchEvent(new ld(ad,t.l?t.l.length:0,e,this.A)),Jy(this)):em(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Sy(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa))&&(t.h=fd(Df(t.Ia,t,e),om(t,t.A)),t.A++,!0))}(this,t)||2==n&&nm(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:am(this,5);break;case 4:am(this,10);break;case 3:am(this,6);break;default:am(this,2)}}},df.fb=function(t){hd(t?2:1)},df.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new My(this.La)).F=this.R,t},df.ma=function(){return!!this.c&&!0},df.Y=function(){return this.R},(df=cm.prototype).va=function(){},df.ua=function(){},df.ta=function(){},df.sa=function(){},df.Ta=function(){},hm.prototype.a=function(t,e){return new lm(t,e)},Pf(lm,Fp),(df=lm.prototype).addEventListener=function(t,e,n,r){lm.N.addEventListener.call(this,t,e,n,r)},df.removeEventListener=function(t,e,n,r){lm.N.removeEventListener.call(this,t,e,n,r)},df.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;hd(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new dy(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Hy(e,t.g,t.i)),(t=t.w).i=n,e=um(t.a,null,t.i),hd(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,yy(t)):(Jd(e,"MODE","init"),!t.a.o&&t.a.j&&Jd(e,"X-HTTP-Session-Id",t.a.j),t.b=new Ed(t,void 0,void 0),t.b.h=t.h,Ad(t.b,e,!1,null),t.M=0)},df.close=function(){zy(this.a)},df.Xa=function(t){if(vf(t)){var e={};e.__data__=t,Xy(this.a,e)}else this.h?((e={}).__data__=Vp(t),Xy(this.a,e)):Xy(this.a,t)},df.G=function(){this.a.c=null,delete this.f,zy(this.a),delete this.a,lm.N.G.call(this)},Pf(fm,wd),Pf(pm,_d),Pf(dm,cm),dm.prototype.va=function(){this.a.dispatchEvent("a")},dm.prototype.ua=function(t){this.a.dispatchEvent(new fm(t))},dm.prototype.ta=function(t){this.a.dispatchEvent(new pm(t))},dm.prototype.sa=function(){this.a.dispatchEvent("b")};var ym=Rf(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},hm);hm.prototype.createWebChannel=hm.prototype.a,lm.prototype.send=lm.prototype.Xa,lm.prototype.open=lm.prototype.Wa,lm.prototype.close=lm.prototype.close,pd.NO_ERROR=0,pd.TIMEOUT=8,pd.HTTP_ERROR=6,dd.COMPLETE="complete",(gd.EventType=bd).OPEN="a",bd.CLOSE="b",bd.ERROR="c",bd.MESSAGE="d",Fp.prototype.listen=Fp.prototype.Aa,My.prototype.listenOnce=My.prototype.Ba,My.prototype.getLastError=My.prototype.Ya,My.prototype.getLastErrorCode=My.prototype.ya,My.prototype.getStatus=My.prototype.T,My.prototype.getStatusText=My.prototype.za,My.prototype.getResponseJson=My.prototype.Va,My.prototype.getResponseText=My.prototype.aa,My.prototype.send=My.prototype.ca;var mm,gm,vm={createWebChannelTransport:ym,ErrorCode:pd,EventType:dd,WebChannel:gd,XhrIo:My},bm=vm.createWebChannelTransport,wm=vm.ErrorCode,_m=vm.EventType,Tm=vm.WebChannel,Em=vm.XhrIo,Sm=fl.SDK_VERSION,Im=new is("@firebase/firestore");function Cm(){return Im.logLevel===$a.DEBUG?mm.DEBUG:Im.logLevel===$a.SILENT?mm.SILENT:mm.ERROR}function Nm(t){switch(t){case mm.DEBUG:Im.logLevel=$a.DEBUG;break;case mm.ERROR:Im.logLevel=$a.ERROR;break;case mm.SILENT:Im.logLevel=$a.SILENT;break;default:Im.error("Firestore ("+Sm+"): Invalid value passed to `setLogLevel`")}}function Am(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Im.logLevel<=$a.DEBUG){var i=n.map(Dm);Im.debug.apply(Im,pa(["Firestore ("+Sm+") ["+t+"]: "+e],i))}}function km(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Im.logLevel<=$a.ERROR){var r=e.map(Dm);Im.error.apply(Im,pa(["Firestore ("+Sm+"): "+t],r))}}function Dm(e){if("string"==typeof e)return e;var t=Pm.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Rm(t){var e="FIRESTORE ("+Sm+") INTERNAL ASSERTION FAILED: "+t;throw km(e),new Error(e)}function Om(t,e){t||Rm(e)}(gm=mm=mm||{})[gm.DEBUG=0]="DEBUG",gm[gm.ERROR=1]="ERROR",gm[gm.SILENT=2]="SILENT";var Pm=(Mm.setPlatform=function(t){Mm.platform&&Rm("Platform already defined"),Mm.platform=t},Mm.getPlatform=function(){return Mm.platform||Rm("Platform not set"),Mm.platform},Mm);function Mm(){}function Lm(){return Pm.getPlatform().emptyByteString}var xm,Fm={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Um=(aa(Vm,xm=Error),Vm);function Vm(t,e){var n=xm.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function qm(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Um(Fm.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Bm(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function jm(t,e){return void 0!==t?t:e}function Wm(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Km(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Qm(t){for(var e in Om(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Hm(t,e){if(0!==e.length)throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+hg(e.length,"argument")+".")}function Gm(t,e,n){if(e.length!==n)throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires "+hg(n,"argument")+", but was called with "+hg(e.length,"argument")+".")}function zm(t,e,n){if(e.length<n)throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires at least "+hg(n,"argument")+", but was called with "+hg(e.length,"argument")+".")}function Ym(t,e,n,r){if(e.length<n||e.length>r)throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+hg(e.length,"argument")+".")}function Xm(t,e,n,r){ng(t,e,cg(n)+" argument",r)}function Jm(t,e,n,r){void 0!==r&&Xm(t,e,n,r)}function $m(t,e,n,r){ng(t,e,n+" option",r)}function Zm(t,e,n,r){void 0!==r&&$m(t,e,n,r)}function tg(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+ig(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+ig(r[o]))}(t,e,n,r,i)}function eg(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(ig(u))}var c=ig(r);throw new Um(Fm.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function ng(t,e,n,r){if(!("object"===e?rg(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=ig(r);throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function rg(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function ig(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Rm("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function og(t,e,n){if(void 0===n)throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+cg(e)+" argument, but it was undefined.")}function ag(n,t,r){Km(t,function(t,e){if(r.indexOf(t)<0)throw new Um(Fm.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function sg(t,e,n,r){var i=ig(r);return new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires its "+cg(n)+" argument to be a "+e+", but it was: "+i)}function ug(t,e,n){if(n<=0)throw new Um(Fm.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+cg(e)+" argument to be a positive number, but it was: "+n+".")}function cg(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function hg(t,e){return t+" "+e+(1===t?"":"s")}var lg=(fg.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Om(20===e.length,"Invalid auto ID: "+e),e},fg);function fg(){}function pg(t,e){return t<e?-1:e<t?1:0}function dg(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function yg(t){return t+"\0"}function mg(){if("undefined"==typeof Uint8Array)throw new Um(Fm.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function gg(){if(!Pm.getPlatform().base64Available)throw new Um(Fm.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var vg=(bg.fromBase64String=function(t){Gm("Blob.fromBase64String",arguments,1),Xm("Blob.fromBase64String","string",1,t),gg();try{return new bg(Pm.getPlatform().atob(t))}catch(t){throw new Um(Fm.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},bg.fromUint8Array=function(t){if(Gm("Blob.fromUint8Array",arguments,1),mg(),!(t instanceof Uint8Array))throw sg("Blob.fromUint8Array","Uint8Array",1,t);return new bg(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},bg.prototype.toBase64=function(){return Gm("Blob.toBase64",arguments,0),gg(),Pm.getPlatform().btoa(this._binaryString)},bg.prototype.toUint8Array=function(){Gm("Blob.toUint8Array",arguments,0),mg();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},bg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},bg.prototype.isEqual=function(t){return this._binaryString===t._binaryString},bg.prototype._compareTo=function(t){return pg(this._binaryString,t._binaryString)},bg);function bg(t){gg(),this._binaryString=t}var wg=qm(vg,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),_g=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},Tg="(default)",Eg=(Object.defineProperty(Sg.prototype,"isDefaultDatabase",{get:function(){return this.database===Tg},enumerable:!0,configurable:!0}),Sg.prototype.isEqual=function(t){return t instanceof Sg&&t.projectId===this.projectId&&t.database===this.database},Sg.prototype.compareTo=function(t){return pg(this.projectId,t.projectId)||pg(this.database,t.database)},Sg);function Sg(t,e){this.projectId=t,this.database=e||Tg}var Ig=(Cg.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Cg.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Cg.INVALID=-1,Cg);function Cg(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var Ng="__name__",Ag=(Object.defineProperty(kg.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),kg.prototype.isEqual=function(t){return 0===kg.comparator(this,t)},kg.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof kg?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},kg.prototype.limit=function(){return this.offset+this.length},kg.prototype.popFirst=function(t){return t=void 0===t?1:t,Om(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},kg.prototype.popLast=function(){return Om(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},kg.prototype.firstSegment=function(){return Om(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},kg.prototype.lastSegment=function(){return this.get(this.length-1)},kg.prototype.get=function(t){return Om(t<this.length,"Index out of range"),this.segments[this.offset+t]},kg.prototype.isEmpty=function(){return 0===this.length},kg.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},kg.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},kg.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},kg.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},kg.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},kg);function kg(t,e,n){void 0===e?e=0:e>t.length&&Rm("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Rm("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Dg,Rg=(aa(Og,Dg=Ag),Og.prototype.construct=function(t,e,n){return new Og(t,e,n)},Og.prototype.canonicalString=function(){return this.toArray().join("/")},Og.prototype.toString=function(){return this.canonicalString()},Og.fromString=function(t){if(0<=t.indexOf("//"))throw new Um(Fm.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Og(t.split("/").filter(function(t){return 0<t.length}))},Og.EMPTY_PATH=new Og([]),Og);function Og(){return null!==Dg&&Dg.apply(this,arguments)||this}var Pg,Mg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Lg=(aa(xg,Pg=Ag),xg.prototype.construct=function(t,e,n){return new xg(t,e,n)},xg.isValidIdentifier=function(t){return Mg.test(t)},xg.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),xg.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},xg.prototype.toString=function(){return this.canonicalString()},xg.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Ng},xg.keyField=function(){return new xg([Ng])},xg.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Um(Fm.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Um(Fm.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Um(Fm.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Um(Fm.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new xg(e)},xg.EMPTY_PATH=new xg([]),xg);function xg(){return null!==Pg&&Pg.apply(this,arguments)||this}var Fg=(Ug.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Ug.prototype.isEqual=function(t){return null!==t&&0===Rg.comparator(this.path,t.path)},Ug.prototype.toString=function(){return this.path.toString()},Ug.comparator=function(t,e){return Rg.comparator(t.path,e.path)},Ug.isDocumentKey=function(t){return t.length%2==0},Ug.fromSegments=function(t){return new Ug(new Rg(t.slice()))},Ug.fromPathString=function(t){return new Ug(Rg.fromString(t))},Ug.EMPTY=new Ug(new Rg([])),Ug);function Ug(t){this.path=t,Om(Ug.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var Vg,qg,Bg=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(qg=Vg=Vg||{}).All="all",qg.ListenStreamIdle="listen_stream_idle",qg.ListenStreamConnectionBackoff="listen_stream_connection_backoff",qg.WriteStreamIdle="write_stream_idle",qg.WriteStreamConnectionBackoff="write_stream_connection_backoff",qg.OnlineStateTimeout="online_state_timeout",qg.ClientMetadataRefresh="client_metadata_refresh",qg.LruGarbageCollection="lru_garbage_collection",qg.RetryTransaction="retry_transaction";var jg=(Wg.createAndSchedule=function(t,e,n,r,i){var o=new Wg(t,e,Date.now()+n,r,i);return o.start(n),o},Wg.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Wg.prototype.skipDelay=function(){return this.handleDelayElapsed()},Wg.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Um(Fm.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Wg.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Wg.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Wg);function Wg(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Bg,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var Kg=(Object.defineProperty(Qg.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),Qg.prototype.enqueueAndForget=function(t){this.enqueue(t)},Qg.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},Qg.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},Qg.prototype.enqueueAndInitiateShutdown=function(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Qg.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},Qg.prototype.enqueueInternal=function(t){var n=this,e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw km("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},Qg.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Om(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=jg.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},Qg.prototype.verifyNotFailed=function(){this.failure&&Rm("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},Qg.prototype.verifyOperationInProgress=function(){Om(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},Qg.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},Qg.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Qg.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){Om(r===Vg.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==Vg.All&&n.timerId===r)break}return i.drain()})},Qg.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},Qg.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Om(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},Qg);function Qg(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var Hg="",Gg="",zg="",Yg="";function Xg(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=$g(e)),e=Jg(t.get(n),e);return $g(e)}function Jg(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Hg+zg;break;case Hg:n+=Hg+Yg;break;default:n+=o}}return n}function $g(t){return t+Hg+Gg}function Zg(t){var e=t.length;if(Om(2<=e,"Invalid path "+t),2===e)return Om(t.charAt(0)===Hg&&t.charAt(1)===Gg,"Non-empty path "+t+" had length 2"),Rg.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Hg,o);switch((a<0||n<a)&&Rm('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Gg:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case zg:i+=t.substring(o,a),i+="\0";break;case Yg:i+=t.substring(o,a+1);break;default:Rm('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Rg(r)}var tv=(ev.now=function(){return ev.fromMillis(Date.now())},ev.fromDate=function(t){return ev.fromMillis(t.getTime())},ev.fromMillis=function(t){var e=Math.floor(t/1e3);return new ev(e,1e6*(t-1e3*e))},ev.prototype.toDate=function(){return new Date(this.toMillis())},ev.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ev.prototype._compareTo=function(t){return this.seconds===t.seconds?pg(this.nanoseconds,t.nanoseconds):pg(this.seconds,t.seconds)},ev.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ev.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ev);function ev(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Um(Fm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Um(Fm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Um(Fm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Um(Fm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var nv=(rv.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new rv(new tv(e,t%1e6*1e3))},rv.fromTimestamp=function(t){return new rv(t)},rv.forDeletedDoc=function(){return rv.MIN},rv.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},rv.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},rv.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},rv.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},rv.prototype.toTimestamp=function(){return this.timestamp},rv.MIN=new rv(new tv(0,0)),rv);function rv(t){this.timestamp=t}var iv=(ov.prototype.insert=function(t,e){return new ov(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,uv.BLACK,null,null))},ov.prototype.remove=function(t){return new ov(this.comparator,this.root.remove(t,this.comparator).copy(null,null,uv.BLACK,null,null))},ov.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ov.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ov.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(ov.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),ov.prototype.minKey=function(){return this.root.minKey()},ov.prototype.maxKey=function(){return this.root.maxKey()},ov.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},ov.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},ov.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},ov.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},ov.prototype.getIterator=function(){return new av(this.root,null,this.comparator,!1)},ov.prototype.getIteratorFrom=function(t){return new av(this.root,t,this.comparator,!1)},ov.prototype.getReverseIterator=function(){return new av(this.root,null,this.comparator,!0)},ov.prototype.getReverseIteratorFrom=function(t){return new av(this.root,t,this.comparator,!0)},ov);function ov(t,e){this.comparator=t,this.root=e||uv.EMPTY}var av=(sv.prototype.getNext=function(){Om(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},sv.prototype.hasNext=function(){return 0<this.nodeStack.length},sv.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},sv);function sv(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var uv=(cv.prototype.copy=function(t,e,n,r,i){return new cv(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},cv.prototype.isEmpty=function(){return!1},cv.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},cv.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},cv.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},cv.prototype.minKey=function(){return this.min().key},cv.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},cv.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},cv.prototype.removeMin=function(){if(this.left.isEmpty())return cv.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},cv.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return cv.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},cv.prototype.isRed=function(){return this.color},cv.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},cv.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},cv.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},cv.prototype.rotateLeft=function(){var t=this.copy(null,null,cv.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},cv.prototype.rotateRight=function(){var t=this.copy(null,null,cv.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},cv.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},cv.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},cv.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Rm("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Rm("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Rm("Black depths differ");return t+(this.isRed()?0:1)},cv.EMPTY=null,cv.RED=!0,cv.BLACK=!1,cv);function cv(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:cv.RED,this.left=null!=r?r:cv.EMPTY,this.right=null!=i?i:cv.EMPTY,this.size=this.left.size+1+this.right.size}var hv=(Object.defineProperty(lv.prototype,"key",{get:function(){throw Rm("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(lv.prototype,"value",{get:function(){throw Rm("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(lv.prototype,"color",{get:function(){throw Rm("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(lv.prototype,"left",{get:function(){throw Rm("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(lv.prototype,"right",{get:function(){throw Rm("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),lv.prototype.copy=function(t,e,n,r,i){return this},lv.prototype.insert=function(t,e,n){return new uv(t,e)},lv.prototype.remove=function(t,e){return this},lv.prototype.isEmpty=function(){return!0},lv.prototype.inorderTraversal=function(t){return!1},lv.prototype.reverseTraversal=function(t){return!1},lv.prototype.minKey=function(){return null},lv.prototype.maxKey=function(){return null},lv.prototype.isRed=function(){return!1},lv.prototype.checkMaxDepth=function(){return!0},lv.prototype.check=function(){return 0},lv);function lv(){this.size=0}uv.EMPTY=new hv;var fv=(pv.fromMapKeys=function(t){var e=new pv(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},pv.prototype.has=function(t){return null!==this.data.get(t)},pv.prototype.first=function(){return this.data.minKey()},pv.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(pv.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),pv.prototype.indexOf=function(t){return this.data.indexOf(t)},pv.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},pv.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},pv.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},pv.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},pv.prototype.getIterator=function(){return new dv(this.data.getIterator())},pv.prototype.getIteratorFrom=function(t){return new dv(this.data.getIteratorFrom(t))},pv.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},pv.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},pv.prototype.isEmpty=function(){return this.data.isEmpty()},pv.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},pv.prototype.isEqual=function(t){if(!(t instanceof pv))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},pv.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},pv.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},pv.prototype.copy=function(t){var e=new pv(this.comparator);return e.data=t,e},pv);function pv(t){this.comparator=t,this.data=new iv(this.comparator)}var dv=(yv.prototype.getNext=function(){return this.iter.getNext().key},yv.prototype.hasNext=function(){return this.iter.hasNext()},yv);function yv(t){this.iter=t}var mv=new iv(Fg.comparator);function gv(){return mv}function vv(){return gv()}var bv=new iv(Fg.comparator);function wv(){return bv}var _v=new iv(Fg.comparator);function Tv(){return _v}var Ev=new fv(Fg.comparator);function Sv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ev,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Iv=new fv(pg);function Cv(){return Iv}var Nv=(Av.prototype.applyToRemoteDocument=function(t,e,n){e&&Om(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Om(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},Av.prototype.applyToLocalView=function(t,e){e&&Om(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},Av.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},Av.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Sv())},Av.prototype.isEqual=function(t){return this.batchId===t.batchId&&dg(this.mutations,t.mutations)&&dg(this.baseMutations,t.baseMutations)},Av);function Av(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Om(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var kv=(Dv.from=function(t,e,n,r){Om(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=Tv(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Dv(t,e,n,r,i)},Dv);function Dv(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Rv=(Ov.prototype.catch=function(t){return this.next(void 0,t)},Ov.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Rm("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Ov(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Ov.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Ov.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Ov?e:Ov.resolve(e)}catch(t){return Ov.reject(t)}},Ov.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Ov.resolve(e)},Ov.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Ov.reject(e)},Ov.resolve=function(n){return new Ov(function(t,e){t(n)})},Ov.reject=function(n){return new Ov(function(t,e){e(n)})},Ov.waitFor=function(t){return new Ov(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Ov.or=function(t){for(var n=Ov.resolve(!1),e=function(e){n=n.next(function(t){return t?Ov.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Ov.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Ov);function Ov(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var Pv="SimpleDb",Mv=(Lv.openOrCreate=function(o,t,a){return Om(Lv.isAvailable(),"IndexedDB not supported in current environment."),Am(Pv,"Opening database:",o),new Rv(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Lv(e))},i.onblocked=function(){r(new Um(Fm.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Um(Fm.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Am(Pv,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;a.createOrUpgrade(e,i.transaction,t.oldVersion,Zw).next(function(){Am(Pv,"Database upgrade to version "+Zw+" complete")})}}).toPromise()},Lv.delete=function(t){return Am(Pv,"Removing database:",t),jv(window.indexedDB.deleteDatabase(t)).toPromise()},Lv.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Lv.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var t=Sa(),e=Lv.getIOSVersion(t),n=0<e&&e<10,r=Lv.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Lv.isMockPersistence=function(){return"undefined"!=typeof process&&"YES"===process.env.USE_MOCK_PERSISTENCE},Lv.getStore=function(t,e){return t.store(e)},Lv.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Lv.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Lv.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},Lv.prototype.runTransaction=function(r,c,h){return ua(this,void 0,void 0,function(){var o,a,s,e,u,n;return ca(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),a=r.endsWith("idempotent"),s=0,e=function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:++s,e=Uv.open(u.db,o?"readonly":"readwrite",c),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=h(e).catch(function(t){return e.abort(t),Rv.reject(t)}).toPromise()).catch(function(){}),[4,e.completionPromise];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=a&&"FirebaseError"!==r.name&&s<3,Am(Pv,"Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},Lv.prototype.close=function(){this.db.close()},Lv);function Lv(t){this.db=t,12.2===Lv.getIOSVersion(Sa())&&km("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var xv=(Object.defineProperty(Fv.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(Fv.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(Fv.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),Fv.prototype.done=function(){this.shouldStop=!0},Fv.prototype.skip=function(t){this.nextKey=t},Fv.prototype.delete=function(){return jv(this.dbCursor.delete())},Fv);function Fv(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var Uv=(Vv.open=function(t,e,n){return new Vv(t.transaction(n,e))},Object.defineProperty(Vv.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),Vv.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Am(Pv,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Vv.prototype.store=function(t){var e=this.transaction.objectStore(t);return Om(!!e,"Object store not part of transaction: "+t),new qv(e)},Vv);function Vv(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Bg,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=Kv(t.target.error);n.completionDeferred.reject(e)}}var qv=(Bv.prototype.put=function(t,e){return jv(void 0!==e?(Am(Pv,"PUT",this.store.name,t,e),this.store.put(e,t)):(Am(Pv,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Bv.prototype.add=function(t){return Am(Pv,"ADD",this.store.name,t,t),jv(this.store.add(t))},Bv.prototype.get=function(e){var n=this;return jv(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Am(Pv,"GET",n.store.name,e,t),t})},Bv.prototype.delete=function(t){return Am(Pv,"DELETE",this.store.name,t),jv(this.store.delete(t))},Bv.prototype.count=function(){return Am(Pv,"COUNT",this.store.name),jv(this.store.count())},Bv.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},Bv.prototype.deleteAll=function(t,e){Am(Pv,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},Bv.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},Bv.prototype.iterateSerial=function(i){var t=this.cursor({});return new Rv(function(n,r){t.onerror=function(t){var e=Kv(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Bv.prototype.iterateCursor=function(t,a){var s=[];return new Rv(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new xv(e),r=a(e.primaryKey,e.value,n);if(r instanceof Rv){var i=r.catch(function(t){return n.done(),Rv.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return Rv.waitFor(s)})},Bv.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Om(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},Bv.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Bv);function Bv(t){this.store=t}function jv(t){return new Rv(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Kv(t.target.error);r(e)}})}var Wv=!1;function Kv(t){var e=Mv.getIOSVersion(Sa());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Um("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Wv||(Wv=!0,setTimeout(function(){throw r},0)),r}}return t}var Qv=(Hv.forUser=function(t,e,n,r){return Om(""!==t.uid,"UserID must not be an empty string."),new Hv(t.isAuthenticated()?t.uid:"",e,n,r)},Hv.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xv(t).iterate({index:s_.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Hv.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Yv(n),$v(e).put(t)})},Hv.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},Hv.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Yv(n),$v(e).put(t)})},Hv.prototype.addMutationBatch=function(c,h,l,f){var p=this,d=Jv(c),y=Xv(c);return y.add({}).next(function(t){Om("number"==typeof t,"Auto-generated key is not a number");for(var e=new Nv(t,h,l,f),n=p.serializer.toDbMutationBatch(p.userId,e),r=[],i=new fv(function(t,e){return pg(t.canonicalString(),e.canonicalString())}),o=0,a=f;o<a.length;o++){var s=a[o],u=c_.key(p.userId,s.key.path,t);i=i.add(s.key.path.popLast()),r.push(y.put(n)),r.push(d.put(u,c_.PLACEHOLDER))}return i.forEach(function(t){r.push(p.indexManager.addToCollectionParentIndex(c,t))}),c.addOnCommittedListener(function(){p.documentKeysByBatchId[t]=e.keys()}),Rv.waitFor(r).next(function(){return e})})},Hv.prototype.lookupMutationBatch=function(t,e){var n=this;return Xv(t).get(e).next(function(t){return t?(Om(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},Hv.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?Rv.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},Hv.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Xv(t).iterate({index:s_.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Om(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},Hv.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Xv(t).iterate({index:s_.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Hv.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xv(t).loadAll(s_.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},Hv.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=c_.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return Jv(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=Zg(i);if(r===c.userId&&u.path.isEqual(a))return Xv(s).get(o).next(function(t){if(!t)throw Rm("Dangling document-mutation reference found: "+e+" which points to "+o);Om(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},Hv.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new fv(pg),i=[];return t.forEach(function(s){var t=c_.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=Jv(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Zg(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),Rv.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},Hv.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;Om(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Om(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=c_.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new fv(pg);return Jv(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Zg(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},Hv.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Xv(t).get(e).next(function(t){if(null===t)throw Rm("Dangling document-mutation reference found, which points to "+e);Om(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Rv.waitFor(i).next(function(){return r})},Hv.prototype.removeMutationBatch=function(e,n){var r=this;return zv(e.simpleDbTransaction,this.userId,n).next(function(t){return e.addOnCommittedListener(function(){r.removeCachedMutationKeys(n.batchId)}),Rv.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},Hv.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},Hv.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return Rv.resolve();var e=IDBKeyRange.lowerBound(c_.prefixForUser(o.userId)),i=[];return Jv(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=Zg(t[1]);i.push(r)}else n.done()}).next(function(){Om(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},Hv.prototype.containsKey=function(t,e){return Gv(t,this.userId,e)},Hv.prototype.getMutationQueueMetadata=function(t){var e=this;return $v(t).get(this.userId).next(function(t){return t||new o_(e.userId,-1,"")})},Hv);function Hv(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function Gv(t,o,e){var n=c_.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return Jv(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function zv(t,e,n){var r=t.store(s_.store),i=t.store(c_.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Om(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=c_.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Rv.waitFor(o).next(function(){return c})}function Yv(t){return t instanceof Uint8Array?(Om(Mv.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Xv(t){return nT.getStore(t,s_.store)}function Jv(t){return nT.getStore(t,c_.store)}function $v(t){return nT.getStore(t,o_.store)}var Zv,tb;(tb=Zv=Zv||{})[tb.QueryCache=0]="QueryCache",tb[tb.SyncEngine=1]="SyncEngine";var eb=(nb.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},nb.prototype.after=function(t){return this.seek(t+2),this.next()},nb.prototype.seek=function(t){Om((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},nb.forTargetCache=function(){return new nb(Zv.QueryCache,2)},nb.forSyncEngine=function(){return new nb(Zv.SyncEngine)},nb);function nb(t,e){Om((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var rb=(ib.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},ib.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return nv.fromTimestamp(new tv(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},ib.prototype.getHighestSequenceNumber=function(t){return sb(t.simpleDbTransaction)},ib.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},ib.prototype.addTargetData=function(e,n){var r=this;return this.saveTargetData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromTargetData(n,t),r.saveMetadata(e,t)})})},ib.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},ib.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return ob(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Om(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.saveMetadata(e,t)})},ib.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return ob(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(s++,u.push(a.removeTargetData(r,n)))}).next(function(){return Rv.waitFor(u)}).next(function(){return s})},ib.prototype.forEachTarget=function(t,r){var i=this;return ob(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},ib.prototype.retrieveMetadata=function(t){return ab(t.simpleDbTransaction)},ib.prototype.saveMetadata=function(t,e){return function(t){return nT.getStore(t,__.store)}(t).put(__.key,e)},ib.prototype.saveTargetData=function(t,e){return ob(t).put(this.serializer.toDbTarget(e))},ib.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},ib.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},ib.prototype.getTargetData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return ob(t).iterate({range:n,index:g_.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.target)&&(a=r,n.done())}).next(function(){return a})},ib.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=ub(n);return t.forEach(function(t){var e=Xg(t.path);o.push(a.put(new b_(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),Rv.waitFor(o)},ib.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=ub(n);return Rv.forEach(t,function(t){var e=Xg(t.path);return Rv.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},ib.prototype.removeMatchingKeysForTargetId=function(t,e){var n=ub(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},ib.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ub(t),o=Sv();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Zg(t[1]),i=new Fg(r);o=o.add(i)}).next(function(){return o})},ib.prototype.containsKey=function(t,e){var n=Xg(e.path),r=IDBKeyRange.bound([n],[yg(n)],!1,!0),i=0;return ub(t).iterate({index:b_.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},ib.prototype.getTargetDataForTarget=function(t,e){var n=this;return ob(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},ib);function ib(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=eb.forTargetCache()}function ob(t){return nT.getStore(t,g_.store)}function ab(t){return Mv.getStore(t,__.store).get(__.key).next(function(t){return Om(null!==t,"Missing metadata row."),t})}function sb(t){return ab(t).next(function(t){return t.highestListenSequenceNumber})}function ub(t){return nT.getStore(t,b_.store)}var cb=(hb.fromSet=function(t){return new hb(t)},hb.fromArray=function(t){var e=new fv(Lg.comparator);return t.forEach(function(t){return e=e.add(t)}),new hb(e)},hb.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},hb.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},hb);function hb(t){this.fields=t}var lb=(fb.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},fb);function fb(t,e){this.field=t,this.transform=e}var pb,db,yb=function(t,e){this.version=t,this.transformResults=e};(db=pb=pb||{})[db.Set=0]="Set",db[db.Patch=1]="Patch",db[db.Transform=2]="Transform",db[db.Delete=3]="Delete";var mb=(gb.exists=function(t){return new gb(void 0,t)},gb.updateTime=function(t){return new gb(t)},Object.defineProperty(gb.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),gb.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof kw&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof kw:(Om(this.isNone,"Precondition should be empty"),!0)},gb.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},gb.NONE=new gb,gb);function gb(t,e){this.updateTime=t,this.exists=e,Om(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var vb=(bb.prototype.verifyKeyMatches=function(t){null!=t&&Om(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},bb.getPostMutationVersion=function(t){return t instanceof kw?t.version:nv.MIN},bb);function bb(){}var wb,_b=(aa(Tb,wb=vb),Tb.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Om(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new kw(this.key,n,{hasCommittedMutations:!0},this.value)},Tb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=vb.getPostMutationVersion(t);return new kw(this.key,r,{hasLocalMutations:!0},this.value)},Tb.prototype.extractBaseValue=function(t){return null},Tb.prototype.isEqual=function(t){return t instanceof Tb&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},Tb);function Tb(t,e,n){var r=wb.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=pb.Set,r}var Eb,Sb=(aa(Ib,Eb=vb),Ib.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Om(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Lw(this.key,e.version);var n=this.patchDocument(t);return new kw(this.key,e.version,{hasCommittedMutations:!0},n)},Ib.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=vb.getPostMutationVersion(t),i=this.patchDocument(t);return new kw(this.key,r,{hasLocalMutations:!0},i)},Ib.prototype.extractBaseValue=function(t){return null},Ib.prototype.isEqual=function(t){return t instanceof Ib&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},Ib.prototype.patchDocument=function(t){var e;return e=t instanceof kw?t.data():_w.EMPTY,this.patchObject(e)},Ib.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},Ib);function Ib(t,e,n,r){var i=Eb.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=pb.Patch,i}var Cb,Nb=(aa(Ab,Cb=vb),Ab.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Om(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Lw(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new kw(this.key,i,{hasCommittedMutations:!0},o)},Ab.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new kw(this.key,r.version,{hasLocalMutations:!0},o)},Ab.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof kw?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?_w.EMPTY.set(i.field,a):e.set(i.field,a))}return e},Ab.prototype.isEqual=function(t){return t instanceof Ab&&this.key.isEqual(t.key)&&dg(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},Ab.prototype.requireDocument=function(t){Om(t instanceof kw,"Unknown MaybeDocument type "+t);var e=t;return Om(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},Ab.prototype.serverTransformResults=function(t,e){var n=[];Om(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof kw&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},Ab.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof kw&&(u=e.field(a.field)),null===u&&n instanceof kw&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},Ab.prototype.transformObject=function(t,e){Om(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},Ab);function Ab(t,e){var n=Cb.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=pb.Transform,n.precondition=mb.exists(!0),n}var kb,Db,Rb,Ob,Pb,Mb=(aa(Lb,kb=vb),Lb.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Om(null==e.transformResults,"Transform results received by DeleteMutation."),new Ow(this.key,e.version,{hasCommittedMutations:!0})},Lb.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Om(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Ow(this.key,nv.forDeletedDoc())):t},Lb.prototype.extractBaseValue=function(t){return null},Lb.prototype.isEqual=function(t){return t instanceof Lb&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Lb);function Lb(t,e){var n=kb.call(this)||this;return n.key=t,n.precondition=e,n.type=pb.Delete,n}(Rb=Db=Db||{})[Rb.NullValue=0]="NullValue",Rb[Rb.BooleanValue=1]="BooleanValue",Rb[Rb.NumberValue=2]="NumberValue",Rb[Rb.TimestampValue=3]="TimestampValue",Rb[Rb.StringValue=4]="StringValue",Rb[Rb.BlobValue=5]="BlobValue",Rb[Rb.RefValue=6]="RefValue",Rb[Rb.GeoPointValue=7]="GeoPointValue",Rb[Rb.ArrayValue=8]="ArrayValue",Rb[Rb.ObjectValue=9]="ObjectValue",(Pb=Ob=Ob||{})[Pb.Default=0]="Default",Pb[Pb.Estimate=1]="Estimate",Pb[Pb.Previous=2]="Previous";var xb=(Fb.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new Fb(Ob.Estimate,e);case"previous":return new Fb(Ob.Previous,e);case"none":case void 0:return new Fb(Ob.Default,e);default:return Rm("fromSnapshotOptions() called with invalid options.")}},Fb);function Fb(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var Ub=(Vb.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},Vb.prototype.defaultCompareTo=function(t){return Om(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),pg(this.typeOrder,t.typeOrder)},Vb);function Vb(){}var qb,Bb=(aa(jb,qb=Ub),jb.prototype.value=function(t){return null},jb.prototype.isEqual=function(t){return t instanceof jb},jb.prototype.compareTo=function(t){return t instanceof jb?0:this.defaultCompareTo(t)},jb.INSTANCE=new jb,jb);function jb(){var t=qb.call(this)||this;return t.typeOrder=Db.NullValue,t.internalValue=null,t}var Wb,Kb=(aa(Qb,Wb=Ub),Qb.prototype.value=function(t){return this.internalValue},Qb.prototype.isEqual=function(t){return t instanceof Qb&&this.internalValue===t.internalValue},Qb.prototype.compareTo=function(t){return t instanceof Qb?pg(this,t):this.defaultCompareTo(t)},Qb.of=function(t){return t?Qb.TRUE:Qb.FALSE},Qb.TRUE=new Qb(!0),Qb.FALSE=new Qb(!1),Qb);function Qb(t){var e=Wb.call(this)||this;return e.internalValue=t,e.typeOrder=Db.BooleanValue,e}var Hb,Gb=(aa(zb,Hb=Ub),zb.prototype.value=function(t){return this.internalValue},zb.prototype.compareTo=function(t){return t instanceof zb?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},zb);function zb(t){var e=Hb.call(this)||this;return e.internalValue=t,e.typeOrder=Db.NumberValue,e}function Yb(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Xb,Jb=(aa($b,Xb=Gb),$b.prototype.isEqual=function(t){return t instanceof $b&&Yb(this.internalValue,t.internalValue)},$b);function $b(){return null!==Xb&&Xb.apply(this,arguments)||this}var Zb,tw=(aa(ew,Zb=Gb),ew.prototype.isEqual=function(t){return t instanceof ew&&Yb(this.internalValue,t.internalValue)},ew.NAN=new ew(NaN),ew.POSITIVE_INFINITY=new ew(1/0),ew.NEGATIVE_INFINITY=new ew(-1/0),ew);function ew(){return null!==Zb&&Zb.apply(this,arguments)||this}var nw,rw=(aa(iw,nw=Ub),iw.prototype.value=function(t){return this.internalValue},iw.prototype.isEqual=function(t){return t instanceof iw&&this.internalValue===t.internalValue},iw.prototype.compareTo=function(t){return t instanceof iw?pg(this.internalValue,t.internalValue):this.defaultCompareTo(t)},iw);function iw(t){var e=nw.call(this)||this;return e.internalValue=t,e.typeOrder=Db.StringValue,e}var ow,aw=(aa(sw,ow=Ub),sw.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},sw.prototype.isEqual=function(t){return t instanceof sw&&this.internalValue.isEqual(t.internalValue)},sw.prototype.compareTo=function(t){return t instanceof sw?this.internalValue._compareTo(t.internalValue):t instanceof cw?-1:this.defaultCompareTo(t)},sw);function sw(t){var e=ow.call(this)||this;return e.internalValue=t,e.typeOrder=Db.TimestampValue,e}var uw,cw=(aa(hw,uw=Ub),hw.prototype.value=function(t){return t&&t.serverTimestampBehavior===Ob.Estimate?new aw(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Ob.Previous&&this.previousValue?this.previousValue.value(t):null},hw.prototype.isEqual=function(t){return t instanceof hw&&this.localWriteTime.isEqual(t.localWriteTime)},hw.prototype.compareTo=function(t){return t instanceof hw?this.localWriteTime._compareTo(t.localWriteTime):t instanceof aw?1:this.defaultCompareTo(t)},hw.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},hw);function hw(t,e){var n=uw.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Db.TimestampValue,n}var lw,fw=(aa(pw,lw=Ub),pw.prototype.value=function(t){return this.internalValue},pw.prototype.isEqual=function(t){return t instanceof pw&&this.internalValue.isEqual(t.internalValue)},pw.prototype.compareTo=function(t){return t instanceof pw?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},pw);function pw(t){var e=lw.call(this)||this;return e.internalValue=t,e.typeOrder=Db.BlobValue,e}var dw,yw=(aa(mw,dw=Ub),mw.prototype.value=function(t){return this.key},mw.prototype.isEqual=function(t){return t instanceof mw&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},mw.prototype.compareTo=function(t){if(t instanceof mw){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Fg.comparator(this.key,t.key)}return this.defaultCompareTo(t)},mw);function mw(t,e){var n=dw.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Db.RefValue,n}var gw,vw=(aa(bw,gw=Ub),bw.prototype.value=function(t){return this.internalValue},bw.prototype.isEqual=function(t){return t instanceof bw&&this.internalValue.isEqual(t.internalValue)},bw.prototype.compareTo=function(t){return t instanceof bw?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},bw);function bw(t){var e=gw.call(this)||this;return e.internalValue=t,e.typeOrder=Db.GeoPointValue,e}var ww,_w=(aa(Tw,ww=Ub),Tw.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},Tw.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},Tw.prototype.isEqual=function(t){if(t instanceof Tw){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},Tw.prototype.compareTo=function(t){if(t instanceof Tw){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=pg(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return pg(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},Tw.prototype.set=function(t,e){if(Om(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof Tw||(n=Tw.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},Tw.prototype.delete=function(t){if(Om(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Tw(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof Tw){var n=e.delete(t.popFirst());return new Tw(this.internalValue.insert(t.firstSegment(),n))}return this},Tw.prototype.contains=function(t){return null!==this.field(t)},Tw.prototype.field=function(t){Om(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Tw?e.internalValue.get(t):null}),e},Tw.prototype.fieldMask=function(){var i=new fv(Lg.comparator);return this.internalValue.forEach(function(t,e){var n=new Lg([t]);if(e instanceof Tw){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),cb.fromSet(i)},Tw.prototype.toString=function(){return this.internalValue.toString()},Tw.prototype.child=function(t){return this.internalValue.get(t)||void 0},Tw.prototype.setChild=function(t,e){return new Tw(this.internalValue.insert(t,e))},Tw.EMPTY=new Tw(new iv(pg)),Tw);function Tw(t){var e=ww.call(this)||this;return e.internalValue=t,e.typeOrder=Db.ObjectValue,e}var Ew,Sw=(aa(Iw,Ew=Ub),Iw.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},Iw.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Iw.prototype.forEach=function(t){this.internalValue.forEach(t)},Iw.prototype.isEqual=function(t){if(t instanceof Iw){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Iw.prototype.compareTo=function(t){if(t instanceof Iw){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return pg(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Iw.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},Iw);function Iw(t){var e=Ew.call(this)||this;return e.internalValue=t,e.typeOrder=Db.ArrayValue,e}var Cw=(Nw.compareByKey=function(t,e){return Fg.comparator(t.key,e.key)},Nw);function Nw(t,e){this.key=t,this.version=e}var Aw,kw=(aa(Dw,Aw=Cw),Dw.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},Dw.prototype.data=function(){var n=this;if(!this.objectValue){var r=_w.EMPTY;Km(this.proto.fields||{},function(t,e){r=r.set(new Lg([t]),n.converter(e))}),this.objectValue=r,this.fieldValueCache=void 0}return this.objectValue},Dw.prototype.value=function(){return this.data().value()},Dw.prototype.isEqual=function(t){return t instanceof Dw&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Dw.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Dw.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Dw.prototype.getProtoField=function(t){Om(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Dw.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Rm("Trying to compare documents on fields that don't exist")},Dw);function Dw(t,e,n,r,i,o){var a=Aw.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,Om(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var Rw,Ow=(aa(Pw,Rw=Cw),Pw.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Pw.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Pw.prototype.isEqual=function(t){return t instanceof Pw&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Pw);function Pw(t,e,n){var r=Rw.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var Mw,Lw=(aa(xw,Mw=Cw),xw.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(xw.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),xw.prototype.isEqual=function(t){return t instanceof xw&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},xw);function xw(){return null!==Mw&&Mw.apply(this,arguments)||this}var Fw=(Uw.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},Uw.prototype.has=function(t){return void 0!==this.get(t)},Uw.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Uw.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Uw.prototype.forEach=function(s){Km(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},Uw.prototype.isEmpty=function(){return Qm(this.inner)},Uw);function Uw(t){this.mapKeyFn=t,this.inner={}}var Vw=(Object.defineProperty(qw.prototype,"readTime",{get:function(){return Om(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){Om(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),qw.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},qw.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},qw.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Rv.resolve(n):this.getFromCache(t,e)},qw.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},qw.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},qw.prototype.assertNotApplied=function(){Om(!this.changesApplied,"Changes have already been applied.")},qw);function qw(){this.changes=new Fw(function(t){return t.toString()}),this.changesApplied=!1}var Bw,jw=(Ww.prototype.addEntry=function(t,e,n){return Hw(t).put(Gw(e),n)},Ww.prototype.removeEntry=function(t,e){var n=Hw(t),r=Gw(e);return n.delete(r)},Ww.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},Ww.prototype.getEntry=function(t,e){var n=this;return Hw(t).get(Gw(e)).next(function(t){return n.maybeDecodeDocument(t)})},Ww.prototype.getSizedEntry=function(t,e){var n=this;return Hw(t).get(Gw(e)).next(function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:zw(t)}:null})},Ww.prototype.getEntries=function(t,e){var r=this,i=vv();return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);i=i.insert(t,n)}).next(function(){return i})},Ww.prototype.getSizedEntries=function(t,e){var r=this,i=vv(),o=new iv(Fg.comparator);return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);o=n?(i=i.insert(t,n),o.insert(t,zw(e))):(i=i.insert(t,null),o.insert(t,0))}).next(function(){return{maybeDocuments:i,sizeMap:o}})},Ww.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return Rv.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return Hw(t).iterate({range:n},function(t,e,n){for(var r=Fg.fromSegments(t);a&&Fg.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},Ww.prototype.getDocumentsMatchingQuery=function(t,i,e){var o=this;Om(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=wv(),s=i.path.length+1,n={};if(e.isEqual(nv.MIN)){var r=i.path.toArray();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.toArray(),c=this.serializer.toDbTimestampKey(e);n.range=IDBKeyRange.lowerBound([u,c],!0),n.index=p_.collectionReadTimeIndex}return Hw(t).iterate(n,function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof kw&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},Ww.prototype.getNewDocumentChanges=function(t,e){var r=this,i=gv(),o=this.serializer.toDbTimestampKey(e),n=Hw(t),a=IDBKeyRange.lowerBound(o,!0);return n.iterate({index:p_.readTimeIndex,range:a},function(t,e){var n=r.serializer.fromDbRemoteDocument(e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{changedDocs:i,readTime:r.serializer.fromDbTimestampKey(o)}})},Ww.prototype.getLastDocumentChange=function(t){var r,i=this,e=Hw(t),o=nv.MIN;return e.iterate({index:p_.readTimeIndex,reverse:!0},function(t,e,n){r=i.serializer.fromDbRemoteDocument(e),e.readTime&&(o=i.serializer.fromDbTimestampKey(e.readTime)),n.done()}).next(function(){return{changedDoc:r,readTime:o}})},Ww.prototype.newChangeBuffer=function(t){return new Ww.RemoteDocumentChangeBuffer(this,!!t&&t.trackRemovals)},Ww.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ww.prototype.getMetadata=function(t){return Qw(t).get(y_.key).next(function(t){return Om(!!t,"Missing document cache metadata"),t})},Ww.prototype.setMetadata=function(t,e){return Qw(t).put(y_.key,e)},Ww.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof Ow&&e.version.isEqual(nv.forDeletedDoc())?null:e}return null},Ww.RemoteDocumentChangeBuffer=(aa(Kw,Bw=Vw),Kw.prototype.applyChanges=function(a){var s=this,u=[],c=0,h=new fv(function(t,e){return pg(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(t,e){var n=s.documentSizes.get(t);if(Om(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){Om(!s.readTime.isEqual(nv.MIN),"Cannot add a document with a read time of zero");var r=s.documentCache.serializer.toDbRemoteDocument(e,s.readTime);h=h.add(t.path.popLast());var i=zw(r);c+=i-n,u.push(s.documentCache.addEntry(a,t,r))}else if(c-=n,s.trackRemovals){var o=s.documentCache.serializer.toDbRemoteDocument(new Ow(t,nv.forDeletedDoc()),s.readTime);u.push(s.documentCache.addEntry(a,t,o))}else u.push(s.documentCache.removeEntry(a,t))}),h.forEach(function(t){u.push(s.documentCache.indexManager.addToCollectionParentIndex(a,t))}),u.push(this.documentCache.updateMetadata(a,c)),Rv.waitFor(u)},Kw.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},Kw.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},Kw),Ww);function Ww(t,e){this.serializer=t,this.indexManager=e}function Kw(t,e){var n=Bw.call(this)||this;return n.documentCache=t,n.trackRemovals=e,n.documentSizes=new Fw(function(t){return t.toString()}),n}function Qw(t){return nT.getStore(t,y_.store)}function Hw(t){return nT.getStore(t,p_.store)}function Gw(t){return t.path.toArray()}function zw(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Rm("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Yw=(Xw.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Rv.resolve()},Xw.prototype.getCollectionParents=function(t,e){return Rv.resolve(this.collectionParentIndex.getEntries(e))},Xw);function Xw(){this.collectionParentIndex=new Jw}var Jw=($w.prototype.add=function(t){Om(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new fv(Rg.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},$w.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},$w.prototype.getEntries=function(t){return(this.index[t]||new fv(Rg.comparator)).toArray()},$w);function $w(){this.index={}}var Zw=9,t_=(e_.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Om(n<r&&0<=n&&r<=Zw,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new Uv(e);n<1&&1<=r&&(function(t){t.createObjectStore(r_.store)}(t),function(t){t.createObjectStore(o_.store,{keyPath:o_.keyPath}),t.createObjectStore(s_.store,{keyPath:s_.keyPath,autoIncrement:!0}).createIndex(s_.userMutationsIndex,s_.userMutationsKeyPath,{unique:!0}),t.createObjectStore(c_.store)}(t),I_(t),function(t){t.createObjectStore(p_.store)}(t));var a=Rv.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(b_.store),t.deleteObjectStore(g_.store),t.deleteObjectStore(__.store)}(t),I_(t)),a=a.next(function(){return function(t){var e=t.store(__.store),n=new __(0,0,nv.MIN.toTimestamp(),0);return e.put(__.key,n)}(o)})),n<4&&4<=r&&(0!==n&&(a=a.next(function(){return function(r,i){return i.store(s_.store).loadAll().next(function(t){r.deleteObjectStore(s_.store),r.createObjectStore(s_.store,{keyPath:s_.keyPath,autoIncrement:!0}).createIndex(s_.userMutationsIndex,s_.userMutationsKeyPath,{unique:!0});var e=i.store(s_.store),n=t.map(function(t){return e.put(t)});return Rv.waitFor(n)})}(t,o)})),a=a.next(function(){!function(t){t.createObjectStore(C_.store,{keyPath:C_.keyPath})}(t)})),n<5&&5<=r&&(a=a.next(function(){return i.removeAcknowledgedMutations(o)})),n<6&&6<=r&&(a=a.next(function(){return function(t){t.createObjectStore(y_.store)}(t),i.addDocumentGlobal(o)})),n<7&&7<=r&&(a=a.next(function(){return i.ensureSequenceNumbers(o)})),n<8&&8<=r&&(a=a.next(function(){return i.createCollectionParentIndex(t,o)})),n<9&&9<=r&&(a=a.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(p_.store);e.createIndex(p_.readTimeIndex,p_.readTimeIndexPath,{unique:!1}),e.createIndex(p_.collectionReadTimeIndex,p_.collectionReadTimeIndexPath,{unique:!1})}(e)})),a},e_.prototype.addDocumentGlobal=function(e){var n=0;return e.store(p_.store).iterate(function(t,e){n+=zw(e)}).next(function(){var t=new y_(n);return e.store(y_.store).put(y_.key,t)})},e_.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(o_.store),e=r.store(s_.store);return t.loadAll().next(function(t){return Rv.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(s_.userMutationsIndex,t).next(function(t){return Rv.forEach(t,function(t){Om(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return zv(r,n.userId,e).next(function(){})})})})})},e_.prototype.ensureSequenceNumbers=function(t){var a=t.store(b_.store),e=t.store(p_.store);return sb(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new Rg(t),r=function(t){return[0,Xg(t)]}(n);o.push(a.get(r).next(function(t){return t?Rv.resolve():function(t){return a.put(new b_(0,Xg(t),i))}(n)}))}).next(function(){return Rv.waitFor(o)})})},e_.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Xg(n)})}}t.createObjectStore(E_.store,{keyPath:E_.keyPath});var r=e.store(E_.store),o=new Jw;return e.store(p_.store).iterate({keysOnly:!0},function(t,e){var n=new Rg(t);return i(n.popLast())}).next(function(){return e.store(c_.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],Zg(n));return i(r.popLast())})})},e_);function e_(t){this.serializer=t}var n_=function(t,e){this.seconds=t,this.nanoseconds=e},r_=(i_.store="owner",i_.key="owner",i_);function i_(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var o_=(a_.store="mutationQueues",a_.keyPath="userId",a_);function a_(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var s_=(u_.store="mutations",u_.keyPath="batchId",u_.userMutationsIndex="userMutationsIndex",u_.userMutationsKeyPath=["userId","batchId"],u_);function u_(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var c_=(h_.prefixForUser=function(t){return[t]},h_.prefixForPath=function(t,e){return[t,Xg(e)]},h_.key=function(t,e,n){return[t,Xg(e),n]},h_.store="documentMutations",h_.PLACEHOLDER=new h_,h_);function h_(){}var l_=function(t,e){this.path=t,this.readTime=e},f_=function(t,e){this.path=t,this.version=e},p_=(d_.store="remoteDocuments",d_.readTimeIndex="readTimeIndex",d_.readTimeIndexPath="readTime",d_.collectionReadTimeIndex="collectionReadTimeIndex",d_.collectionReadTimeIndexPath=["parentPath","readTime"],d_);function d_(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var y_=(m_.store="remoteDocumentGlobal",m_.key="remoteDocumentGlobalKey",m_);function m_(t){this.byteSize=t}var g_=(v_.store="targets",v_.keyPath="targetId",v_.queryTargetsIndexName="queryTargetsIndex",v_.queryTargetsKeyPath=["canonicalId","targetId"],v_);function v_(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}var b_=(w_.store="targetDocuments",w_.keyPath=["targetId","path"],w_.documentTargetsIndex="documentTargetsIndex",w_.documentTargetsKeyPath=["path","targetId"],w_);function w_(t,e,n){this.targetId=t,this.path=e,Om(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var __=(T_.key="targetGlobalKey",T_.store="targetGlobal",T_);function T_(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var E_=(S_.store="collectionParents",S_.keyPath=["collectionId","parent"],S_);function S_(t,e){this.collectionId=t,this.parent=e}function I_(t){t.createObjectStore(b_.store,{keyPath:b_.keyPath}).createIndex(b_.documentTargetsIndex,b_.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(g_.store,{keyPath:g_.keyPath}).createIndex(g_.queryTargetsIndexName,g_.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(__.store)}var C_=(N_.store="clientMetadata",N_.keyPath="clientId",N_);function N_(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var A_,k_,D_=pa(pa(pa([o_.store,s_.store,c_.store,p_.store,g_.store,r_.store,__.store,b_.store],[C_.store]),[y_.store]),[E_.store]),R_=(O_.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(Om(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.has(e))return Rv.resolve();var r=e.lastSegment(),i=e.popLast();return t.addOnCommittedListener(function(){n.collectionParentsCache.add(e)}),P_(t).put({collectionId:r,parent:Xg(i)})},O_.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[yg(i),""],!1,!0);return P_(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Zg(r.parent))}return o})},O_);function O_(){this.collectionParentsCache=new Jw}function P_(t){return nT.getStore(t,E_.store)}(k_=A_=A_||{})[k_.Listen=0]="Listen",k_[k_.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",k_[k_.LimboResolution=2]="LimboResolution";var M_=(L_.prototype.withSequenceNumber=function(t){return new L_(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},L_.prototype.withResumeToken=function(t,e){return new L_(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},L_.prototype.withLastLimboFreeSnapshotVersion=function(t){return new L_(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},L_.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},L_);function L_(t,e,n,r,i,o,a){void 0===i&&(i=nv.MIN),void 0===o&&(o=nv.MIN),void 0===a&&(a=Lm()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var x_=(F_.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Fg.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Ow(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Fg.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new Lw(e,n)):Rm("Unexpected DbRemoteDocument")},F_.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof kw){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new p_(null,null,i,o,n,r)}if(t instanceof Ow){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);return o=t.hasCommittedMutations,new p_(null,new l_(a,s),null,o,n,r)}if(t instanceof Lw){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new p_(new f_(a,u),null,null,!0,n,r)}return Rm("Unexpected MaybeDocument")},F_.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},F_.prototype.fromDbTimestampKey=function(t){var e=new tv(t[0],t[1]);return nv.fromTimestamp(e)},F_.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new n_(e.seconds,e.nanoseconds)},F_.prototype.fromDbTimestamp=function(t){var e=new tv(t.seconds,t.nanoseconds);return nv.fromTimestamp(e)},F_.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new s_(t,e.batchId,e.localWriteTime.toMillis(),r,i)},F_.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=tv.fromMillis(t.localWriteTimeMs);return new Nv(t.batchId,i,n,r)},F_.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Xg(t.path))}),e},F_.prototype.fromDbResourcePaths=function(t){for(var e=Sv(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Fg(Zg(i)))}return e},F_.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):nv.MIN,i=t.resumeToken;return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new M_(e,t.targetId,A_.Listen,t.lastListenSequenceNumber,n,r,i)},F_.prototype.toDbTarget=function(t){Om(A_.Listen===t.purpose,"Only queries with purpose "+A_.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),n=t.resumeToken instanceof Uint8Array?(Om(Mv.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new g_(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},F_);function F_(t){this.remoteSerializer=t}function U_(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=pg(n,i);return 0===a?pg(r,o):a}var V_=(q_.prototype.nextIndex=function(){return++this.previousIndex},q_.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();U_(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(q_.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),q_);function q_(t){this.maxElements=t,this.buffer=new fv(U_),this.previousIndex=0}var B_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},j_=(W_.withCacheSize=function(t){return new W_(t,W_.DEFAULT_COLLECTION_PERCENTILE,W_.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},W_.COLLECTION_DISABLED=-1,W_.MINIMUM_CACHE_SIZE_BYTES=1048576,W_.DEFAULT=new W_(W_.DEFAULT_CACHE_SIZE_BYTES=41943040,W_.DEFAULT_COLLECTION_PERCENTILE=10,W_.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),W_.DISABLED=new W_(W_.COLLECTION_DISABLED,0,0),W_);function W_(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var K_=(Q_.prototype.start=function(){Om(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==j_.COLLECTION_DISABLED&&this.scheduleGC()},Q_.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(Q_.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),Q_.prototype.scheduleGC=function(){var t=this;Om(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Am("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Vg.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(iT)})},Q_);function Q_(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var H_=(G_.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},G_.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Rv.resolve(Ig.INVALID);var r=new V_(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},G_.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},G_.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},G_.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===j_.COLLECTION_DISABLED?(Am("LruGarbageCollector","Garbage collection skipped; disabled"),Rv.resolve(B_)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Am("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),B_):r.runGarbageCollection(e,n)})},G_.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},G_.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(Am("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),Cm()<=mm.DEBUG&&Am("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),Rv.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},G_);function G_(t,e){this.delegate=t,this.params=e}var z_=(Y_.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},Y_.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},Y_);function Y_(){this.onCommittedListeners=[]}var X_,J_="IndexedDbPersistence",$_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Z_="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",tT=(aa(eT,X_=z_),eT);function eT(t,e){var n=X_.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var nT=(rT.getStore=function(t,e){if(t instanceof tT)return Mv.getStore(t.simpleDbTransaction,e);throw Rm("IndexedDbPersistence must use instances of IndexedDbTransaction")},rT.createIndexedDbPersistence=function(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:if(!rT.isAvailable())throw new Um(Fm.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new rT(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.lruParams,n.queue,n.serializer,n.sequenceNumberSyncer)).start()];case 1:return t.sent(),[2,e]}})})},rT.prototype.start=function(){var e=this;return Om(!this.started,"IndexedDbPersistence double-started!"),Om(null!==this.window,"Expected 'window' to be defined"),Mv.openOrCreate(this.dbName,Zw,new t_(this.serializer)).then(function(t){return e.simpleDb=t,e.updateClientMetadataAndTryBecomePrimary()}).then(function(){return e.attachVisibilityHandler(),e.attachWindowUnloadHook(),e.scheduleClientMetadataAndPrimaryLeaseRefreshes(),e.simpleDb.runTransaction("readonly-idempotent",[__.store],function(t){return sb(t)})}).then(function(t){e.listenSequence=new Ig(t,e.sequenceNumberSyncer)}).then(function(){e._started=!0}).catch(function(t){return e.simpleDb&&e.simpleDb.close(),Promise.reject(t)})},rT.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return ua(t,void 0,void 0,function(){return ca(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},rT.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return ua(t,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},rT.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return ua(e,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},rT.prototype.updateClientMetadataAndTryBecomePrimary=function(){var n=this;return this.simpleDb.runTransaction("readwrite-idempotent",D_,function(e){return aT(e).put(new C_(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.verifyPrimaryLease(e).next(function(t){t||(n.isPrimary=!1,n.queue.enqueueAndForget(function(){return n.primaryStateListener(!1)}))})}).next(function(){return n.canActAsPrimary(e)}).next(function(t){return n.isPrimary&&!t?n.releasePrimaryLeaseIfHeld(e).next(function(){return!1}):!!t&&n.acquireOrExtendPrimaryLease(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Am(J_,"Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.queue.enqueueAndForget(function(){return n.primaryStateListener(t)}),n.isPrimary=t})},rT.prototype.verifyPrimaryLease=function(t){var e=this;return oT(t).get(r_.key).next(function(t){return Rv.resolve(e.isLocalClient(t))})},rT.prototype.removeClientMetadata=function(t){return aT(t).delete(this.clientId)},rT.prototype.maybeGarbageCollectMultiClientState=function(){return ua(this,void 0,void 0,function(){var i=this;return ca(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=rT.getStore(t,C_.store);return r.loadAll().next(function(t){var e=i.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Rv.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},rT.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Vg.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},rT.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},rT.prototype.canActAsPrimary=function(e){var i=this;return oT(e).get(r_.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new Um(Fm.FAILED_PRECONDITION,Z_);return!1}}return!(!i.networkEnabled||!i.inForeground)||aT(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Am(J_,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},rT.prototype.shutdown=function(){return ua(this,void 0,void 0,function(){var e=this;return ca(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[r_.store,C_.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},rT.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},rT.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly-idempotent",[C_.store],function(t){return aT(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},rT.clearPersistence=function(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return rT.isAvailable()?(e=n+rT.MAIN_DATABASE,[4,Mv.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(rT.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),rT.prototype.getMutationQueue=function(t){return Om(this.started,"Cannot initialize MutationQueue before persistence is started."),Qv.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},rT.prototype.getTargetCache=function(){return Om(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},rT.prototype.getRemoteDocumentCache=function(){return Om(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},rT.prototype.getIndexManager=function(){return Om(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},rT.prototype.runTransaction=function(n,t,r){var i=this;Am(J_,"Starting transaction:",n);var o,e=t.endsWith("idempotent"),a=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,D_,function(e){return o=new tT(e,i.listenSequence.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.verifyPrimaryLease(e).next(function(t){return!!t||i.canActAsPrimary(e)}).next(function(t){if(!t)throw km("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new Um(Fm.FAILED_PRECONDITION,$_);return r(o)}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(o)})}).then(function(t){return o.raiseOnCommittedEvent(),t})},rT.prototype.verifyAllowTabSynchronization=function(t){var e=this;return oT(t).get(r_.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Um(Fm.FAILED_PRECONDITION,Z_)})},rT.prototype.acquireOrExtendPrimaryLease=function(t){var e=new r_(this.clientId,this.allowTabSynchronization,Date.now());return oT(t).put(r_.key,e)},rT.isAvailable=function(){return Mv.isAvailable()},rT.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},rT.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=oT(t);return n.get(r_.key).next(function(t){return e.isLocalClient(t)?(Am(J_,"Releasing primary lease."),n.delete(r_.key)):Rv.resolve()})},rT.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(km("Detected an update time that is in the future: "+t+" > "+n),1))},rT.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},rT.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Om(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},rT.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},rT.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Om("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},rT.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Am(J_,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return km(J_,"Failed to get zombied client id.",t),!1}},rT.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){km("Failed to set zombie client id.",t)}},rT.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},rT.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},rT.MAIN_DATABASE="main",rT);function rT(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new sT(this,i),this.dbName=e+rT.MAIN_DATABASE,this.serializer=new x_(a),this.document=r.document,this.targetCache=new rb(this.referenceDelegate,this.serializer),this.indexManager=new R_,this.remoteDocumentCache=new jw(this.serializer,this.indexManager),!r.window||!r.window.localStorage)throw new Um(Fm.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function iT(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){if(!function(t){return t.code===Fm.FAILED_PRECONDITION&&t.message===$_}(e))throw e;return Am(J_,"Unexpectedly lost primary lease"),[2]})})}function oT(t){return t.store(r_.store)}function aT(t){return t.store(C_.store)}var sT=(uT.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},uT.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},uT.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},uT.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},uT.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},uT.prototype.addReference=function(t,e){return cT(t,e)},uT.prototype.removeReference=function(t,e){return cT(t,e)},uT.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},uT.prototype.removeMutationReference=function(t,e){return cT(t,e)},uT.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Rv.resolve(!0):function(e,n){var r=!1;return $v(e).iterateSerial(function(t){return Gv(e,t,n).next(function(t){return t&&(r=!0),Rv.resolve(!t)})}).next(function(){return r})}(t,e)},uT.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],u=0;return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return u++,a.getEntry(r,e).next(function(){return a.removeEntry(e),ub(r).delete(function(t){return[0,Xg(t.path)]}(e))})});s.push(n)}}).next(function(){return Rv.waitFor(s)}).next(function(){return a.apply(r)}).next(function(){return u})},uT.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},uT.prototype.updateLimboDocument=function(t,e){return cT(t,e)},uT.prototype.forEachOrphanedDocument=function(t,o){var a,e=ub(t),s=Ig.INVALID;return e.iterate({index:b_.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==Ig.INVALID&&o(new Fg(Zg(a)),s),s=i,a=r):s=Ig.INVALID}).next(function(){s!==Ig.INVALID&&o(new Fg(Zg(a)),s)})},uT.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},uT);function uT(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new H_(this,e)}function cT(t,e){return ub(t).put(function(t,e){return new b_(0,Xg(t.path),e)}(e,t.currentSequenceNumber))}var hT=Number,lT=hT.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),fT=hT.MAX_SAFE_INTEGER||Math.pow(2,53)-1,pT=hT.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function dT(t){return null==t}function yT(t){return pT(t)&&t<=fT&&lT<=t}var mT,gT,vT=(bT.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";dT(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},bT.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),dT(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},bT.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},bT.prototype.isDocumentQuery=function(){return Fg.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},bT);function bT(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}(gT=mT=mT||{}).First="F",gT.Last="L";var wT=(_T.atPath=function(t){return new _T(t)},Object.defineProperty(_T.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[YT]:this.memoizedOrderBy=[new GT(t),YT];else{Om(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:WT.ASCENDING;this.memoizedOrderBy.push(a===WT.ASCENDING?YT:XT)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),_T.prototype.addFilter=function(t){Om(null==this.getInequalityFilterField()||!(t instanceof CT)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Om(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new _T(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.limitType,this.startAt,this.endAt)},_T.prototype.addOrderBy=function(t){Om(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new _T(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},_T.prototype.withLimitToFirst=function(t){return new _T(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,mT.First,this.startAt,this.endAt)},_T.prototype.withLimitToLast=function(t){return new _T(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,mT.Last,this.startAt,this.endAt)},_T.prototype.withStartAt=function(t){return new _T(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,t,this.endAt)},_T.prototype.withEndAt=function(t){return new _T(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,t)},_T.prototype.asCollectionQueryAtPath=function(t){return new _T(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},_T.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},_T.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},_T.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},_T.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},_T.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Om(n,"orderBy used that doesn't compare on key field"),0},_T.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},_T.prototype.hasLimitToFirst=function(){return!dT(this.limit)&&this.limitType===mT.First},_T.prototype.hasLimitToLast=function(){return!dT(this.limit)&&this.limitType===mT.Last},_T.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},_T.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof CT&&n.isInequality())return n.field}return null},_T.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof CT&&0<=t.indexOf(r.op))return r.op}return null},_T.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},_T.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},_T.prototype.toTarget=function(){if(!this.memorizedTarget)if(this.limitType===mT.First)this.memorizedTarget=new vT(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===WT.DESCENDING?WT.ASCENDING:WT.DESCENDING;t.push(new GT(r.field,i))}var o=this.endAt?new QT(this.endAt.position,!this.endAt.before):null,a=this.startAt?new QT(this.startAt.position,!this.startAt.before):null;this.memorizedTarget=new vT(this.path,this.collectionGroup,t,this.filters,this.limit,o,a)}return this.memorizedTarget},_T.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Fg.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},_T.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},_T.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},_T.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},_T.prototype.assertValidBound=function(t){Om(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},_T);function _T(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=mT.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memorizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function TT(){}var ET=(ST.fromString=function(t){switch(t){case"<":return ST.LESS_THAN;case"<=":return ST.LESS_THAN_OR_EQUAL;case"==":return ST.EQUAL;case">=":return ST.GREATER_THAN_OR_EQUAL;case">":return ST.GREATER_THAN;case"array-contains":return ST.ARRAY_CONTAINS;case"in":return ST.IN;case"array-contains-any":return ST.ARRAY_CONTAINS_ANY;default:return Rm("Unknown FieldFilter operator: "+t)}},ST.prototype.toString=function(){return this.name},ST.prototype.isEqual=function(t){return this.name===t.name},ST.LESS_THAN=new ST("<"),ST.LESS_THAN_OR_EQUAL=new ST("<="),ST.EQUAL=new ST("=="),ST.GREATER_THAN=new ST(">"),ST.GREATER_THAN_OR_EQUAL=new ST(">="),ST.ARRAY_CONTAINS=new ST("array-contains"),ST.IN=new ST("in"),ST.ARRAY_CONTAINS_ANY=new ST("array-contains-any"),ST);function ST(t){this.name=t}var IT,CT=(aa(NT,IT=TT),NT.create=function(t,e,n){if(t.isKeyField())return e===ET.IN?(Om(n instanceof Sw,"Comparing on key with IN, but filter value not an ArrayValue"),Om(n.internalValue.every(function(t){return t instanceof yw}),"Comparing on key with IN, but an array value was not a RefValue"),new OT(t,n)):(Om(n instanceof yw,"Comparing on key, but filter value not a RefValue"),Om(e!==ET.ARRAY_CONTAINS&&e!==ET.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new kT(t,e,n));if(n.isEqual(Bb.INSTANCE)){if(e!==ET.EQUAL)throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new NT(t,e,n)}if(n.isEqual(tw.NAN)){if(e!==ET.EQUAL)throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new NT(t,e,n)}return e===ET.ARRAY_CONTAINS?new LT(t,n):e===ET.IN?(Om(n instanceof Sw,"IN filter has invalid value: "+n.toString()),new UT(t,n)):e===ET.ARRAY_CONTAINS_ANY?(Om(n instanceof Sw,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new BT(t,n)):new NT(t,e,n)},NT.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},NT.prototype.matchesComparison=function(t){switch(this.op){case ET.LESS_THAN:return t<0;case ET.LESS_THAN_OR_EQUAL:return t<=0;case ET.EQUAL:return 0===t;case ET.GREATER_THAN:return 0<t;case ET.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Rm("Unknown FieldFilter operator: "+this.op)}},NT.prototype.isInequality=function(){return 0<=[ET.LESS_THAN,ET.LESS_THAN_OR_EQUAL,ET.GREATER_THAN,ET.GREATER_THAN_OR_EQUAL].indexOf(this.op)},NT.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},NT.prototype.isEqual=function(t){return t instanceof NT&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},NT.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},NT);function NT(t,e,n){var r=IT.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var AT,kT=(aa(DT,AT=CT),DT.prototype.matches=function(t){var e=this.value,n=Fg.comparator(t.key,e.key);return this.matchesComparison(n)},DT);function DT(){return null!==AT&&AT.apply(this,arguments)||this}var RT,OT=(aa(PT,RT=CT),PT.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},PT);function PT(t,e){var n=RT.call(this,t,ET.IN,e)||this;return n.value=e,n}var MT,LT=(aa(xT,MT=CT),xT.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Sw&&e.contains(this.value)},xT);function xT(t,e){return MT.call(this,t,ET.ARRAY_CONTAINS,e)||this}var FT,UT=(aa(VT,FT=CT),VT.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},VT);function VT(t,e){var n=FT.call(this,t,ET.IN,e)||this;return n.value=e,n}var qT,BT=(aa(jT,qT=CT),jT.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Sw&&n.internalValue.some(function(t){return e.value.contains(t)})},jT);function jT(t,e){var n=qT.call(this,t,ET.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var WT=(KT.prototype.toString=function(){return this.name},KT.ASCENDING=new KT("asc"),KT.DESCENDING=new KT("desc"),KT);function KT(t){this.name=t}var QT=(HT.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},HT.prototype.sortsBeforeDocument=function(t,e){Om(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Om(o instanceof yw,"Bound has a non-key value where the key path is being used."),n=Fg.comparator(o.key,e.key);else{var a=e.field(i.field);Om(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===WT.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},HT.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},HT);function HT(t,e){this.position=t,this.before=e}var GT=(zT.prototype.compare=function(t,e){var n=this.isKeyOrderBy?kw.compareByKey(t,e):kw.compareByField(this.field,t,e);switch(this.dir){case WT.ASCENDING:return n;case WT.DESCENDING:return-1*n;default:return Rm("Unknown direction: "+this.dir)}},zT.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},zT.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},zT.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},zT);function zT(t,e){this.field=t,void 0===e&&(e=WT.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var YT=new GT(Lg.keyField(),WT.ASCENDING),XT=new GT(Lg.keyField(),WT.DESCENDING),JT=($T.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},$T.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var a=this;return Om(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),r.matchesAllDocuments()?this.executeFullCollectionScan(e,r):i.isEqual(nv.MIN)?this.executeFullCollectionScan(e,r):this.localDocumentsView.getDocuments(e,o).next(function(t){var n=a.applyQuery(r,t);return(r.hasLimitToFirst()||r.hasLimitToLast())&&a.needsRefill(r.limitType,n,o,i)?a.executeFullCollectionScan(e,r):(Cm()<=mm.DEBUG&&Am("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),a.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},$T.prototype.applyQuery=function(n,t){var r=new fv(function(t,e){return n.docComparator(t,e)});return t.forEach(function(t,e){e instanceof kw&&n.matches(e)&&(r=r.add(e))}),r},$T.prototype.needsRefill=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===mT.First?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))},$T.prototype.executeFullCollectionScan=function(t,e){return Cm()<=mm.DEBUG&&Am("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.localDocumentsView.getDocumentsMatchingQuery(t,e,nv.MIN)},$T);function $T(){}var ZT=(tE.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},tE.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},tE.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=vv();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},tE.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},tE.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=gv();return e.forEach(function(t,e){e=e||new Ow(t,nv.forDeletedDoc()),n=n.insert(t,e)}),n})},tE.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},tE.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Fg(e)).next(function(t){var e=wv();return t instanceof kw&&(e=e.insert(t.key,t)),e})},tE.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;Om(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=wv();return this.indexManager.getCollectionParents(n,a).next(function(t){return Rv.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(a));return o.getDocumentsMatchingCollectionQuery(n,e,i).next(function(t){t.forEach(function(t,e){s=s.insert(t,e)})})}).next(function(){return s})})},tE.prototype.getDocumentsMatchingCollectionQuery=function(e,n,t){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,t).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof kw?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},tE.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Sv(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Sb&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof kw&&(c=c.insert(t,e))}),c})},tE);function tE(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var eE=(nE.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},nE.prototype.addReference=function(t,e){var n=new rE(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},nE.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},nE.prototype.removeReference=function(t,e){this.removeRef(new rE(t,e))},nE.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},nE.prototype.removeReferencesForId=function(t){var e=this,n=Fg.EMPTY,r=new rE(n,t),i=new rE(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},nE.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},nE.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},nE.prototype.referencesForId=function(t){var e=Fg.EMPTY,n=new rE(e,t),r=new rE(e,t+1),i=Sv();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},nE.prototype.containsKey=function(t){var e=new rE(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},nE);function nE(){this.refsByKey=new fv(rE.compareByKey),this.refsByTarget=new fv(rE.compareByTargetId)}var rE=(iE.compareByKey=function(t,e){return Fg.comparator(t.key,e.key)||pg(t.targetOrBatchId,e.targetOrBatchId)},iE.compareByTargetId=function(t,e){return pg(t.targetOrBatchId,e.targetOrBatchId)||Fg.comparator(t.key,e.key)},iE);function iE(t,e){this.key=t,this.targetOrBatchId=e}var oE=(aE.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},aE.prototype.handleUserChange=function(i){return ua(this,void 0,void 0,function(){var e,m,n,r=this;return ca(this,function(t){switch(t.label){case 0:return e=this.mutationQueue,m=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var y;return r.mutationQueue.getAllMutationBatches(d).next(function(t){return y=t,e=r.persistence.getMutationQueue(i),m=new ZT(r.remoteDocuments,e,r.persistence.getIndexManager()),e.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=Sv(),i=0,o=y;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++)c=p[f],r=r.add(c.key)}return m.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return n=t.sent(),this.mutationQueue=e,this.localDocuments=m,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,n]}})})},aE.prototype.localWrite=function(s){var u,c=this,h=tv.now(),t=s.reduce(function(t,e){return t.add(e.key)},Sv());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(a){return c.localDocuments.getDocuments(a,t).next(function(t){u=t;for(var e=[],n=0,r=s;n<r.length;n++){var i=r[n],o=i.extractBaseValue(u.get(i.key));null!=o&&e.push(new Sb(i.key,o,o.fieldMask(),mb.exists(!0)))}return c.mutationQueue.addMutationBatch(a,h,e,s)})}).then(function(t){var e=t.applyToLocalDocumentSet(u);return{batchId:t.batchId,changes:e}})},aE.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Rv.resolve(null)})})},aE.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer({trackRemovals:!0});return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},aE.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Om(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},aE.prototype.getHighestUnacknowledgedBatchId=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.mutationQueue.getHighestUnacknowledgedBatchId(t)})},aE.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.mutationQueue.getLastStreamToken(t)})},aE.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},aE.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e.targetCache.getLastRemoteSnapshotVersion(t)})},aE.prototype.applyRemoteEvent=function(u){var c=this,h=u.snapshotVersion,l=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});l=c.targetDataByTarget;var a=[];Wm(u.targetChanges,function(t,e){var n=l.get(t);if(n){a.push(c.targetCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.targetCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n.withResumeToken(r,h).withSequenceNumber(o.currentSequenceNumber);l=l.insert(t,i),aE.shouldPersistTargetData(n,i,e)&&a.push(c.targetCache.updateTargetData(o,i))}}});var s=gv(),n=Sv();if(u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(i.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);e instanceof Ow&&e.version.isEqual(nv.MIN)?(i.removeEntry(t,h),s=s.insert(t,e)):null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(Om(!nv.MIN.isEqual(h),"Cannot add a document when the remote version is zero"),i.addEntry(e,h),s=s.insert(t,e)):Am("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})})),!h.isEqual(nv.MIN)){var t=c.targetCache.getLastRemoteSnapshotVersion(o).next(function(t){return Om(0<=h.compareTo(t),"Watch stream reverted to previous snapshot?? "+h+" < "+t),c.targetCache.setTargetsMetadata(o,o.currentSequenceNumber,h)});a.push(t)}return Rv.waitFor(a).next(function(){return i.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,s)})}).then(function(t){return c.targetDataByTarget=l,t})},aE.shouldPersistTargetData=function(t,e,n){return Om(0<e.resumeToken.length,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},aE.prototype.notifyLocalViewChanges=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);Om(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(s);this.targetDataByTarget=this.targetDataByTarget.insert(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return Rv.forEach(t,function(t){return Rv.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},aE.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},aE.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.localDocuments.getDocument(t,e)})},aE.prototype.allocateTarget=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i.targetCache.getTargetData(e,r).next(function(t){return t?(n=t,Rv.resolve(n)):i.targetCache.allocateTargetId(e).next(function(t){return n=new M_(r,t,A_.Listen,e.currentSequenceNumber),i.targetCache.addTargetData(e,n).next(function(){return n})})})}).then(function(t){return null===i.targetDataByTarget.get(t.targetId)&&(i.targetDataByTarget=i.targetDataByTarget.insert(t.targetId,t),i.targetIdByTarget.set(r,t.targetId)),t})},aE.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?Rv.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},aE.prototype.releaseTarget=function(n,r){var i=this,o=this.targetDataByTarget.get(n);if(!o)return Promise.resolve();var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.localViewReferences.removeReferencesForId(n);return r?Rv.resolve():Rv.forEach(t,function(t){return i.persistence.referenceDelegate.removeReference(e,t)}).next(function(){i.persistence.referenceDelegate.removeTarget(e,o)})}).then(function(){i.targetDataByTarget=i.targetDataByTarget.remove(n),i.targetIdByTarget.delete(o.target)})},aE.prototype.executeQuery=function(t,n){var r=this,i=nv.MIN,o=Sv();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.getTargetData(e,t.toTarget()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(function(t){o=t})}).next(function(){return r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:nv.MIN,n?o:Sv())}).next(function(t){return{documents:t,remoteKeys:o}})})},aE.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n.targetCache.getMatchingKeysForTargetId(t,e)})},aE.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},aE.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},aE.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},aE.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=Rv.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Om(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e,i.commitVersion):Om(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},aE.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.collect(t,n.targetDataByTarget)})},aE.prototype.getTarget=function(e){var n=this,t=this.targetDataByTarget.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n.targetCache.getTargetDataForTarget(t,e).next(function(t){return t?t.target:null})})},aE.prototype.getNewDocumentChanges=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.remoteDocuments.getNewDocumentChanges(t,r.lastDocumentChangeReadTime)}).then(function(t){var e=t.changedDocs,n=t.readTime;return r.lastDocumentChangeReadTime=n,e})},aE.prototype.synchronizeLastDocumentChangeReadTime=function(){return ua(this,void 0,void 0,function(){var e,n=this;return ca(this,function(t){return this.remoteDocuments instanceof jw?(e=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return e.getLastDocumentChange(t)}).then(function(t){var e=t.readTime;n.lastDocumentChangeReadTime=e})]):[2]})})},aE.RESUME_TOKEN_MAX_AGE_MICROS=3e8,aE);function aE(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new eE,this.targetDataByTarget=new iv(pg),this.targetIdByTarget=new Fw(function(t){return t.canonicalId()}),this.lastDocumentChangeReadTime=nv.MIN,Om(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new ZT(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}var sE=(uE.prototype.checkEmpty=function(t){return Rv.resolve(0===this.mutationQueue.length)},uE.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Om(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Om(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Rv.resolve()},uE.prototype.getLastStreamToken=function(t){return Rv.resolve(this.lastStreamToken)},uE.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Rv.resolve()},uE.prototype.addMutationBatch=function(t,e,n,r){Om(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&Om(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Nv(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new rE(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Rv.resolve(o)},uE.prototype.lookupMutationBatch=function(t,e){return Rv.resolve(this.findMutationBatch(e))},uE.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Om(null!=n,"Failed to find local mutation batch."),Rv.resolve(n.keys())},uE.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Rv.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},uE.prototype.getHighestUnacknowledgedBatchId=function(){return Rv.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},uE.prototype.getAllMutationBatches=function(t){return Rv.resolve(this.mutationQueue.slice())},uE.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new rE(n,0),i=new rE(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Om(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Om(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Rv.resolve(o)},uE.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new fv(pg);return e.forEach(function(e){var t=new rE(e,0),n=new rE(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Om(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),Rv.resolve(this.findMutationBatches(i))},uE.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Om(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Fg.isDocumentKey(i)||(i=i.child(""));var o=new rE(new Fg(i),0),a=new fv(pg);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Rv.resolve(this.findMutationBatches(a))},uE.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},uE.prototype.removeMutationBatch=function(n,r){var i=this;Om(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return Rv.forEach(r.mutations,function(t){var e=new rE(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},uE.prototype.removeCachedMutationKeys=function(t){},uE.prototype.containsKey=function(t,e){var n=new rE(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Rv.resolve(e.isEqual(r&&r.key))},uE.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Om(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Rv.resolve()},uE.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Om(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},uE.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},uE.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Om(n.batchId===t,"If found batch must match"),n},uE);function uE(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Lm(),this.batchesByDocumentKey=new fv(rE.compareByKey)}var cE,hE=(lE.prototype.addEntry=function(t,e,n){Om(!n.isEqual(nv.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},lE.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},lE.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Rv.resolve(n?n.maybeDocument:null)},lE.prototype.getEntries=function(t,e){var n=this,r=vv();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Rv.resolve(r)},lE.prototype.getDocumentsMatchingQuery=function(t,e,n){Om(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=wv(),i=new Fg(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof kw&&e.matches(c)&&(r=r.insert(c.key,c))}return Rv.resolve(r)},lE.prototype.forEachDocumentKey=function(t,e){return Rv.forEach(this.docs,function(t){return e(t)})},lE.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},lE.prototype.newChangeBuffer=function(t){return new lE.RemoteDocumentChangeBuffer(this)},lE.prototype.getSize=function(t){return Rv.resolve(this.size)},lE.RemoteDocumentChangeBuffer=(aa(fE,cE=Vw),fE.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e?i.push(r.documentCache.addEntry(n,e,r.readTime)):r.documentCache.removeEntry(t)}),Rv.waitFor(i)},fE.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},fE.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},fE),lE);function lE(t,e){this.indexManager=t,this.sizer=e,this.docs=new iv(Fg.comparator),this.size=0}function fE(t){var e=cE.call(this)||this;return e.documentCache=t,e}var pE=(dE.prototype.forEachTarget=function(t,n){return this.targets.forEach(function(t,e){return n(e)}),Rv.resolve()},dE.prototype.getLastRemoteSnapshotVersion=function(t){return Rv.resolve(this.lastRemoteSnapshotVersion)},dE.prototype.getHighestSequenceNumber=function(t){return Rv.resolve(this.highestSequenceNumber)},dE.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Rv.resolve(e)},dE.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Rv.resolve()},dE.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},dE.prototype.addTargetData=function(t,e){return Om(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,Rv.resolve()},dE.prototype.updateTargetData=function(t,e){return Om(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),Rv.resolve()},dE.prototype.removeTargetData=function(t,e){return Om(0<this.targetCount,"Removing a target from an empty cache"),Om(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Rv.resolve()},dE.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.targets.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.targets.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),Rv.waitFor(s).next(function(){return a})},dE.prototype.getTargetCount=function(t){return Rv.resolve(this.targetCount)},dE.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return Rv.resolve(n)},dE.prototype.getTargetDataForTarget=function(t,e){return Rm("Not yet implemented.")},dE.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),Rv.waitFor(i)},dE.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),Rv.waitFor(i)},dE.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Rv.resolve()},dE.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Rv.resolve(n)},dE.prototype.containsKey=function(t,e){return Rv.resolve(this.references.containsKey(e))},dE);function dE(t){this.persistence=t,this.targets=new Fw(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=nv.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new eE,this.targetCount=0,this.targetIdGenerator=eb.forTargetCache()}var yE=(mE.createLruPersistence=function(t,e,n){return new mE(t,function(t){return new TE(t,new x_(e),n)})},mE.createEagerPersistence=function(t){return new mE(t,function(t){return new wE(t)})},mE.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(mE.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),mE.prototype.getActiveClients=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){return[2,[this.clientId]]})})},mE.prototype.setPrimaryStateListener=function(t){return t(!0)},mE.prototype.setDatabaseDeletedListener=function(){},mE.prototype.setNetworkEnabled=function(t){},mE.prototype.getIndexManager=function(){return this.indexManager},mE.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new sE(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},mE.prototype.getTargetCache=function(){return this.targetCache},mE.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},mE.prototype.runTransaction=function(t,e,n){var r=this;Am("MemoryPersistence","Starting transaction:",t);var i=new vE(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},mE.prototype.mutationQueuesContainKey=function(e,n){return Rv.or(function(t){var n=[];return Km(t,function(t,e){return n.push(e)}),n}(this.mutationQueues).map(function(t){return function(){return t.containsKey(e,n)}}))},mE);function mE(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Ig(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new pE(this);this.indexManager=new Yw,this.remoteDocumentCache=new hE(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var gE,vE=(aa(bE,gE=z_),bE);function bE(t){var e=gE.call(this)||this;return e.currentSequenceNumber=t,e}var wE=(Object.defineProperty(_E.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Rm("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),_E.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},_E.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Rv.resolve()},_E.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Rv.resolve()},_E.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Rv.resolve()},_E.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeTargetData(t,e)})},_E.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},_E.prototype.onTransactionCommitted=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Rv.forEach(this.orphanedDocuments,function(e){return n.isReferenced(t,e).next(function(t){t||r.removeEntry(e)})}).next(function(){return n._orphanedDocuments=null,r.apply(t)})},_E.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},_E.prototype.documentSize=function(t){return 0},_E.prototype.isReferenced=function(t,e){var n=this;return Rv.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Rv.resolve(n.inMemoryPins.containsKey(e))}])},_E);function _E(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var TE=(EE.prototype.onTransactionStarted=function(){},EE.prototype.onTransactionCommitted=function(t){return Rv.resolve()},EE.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},EE.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},EE.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},EE.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return Rv.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?Rv.resolve():r(e)})})},EE.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},EE.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},EE.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=0,e=this.persistence.getRemoteDocumentCache(),o=e.newChangeBuffer();return e.forEachDocumentKey(t,function(e){return r.isPinned(t,e,n).next(function(t){t||(i++,o.removeEntry(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},EE.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Rv.resolve()},EE.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},EE.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Rv.resolve()},EE.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Rv.resolve()},EE.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Rv.resolve()},EE.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Rm("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},EE.prototype.isPinned=function(t,e,n){var r=this;return Rv.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Rv.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Rv.resolve(void 0!==t&&n<t)}])},EE.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},EE);function EE(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Fw(function(t){return Xg(t.path)}),this.garbageCollector=new H_(this,n)}var SE=(IE.prototype.reset=function(){this.currentBaseMs=0},IE.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},IE.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Am("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},IE.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},IE.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},IE);function IE(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var CE,NE,AE="PersistentStream";(NE=CE=CE||{})[NE.Initial=0]="Initial",NE[NE.Starting=1]="Starting",NE[NE.Open=2]="Open",NE[NE.Error=3]="Error",NE[NE.Backoff=4]="Backoff";var kE=(DE.prototype.isStarted=function(){return this.state===CE.Starting||this.state===CE.Open||this.state===CE.Backoff},DE.prototype.isOpen=function(){return this.state===CE.Open},DE.prototype.start=function(){this.state!==CE.Error?(Om(this.state===CE.Initial,"Already started"),this.auth()):this.performBackoff()},DE.prototype.stop=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(CE.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},DE.prototype.inhibitBackoff=function(){Om(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=CE.Initial,this.backoff.reset()},DE.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},DE.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},DE.prototype.handleIdleCloseTimer=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){return this.isOpen()?[2,this.close(CE.Initial)]:[2]})})},DE.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},DE.prototype.close=function(e,n){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return Om(this.isStarted(),"Only started streams should be closed."),Om(e===CE.Error||dT(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==CE.Error?this.backoff.reset():n&&n.code===Fm.RESOURCE_EXHAUSTED?(km(n.toString()),km("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===Fm.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},DE.prototype.tearDown=function(){},DE.prototype.auth=function(){var n=this;Om(this.state===CE.Initial,"Must be in initial state to auth"),this.state=CE.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new Um(Fm.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},DE.prototype.startStream=function(t){var e=this;Om(this.state===CE.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Om(e.state===CE.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=CE.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},DE.prototype.performBackoff=function(){var t=this;Om(this.state===CE.Error,"Should only perform backoff when in Error state"),this.state=CE.Backoff,this.backoff.backoffAndRun(function(){return ua(t,void 0,void 0,function(){return ca(this,function(t){return Om(this.state===CE.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=CE.Initial,this.start(),Om(this.isStarted(),"PersistentStream should have started"),[2]})})})},DE.prototype.handleStreamClose=function(t){return Om(this.isStarted(),"Can't handle server close on non-started stream"),Am(AE,"close with error: "+t),this.stream=null,this.close(CE.Error,t)},DE.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(Am(AE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},DE);function DE(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=CE.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new SE(t,e)}var RE,OE=(aa(PE,RE=kE),PE.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},PE.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},PE.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},PE.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},PE);function PE(t,e,n,r,i){var o=RE.call(this,t,Vg.ListenStreamConnectionBackoff,Vg.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var ME,LE=(aa(xE,ME=kE),Object.defineProperty(xE.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),xE.prototype.start=function(){this.handshakeComplete_=!1,ME.prototype.start.call(this)},xE.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},xE.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},xE.prototype.onMessage=function(t){if(Om(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Om(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},xE.prototype.writeHandshake=function(){Om(this.isOpen(),"Writing handshake requires an opened stream"),Om(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},xE.prototype.writeMutations=function(t){var e=this;Om(this.isOpen(),"Writing mutations requires an opened stream"),Om(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Om(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},xE);function xE(t,e,n,r,i){var o=ME.call(this,t,Vg.WriteStreamConnectionBackoff,Vg.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=Lm(),o}var FE=(UE.prototype.newPersistentWriteStream=function(t){return new LE(this.queue,this.connection,this.credentials,this.serializer,t)},UE.prototype.newPersistentWatchStream=function(t){return new OE(this.queue,this.connection,this.credentials,this.serializer,t)},UE.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},UE.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=gv();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Om(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},UE.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===Fm.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},UE.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===Fm.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},UE);function UE(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var VE,qE,BE,jE,WE=(KE.prototype.lookup=function(r){return ua(this,void 0,void 0,function(){var e,n=this;return ca(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Um(Fm.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Ow||t instanceof kw?n.recordVersion(t):Rm("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},KE.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},KE.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},KE.prototype.delete=function(t){this.write([new Mb(t,this.precondition(t))]),this.writtenDocs.add(t)},KE.prototype.commit=function(){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new Um(Fm.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},KE.prototype.recordVersion=function(t){var e;if(t instanceof kw)e=t.version;else{if(!(t instanceof Ow))throw Rm("Document in a transaction was a "+t.constructor.name);e=nv.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Um(Fm.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},KE.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?mb.updateTime(e):mb.NONE},KE.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return mb.exists(!0);if(e.isEqual(nv.forDeletedDoc()))throw new Um(Fm.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return mb.updateTime(e)},KE.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},KE.prototype.ensureCommitNotCalled=function(){Om(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},KE);function KE(t){this.datastore=t,this.readVersions=Tv(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(qE=VE=VE||{})[qE.Unknown=0]="Unknown",qE[qE.Online=1]="Online",qE[qE.Offline=2]="Offline",(jE=BE=BE||{})[jE.RemoteStore=0]="RemoteStore",jE[jE.SharedClientState=1]="SharedClientState";var QE,HE,GE=(zE.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(VE.Unknown),Om(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Vg.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Om(t.state===VE.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(VE.Offline),Promise.resolve()}))},zE.prototype.handleWatchStreamFailure=function(t){this.state===VE.Online?(this.setAndBroadcast(VE.Unknown),Om(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Om(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(VE.Offline)))},zE.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===VE.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},zE.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},zE.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(km(e),this.shouldWarnClientIsOffline=!1):Am("OnlineStateTracker",e)},zE.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},zE);function zE(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=VE.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function YE(t){switch(t){case Fm.OK:return Rm("Treated status OK as error");case Fm.CANCELLED:case Fm.UNKNOWN:case Fm.DEADLINE_EXCEEDED:case Fm.RESOURCE_EXHAUSTED:case Fm.INTERNAL:case Fm.UNAVAILABLE:case Fm.UNAUTHENTICATED:return!1;case Fm.INVALID_ARGUMENT:case Fm.NOT_FOUND:case Fm.ALREADY_EXISTS:case Fm.PERMISSION_DENIED:case Fm.FAILED_PRECONDITION:case Fm.ABORTED:case Fm.OUT_OF_RANGE:case Fm.UNIMPLEMENTED:case Fm.DATA_LOSS:return!0;default:return Rm("Unknown status code: "+t)}}function XE(t){if(void 0===t)return km("GRPC error has no .code"),Fm.UNKNOWN;switch(t){case QE.OK:return Fm.OK;case QE.CANCELLED:return Fm.CANCELLED;case QE.UNKNOWN:return Fm.UNKNOWN;case QE.DEADLINE_EXCEEDED:return Fm.DEADLINE_EXCEEDED;case QE.RESOURCE_EXHAUSTED:return Fm.RESOURCE_EXHAUSTED;case QE.INTERNAL:return Fm.INTERNAL;case QE.UNAVAILABLE:return Fm.UNAVAILABLE;case QE.UNAUTHENTICATED:return Fm.UNAUTHENTICATED;case QE.INVALID_ARGUMENT:return Fm.INVALID_ARGUMENT;case QE.NOT_FOUND:return Fm.NOT_FOUND;case QE.ALREADY_EXISTS:return Fm.ALREADY_EXISTS;case QE.PERMISSION_DENIED:return Fm.PERMISSION_DENIED;case QE.FAILED_PRECONDITION:return Fm.FAILED_PRECONDITION;case QE.ABORTED:return Fm.ABORTED;case QE.OUT_OF_RANGE:return Fm.OUT_OF_RANGE;case QE.UNIMPLEMENTED:return Fm.UNIMPLEMENTED;case QE.DATA_LOSS:return Fm.DATA_LOSS;default:return Rm("Unknown status code: "+t)}}(HE=QE=QE||{})[HE.OK=0]="OK",HE[HE.CANCELLED=1]="CANCELLED",HE[HE.UNKNOWN=2]="UNKNOWN",HE[HE.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",HE[HE.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",HE[HE.NOT_FOUND=5]="NOT_FOUND",HE[HE.ALREADY_EXISTS=6]="ALREADY_EXISTS",HE[HE.PERMISSION_DENIED=7]="PERMISSION_DENIED",HE[HE.UNAUTHENTICATED=16]="UNAUTHENTICATED",HE[HE.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",HE[HE.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",HE[HE.ABORTED=10]="ABORTED",HE[HE.OUT_OF_RANGE=11]="OUT_OF_RANGE",HE[HE.UNIMPLEMENTED=12]="UNIMPLEMENTED",HE[HE.INTERNAL=13]="INTERNAL",HE[HE.UNAVAILABLE=14]="UNAVAILABLE",HE[HE.DATA_LOSS=15]="DATA_LOSS";var JE,$E,ZE,tS,eS=(nS.emptySet=function(t){return new nS(t.comparator)},nS.prototype.has=function(t){return null!=this.keyedMap.get(t)},nS.prototype.get=function(t){return this.keyedMap.get(t)},nS.prototype.first=function(){return this.sortedSet.minKey()},nS.prototype.last=function(){return this.sortedSet.maxKey()},nS.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},nS.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(nS.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),nS.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},nS.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},nS.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},nS.prototype.isEqual=function(t){if(!(t instanceof nS))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},nS.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},nS.prototype.copy=function(t,e){var n=new nS;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},nS);function nS(n){this.comparator=n?function(t,e){return n(t,e)||Fg.comparator(t.key,e.key)}:function(t,e){return Fg.comparator(t.key,e.key)},this.keyedMap=wv(),this.sortedSet=new iv(this.comparator)}($E=JE=JE||{})[$E.Added=0]="Added",$E[$E.Removed=1]="Removed",$E[$E.Modified=2]="Modified",$E[$E.Metadata=3]="Metadata",(tS=ZE=ZE||{})[tS.Local=0]="Local",tS[tS.Synced=1]="Synced";var rS=(iS.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==JE.Added&&n.type===JE.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===JE.Metadata&&n.type!==JE.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===JE.Modified&&n.type===JE.Modified?this.changeMap=this.changeMap.insert(e,{type:JE.Modified,doc:t.doc}):t.type===JE.Modified&&n.type===JE.Added?this.changeMap=this.changeMap.insert(e,{type:JE.Added,doc:t.doc}):t.type===JE.Removed&&n.type===JE.Added?this.changeMap=this.changeMap.remove(e):t.type===JE.Removed&&n.type===JE.Modified?this.changeMap=this.changeMap.insert(e,{type:JE.Removed,doc:n.doc}):t.type===JE.Added&&n.type===JE.Removed?this.changeMap=this.changeMap.insert(e,{type:JE.Modified,doc:t.doc}):Rm("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},iS.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},iS);function iS(){this.changeMap=new iv(Fg.comparator)}var oS=(aS.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:JE.Added,doc:t})}),new aS(t,e,eS.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(aS.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),aS.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},aS);function aS(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var sS=(uS.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=cS.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new uS(nv.MIN,r,Cv(),gv(),Sv())},uS);function uS(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var cS=(hS.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new hS(Lm(),e,Sv(),Sv(),Sv())},hS);function hS(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var lS,fS,pS=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},dS=function(t,e){this.targetId=t,this.existenceFilter=e};(fS=lS=lS||{})[fS.NoChange=0]="NoChange",fS[fS.Added=1]="Added",fS[fS.Removed=2]="Removed",fS[fS.Current=3]="Current",fS[fS.Reset=4]="Reset";var yS=function(t,e,n,r){void 0===n&&(n=Lm()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},mS=(Object.defineProperty(gS.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(gS.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(gS.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(gS.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),gS.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},gS.prototype.toTargetChange=function(){var n=Sv(),r=Sv(),i=Sv();return this.documentChanges.forEach(function(t,e){switch(e){case JE.Added:n=n.add(t);break;case JE.Modified:r=r.add(t);break;case JE.Removed:i=i.add(t);break;default:Rm("Encountered invalid change type: "+e)}}),new cS(this._resumeToken,this._current,n,r,i)},gS.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=_S()},gS.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},gS.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},gS.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},gS.prototype.recordTargetResponse=function(){this.pendingResponses-=1},gS.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},gS);function gS(){this.pendingResponses=0,this.documentChanges=_S(),this._resumeToken=Lm(),this._current=!1,this._hasPendingChanges=!0}var vS=(bS.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof kw?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Ow&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},bS.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case lS.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case lS.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case lS.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Om(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case lS.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case lS.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Rm("Unknown target watch change state: "+n.state)}})},bS.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):Wm(this.targetStates,e)},bS.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new Fg(i.path);this.removeDocumentFromTarget(e,o,new Ow(o,nv.forDeletedDoc()))}else Om(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},bS.prototype.createRemoteEvent=function(i){var o=this,a={};Wm(this.targetStates,function(t,e){var n=o.targetDataForActiveTarget(t);if(n){if(e.current&&n.target.isDocumentQuery()){var r=new Fg(n.target.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new Ow(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=Sv();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.targetDataForActiveTarget(t);return!e||e.purpose===A_.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new sS(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=gv(),this.pendingDocumentTargetMapping=wS(),this.pendingTargetResets=new fv(pg),t},bS.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?JE.Modified:JE.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},bS.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,JE.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},bS.prototype.removeTarget=function(t){delete this.targetStates[t]},bS.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},bS.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},bS.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new mS),this.targetStates[t]},bS.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new fv(pg),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},bS.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||Am("WatchChangeAggregator","Detected inactive target",t),e},bS.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},bS.prototype.resetTarget=function(e){var n=this;Om(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new mS,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},bS.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},bS);function bS(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=gv(),this.pendingDocumentTargetMapping=wS(),this.pendingTargetResets=new fv(pg)}function wS(){return new iv(Fg.comparator)}function _S(){return new iv(Fg.comparator)}var TS="RemoteStore",ES=(SS.prototype.start=function(){return this.enableNetwork()},SS.prototype.enableNetwork=function(){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(VE.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},SS.prototype.disableNetwork=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(VE.Offline),[2]}})})},SS.prototype.disableNetworkInternal=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Am(TS,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},SS.prototype.shutdown=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return Am(TS,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(VE.Unknown),[2]}})})},SS.prototype.listen=function(t){Bm(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},SS.prototype.unlisten=function(t){Bm(this.listenTargets,t)&&(delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Qm(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(VE.Unknown)))},SS.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},SS.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},SS.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},SS.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},SS.prototype.startWatchStream=function(){Om(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new vS(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},SS.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Qm(this.listenTargets)},SS.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},SS.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},SS.prototype.onWatchStreamOpen=function(){return ua(this,void 0,void 0,function(){var n=this;return ca(this,function(t){return Wm(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},SS.prototype.onWatchStreamClose=function(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){return void 0===e&&Om(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(VE.Unknown),[2]})})},SS.prototype.onWatchStreamChange=function(n,r){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(VE.Online),n instanceof yS&&n.state===lS.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof pS?this.watchChangeAggregator.handleDocumentChange(n):n instanceof dS?this.watchChangeAggregator.handleExistenceFilter(n):(Om(n instanceof yS,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(nv.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},SS.prototype.raiseWatchSnapshot=function(r){var i=this;Om(!r.isEqual(nv.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return Wm(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.withResumeToken(e.resumeToken,r))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.withResumeToken(Lm(),e.snapshotVersion),i.sendUnwatchRequest(t);var n=new M_(e.target,t,A_.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},SS.prototype.handleTargetError=function(t){var n=this;Om(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return ua(n,void 0,void 0,function(){return ca(this,function(t){return Bm(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},SS.prototype.fillWritePipeline=function(){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},SS.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},SS.prototype.outstandingWrites=function(){return this.writePipeline.length},SS.prototype.addToWritePipeline=function(t){Om(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},SS.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},SS.prototype.startWriteStream=function(){Om(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},SS.prototype.onWriteStreamOpen=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){return this.writeStream.writeHandshake(),[2]})})},SS.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(iT)},SS.prototype.onMutationResult=function(t,e){var n=this;Om(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=kv.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},SS.prototype.onWriteStreamClose=function(n){return ua(this,void 0,void 0,function(){var e=this;return ca(this,function(t){return void 0===n&&Om(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},SS.prototype.handleHandshakeError=function(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){return YE(e.code)?(Am(TS,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Lm(),[2,this.localStore.setLastStreamToken(Lm()).catch(iT)]):[2]})})},SS.prototype.handleWriteError=function(r){return ua(this,void 0,void 0,function(){var e,n=this;return ca(this,function(t){return function(t){return YE(t)&&t!==Fm.ABORTED}(r.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,r).then(function(){return n.fillWritePipeline()})]):[2]})})},SS.prototype.createTransaction=function(){return new WE(this.datastore)},SS.prototype.restartNetwork=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(VE.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},SS.prototype.handleCredentialChange=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Am(TS,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},SS.prototype.applyPrimaryState=function(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(VE.Unknown),t.label=4;case 4:return[2]}})})},SS);function SS(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return ua(o,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Am(TS,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new GE(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var IS=(Object.defineProperty(CS.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(CS.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),CS.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},CS.prototype._compareTo=function(t){return pg(this._lat,t._lat)||pg(this._long,t._long)},CS);function CS(t,e){if(Gm("GeoPoint",arguments,2),Xm("GeoPoint","number",1,t),Xm("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Um(Fm.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Um(Fm.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var NS=(AS.prototype.applyToLocalView=function(t,e){return new cw(e,t)},AS.prototype.applyToRemoteDocument=function(t,e){return e},AS.prototype.computeBaseValue=function(t){return null},AS.prototype.isEqual=function(t){return t instanceof AS},AS.instance=new AS,AS);function AS(){}var kS=(DS.prototype.applyToLocalView=function(t,e){return this.apply(t)},DS.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},DS.prototype.apply=function(t){for(var n=LS(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Sw(n)},DS.prototype.computeBaseValue=function(t){return null},DS.prototype.isEqual=function(t){return t instanceof DS&&dg(t.elements,this.elements)},DS);function DS(t){this.elements=t}var RS=(OS.prototype.applyToLocalView=function(t,e){return this.apply(t)},OS.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},OS.prototype.apply=function(t){for(var n=LS(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Sw(n)},OS.prototype.computeBaseValue=function(t){return null},OS.prototype.isEqual=function(t){return t instanceof OS&&dg(t.elements,this.elements)},OS);function OS(t){this.elements=t}var PS=(MS.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof Jb&&this.operand instanceof Jb){var r=n.internalValue+this.operand.internalValue;return new Jb(r)}return r=n.internalValue+this.operand.internalValue,new tw(r)},MS.prototype.applyToRemoteDocument=function(t,e){return Om(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},MS.prototype.computeBaseValue=function(t){return t instanceof Gb?t:new Jb(0)},MS.prototype.isEqual=function(t){return t instanceof MS&&this.operand.isEqual(t.operand)},MS);function MS(t){this.operand=t}function LS(t){return t instanceof Sw?t.internalValue.slice():[]}var xS=(FS.prototype.isEqual=function(t){return t&&t.count===this.count},FS);function FS(t){this.count=t}var US,VS,qS=((US={})[WT.ASCENDING.name]="ASCENDING",US[WT.DESCENDING.name]="DESCENDING",US),BS=((VS={})[ET.LESS_THAN.name]="LESS_THAN",VS[ET.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",VS[ET.GREATER_THAN.name]="GREATER_THAN",VS[ET.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",VS[ET.EQUAL.name]="EQUAL",VS[ET.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",VS[ET.IN.name]="IN",VS[ET.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",VS),jS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function WS(t,e){Om(!dT(t),e+" is missing")}function KS(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Rm("can't parse "+t)}var QS=(HS.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},HS.prototype.unsafeCastProtoByteString=function(t){return t},HS.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Fm.UNKNOWN:XE(t.code);return new Um(e,t.message||"")},HS.prototype.toInt32Value=function(t){return this.options.useProto3Json||dT(t)?t:{value:t}},HS.prototype.fromInt32Value=function(t){var e;return dT(e="object"==typeof t?t.value:t)?null:e},HS.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},HS.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Om(!!t,"Cannot deserialize null or undefined timestamp.");var e=KS(t.seconds||"0"),n=t.nanos||0;return new tv(e,n)},HS.prototype.fromIso8601String=function(t){var e=0,n=jS.exec(t);if(Om(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new tv(o,e)},HS.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},HS.prototype.fromBlob=function(t){return"string"==typeof t?(Om(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),vg.fromBase64String(t)):(Om(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),vg.fromUint8Array(t))},HS.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},HS.prototype.fromVersion=function(t){return Om(!!t,"Trying to deserialize version that isn't set"),nv.fromTimestamp(this.fromTimestamp(t))},HS.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},HS.prototype.fromResourceName=function(t){var e=Rg.fromString(t);return Om(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},HS.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},HS.prototype.fromName=function(t){var e=this.fromResourceName(t);return Om(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Om(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Fg(this.extractLocalPathFromResourceName(e))},HS.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},HS.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Rg.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(HS.prototype,"encodedDatabaseId",{get:function(){return new Rg(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),HS.prototype.fullyQualifiedPrefixPath=function(t){return new Rg(["projects",t.projectId,"databases",t.database])},HS.prototype.extractLocalPathFromResourceName=function(t){return Om(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},HS.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},HS.prototype.toValue=function(t){if(t instanceof Bb)return{nullValue:"NULL_VALUE"};if(t instanceof Kb)return{booleanValue:t.value()};if(t instanceof Jb)return{integerValue:""+t.value()};if(t instanceof tw){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof rw?{stringValue:t.value()}:t instanceof _w?{mapValue:this.toMapValue(t)}:t instanceof Sw?{arrayValue:this.toArrayValue(t)}:t instanceof aw?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof vw?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof fw?{bytesValue:this.toBytes(t.value())}:t instanceof yw?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Rm("Unknown FieldValue "+JSON.stringify(t))},HS.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Bb.INSTANCE;if("booleanValue"in t)return Kb.of(t.booleanValue);if("integerValue"in t)return new Jb(KS(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return tw.NAN;if("Infinity"===t.doubleValue)return tw.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return tw.NEGATIVE_INFINITY}return new tw(t.doubleValue)}if("stringValue"in t)return new rw(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){WS(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Sw(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return WS(t.timestampValue,"timestampValue"),new aw(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){WS(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new vw(new IS(r,i))}if("bytesValue"in t){WS(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new fw(o)}if("referenceValue"in t){WS(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new Eg(a.get(1),a.get(3)),u=new Fg(this.extractLocalPathFromResourceName(a));return new yw(s,u)}return Rm("Unknown Value proto "+JSON.stringify(t))},HS.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},HS.prototype.toDocument=function(t){return Om(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},HS.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new kw(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.fromValue(t)})},HS.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},HS.prototype.fromFields=function(t){var n=this,e=t,r=_w.EMPTY;return Km(e,function(t,e){r=r.set(new Lg([t]),n.fromValue(e))}),r},HS.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},HS.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},HS.prototype.fromFound=function(t){var e=this;Om(!!t.found,"Tried to deserialize a found document from a missing document."),WS(t.found.name,"doc.found.name"),WS(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new kw(n,r,{},void 0,t.found,function(t){return e.fromValue(t)})},HS.prototype.fromMissing=function(t){Om(!!t.missing,"Tried to deserialize a missing document from a found document."),Om(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Ow(e,n)},HS.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Rm("invalid batch get response: "+JSON.stringify(t))},HS.prototype.toWatchTargetChangeState=function(t){switch(t){case lS.Added:return"ADD";case lS.Current:return"CURRENT";case lS.NoChange:return"NO_CHANGE";case lS.Removed:return"REMOVE";case lS.Reset:return"RESET";default:return Rm("Unknown WatchTargetChangeState: "+t)}},HS.prototype.toTestWatchChange=function(t){if(t instanceof dS)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof pS){if(t.newDoc instanceof kw){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Ow)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof yS){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return QE.OK;switch(t){case Fm.OK:return QE.OK;case Fm.CANCELLED:return QE.CANCELLED;case Fm.UNKNOWN:return QE.UNKNOWN;case Fm.DEADLINE_EXCEEDED:return QE.DEADLINE_EXCEEDED;case Fm.RESOURCE_EXHAUSTED:return QE.RESOURCE_EXHAUSTED;case Fm.INTERNAL:return QE.INTERNAL;case Fm.UNAVAILABLE:return QE.UNAVAILABLE;case Fm.UNAUTHENTICATED:return QE.UNAUTHENTICATED;case Fm.INVALID_ARGUMENT:return QE.INVALID_ARGUMENT;case Fm.NOT_FOUND:return QE.NOT_FOUND;case Fm.ALREADY_EXISTS:return QE.ALREADY_EXISTS;case Fm.PERMISSION_DENIED:return QE.PERMISSION_DENIED;case Fm.FAILED_PRECONDITION:return QE.FAILED_PRECONDITION;case Fm.ABORTED:return QE.ABORTED;case Fm.OUT_OF_RANGE:return QE.OUT_OF_RANGE;case Fm.UNIMPLEMENTED:return QE.UNIMPLEMENTED;case Fm.DATA_LOSS:return QE.DATA_LOSS;default:return Rm("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Rm("Unrecognized watch change: "+JSON.stringify(t))},HS.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){WS(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new yS(r,i,o,s||null)}else if("documentChange"in t){WS(t.documentChange,"documentChange"),WS(t.documentChange.document,"documentChange.name"),WS(t.documentChange.document.name,"documentChange.document.name"),WS(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new kw(c,h,{},void 0,u.document,function(t){return n.fromValue(t)}),f=u.targetIds||[],p=u.removedTargetIds||[];e=new pS(f,p,l.key,l)}else if("documentDelete"in t){WS(t.documentDelete,"documentDelete"),WS(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):nv.forDeletedDoc(),l=new Ow(c,h),p=d.removedTargetIds||[],e=new pS([],p,l.key,l)}else if("documentRemove"in t){WS(t.documentRemove,"documentRemove"),WS(t.documentRemove.document,"documentRemove");var y=t.documentRemove;c=this.fromName(y.document),p=y.removedTargetIds||[],e=new pS([],p,c,null)}else{if(!("filter"in t))return Rm("Unknown change type "+JSON.stringify(t));WS(t.filter,"filter"),WS(t.filter.targetId,"filter.targetId");var m=t.filter,g=m.count||0,v=new xS(g),b=m.targetId;e=new dS(b,v)}return e},HS.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?lS.NoChange:"ADD"===t?lS.Added:"REMOVE"===t?lS.Removed:"CURRENT"===t?lS.Current:"RESET"===t?lS.Reset:Rm("Got unexpected TargetChange.state: "+t)},HS.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return nv.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?nv.MIN:e.readTime?this.fromVersion(e.readTime):nv.MIN},HS.prototype.toMutation=function(t){var e,n=this;if(t instanceof _b)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Mb)e={delete:this.toName(t.key)};else if(t instanceof Sb)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Nb))return Rm("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},HS.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):mb.NONE;if(t.update){WS(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Sb(r,i,o,n)}return new _b(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new Mb(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Om(!0===n.exists,'Transforms only support precondition "exists == true"'),new Nb(r,a)}return Rm("unknown mutation proto: "+JSON.stringify(t))},HS.prototype.toPrecondition=function(t){return Om(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Rm("Unknown precondition")},HS.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?mb.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?mb.exists(t.exists):mb.NONE},HS.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(nv.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new yb(r,i)},HS.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Om(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},HS.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof NS)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof kS)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof RS)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof PS)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Rm("Unknown transform: "+t.transform)},HS.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Om("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=NS.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new kS(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new RS(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);Om(i instanceof Gb,"NUMERIC_ADD transform requires a NumberValue"),n=new PS(i)}else Rm("Unknown transform proto: "+JSON.stringify(t));var o=Lg.fromServerFormat(t.fieldPath);return new lb(o,n)},HS.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},HS.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Om(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return wT.atPath(this.fromQueryPath(n)).toTarget()},HS.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Om(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Om(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},HS.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Om(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new wT(e,i,s,a,u,mT.First,c,h).toTarget()},HS.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},HS.prototype.toLabel=function(t){switch(t){case A_.Listen:return null;case A_.ExistenceFilterMismatch:return"existence-filter-mismatch";case A_.LimboResolution:return"limbo-document";default:return Rm("Unrecognized query purpose: "+t)}},HS.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},HS.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof CT?e.toUnaryOrFieldFilter(t):Rm("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},HS.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Rm("Unknown filter: "+JSON.stringify(t)):[]},HS.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},HS.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},HS.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},HS.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new QT(r,n)},HS.prototype.toDirection=function(t){return qS[t.name]},HS.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return WT.ASCENDING;case"DESCENDING":return WT.DESCENDING;default:return}},HS.prototype.toOperatorName=function(t){return BS[t.name]},HS.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return ET.EQUAL;case"GREATER_THAN":return ET.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return ET.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return ET.LESS_THAN;case"LESS_THAN_OR_EQUAL":return ET.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return ET.ARRAY_CONTAINS;case"IN":return ET.IN;case"ARRAY_CONTAINS_ANY":return ET.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Rm("Unspecified operator");default:return Rm("Unknown operator")}},HS.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},HS.prototype.fromFieldPathReference=function(t){return Lg.fromServerFormat(t.fieldPath)},HS.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},HS.prototype.fromPropertyOrder=function(t){return new GT(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},HS.prototype.fromFieldFilter=function(t){return CT.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},HS.prototype.toUnaryOrFieldFilter=function(t){if(t.op===ET.EQUAL){if(t.value.isEqual(tw.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Bb.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},HS.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return CT.create(e,ET.EQUAL,tw.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return CT.create(n,ET.EQUAL,Bb.INSTANCE);case"OPERATOR_UNSPECIFIED":return Rm("Unspecified filter");default:return Rm("Unknown filter")}},HS.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},HS.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Lg.fromServerFormat(t)});return cb.fromArray(e)},HS);function HS(t,e){this.databaseId=t,this.options=e}var GS=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},zS=(YS.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new GS,this.queries.set(e,r)),r.listeners.push(t),Om(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},YS.prototype.unlisten=function(o){return ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},YS.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(e=!0);a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},YS.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},YS.prototype.onOnlineStateChange=function(i){this.onlineState=i;var o=!1;this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&this.raiseSnapshotsInSyncEvent()},YS.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},YS.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},YS.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(t){t.next()})},YS);function YS(t){this.syncEngine=t,this.queries=new Fw(function(t){return t.canonicalId()}),this.onlineState=VE.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var XS=(JS.prototype.onViewSnapshot=function(t){if(Om(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==JE.Metadata&&e.push(i)}t=new oS(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},JS.prototype.onError=function(t){this.queryObserver.error(t)},JS.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},JS.prototype.shouldRaiseInitialEvent=function(t,e){if(Om(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==VE.Offline;return this.options.waitForSyncWhenOnline&&n?(Om(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===VE.Offline},JS.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},JS.prototype.raiseInitialEvent=function(t){Om(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=oS.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},JS);function JS(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=VE.Unknown,this.options=n||{}}var $S=(ZS.fromSnapshot=function(t,e){for(var n=Sv(),r=Sv(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case JE.Added:n=n.add(a.doc.key);break;case JE.Removed:r=r.add(a.doc.key)}}return new ZS(t,e.fromCache,n,r)},ZS);function ZS(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}var tI=function(t){this.key=t},eI=function(t){this.key=t},nI=(Object.defineProperty(rI.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),rI.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new rS,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimitToFirst()&&c.size===this.query.limit?c.last():null,d=this.query.hasLimitToLast()&&c.size===this.query.limit?c.first():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof kw?e:null;r&&(Om(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:JE.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:JE.Modified,doc:r}),a=!0,(p&&0<s.query.docComparator(r,p)||d&&s.query.docComparator(r,d)<0)&&(f=!0)):!n&&r?(u.track({type:JE.Added,doc:r}),a=!0):n&&!r&&(u.track({type:JE.Removed,doc:n}),a=!0,(p||d)&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;l.size>this.query.limit;){var n=this.query.hasLimitToFirst()?l.last():l.first();l=l.delete(n.key),h=h.delete(n.key),u.track({type:JE.Removed,doc:n})}return Om(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},rI.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},rI.prototype.applyChanges=function(t,e,n){var r=this;Om(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case JE.Added:return 1;case JE.Modified:case JE.Metadata:return 2;case JE.Removed:return 0;default:return Rm("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?ZE.Synced:ZE.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new oS(this.query,t.documentSet,i,o,t.mutatedKeys,s===ZE.Local,u,!1),limboChanges:a}:{limboChanges:a}},rI.prototype.applyOnlineStateChange=function(t){return this.current&&t===VE.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new rS,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},rI.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},rI.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Om(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},rI.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=Sv(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new eI(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new tI(t))}),r},rI.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=Sv();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},rI.prototype.computeInitialSnapshot=function(){return oS.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===ZE.Local)},rI);function rI(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Sv(),this.mutatedKeys=Sv(),this.documentSet=new eS(t.docComparator.bind(t))}var iI=(oI.prototype.run=function(){this.runWithBackOff()},oI.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return ua(t,void 0,void 0,function(){var e,n,r=this;return ca(this,function(t){return e=this.remoteStore.createTransaction(),(n=this.tryRunUpdateFunction(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.handleTransactionError(t)})})}).catch(function(t){r.handleTransactionError(t)}),[2]})})})},oI.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!dT(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},oI.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},oI.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!YE(e)},oI);function oI(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new SE(this.asyncQueue,Vg.RetryTransaction)}var aI="SyncEngine",sI=function(t,e,n){this.query=t,this.targetId=e,this.view=n},uI=function(t){this.key=t,this.receivedDocument=!1},cI=(Object.defineProperty(hI.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),hI.prototype.subscribe=function(t){Om(null!==t,"SyncEngine listener cannot be null"),Om(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},hI.prototype.listen=function(a){return ua(this,void 0,void 0,function(){var e,n,r,i,o;return ca(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(a.toTarget())];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(a,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},hI.prototype.initializeViewAndComputeSnapshot=function(s,u,c){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(s,!0)];case 1:return e=t.sent(),n=new nI(s,e.remoteKeys),r=n.computeDocChanges(e.documents),i=cS.createSynthesizedTargetChangeForCurrentChange(u,c&&this.onlineState!==VE.Offline),Om(0===(o=n.applyChanges(r,!0===this.isPrimary,i)).limboChanges.length,"View returned limbo docs before target ack from the server."),Om(!!o.snapshot,"applyChanges for new view should always return a snapshot"),a=new sI(s,u,n),this.queryViewsByQuery.set(s,a),this.queriesByTarget[u]||(this.queriesByTarget[u]=[]),this.queriesByTarget[u].push(s),[2,o.snapshot]}})})},hI.prototype.synchronizeViewAndComputeSnapshot=function(r){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(r.query,!0)];case 1:return e=t.sent(),n=r.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(r.targetId,n.limboChanges),[2,n]}})})},hI.prototype.unlisten=function(i){return ua(this,void 0,void 0,function(){var e,n,r=this;return ca(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Om(!!(e=this.queryViewsByQuery.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.queriesByTarget[e.targetId]).length?(this.queriesByTarget[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.queryViewsByQuery.delete(i),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then(function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)}).catch(iT)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},hI.prototype.write=function(n,r){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},hI.prototype.runTransaction=function(t,e,n){new iI(t,this.remoteStore,e,n).run()},hI.prototype.applyRemoteEvent=function(n){return ua(this,void 0,void 0,function(){var e,r=this;return ca(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),Km(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&(Om(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Om(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Om(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,iT(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},hI.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===BE.RemoteStore||!this.isPrimary&&t===BE.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Om(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},hI.prototype.rejectListen=function(s,u){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a=this;return ca(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(s,"rejected",u),e=this.limboResolutionsByTarget[s],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[s],r=(r=new iv(Fg.comparator)).insert(n,new Ow(n,nv.forDeletedDoc())),i=Sv().add(n),o=new sS(nv.MIN,{},new fv(pg),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return[4,this.localStore.releaseTarget(s,!1).then(function(){return a.removeAndCleanupTarget(s,u)}).catch(iT)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},hI.prototype.applyBatchState=function(n,r,i){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(Am(aI,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Rm("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},hI.prototype.applySuccessfulWrite=function(r){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,iT(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},hI.prototype.rejectFailedWrite=function(n,r){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),this.triggerPendingWritesCallbacks(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,iT(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},hI.prototype.registerPendingWritesCallback=function(r){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return this.remoteStore.canUseNetwork()||Am(aI,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(r),this.pendingWritesCallbacks.set(e,n)),[2]}})})},hI.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},hI.prototype.rejectOutstandingPendingWritesCallbacks=function(e){this.pendingWritesCallbacks.forEach(function(t){t.forEach(function(t){t.reject(new Um(Fm.CANCELLED,e))})}),this.pendingWritesCallbacks.clear()},hI.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new iv(pg)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},hI.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Om(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},hI.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),Om(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach(function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)})}},hI.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},hI.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof tI?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof eI?(Am(aI,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Rm("Unknown limbo change: "+JSON.stringify(i))}},hI.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Am(aI,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=wT.atPath(e.path);this.limboResolutionsByTarget[n]=new uI(e),this.remoteStore.listen(new M_(r.toTarget(),n,A_.LimboResolution,Ig.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},hI.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},hI.prototype.emitNewSnapsAndNotifyLocalStore=function(r,u){return ua(this,void 0,void 0,function(){var o,a,e,s=this;return ca(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.computeDocChanges(r);return n.needsRefill?s.localStore.executeQuery(i.query,!1).then(function(t){var e=t.documents;return i.view.computeDocChanges(e,n)}):n}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=$S.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},hI.prototype.assertSubscribed=function(t){Om(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},hI.prototype.handleCredentialChange=function(r){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(r)]):[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},hI.prototype.applyPrimaryState=function(c){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return ca(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),Wm(this.queriesByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.removeAndCleanupTarget(t),u.localStore.releaseTarget(t,!0)}),u.remoteStore.unlisten(t)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},hI.prototype.resetLimboDocuments=function(){var e=this;Wm(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new iv(Fg.comparator)},hI.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(d){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p;return ca(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queriesByTarget[o])&&0!==s.length?[4,this.localStore.releaseTarget(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.localStore.allocateTarget(s[0].toTarget())];case 3:a=t.sent(),u=0,c=s,t.label=4;case 4:return u<c.length?(h=c[u],Om(!!(l=this.queryViewsByQuery.get(h)),"No query view found for "+h),[4,this.synchronizeViewAndComputeSnapshot(l)]):[3,7];case 5:(f=t.sent()).snapshot&&n.push(f.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Om(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(o)];case 9:return Om(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.localStore.allocateTarget(p)];case 10:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(a),t.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},hI.prototype.synthesizeTargetToQuery=function(t){return new wT(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,mT.First,t.startAt,t.endAt)},hI.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},hI.prototype.applyTargetState=function(r,i,o){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Am(aI,"Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return e=t.sent(),n=sS.createSynthesizedRemoteEventForCurrentChange(r,"current"===i),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(r,!0)];case 5:return t.sent(),this.removeAndCleanupTarget(r,o),[3,7];case 6:Rm("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},hI.prototype.applyActiveTargetsChange=function(l,f){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return ca(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],Om(!this.queriesByTarget[c],"Trying to add an already active target"),[4,this.localStore.getTarget(c)]):[3,6];case 2:return Om(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateTarget(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(r),i.targetId,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return ca(this,function(t){switch(t.label){case 0:return a.queriesByTarget[e]?[4,a.localStore.releaseTarget(e,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupTarget(e)}).catch(iT)]:[2,"continue"];case 1:return t.sent(),[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},hI.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},hI.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},hI.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return Sv().add(e.key);var n=Sv(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);Om(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},hI);function hI(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Fw(function(t){return t.canonicalId()}),this.queriesByTarget={},this.limboTargetsByKey=new iv(Fg.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new eE,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=eb.forSyncEngine(),this.isPrimary=void 0,this.onlineState=VE.Unknown}var lI=(fI.prototype.isAuthenticated=function(){return null!=this.uid},fI.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},fI.prototype.isEqual=function(t){return t.uid===this.uid},fI.UNAUTHENTICATED=new fI(null),fI.GOOGLE_CREDENTIALS=new fI("google-credentials-uid"),fI.FIRST_PARTY=new fI("first-party-uid"),fI);function fI(t){this.uid=t}var pI="SharedClientState",dI="firestore_clients",yI="firestore_mutations",mI="firestore_targets",gI=(vI.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Um(r.error.code,r.error.message)),i?new vI(t,e,r.state,o):(km(pI,"Failed to parse mutation state for ID '"+e+"': "+n),null)},vI.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},vI);function vI(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Om(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var bI=(wI.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Um(n.error.code,n.error.message)),r?new wI(t,n.state,i):(km(pI,"Failed to parse target state for ID '"+t+"': "+e),null)},wI.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},wI);function wI(t,e,n){this.targetId=t,this.state=e,Om(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var _I=(TI.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Cv(),o=0;r&&o<n.activeTargetIds.length;++o)r=yT(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new TI(t,i):(km(pI,"Failed to parse client data for instance '"+t+"': "+e),null)},TI);function TI(t,e){this.clientId=t,this.activeTargetIds=e}var EI=(SI.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in VE&&"string"==typeof e.clientId?new SI(e.clientId,VE[e.onlineState]):(km(pI,"Failed to parse online state: "+t),null)},SI);function SI(t,e){this.clientId=t,this.onlineState=e}var II=(CI.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},CI.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},CI.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},CI);function CI(){this.activeTargetIds=Cv()}var NI=(AI.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},AI.prototype.start=function(){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return ca(this,function(t){switch(t.label){case 0:return Om(!this.started,"WebStorageSharedClientState already started"),Om(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Om(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=_I.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},AI.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},AI.prototype.getAllActiveQueryTargets=function(){var n=Cv();return Km(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},AI.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},AI.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},AI.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},AI.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=bI.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},AI.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},AI.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},AI.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},AI.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},AI.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},AI.prototype.setOnlineState=function(t){this.persistOnlineState(t)},AI.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},AI.prototype.getItem=function(t){var e=this.storage.getItem(t);return Am(pI,"READ",t,e),e},AI.prototype.setItem=function(t,e){Am(pI,"SET",t,e),this.storage.setItem(t,e)},AI.prototype.removeItem=function(t){Am(pI,"REMOVE",t),this.storage.removeItem(t)},AI.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(Am(pI,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void km("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return ua(t,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Om(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Ig.INVALID;if(null!=t)try{var n=JSON.parse(t);Om("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){km(pI,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Ig.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(AI.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),AI.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},AI.prototype.persistMutationState=function(t,e,n){var r=new gI(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},AI.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},AI.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:VE[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},AI.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new bI(t,e,n);this.setItem(r,i.toWebStorageJSON())},AI.prototype.toWebStorageClientStateKey=function(t){return Om(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),dI+"_"+this.persistenceKey+"_"+t},AI.prototype.toWebStorageQueryTargetMetadataKey=function(t){return mI+"_"+this.persistenceKey+"_"+t},AI.prototype.toWebStorageMutationBatchKey=function(t){var e=yI+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},AI.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},AI.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Om(null!==n,"Cannot parse client state key '"+t+"'"),_I.fromWebStorageEntry(n,e)},AI.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Om(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return gI.fromWebStorageEntry(new lI(i),r,e)},AI.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Om(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return bI.fromWebStorageEntry(r,e)},AI.prototype.fromWebStorageOnlineState=function(t){return EI.fromWebStorageEntry(t)},AI.prototype.handleMutationBatchEvent=function(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){return e.user.uid!==this.currentUser.uid?(Am(pI,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},AI.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},AI.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return ua(n,void 0,void 0,function(){return ca(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return ua(n,void 0,void 0,function(){return ca(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},AI.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},AI);function AI(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!AI.isAvailable(this.platform))throw new Um(Fm.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new II,this.clientStateKeyRe=new RegExp("^"+dI+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+yI+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+mI+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}var kI=(DI.prototype.addPendingMutation=function(t){},DI.prototype.updateMutationState=function(t,e,n){},DI.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},DI.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},DI.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},DI.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},DI.prototype.clearQueryState=function(t){delete this.queryState[t]},DI.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},DI.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},DI.prototype.start=function(){return this.localState=new II,Promise.resolve()},DI.prototype.handleUserChange=function(t,e,n){},DI.prototype.setOnlineState=function(t){},DI.prototype.shutdown=function(){},DI.prototype.writeSequenceNumber=function(t){},DI);function DI(){this.localState=new II,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var RI="FirestoreClient",OI=(PI.prototype.lruParams=function(){return j_.withCacheSize(this.cacheSizeBytes)},PI);function PI(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var MI=function(){},LI=(xI.prototype.start=function(t){var n=this;this.verifyNotTerminated();var r=new Bg,i=new Bg,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},xI.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},xI.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof OI?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},xI.prototype.canFallback=function(t){return t instanceof Um?t.code===Fm.FAILED_PRECONDITION||t.code===Fm.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},xI.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Um(Fm.FAILED_PRECONDITION,"The client has already been terminated.")},xI.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=nT.buildStoragePrefix(this.databaseInfo),a=new QS(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return ua(t,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!NI.isAvailable(this.platform))throw new Um(Fm.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.lruParams(),this.sharedClientState=i.synchronizeTabs?new NI(this.asyncQueue,this.platform,o,this.clientId,r):new kI,[4,nT.createIndexedDbPersistence({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:a,lruParams:e,sequenceNumberSyncer:this.sharedClientState})];case 1:return n=t.sent(),[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},xI.prototype.startMemoryPersistence=function(){return this.persistence=yE.createEagerPersistence(this.clientId),this.sharedClientState=new kI,Promise.resolve(null)},xI.prototype.initializeRest=function(c,h){var t=this;return Am(RI,"Initializing. user=",c.uid),this.platform.loadConnection(this.databaseInfo).then(function(u){return ua(t,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return ca(this,function(t){switch(t.label){case 0:return e=new JT,this.localStore=new oE(this.persistence,e,c),[4,this.localStore.start()];case 1:return t.sent(),h&&(this.lruScheduler=new K_(h,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),r=this.platform.newSerializer(this.databaseInfo.databaseId),i=new FE(this.asyncQueue,u,this.credentials,r),o=function(t){return s.syncEngine.applyOnlineStateChange(t,BE.RemoteStore)},a=function(t){return s.syncEngine.applyOnlineStateChange(t,BE.SharedClientState)},this.remoteStore=new ES(this.localStore,i,this.asyncQueue,o,n),this.syncEngine=new cI(this.localStore,this.remoteStore,this.sharedClientState,c),this.sharedClientState.onlineStateHandler=a,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new zS(this.syncEngine),[4,this.sharedClientState.start()];case 2:return t.sent(),[4,this.remoteStore.start()];case 3:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return ua(s,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return ua(s,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},xI.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Am(RI,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},xI.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},xI.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return ua(t,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},xI.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new Bg;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},xI.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new XS(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},xI.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},xI.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof kw)return t;if(t instanceof Ow)return null;throw new Um(Fm.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},xI.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return ua(t,void 0,void 0,function(){var e,n,r;return ca(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i,!0)];case 1:return e=t.sent(),n=new nI(i,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}})})})},xI.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new Bg;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},xI.prototype.databaseId=function(){return this.databaseInfo.databaseId},xI.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()})},xI.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(xI.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),xI.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new Bg;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},xI);function xI(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=lg.newId()}var FI=(UI.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},UI.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},UI.prototype.mute=function(){this.muted=!0},UI.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},UI);function UI(t){this.observer=t,this.muted=!1}var VI=(qI.documentId=function(){return qI._DOCUMENT_ID},qI.prototype.isEqual=function(t){if(!(t instanceof qI))throw sg("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},qI._DOCUMENT_ID=new qI(Lg.keyField().canonicalString()),qI);function qI(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+hg(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Xm("FieldPath","string",n,t[n]),0===t[n].length)throw new Um(Fm.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Lg(t)}var BI=new RegExp("[~\\*/\\[\\]]");var jI=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},WI=(KI.prototype.getToken=function(){return Promise.resolve(null)},KI.prototype.invalidateToken=function(){},KI.prototype.setChangeListener=function(t){Om(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(lI.UNAUTHENTICATED)},KI.prototype.removeChangeListener=function(){Om(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},KI);function KI(){this.changeListener=null}var QI=(HI.prototype.getToken=function(){var e=this;Om(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new Um(Fm.ABORTED,"getToken aborted due to token change.");return t?(Om("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new jI(t.accessToken,e.currentUser)):null})},HI.prototype.invalidateToken=function(){this.forceRefresh=!0},HI.prototype.setChangeListener=function(t){Om(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},HI.prototype.removeChangeListener=function(){Om(null!=this.tokenListener,"removeChangeListener() called twice"),Om(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},HI.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Om(null===t||"string"==typeof t,"Received invalid UID: "+t),new lI(t)},HI);function HI(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=lI.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}var GI=(Object.defineProperty(zI.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),zI);function zI(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=lI.FIRST_PARTY}var YI=(XI.prototype.getToken=function(){return Promise.resolve(new GI(this.gapi,this.sessionIndex))},XI.prototype.setChangeListener=function(t){t(lI.FIRST_PARTY)},XI.prototype.removeChangeListener=function(){},XI.prototype.invalidateToken=function(){},XI);function XI(t,e){this.gapi=t,this.sessionIndex=e}function JI(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var $I=(ZI.delete=function(){return Hm("FieldValue.delete",arguments),eC.instance},ZI.serverTimestamp=function(){return Hm("FieldValue.serverTimestamp",arguments),iC.instance},ZI.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return zm("FieldValue.arrayUnion",arguments,1),new sC(t)},ZI.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return zm("FieldValue.arrayRemove",arguments,1),new hC(t)},ZI.increment=function(t){return Xm("FieldValue.increment","number",1,t),Gm("FieldValue.increment",arguments,1),new pC(t)},ZI.prototype.isEqual=function(t){return this===t},ZI);function ZI(t){this._methodName=t}var tC,eC=(aa(nC,tC=$I),nC.instance=new nC,nC);function nC(){return tC.call(this,"FieldValue.delete")||this}var rC,iC=(aa(oC,rC=$I),oC.instance=new oC,oC);function oC(){return rC.call(this,"FieldValue.serverTimestamp")||this}var aC,sC=(aa(uC,aC=$I),uC);function uC(t){var e=aC.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var cC,hC=(aa(lC,cC=$I),lC);function lC(t){var e=cC.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var fC,pC=(aa(dC,fC=$I),dC);function dC(t){var e=fC.call(this,"FieldValue.increment")||this;return e._operand=t,e}var yC=qm($I,"Use FieldValue.<field>() instead."),mC=/^__.*__$/,gC=(vC.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Sb(t,this.data,this.fieldMask,e)):n.push(new _b(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Nb(t,this.fieldTransforms)),n},vC);function vC(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var bC,wC,_C=(TC.prototype.toMutations=function(t,e){var n=[new Sb(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new Nb(t,this.fieldTransforms)),n},TC);function TC(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function EC(t){switch(t){case bC.Set:case bC.MergeSet:case bC.Update:return!0;case bC.Argument:case bC.ArrayArgument:return!1;default:throw Rm("Unexpected case for UserDataSource: "+t)}}(wC=bC=bC||{})[wC.Set=0]="Set",wC[wC.Update=1]="Update",wC[wC.MergeSet=2]="MergeSet",wC[wC.Argument=3]="Argument",wC[wC.ArrayArgument=4]="ArrayArgument";var SC=(IC.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new IC(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},IC.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new IC(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},IC.prototype.childContextForArray=function(t){return new IC(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},IC.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Um(Fm.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},IC.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},IC.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},IC.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(EC(this.dataSource)&&mC.test(t))throw this.createError('Document fields cannot begin and end with "__"')},IC);function IC(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var CC=function(t,e){this.databaseId=t,this.key=e},NC=(AC.prototype.parseSetData=function(t,e){var n=new SC(bC.Set,t,Lg.EMPTY_PATH);DC("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new gC(r,null,n.fieldTransforms)},AC.prototype.parseMergeData=function(t,e,n){var r=new SC(bC.MergeSet,t,Lg.EMPTY_PATH);DC("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new fv(Lg.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof VI)l=h._internalPath;else{if("string"!=typeof h)throw Rm("Expected stringOrFieldPath to be a string or a FieldPath");l=OC(t,h)}if(!r.contains(l))throw new Um(Fm.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=cb.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=cb.fromArray(r.fieldMask),o=r.fieldTransforms;return new gC(a,i,o)},AC.prototype.parseUpdateData=function(o,t){var a=this,s=new SC(bC.Update,o,Lg.EMPTY_PATH);DC("Data must be an object, but it was:",s,t);var u=new fv(Lg.comparator),c=_w.EMPTY;Km(t,function(t,e){var n=OC(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof eC)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=cb.fromSet(u);return new _C(c,e,s.fieldTransforms)},AC.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new SC(bC.Update,t,Lg.EMPTY_PATH),o=[RC(t,e)],a=[n];if(r.length%2!=0)throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(RC(t,r[s])),a.push(r[s+1]);var u=new fv(Lg.comparator),c=_w.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof eC)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=cb.fromSet(u);return new _C(c,d,i.fieldTransforms)},AC.prototype.parseQueryValue=function(t,e,n){void 0===n&&(n=!1);var r=new SC(n?bC.ArrayArgument:bC.Argument,t,Lg.EMPTY_PATH),i=this.parseData(e,r);return Om(null!=i,"Parsed data should not be null."),Om(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},AC.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=PC(t);throw e.createError(n)}},AC.prototype.parseData=function(t,e){if(kC(t=this.runPreConverter(t,e)))return DC("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof $I)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement&&e.dataSource!==bC.ArrayArgument)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},AC.prototype.parseObject=function(t,r){var i=this,o=new iv(pg);return Qm(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Km(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new _w(o)},AC.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Bb.INSTANCE),n.push(s),r++}return new Sw(n)},AC.prototype.parseSentinelFieldValue=function(t,e){if(!EC(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof eC){if(e.dataSource!==bC.MergeSet)throw e.dataSource===bC.Update?(Om(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof iC)e.fieldTransforms.push(new lb(e.path,NS.instance));else if(t instanceof sC){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new kS(n);e.fieldTransforms.push(new lb(e.path,r))}else if(t instanceof hC){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new RS(n);e.fieldTransforms.push(new lb(e.path,i))}else if(t instanceof pC){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new PS(o);e.fieldTransforms.push(new lb(e.path,a))}else Rm("Unknown FieldValue type: "+t)},AC.prototype.parseScalarValue=function(t,e){if(null===t)return Bb.INSTANCE;if("number"==typeof t)return yT(t)?new Jb(t):new tw(t);if("boolean"==typeof t)return Kb.of(t);if("string"==typeof t)return new rw(t);if(t instanceof Date)return new aw(tv.fromDate(t));if(t instanceof tv)return new aw(new tv(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof IS)return new vw(t);if(t instanceof vg)return new fw(t);if(t instanceof CC)return new yw(t.databaseId,t.key);throw e.createError("Unsupported field value: "+ig(t))},AC.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new SC(bC.Argument,r,Lg.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},AC);function AC(t){this.preConverter=t}function kC(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof tv||t instanceof IS||t instanceof vg||t instanceof CC||t instanceof $I)}function DC(t,e,n){if(!kC(n)||!rg(n)){var r=ig(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function RC(t,e){if(e instanceof VI)return e._internalPath;if("string"==typeof e)return OC(t,e);throw new Um(Fm.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function OC(e,t){try{return function(e){if(0<=e.search(BI))throw new Um(Fm.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(VI.bind.apply(VI,pa([void 0],e.split("."))))}catch(t){throw new Um(Fm.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=PC(t);throw new Um(Fm.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function PC(t){return t instanceof Error?t.message:t.toString()}var MC=j_.COLLECTION_DISABLED,LC=(xC.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},xC);function xC(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Um(Fm.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else $m("settings","non-empty string","host",t.host),this.host=t.host,Zm("settings","boolean","ssl",t.ssl),this.ssl=jm(t.ssl,!0);if(ag("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Zm("settings","object","credentials",t.credentials),this.credentials=t.credentials,Zm("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?km("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&km("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=jm(t.timestampsInSnapshots,!0),Zm("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=j_.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==MC&&t.cacheSizeBytes<j_.MINIMUM_CACHE_SIZE_BYTES)throw new Um(Fm.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+j_.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}Zm("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var FC=(UC.prototype.settings=function(t){if(Gm("Firestore.settings",arguments,1),Xm("Firestore.settings","object",1,t),Bm(t,"persistence"))throw new Um(Fm.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new LC(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new Um(Fm.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new WI;switch(t.type){case"gapi":var e=t.client;return Om(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new YI(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Um(Fm.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},UC.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},UC.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},UC.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Um(Fm.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&km("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=jm(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new OI(this._settings.cacheSizeBytes,e))},UC.prototype.clearPersistence=function(){var t=this,n=nT.buildStoragePrefix(this.makeDatabaseInfo()),r=new Bg;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return ua(t,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new Um(Fm.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,nT.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},UC.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(UC.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),UC.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},UC.prototype.onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),JI(t))return this.onSnapshotsInSyncInternal(t);Xm("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},UC.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new FI({next:function(){t.next&&t.next()},error:function(t){throw Rm("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},UC.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new MI),this._firestoreClient},UC.prototype.makeDatabaseInfo=function(){return new _g(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},UC.prototype.configureClient=function(t){Om(!!this._settings.host,"FirestoreSettings.host is not set"),Om(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new LI(Pm.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},UC.prototype.createDataConverter=function(r){return new NC(function(t){if(t instanceof WC){var e=r,n=t.firestore._databaseId;if(!n.isEqual(e))throw new Um(Fm.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new CC(r,t._key)}return t})},UC.databaseIdFromApp=function(t){var e=t.options;if(!Bm(e,"projectId"))throw new Um(Fm.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Um(Fm.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Eg(n)},Object.defineProperty(UC.prototype,"app",{get:function(){if(!this._firebaseApp)throw new Um(Fm.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),UC.prototype.collection=function(t){return Gm("Firestore.collection",arguments,1),Xm("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new rN(Rg.fromString(t),this)},UC.prototype.doc=function(t){return Gm("Firestore.doc",arguments,1),Xm("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),WC.forPath(Rg.fromString(t),this)},UC.prototype.collectionGroup=function(t){if(Gm("Firestore.collectionGroup",arguments,1),Xm("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Um(Fm.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new $C(new wT(Rg.EMPTY_PATH,t),this)},UC.prototype.runTransaction=function(e){var n=this;return Gm("Firestore.runTransaction",arguments,1),Xm("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new VC(n,t))})},UC.prototype.batch=function(){return this.ensureClientConfigured(),new BC(this)},Object.defineProperty(UC,"logLevel",{get:function(){switch(Cm()){case mm.DEBUG:return"debug";case mm.ERROR:return"error";case mm.SILENT:return"silent";default:return Rm("Unknown log level: "+Cm())}},enumerable:!0,configurable:!0}),UC.setLogLevel=function(t){switch(Gm("Firestore.setLogLevel",arguments,1),Xm("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Nm(mm.DEBUG);break;case"error":Nm(mm.ERROR);break;case"silent":Nm(mm.SILENT);break;default:throw new Um(Fm.INVALID_ARGUMENT,"Invalid log level: "+t)}},UC.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},UC);function UC(t){var e=this;if(this._firebaseApp=null,this._queue=new Kg,this.INTERNAL={delete:function(){return ua(e,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var n=t;this._firebaseApp=n,this._databaseId=UC.databaseIdFromApp(n),this._persistenceKey=n.name,this._credentials=new QI(n)}else{var r=t;if(!r.projectId)throw new Um(Fm.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new Eg(r.projectId,r.database),this._persistenceKey="[DEFAULT]",this._credentials=new WI}this._settings=new LC({}),this._dataConverter=this.createDataConverter(this._databaseId)}var VC=(qC.prototype.get=function(t){var n=this;Gm("Transaction.get",arguments,1);var r=uN("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Rm("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Ow)return new GC(n._firestore,r._key,null,!1,!1);if(e instanceof kw)return new GC(n._firestore,r._key,e,!1,!1);throw Rm("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},qC.prototype.set=function(t,e,n){Ym("Transaction.set",arguments,2,3);var r=uN("Transaction.set",t,this._firestore),i=(n=oN("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},qC.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof VI?(zm("Transaction.update",arguments,3),r=uN("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Gm("Transaction.update",arguments,2),r=uN("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},qC.prototype.delete=function(t){Gm("Transaction.delete",arguments,1);var e=uN("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},qC);function qC(t,e){this._firestore=t,this._transaction=e}var BC=(jC.prototype.set=function(t,e,n){Ym("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=uN("WriteBatch.set",t,this._firestore),i=(n=oN("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,mb.NONE)),this},jC.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof VI?(zm("WriteBatch.update",arguments,3),r=uN("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Gm("WriteBatch.update",arguments,2),r=uN("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,mb.exists(!0))),this},jC.prototype.delete=function(t){Gm("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=uN("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Mb(e._key,mb.NONE)),this},jC.prototype.commit=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},jC.prototype.verifyNotCommitted=function(){if(this._committed)throw new Um(Fm.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},jC);function jC(t){this._firestore=t,this._mutations=[],this._committed=!1}var WC=(KC.forPath=function(t,e){if(t.length%2!=0)throw new Um(Fm.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new KC(new Fg(t),e)},Object.defineProperty(KC.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(KC.prototype,"parent",{get:function(){return new rN(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(KC.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),KC.prototype.collection=function(t){if(Gm("DocumentReference.collection",arguments,1),Xm("DocumentReference.collection","non-empty string",1,t),!t)throw new Um(Fm.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Rg.fromString(t);return new rN(this._key.path.child(e),this.firestore)},KC.prototype.isEqual=function(t){if(!(t instanceof KC))throw sg("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},KC.prototype.set=function(t,e){Ym("DocumentReference.set",arguments,1,2);var n=(e=oN("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,mb.NONE))},KC.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof VI?(zm("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Gm("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,mb.exists(!0)))},KC.prototype.delete=function(){return Gm("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Mb(this._key,mb.NONE)])},KC.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ym("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||JI(t[i])||(ag("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Zm("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=JI(t[i])?t[i]:(Xm("DocumentReference.onSnapshot","function",i,t[i]),Jm("DocumentReference.onSnapshot","function",i+1,t[i+1]),Jm("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},KC.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new FI({next:function(t){if(n.next){Om(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new GC(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(wT.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},KC.prototype.get=function(n){var r=this;return Ym("DocumentReference.get",arguments,0,1),sN("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new GC(r.firestore,r._key,t,!0,t instanceof kw&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},KC.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Um(Fm.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Um(Fm.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},KC);function KC(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}var QC=(HC.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},HC);function HC(t,e){this.hasPendingWrites=t,this.fromCache=e}var GC=(zC.prototype.data=function(t){return Ym("DocumentSnapshot.data",arguments,0,1),t=aN("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data(),xb.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},zC.prototype.get=function(t,e){if(Ym("DocumentSnapshot.get",arguments,1,2),e=aN("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(RC("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,xb.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(zC.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(zC.prototype,"ref",{get:function(){return new WC(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(zC.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(zC.prototype,"metadata",{get:function(){return new QC(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),zC.prototype.isEqual=function(t){if(!(t instanceof zC))throw sg("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},zC.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},zC.prototype.convertValue=function(t,e){if(t instanceof _w)return this.convertObject(t,e);if(t instanceof Sw)return this.convertArray(t,e);if(t instanceof yw){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||km("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new WC(n,this._firestore)}return t.value(e)},zC.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},zC);function zC(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}var YC,XC=(aa(JC,YC=GC),JC.prototype.data=function(t){var e=YC.prototype.data.call(this,t);return Om("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},JC);function JC(){return null!==YC&&YC.apply(this,arguments)||this}var $C=(ZC.prototype.where=function(t,e,n){var r;Gm("Query.where",arguments,3),og("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Um(Fm.INVALID_ARGUMENT,"Invalid value "+ig(r)+" provided to function "+t+"() for its "+cg(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=RC("Query.where",t),o=ET.fromString(e);if(i.isKeyField()){if(o===ET.ARRAY_CONTAINS||o===ET.ARRAY_CONTAINS_ANY)throw new Um(Fm.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===ET.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Sw(a)}else r=this.parseDocumentIdValue(n)}else o!==ET.IN&&o!==ET.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n,o===ET.IN);var h=CT.create(i,o,r);return this.validateNewFilter(h),new ZC(this._query.addFilter(h),this.firestore)},ZC.prototype.orderBy=function(t,e){var n;if(Ym("Query.orderBy",arguments,1,2),Jm("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=WT.ASCENDING;else{if("desc"!==e)throw new Um(Fm.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=WT.DESCENDING}if(null!==this._query.startAt)throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=RC("Query.orderBy",t),i=new GT(r,n);return this.validateNewOrderBy(i),new ZC(this._query.addOrderBy(i),this.firestore)},ZC.prototype.limit=function(t){return Gm("Query.limit",arguments,1),Xm("Query.limit","number",1,t),ug("Query.limit",1,t),new ZC(this._query.withLimitToFirst(t),this.firestore)},ZC.prototype.limitToLast=function(t){return Gm("Query.limitToLast",arguments,1),Xm("Query.limitToLast","number",1,t),ug("Query.limitToLast",1,t),new ZC(this._query.withLimitToLast(t),this.firestore)},ZC.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];zm("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new ZC(this._query.withStartAt(r),this.firestore)},ZC.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];zm("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new ZC(this._query.withStartAt(r),this.firestore)},ZC.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];zm("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new ZC(this._query.withEndAt(r),this.firestore)},ZC.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];zm("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new ZC(this._query.withEndAt(r),this.firestore)},ZC.prototype.isEqual=function(t){if(!(t instanceof ZC))throw sg("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},ZC.prototype.boundFromDocOrFields=function(t,e,n,r){if(og(t,1,e),e instanceof GC){if(0<n.length)throw new Um(Fm.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Um(Fm.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},ZC.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new yw(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof cw)throw new Um(Fm.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new QT(r,n)},ZC.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Um(Fm.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Rg.fromString(a));if(!Fg.isDocumentKey(s))throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Fg(s);i.push(new yw(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new QT(i,n)},ZC.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ym("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||JI(t[i])||(ag("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Zm("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=JI(t[i])?t[i]:(Xm("Query.onSnapshot","function",i,t[i]),Jm("Query.onSnapshot","function",i+1,t[i+1]),Jm("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},ZC.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new FI({next:function(t){e.next&&e.next(new tN(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},ZC.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new Um(Fm.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},ZC.prototype.get=function(n){var r=this;return Ym("Query.get",arguments,0,1),sN("Query.get",n),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new tN(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},ZC.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Um(Fm.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},ZC.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Rg.fromString(t));if(!Fg.isDocumentKey(e))throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new yw(this.firestore._databaseId,new Fg(e))}if(t instanceof WC){var n=t;return new yw(this.firestore._databaseId,n._key)}throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ig(t)+".")},ZC.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Um(Fm.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Um(Fm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Um(Fm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Um(Fm.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},ZC.prototype.validateNewFilter=function(t){if(t instanceof CT){var e=[ET.ARRAY_CONTAINS,ET.ARRAY_CONTAINS_ANY],n=[ET.IN,ET.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Um(Fm.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Um(Fm.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},ZC.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},ZC.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Um(Fm.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},ZC);function ZC(t,e){this._query=t,this.firestore=e}var tN=(Object.defineProperty(eN.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(eN.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(eN.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),eN.prototype.forEach=function(e,n){var r=this;Ym("QuerySnapshot.forEach",arguments,1,2),Xm("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(eN.prototype,"query",{get:function(){return new $C(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),eN.prototype.docChanges=function(t){t&&(ag("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Zm("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Um(Fm.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new XC(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return Om(t.type===JE.Added,"Invalid event type for first snapshot"),Om(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==JE.Metadata}).map(function(t){var e=new XC(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==JE.Added&&(Om(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==JE.Removed&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case JE.Added:return"added";case JE.Modified:case JE.Metadata:return"modified";case JE.Removed:return"removed";default:return Rm("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},eN.prototype.isEqual=function(t){if(!(t instanceof eN))throw sg("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},eN.prototype.convertToDocumentImpl=function(t){return new XC(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},eN);function eN(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new QC(n.hasPendingWrites,n.fromCache)}pa(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(tN.prototype.docChanges,t,{get:function(){return function(){throw new Um(Fm.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var nN,rN=(aa(iN,nN=$C),Object.defineProperty(iN.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(iN.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new WC(new Fg(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(iN.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),iN.prototype.doc=function(t){if(Ym("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=lg.newId()),Xm("CollectionReference.doc","non-empty string",1,t),""===t)throw new Um(Fm.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Rg.fromString(t);return WC.forPath(this._query.path.child(e),this.firestore)},iN.prototype.add=function(t){Gm("CollectionReference.add",arguments,1),Xm("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},iN);function iN(t,e){var n=nN.call(this,wT.atPath(t),e)||this;if(t.length%2!=1)throw new Um(Fm.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}function oN(t,e){if(void 0===e)return{merge:!1};if(ag(t,e,["merge","mergeFields"]),Zm(t,"boolean","merge",e.merge),tg(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof VI}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Um(Fm.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function aN(t,e){return void 0===e?{}:(ag(t,e,["serverTimestamps"]),eg(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function sN(t,e){Jm(t,"object",1,e),e&&(ag(t,e,["source"]),eg(t,0,"source",e.source,["default","server","cache"]))}function uN(t,e,n){if(e instanceof WC){if(e.firestore!==n)throw new Um(Fm.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw sg(t,"DocumentReference",1,e)}var cN=qm(FC,"Use firebase.firestore() instead."),hN=qm(VC,"Use firebase.firestore().runTransaction() instead."),lN=qm(BC,"Use firebase.firestore().batch() instead."),fN=qm(WC,"Use firebase.firestore().doc() instead."),pN=qm(GC),dN=qm(XC),yN=qm($C),mN=qm(tN),gN=qm(rN,"Use firebase.firestore().collection() instead."),vN={Firestore:cN,GeoPoint:IS,Timestamp:tv,Blob:wg,Transaction:hN,WriteBatch:lN,DocumentReference:fN,DocumentSnapshot:pN,Query:yN,QueryDocumentSnapshot:dN,QuerySnapshot:mN,CollectionReference:gN,FieldPath:VI,FieldValue:yC,setLogLevel:FC.setLogLevel,CACHE_SIZE_UNLIMITED:MC};function bN(t){t.INTERNAL.registerService("firestore",function(t){return new FC(t)},function(t){Om(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(vN))}var wN=(_N.prototype.addCallback=function(t){},_N.prototype.shutdown=function(){},_N);function _N(){}var TN="ConnectivityMonitor",EN=(SN.prototype.addCallback=function(t){this.callbacks.push(t)},SN.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},SN.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},SN.prototype.onNetworkAvailable=function(){Am(TN,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},SN.prototype.onNetworkUnavailable=function(){Am(TN,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},SN.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},SN);function SN(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var IN=(CN.prototype.onOpen=function(t){Om(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},CN.prototype.onClose=function(t){Om(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},CN.prototype.onMessage=function(t){Om(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},CN.prototype.close=function(){this.closeFn()},CN.prototype.send=function(t){this.sendFn(t)},CN.prototype.callOnOpen=function(){Om(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},CN.prototype.callOnClose=function(t){Om(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},CN.prototype.callOnMessage=function(t){Om(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},CN);function CN(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var NN="Connection",AN={BatchGetDocuments:"batchGet",Commit:"commit"},kN="gl-js/ fire/"+Sm,DN=(RN.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=kN},RN.prototype.invokeRPC=function(s,r,u){var c=this,h=this.makeUrl(s);return new Promise(function(i,o){var a=new Em;a.listenOnce(_m.COMPLETE,function(){try{switch(a.getLastErrorCode()){case wm.NO_ERROR:var t=a.getResponseJson();Am(NN,"XHR received:",JSON.stringify(t)),i(t);break;case wm.TIMEOUT:Am(NN,'RPC "'+s+'" timed out'),o(new Um(Fm.DEADLINE_EXCEEDED,"Request time out"));break;case wm.HTTP_ERROR:var e=a.getStatus();if(Am(NN,'RPC "'+s+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(Fm).indexOf(e)?e:Fm.UNKNOWN}(n.status);o(new Um(r,n.message))}else o(new Um(Fm.UNKNOWN,"Server responded with status "+a.getStatus()))}else Am(NN,'RPC "'+s+'" failed'),o(new Um(Fm.UNAVAILABLE,"Connection failed."));break;default:Rm('RPC "'+s+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Am(NN,'RPC "'+s+'" completed.')}});var t=sa({},r);delete t.database;var e=JSON.stringify(t);Am(NN,"XHR sending: ",h+" "+e);var n={"Content-Type":"text/plain"};c.modifyHeadersForRequest(n,u),a.send(h,"POST",e,n,15)})},RN.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},RN.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=bm(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Ca()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){s.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Am(NN,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),u=!1,c=!1,h=new IN({sendFn:function(t){c?Am(NN,"Not sending because WebChannel is closed:",t):(u||(Am(NN,"Opening WebChannel transport."),s.open(),u=!0),Am(NN,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}});return a(Tm.EventType.OPEN,function(){c||Am(NN,"WebChannel transport opened.")}),a(Tm.EventType.CLOSE,function(){c||(c=!0,Am(NN,"WebChannel transport closed"),h.callOnClose())}),a(Tm.EventType.ERROR,function(t){c||(c=!0,Am(NN,"WebChannel transport errored:",t),h.callOnClose(new Um(Fm.UNAVAILABLE,"The operation could not be completed")))}),a(Tm.EventType.MESSAGE,function(t){if(!c){var e=t.data[0];Om(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Am(NN,"WebChannel received error:",r);var i=r.status,o=function(t){var e=QE[t];if(void 0!==e)return XE(e)}(i),a=r.message;void 0===o&&(o=Fm.INTERNAL,a="Unknown error status: "+i+" with message "+r.message),c=!0,h.callOnClose(new Um(o,a)),s.close()}else Am(NN,"WebChannel received:",e),h.callOnMessage(e)}}),setTimeout(function(){h.callOnOpen()},0),h},RN.prototype.makeUrl=function(t){var e=AN[t];return Om(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},RN);function RN(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var ON=(Object.defineProperty(PN.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(PN.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),PN.prototype.loadConnection=function(t){return Promise.resolve(new DN(t))},PN.prototype.newConnectivityMonitor=function(){return EN.isAvailable()?new EN:new wN},PN.prototype.newSerializer=function(t){return new QS(t,{useProto3Json:!0})},PN.prototype.formatJSON=function(t){return JSON.stringify(t)},PN.prototype.atob=function(t){return atob(t)},PN.prototype.btoa=function(t){return btoa(t)},PN);function PN(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Pm.setPlatform(new ON),bN(fl);var MN,LN={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},xN=(aa(FN,MN=Error),FN);function FN(t,e,n){var r=MN.call(this,e)||this;return Object.setPrototypeOf(r,FN.prototype),r.code=t,r.details=n,r}function UN(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!LN[s])return new xN("internal","internal");r=LN[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new xN(r,i,o)}var VN=(qN.prototype.getAuthToken=function(){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},qN.prototype.getInstanceIdToken=function(){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},qN.prototype.getContext=function(){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},qN);function qN(t){this.app=t}function BN(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var jN=(WN.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return BN(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},WN.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?BN(t,function(t){return e.decode(t)}):t},WN);function WN(){}var KN=(Object.defineProperty(QN.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),QN.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},QN.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},QN.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},QN.prototype.postJSON=function(r,i,o){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},QN.prototype.call=function(c,h,l){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return ca(this,function(t){switch(t.label){case 0:return e=this._url(c),h=this.serializer.encode(h),n={data:h},r=new Headers,[4,this.contextProvider.getContext()];case 1:return(i=t.sent()).authToken&&r.append("Authorization","Bearer "+i.authToken),i.instanceIdToken&&r.append("Firebase-Instance-ID-Token",i.instanceIdToken),o=l.timeout||7e4,[4,Promise.race([this.postJSON(e,n,r),function(n){return new Promise(function(t,e){setTimeout(function(){e(new xN("deadline-exceeded","deadline-exceeded"))},n)})}(o),this.cancelAllRequests])];case 2:if(!(a=t.sent()))throw new xN("cancelled","Firebase Functions instance was deleted.");if(s=UN(a.status,a.json,this.serializer))throw s;if(!a.json)throw new xN("internal","Response is not valid JSON object.");if(void 0===(u=a.json.data)&&(u=a.json.result),void 0===u)throw new xN("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},QN);function QN(t,e){var n=this;void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new jN,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return n.deleteService()}},this.contextProvider=new VN(t),this.cancelAllRequests=new Promise(function(t){n.deleteService=function(){return t()}})}var HN;function GN(t,e,n){return new KN(t,n)}function zN(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function YN(n,r,i){var o,t=new Promise(function(t,e){zN(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function XN(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function JN(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return YN(this[n],t,arguments)})})}function $N(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function ZN(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return function(t,e,n){var r=YN(t,e,n);return r.then(function(t){if(t)return new eA(t,r.request)})}(this[n],t,arguments)})})}function tA(t){this._index=t}function eA(t,e){this._cursor=t,this._request=e}function nA(t){this._store=t}function rA(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function iA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new rA(n)}function oA(t){this._db=t}HN={Functions:KN},fl.INTERNAL.registerService("functions",GN,HN,void 0,!0),XN(tA,"_index",["name","keyPath","multiEntry","unique"]),JN(tA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),ZN(tA,"_index",IDBIndex,["openCursor","openKeyCursor"]),XN(eA,"_cursor",["direction","key","primaryKey","value"]),JN(eA,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(eA.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),zN(e._request).then(function(t){if(t)return new eA(t,e._request)})})})}),nA.prototype.createIndex=function(){return new tA(this._store.createIndex.apply(this._store,arguments))},nA.prototype.index=function(){return new tA(this._store.index.apply(this._store,arguments))},XN(nA,"_store",["name","keyPath","indexNames","autoIncrement"]),JN(nA,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),ZN(nA,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),$N(nA,"_store",IDBObjectStore,["deleteIndex"]),rA.prototype.objectStore=function(){return new nA(this._tx.objectStore.apply(this._tx,arguments))},XN(rA,"_tx",["objectStoreNames","mode"]),$N(rA,"_tx",IDBTransaction,["abort"]),iA.prototype.createObjectStore=function(){return new nA(this._db.createObjectStore.apply(this._db,arguments))},XN(iA,"_db",["name","version","objectStoreNames"]),$N(iA,"_db",IDBDatabase,["deleteObjectStore","close"]),oA.prototype.transaction=function(){return new rA(this._db.transaction.apply(this._db,arguments))},XN(oA,"_db",["name","version","objectStoreNames"]),$N(oA,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[nA,tA].forEach(function(t){i in t.prototype&&(t.prototype[i.replace("open","iterate")]=function(){var t=function(t){return Array.prototype.slice.call(t)}(arguments),e=t[t.length-1],n=this._store||this._index,r=n[i].apply(n,t.slice(0,-1));r.onsuccess=function(){e(r.result)}})})}),[tA,nA].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var aA,sA=1e4,uA="w:0.3.6",cA="FIS_v2",hA="https://firebaseinstallations.googleapis.com/v1",lA=36e5,fA=((aA={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',aA["not-registered"]="Firebase Installation is not registered.",aA["installation-not-found"]="Firebase Installation not found.",aA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',aA["app-offline"]="Could not process request. Application offline.",aA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",aA),pA=new Ra("installations","Installations",fA);function dA(t){return t instanceof ka&&t.code.includes("request-failed")}function yA(t){var e,n;if(!t||!t.options)throw mA("App Configuration");if(!t.name)throw mA("App Name");try{for(var r=ha(["projectId","apiKey","appId"]),i=r.next();!i.done;i=r.next()){var o=i.value;if(!t.options[o])throw mA(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function mA(t){return pA.create("missing-app-config-values",{valueName:t})}function gA(t){var e=t.projectId;return hA+"/projects/"+e+"/installations"}function vA(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function bA(r,i){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,pA.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function wA(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function _A(t,e){var n=e.refreshToken,r=wA(t);return r.append("Authorization",function(t){return cA+" "+t}(n)),r}function TA(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function EA(e){return new Promise(function(t){setTimeout(t,e)})}var SA=/^[cdef][\w-]{21}$/,IA="";function CA(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,fa(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return SA.test(e)?e:IA}catch(t){return IA}}var NA,AA="firebase-installations-database",kA=1,DA="firebase-installations-store",RA=null;function OA(){return RA=RA||function(t,e,n){var r=YN(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new iA(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new oA(t)})}(AA,kA,function(t){switch(t.oldVersion){case 0:t.createObjectStore(DA)}})}function PA(i,o){return ua(this,void 0,void 0,function(){var e,n,r;return ca(this,function(t){switch(t.label){case 0:return e=xA(i),[4,OA()];case 1:return n=t.sent(),[4,(r=n.transaction(DA,"readwrite")).objectStore(DA).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function MA(i){return ua(this,void 0,void 0,function(){var e,n,r;return ca(this,function(t){switch(t.label){case 0:return e=xA(i),[4,OA()];case 1:return n=t.sent(),[4,(r=n.transaction(DA,"readwrite")).objectStore(DA).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function LA(s,u){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){switch(t.label){case 0:return e=xA(s),[4,OA()];case 1:return n=t.sent(),r=n.transaction(DA,"readwrite"),[4,(i=r.objectStore(DA)).get(e)];case 2:return o=t.sent(),void 0!==(a=u(o))?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function xA(t){return t.appName+"!"+t.appId}function FA(i){return ua(this,void 0,void 0,function(){var r,e,n;return ca(this,function(t){switch(t.label){case 0:return[4,LA(i,function(t){var e=function(t){return VA(t||{fid:CA(),registrationStatus:0})}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(o){return ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:return[4,UA(o)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,EA(100)];case 3:return t.sent(),[4,UA(o)];case 4:return e=t.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,FA(o)];case 6:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,r];case 7:return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(pA.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return ua(this,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){switch(t.label){case 0:return e=gA(s),n=wA(s),r={fid:u,authVersion:cA,appId:s.appId,sdkVersion:uA},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,TA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,{fid:a.fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:vA(a.authToken)}];case 3:return[4,bA("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,PA(r,e)];case 2:return dA(n=t.sent())&&409===n.serverCode?[4,MA(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,PA(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==IA?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function UA(t){return LA(t,function(t){if(!t)throw pA.create("installation-not-found");return VA(t)})}function VA(t){return function(t){return 1===t.registrationStatus&&t.registrationTime+sA<Date.now()}(t)?{fid:t.fid,registrationStatus:0}:t}function qA(s,u){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return gA(t)+"/"+n+"/authTokens:generate"}(s,u),n=_A(s,u),r={installation:{sdkVersion:uA}},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,TA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,vA(a)];case 3:return[4,bA("Generate Auth Token",o)];case 4:throw t.sent()}})})}function BA(i,o){return void 0===o&&(o=!1),ua(this,void 0,void 0,function(){var r,e,n;return ca(this,function(t){switch(t.label){case 0:return[4,LA(i,function(t){if(!WA(t))throw pA.create("not-registered");var e=t.authToken;if(!o&&function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+lA}(t)}(e))return t;if(1===e.requestStatus)return r=function(r,i){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,jA(r)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,EA(100)];case 3:return t.sent(),[4,jA(r)];case 4:return e=t.sent(),[3,2];case 5:return 0===(n=e.authToken).requestStatus?[2,BA(r,i)]:[2,n]}})})}(i,o),t;if(!navigator.onLine)throw pA.create("app-offline");var n=function(t){var e={requestStatus:1,requestTime:Date.now()};return sa(sa({},t),{authToken:e})}(t);return r=function(i,o){return ua(this,void 0,void 0,function(){var e,n,r;return ca(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,qA(i,o)];case 1:return e=t.sent(),r=sa(sa({},o),{authToken:e}),[4,PA(i,r)];case 2:return t.sent(),[2,e];case 3:return!dA(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,MA(i)];case 4:return t.sent(),[3,7];case 5:return r=sa(sa({},o),{authToken:{requestStatus:0}}),[4,PA(i,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(i,n),n})];case 1:return e=t.sent(),r?[4,r]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n]}})})}function jA(t){return LA(t,function(t){if(!WA(t))throw pA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+sA<Date.now()}(t.authToken)?sa(sa({},t),{authToken:{requestStatus:0}}):t})}function WA(t){return void 0!==t&&2===t.registrationStatus}function KA(n,r){return void 0===r&&(r=!1),ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return[4,function(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return[4,FA(n)];case 1:return(e=t.sent().registrationPromise)?[4,e]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e=yA(n))];case 1:return t.sent(),[4,BA(e,r)];case 2:return[2,t.sent().token]}})})}function QA(o,a){return ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return gA(t)+"/"+n}(o,a),n=_A(o,a),r={method:"DELETE",headers:n},[4,TA(function(){return fetch(e,r)})];case 1:return(i=t.sent()).ok?[3,3]:[4,bA("Delete Installation",i)];case 2:throw t.sent();case 3:return[2]}})})}fl.INTERNAL.registerService("installations",function(e){return yA(e),{app:e,getId:function(){return function(o){return ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:return[4,FA(e=yA(o))];case 1:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)?i.catch(console.error):BA(e).catch(console.error),[2,r.fid]}})})}(e)},getToken:function(t){return KA(e,t)},delete:function(){return function(r){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,LA(e=yA(r),function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw pA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw pA.create("app-offline");case 3:return[4,QA(e,n)];case 4:return t.sent(),[4,MA(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(e)}}});var HA,GA,zA=((NA={})["only-available-in-window"]="This method is available in a Window context.",NA["only-available-in-sw"]="This method is available in a service worker context.",NA["should-be-overriden"]="This method should be overriden by extended classes.",NA["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",NA["permission-default"]="The required permissions were not granted and dismissed instead.",NA["permission-blocked"]="The required permissions were not granted and blocked instead.",NA["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",NA["notifications-blocked"]="Notifications have been blocked.",NA["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",NA["sw-registration-expected"]="A service worker registration was the expected input.",NA["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",NA["invalid-saved-token"]="Unable to access details of the saved token.",NA["sw-reg-redundant"]="The service worker being used for push was made redundant.",NA["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",NA["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",NA["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",NA["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",NA["token-update-no-token"]="FCM returned no token when updating the user to push.",NA["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",NA["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",NA["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",NA["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",NA["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",NA["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",NA["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",NA["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",NA["failed-to-delete-token"]="Unable to delete the currently saved token.",NA["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",NA["bad-scope"]="The service worker scope must be a string with at least one character.",NA["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",NA["bad-subscription"]="The subscription must be a valid PushSubscription.",NA["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",NA["failed-delete-vapid-key"]="The VAPID key could not be deleted.",NA["invalid-public-vapid-key"]="The public VAPID key must be a string.",NA["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",NA["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",NA),YA=new Ra("messaging","Messaging",zA),XA=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),JA="google.c.a.c_id";function $A(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function ZA(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,fa(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(GA=HA=HA||{}).PUSH_MSG_RECEIVED="push-msg-received",GA.NOTIFICATION_CLICKED="notification-clicked";var tk=(ek.prototype.getToken=function(s,u,c){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){switch(t.label){case 0:return[4,rk(s)];case 1:e=t.sent(),n=ik(u,c),r={method:"POST",headers:e,body:JSON.stringify(n)},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(nk(s),r)];case 3:return[4,t.sent().json()];case 4:return i=t.sent(),[3,6];case 5:throw o=t.sent(),YA.create("token-subscribe-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,YA.create("token-subscribe-failed",{errorInfo:a});if(!i.token)throw YA.create("token-subscribe-no-token");return[2,i.token]}})})},ek.prototype.updateToken=function(s,u,c,h){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){switch(t.label){case 0:return[4,rk(u)];case 1:e=t.sent(),n=ik(c,h),r={method:"PATCH",headers:e,body:JSON.stringify(n)},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(nk(u)+"/"+s.fcmToken,r)];case 3:return[4,t.sent().json()];case 4:return i=t.sent(),[3,6];case 5:throw o=t.sent(),YA.create("token-update-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,YA.create("token-update-failed",{errorInfo:a});if(!i.token)throw YA.create("token-update-no-token");return[2,i.token]}})})},ek.prototype.deleteToken=function(a,s){return ua(this,void 0,void 0,function(){var e,n,r,i,o;return ca(this,function(t){switch(t.label){case 0:return[4,rk(a)];case 1:e=t.sent(),n={method:"DELETE",headers:e},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(nk(a)+"/"+s.fcmToken,n)];case 3:return[4,t.sent().json()];case 4:if((r=t.sent()).error)throw i=r.error.message,YA.create("token-unsubscribe-failed",{errorInfo:i});return[3,6];case 5:throw o=t.sent(),YA.create("token-unsubscribe-failed",{errorInfo:o});case 6:return[2]}})})},ek);function ek(){}function nk(t){return"https://fcmregistrations.googleapis.com/v1/projects/"+t.options.projectId+"/registrations"}function rk(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return[4,n.installations().getToken()];case 1:return e=t.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.options.apiKey,"x-goog-firebase-installations-auth":"FIS "+e})]}})})}function ik(t,e){var n=ZA(t.getKey("p256dh")),r=ZA(t.getKey("auth")),i={web:{endpoint:t.endpoint,p256dh:n,auth:r}};return $A(e.buffer,XA.buffer)||(i.web.applicationPubKey=ZA(e)),i}function ok(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var ak="undefined",sk="fcm_token_object_Store";function uk(e){var n=indexedDB.open(ak);n.onerror=function(t){},n.onsuccess=function(t){!function(n,r){if(n.objectStoreNames.contains(sk)){var t=n.transaction(sk).objectStore(sk),i=new tk,o=t.openCursor();o.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},o.onsuccess=function(){var t=o.result;if(t){var e=t.value;i.deleteToken(r,e),t.continue()}else n.close(),indexedDB.deleteDatabase(ak)}}}(n.result,e)}}var ck=(hk.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},hk.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},hk.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},hk.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},hk.prototype.closeDatabase=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},hk.prototype.createTransaction=function(o,a){return void 0===a&&(a="readonly"),ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),n=e.transaction(this.objectStoreName,a),r=n.objectStore(this.objectStoreName),[4,function(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}(o(r))];case 2:return i=t.sent(),[2,new Promise(function(t,e){n.oncomplete=function(){t(i)},n.onerror=function(){e(n.error)}})]}})})},hk.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},hk);function hk(){this.dbPromise=null}var lk,fk=(aa(pk,lk=ck),pk.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(i=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),i.createIndex("fcmToken","fcmToken",{unique:!0});case 1:uk(this.app);case 2:var r=(i=t.transaction.objectStore(this.objectStoreName)).openCursor();r.onsuccess=function(){var t=r.result;if(t){var e=t.value,n=sa({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=ok(e.vapidKey)),"string"==typeof e.auth&&(n.auth=ok(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=ok(e.p256dh).buffer),"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}};break;case 3:var i,o=(i=t.transaction.objectStore(this.objectStoreName)).openCursor();o.onsuccess=function(){var t=o.result;if(t){var e=t.value,n=sa({},e);"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}}}},pk.prototype.getTokenDetailsFromToken=function(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){if(!e)throw YA.create("bad-token");return dk({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},pk.prototype.getTokenDetailsFromSWScope=function(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){if(!e)throw YA.create("bad-scope");return dk({swScope:e}),[2,this.get(e)]})})},pk.prototype.saveTokenDetails=function(e){return ua(this,void 0,void 0,function(){return ca(this,function(t){if(!e.swScope)throw YA.create("bad-scope");if(!e.vapidKey)throw YA.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw YA.create("bad-subscription");if(!e.fcmSenderId)throw YA.create("bad-sender-id");if(!e.fcmToken)throw YA.create("bad-token");return dk(e),[2,this.put(e)]})})},pk.prototype.deleteToken=function(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(YA.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw YA.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},pk);function pk(t){var e=lk.call(this)||this;return e.app=t,e.dbName="fcm_token_details_db",e.dbVersion=4,e.objectStoreName="fcm_token_object_Store",e}function dk(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw YA.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw YA.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw YA.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw YA.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw YA.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw YA.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw YA.create("bad-sender-id")}var yk,mk=(aa(gk,yk=ck),gk.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},gk.prototype.getVapidFromSWScope=function(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw YA.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},gk.prototype.saveVapidDetails=function(n,r){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){if("string"!=typeof n||0===n.length)throw YA.create("bad-scope");if(null===r||65!==r.length)throw YA.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},gk.prototype.deleteVapidDetails=function(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw YA.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},gk);function gk(){var t=null!==yk&&yk.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var vk=(bk.prototype.getToken=function(){return ua(this,void 0,void 0,function(){var e,n,r,i,o;return ca(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw YA.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},bk.prototype.manageExistingToken=function(e,n,r,i){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!$A(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=$A(t.getKey("auth"),n.auth),o=$A(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[3,1];case 1:return[4,this.deleteTokenFromDB(i.fcmToken)];case 2:return t.sent(),[2,this.getNewToken(e,n,r)];case 3:return[2]}})})},bk.prototype.updateToken=function(i,o,a,s){return ua(this,void 0,void 0,function(){var e,n,r;return ca(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.subscriptionManager.updateToken(s,this.app,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.app.options.messagingSenderId,fcmToken:e,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},bk.prototype.getNewToken=function(r,i,o){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,this.subscriptionManager.getToken(this.app,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.app.options.messagingSenderId,fcmToken:e,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e]}})})},bk.prototype.deleteToken=function(r){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},bk.prototype.deleteTokenFromDB=function(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.subscriptionManager.deleteToken(this.app,e)];case 2:return t.sent(),[2]}})})},bk.prototype.getPushSubscription=function(n,r){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return[4,n.pushManager.getSubscription()];case 1:return(e=t.sent())?[2,e]:[2,n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r})]}})})},bk.prototype.requestPermission=function(){throw YA.create("only-available-in-window")},bk.prototype.useServiceWorker=function(t){throw YA.create("only-available-in-window")},bk.prototype.usePublicVapidKey=function(t){throw YA.create("only-available-in-window")},bk.prototype.onMessage=function(t,e,n){throw YA.create("only-available-in-window")},bk.prototype.onTokenRefresh=function(t,e,n){throw YA.create("only-available-in-window")},bk.prototype.setBackgroundMessageHandler=function(t){throw YA.create("only-available-in-sw")},bk.prototype.delete=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},bk.prototype.getNotificationPermission_=function(){return Notification.permission},bk.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},bk.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},bk.prototype.getSubscriptionManager=function(){return this.subscriptionManager},bk);function bk(t){var e=this;if(this.app=t,this.vapidDetailsModel=new mk,this.subscriptionManager=new tk,!t.options.messagingSenderId||"string"!=typeof t.options.messagingSenderId)throw YA.create("bad-sender-id");this.INTERNAL={delete:function(){return e.delete()}},this.tokenDetailsModel=new fk(t)}var wk,_k="FCM_MSG",Tk=(aa(Ek,wk=vk),Ek.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},Ek.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},Ek.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},Ek.prototype.onPush_=function(s){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},Ek.prototype.onSubChange_=function(t){return ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),YA.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},Ek.prototype.onNotificationClick_=function(o){return ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:if(!(o.notification&&o.notification.data&&o.notification.data[_k]))return[2];if(o.action)return[2];if(o.stopImmediatePropagation(),o.notification.close(),!(e=o.notification.data[_k]).notification)return[2];if(!(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)){if(!(e.data&&JA in e.data))return[2];n=self.location.origin}return[4,this.getWindowClient_(n)];case 1:return(r=t.sent())?[3,4]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[4,function(e){return new Promise(function(t){setTimeout(t,e)})}(3e3)];case 3:return t.sent(),[3,6];case 4:return[4,r.focus()];case 5:r=t.sent(),t.label=6;case 6:return r?(delete e.notification,delete e.fcmOptions,i=Ik(HA.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},Ek.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=sa({},t.notification);return n.data=sa(sa({},t.notification.data),((e={})[_k]=t,e)),n}},Ek.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw YA.create("bg-handler-function-expected");this.bgMessageHandler=t},Ek.prototype.getWindowClient_=function(o){return ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,Sk()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},Ek.prototype.attemptToMessageClient_=function(e,n){return ua(this,void 0,void 0,function(){return ca(this,function(t){if(!e)throw YA.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},Ek.prototype.hasVisibleClients_=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return[4,Sk()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},Ek.prototype.sendMessageToWindowClients_=function(i){return ua(this,void 0,void 0,function(){var e,n,r=this;return ca(this,function(t){switch(t.label){case 0:return[4,Sk()];case 1:return e=t.sent(),n=Ik(HA.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},Ek.prototype.getSWRegistration_=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){return[2,self.registration]})})},Ek.prototype.getPublicVapidKey_=function(){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw YA.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,XA]:[2,n]}})})},Ek);function Ek(t){var e=wk.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function Sk(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function Ik(t,e){return{firebaseMessagingType:t,firebaseMessagingData:e}}var Ck,Nk,Ak=(aa(kk,Ck=vk),kk.prototype.requestPermission=function(){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?YA.create("permission-blocked"):YA.create("permission-default")}})})},kk.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw YA.create("sw-registration-expected");if(null!=this.registrationToUse)throw YA.create("use-sw-before-get-token");this.registrationToUse=t},kk.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw YA.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw YA.create("use-public-key-before-get-token");var e=ok(t);if(65!==e.length)throw YA.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},kk.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},kk.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},kk.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(YA.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(YA.create("sw-reg-redundant"));else t(r);else e(YA.create("no-sw-in-reg"))})},kk.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw YA.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},kk.prototype.getPublicVapidKey_=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,XA]})})},kk.prototype.setupSWMessageListener_=function(){var a=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data.firebaseMessagingType&&t.data.firebaseMessagingData){var e=t.data,n=e.firebaseMessagingType,r=e.firebaseMessagingData;a.messageObserver&&a.messageObserver.next(r);var i=r.data;if(i&&JA in i&&"1"===i["google.c.a.e"]){var o=function(t){switch(t){case HA.NOTIFICATION_CLICKED:return"notification_open";case HA.PUSH_MSG_RECEIVED:return"notification_foreground";default:throw new Error}}(n);a.app.INTERNAL.analytics.logEvent(o,{message_name:i["google.c.a.c_l"],message_id:i[JA],message_time:i["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}}},!1)},kk);function kk(t){var e=Ck.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Wa(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Wa(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}function Dk(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}Nk={isSupported:Dk},fl.INTERNAL.registerService("messaging",function(t){if(!Dk())throw YA.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new Tk(t):new Ak(t)},Nk);var Rk="firebasestorage.googleapis.com",Ok="storageBucket",Pk=(Mk.prototype.codeProp=function(){return this.code},Mk.prototype.codeEquals=function(t){return xk(t)===this.codeProp()},Mk.prototype.serverResponseProp=function(){return this.serverResponse_},Mk.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(Mk.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(Mk.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(Mk.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(Mk.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),Mk);function Mk(t,e){this.code_=xk(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var Lk={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function xk(t){return"storage/"+t}function Fk(){return new Pk(Lk.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Uk(){return new Pk(Lk.CANCELED,"User canceled the upload/download.")}function Vk(){return new Pk(Lk.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function qk(t,e,n){return new Pk(Lk.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function Bk(){return new Pk(Lk.APP_DELETED,"The Firebase app was deleted.")}function jk(t,e){return new Pk(Lk.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Wk(t){throw new Pk(Lk.INTERNAL_ERROR,"Internal error: "+t)}var Kk={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function Qk(t){switch(t){case Kk.RAW:case Kk.BASE64:case Kk.BASE64URL:case Kk.DATA_URL:return;default:throw"Expected one of the event types: ["+Kk.RAW+", "+Kk.BASE64+", "+Kk.BASE64URL+", "+Kk.DATA_URL+"]."}}var Hk=function(t,e){this.data=t,this.contentType=e||null};function Gk(t,e){switch(t){case Kk.RAW:return new Hk(zk(e));case Kk.BASE64:case Kk.BASE64URL:return new Hk(Yk(t,e));case Kk.DATA_URL:return new Hk(function(t){var e=new Xk(t);return e.base64?Yk(Kk.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw jk(Kk.DATA_URL,"Malformed data URL.")}return zk(e)}(e.rest)}(e),function(t){return new Xk(t).contentType}(e))}throw Fk()}function zk(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function Yk(e,t){switch(e){case Kk.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw jk(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Kk.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw jk(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw jk(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var Xk=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw jk(Kk.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)};var Jk,$k,Zk={STATE_CHANGED:"state_changed"},tD="running",eD="pausing",nD="paused",rD="success",iD="canceling",oD="canceled",aD="error",sD={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function uD(t){switch(t){case tD:case eD:case iD:return sD.RUNNING;case nD:return sD.PAUSED;case rD:return sD.SUCCESS;case oD:return sD.CANCELED;case aD:default:return sD.ERROR}}function cD(t){return null!=t}function hD(t){return void 0!==t}function lD(t){return"function"==typeof t}function fD(t){return"object"==typeof t}function pD(t){return"string"==typeof t||t instanceof String}function dD(t){return"number"==typeof t||t instanceof Number}function yD(t){return mD()&&t instanceof Blob}function mD(){return"undefined"!=typeof Blob}($k=Jk=Jk||{})[$k.NO_ERROR=0]="NO_ERROR",$k[$k.NETWORK_ERROR=1]="NETWORK_ERROR",$k[$k.ABORT=2]="ABORT";var gD=(vD.prototype.send=function(t,e,n,r){if(this.sent_)throw Wk("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),cD(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return cD(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},vD.prototype.getErrorCode=function(){if(!this.sent_)throw Wk("cannot .getErrorCode() before sending");return this.errorCode_},vD.prototype.getStatus=function(){if(!this.sent_)throw Wk("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},vD.prototype.getResponseText=function(){if(!this.sent_)throw Wk("cannot .getResponseText() before sending");return this.xhr_.responseText},vD.prototype.abort=function(){this.xhr_.abort()},vD.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},vD.prototype.addUploadProgressListener=function(t){cD(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},vD.prototype.removeUploadProgressListener=function(t){cD(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},vD);function vD(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Jk.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=Jk.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=Jk.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}var bD=(wD.prototype.createXhrIo=function(){return new gD},wD);function wD(){}function _D(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(mD())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var TD=(ED.prototype.size=function(){return this.size_},ED.prototype.type=function(){return this.type_},ED.prototype.slice=function(t,e){if(yD(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new ED(n)}return new ED(new Uint8Array(this.data_.buffer,t,e-t),!0)},ED.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(mD()){var n=t.map(function(t){return t instanceof ED?t.data_:t});return new ED(_D.apply(null,n))}var r=t.map(function(t){return pD(t)?Gk(Kk.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new ED(o,!0)},ED.prototype.uploadData=function(){return this.data_},ED);function ED(t,e){var n=0,r="";yD(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var SD=(Object.defineProperty(ID.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(ID.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),ID.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},ID.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},ID.makeFromBucketSpec=function(e){var t;try{t=ID.makeFromUrl(e)}catch(t){return new ID(e,"")}if(""===t.path)return t;throw function(t){return new Pk(Lk.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(e)},ID.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=Rk.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new ID(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new Pk(Lk.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},ID);function ID(t,e){this.bucket=t,this.path_=e}function CD(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return fD(t)&&!Array.isArray(t)}(e)?e:null}function ND(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function AD(t){return"https://"+Rk+"/v0"+t}function kD(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function DD(t,e){return e}var RD=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||DD},OD=null;function PD(){if(OD)return OD;var t=[];t.push(new RD("bucket")),t.push(new RD("generation")),t.push(new RD("metageneration")),t.push(new RD("name","fullPath",!0));var e=new RD("name");e.xform=function(t,e){return function(t){return!pD(t)||t.length<2?t:ND(t)}(e)},t.push(e);var n=new RD("size");return n.xform=function(t,e){return cD(e)?Number(e):e},t.push(n),t.push(new RD("timeCreated")),t.push(new RD("updated")),t.push(new RD("md5Hash",null,!0)),t.push(new RD("cacheControl",null,!0)),t.push(new RD("contentDisposition",null,!0)),t.push(new RD("contentEncoding",null,!0)),t.push(new RD("contentLanguage",null,!0)),t.push(new RD("contentType",null,!0)),t.push(new RD("metadata","customMetadata",!0)),OD=t}function MD(r,i){Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new SD(t,e);return i.makeStorageReference(n)}})}function LD(t,e,n){var r=CD(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return MD(r,t),r}(t,r,n)}function xD(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function FD(t){if(!fD(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!fD(n))throw"Expected object for 'customMetadata' mapping."}else if(fD(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var UD="maxResults",VD=1e3,qD="pageToken",BD="prefixes",jD="items";function WD(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new Pk(Lk.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Ok+"' property when initializing the app?");if(e[BD])for(var i=0,o=e[BD];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new SD(r,a));n.prefixes.push(s)}if(e[jD])for(var u=0,c=e[jD];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new SD(r,h.name));n.items.push(s)}return n}function KD(t){if(!fD(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===UD){if(!dD(n=t[UD])||!Number.isInteger(n)||t[UD]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[UD])throw"Expected maxResults to be less than or equal to "+VD+"."}else{if(e!==qD)throw"Unknown option: "+e;if(t[qD]&&!pD(t[qD]))throw"Expected pageToken to be string."}var n}var QD=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function HD(t){if(!t)throw Fk()}function GD(r,i){return function(t,e){var n=LD(r,e,i);return HD(null!==n),n}}function zD(r){return function(t,e){var n=function(t,e){var n=CD(e);return null===n?null:WD(t,n)}(r,e);return HD(null!==n),n}}function YD(r,i){return function(t,e){var n=LD(r,e,i);return HD(null!==n),function(r,t){var e=CD(t);if(null===e)return null;if(!pD(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return AD("/b/"+i(e)+"/o/"+i(n))+kD({alt:"media",token:t})})[0]}(n,e)}}function XD(r){return function(t,e){var n;return(n=401===t.getStatus()?new Pk(Lk.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?function(t){return new Pk(Lk.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(r.bucket):403===t.getStatus()?function(t){return new Pk(Lk.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(r.path):e).setServerResponseProp(e.serverResponseProp()),n}}function JD(r){var i=XD(r);return function(t,e){var n=i(t,e);return 404===t.getStatus()&&(n=function(t){return new Pk(Lk.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(r.path)),n.setServerResponseProp(e.serverResponseProp()),n}}function $D(t,e,n){var r=AD(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new QD(r,"GET",GD(t,n),i);return o.errorHandler=JD(e),o}function ZD(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}function tR(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};var s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=ZD(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+xD(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=TD.getBlob(c,r,h);if(null===l)throw Vk();var f={name:u.fullPath},p=AD(o),d=t.maxUploadRetryTime(),y=new QD(p,"POST",GD(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=XD(e),y}var eR=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function nR(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){HD(!1)}return HD(!!n&&-1!==(e||["active"]).indexOf(n)),n}function rR(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=ZD(e,r,i),s={name:a.fullPath},u=AD(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=xD(a,n),l=t.maxUploadRetryTime();var f=new QD(u,"POST",function(t){var e;nR(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){HD(!1)}return HD(pD(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=XD(e),f}function iR(t,e,n,i){var r=t.maxUploadRetryTime(),o=new QD(n,"POST",function(t){var e=nR(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){HD(!1)}n||HD(!1);var r=Number(n);return HD(!isNaN(r)),new eR(r,i.size(),"final"===e)},r);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=XD(e),o}function oR(t,a,e,s,n,u,r,i){var c=new eR(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new Pk(Lk.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw Vk();var y=a.maxUploadRetryTime(),m=new QD(e,"POST",function(t,e){var n,r=nR(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?GD(a,u)(t,e):null,new eR(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=XD(t),m}var aR=function(t,e,n){if(lD(t)||cD(e)||cD(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},sR=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function uR(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new Pk(Lk.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,e,n.length);for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?qk(o,e,t.message):qk(o,e,t)}}var cR=function(e,t){var n=this;this.validator=function(t){n.optional&&!hD(t)||e(t)},this.optional=!!t};function hR(t,e){function n(t){if(!pD(t))throw"Expected string."}var r;return r=t?function(e,n){return function(t){e(t),n(t)}}(n,t):n,new cR(r,e)}function lR(){return new cR(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||mD()&&t instanceof Blob))throw"Expected Blob or File."})}function fR(t){return new cR(FD,t)}function pR(){return new cR(function(t){if(!(dD(t)&&0<=t))throw"Expected a number 0 or greater."})}function dR(e,t){return new cR(function(t){if(!(null===t||cD(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function yR(t){return new cR(function(t){if(!(null===t||lD(t)))throw"Expected a Function."},t)}function mR(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,t)})}}var gR=(vR.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},vR.prototype.shouldDoResumable_=function(t){return 262144<t.size()},vR.prototype.start_=function(){this.state_===tD&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},vR.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case tD:e(t);break;case iD:n.transition_(oD);break;case eD:n.transition_(nD)}})},vR.prototype.createResumable_=function(){var r=this;this.resolveToken_(function(t){var e=rR(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.uploadUrl_=t,r.needToFetchStatus_=!1,r.completeTransitions_()},r.errorHandler_)})},vR.prototype.fetchStatus_=function(){var r=this,i=this.uploadUrl_;this.resolveToken_(function(t){var e=iR(r.authWrapper_,r.location_,i,r.blob_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){t=t,r.request_=null,r.updateProgress_(t.current),r.needToFetchStatus_=!1,t.finalized&&(r.needToFetchMetadata_=!0),r.completeTransitions_()},r.errorHandler_)})},vR.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new eR(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=oR(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(aD)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(rD)):r.completeTransitions_()},r.errorHandler_)})},vR.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},vR.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=$D(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(rD)},r.metadataErrorHandler_)})},vR.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=tR(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(rD)},r.errorHandler_)})},vR.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},vR.prototype.transition_=function(t){if(this.state_!==t)switch(t){case iD:case eD:this.state_=t,null!==this.request_&&this.request_.cancel();break;case tD:var e=this.state_===nD;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case nD:this.state_=t,this.notifyObservers_();break;case oD:this.error_=Uk(),this.state_=t,this.notifyObservers_();break;case aD:case rD:this.state_=t,this.notifyObservers_()}},vR.prototype.completeTransitions_=function(){switch(this.state_){case eD:this.transition_(nD);break;case iD:this.transition_(oD);break;case tD:this.start_()}},Object.defineProperty(vR.prototype,"snapshot",{get:function(){var t=uD(this.state_);return new sR(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),vR.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=yR(!0).validator,a=dR(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(hD(t.next)||hD(t.error)||hD(t.complete)))throw"";return}catch(t){throw r}}uR("on",[hR(function(){if(t!==Zk.STATE_CHANGED)throw"Expected one of the event types: ["+Zk.STATE_CHANGED+"]."}),dR(s,!0),yR(!0),yR(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&uR("on",i,arguments);var r=new aR(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[dR(function(t){if(null===t)throw r;s(t)}),yR(!0),yR(!0)];return hD(e)||hD(n)||hD(o)?c(null)(e,n,o):c(h)},vR.prototype.then=function(t,e){return this.promise_.then(t,e)},vR.prototype.catch=function(t){return this.then(null,t)},vR.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},vR.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},vR.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},vR.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(uD(this.state_)){case sD.SUCCESS:mR(this.resolve_.bind(null,this.snapshot))();break;case sD.CANCELED:case sD.ERROR:mR(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},vR.prototype.notifyObserver_=function(t){switch(uD(this.state_)){case sD.RUNNING:case sD.PAUSED:t.next&&mR(t.next.bind(t,this.snapshot))();break;case sD.SUCCESS:t.complete&&mR(t.complete.bind(t))();break;case sD.CANCELED:case sD.ERROR:t.error&&mR(t.error.bind(t,this.error_))();break;default:t.error&&mR(t.error.bind(t,this.error_))()}},vR.prototype.resume=function(){uR("resume",[],arguments);var t=this.state_===nD||this.state_===eD;return t&&this.transition_(tD),t},vR.prototype.pause=function(){uR("pause",[],arguments);var t=this.state_===tD;return t&&this.transition_(eD),t},vR.prototype.cancel=function(){uR("cancel",[],arguments);var t=this.state_===tD||this.state_===eD;return t&&this.transition_(iD),t},vR);function vR(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=tD,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(Lk.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(aD))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(Lk.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(aD))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var bR=(wR.prototype.toString=function(){return uR("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},wR.prototype.newRef=function(t,e){return new wR(t,e)},wR.prototype.mappings=function(){return PD()},wR.prototype.child=function(t){uR("child",[hR()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new SD(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(wR.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new SD(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(wR.prototype,"root",{get:function(){var t=new SD(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(wR.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(wR.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(wR.prototype,"name",{get:function(){return ND(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(wR.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),wR.prototype.put=function(t,e){return void 0===e&&(e=null),uR("put",[lR(),fR(!0)],arguments),this.throwIfRoot_("put"),new gR(this,this.authWrapper,this.location,this.mappings(),new TD(t),e)},wR.prototype.putString=function(t,e,n){void 0===e&&(e=Kk.RAW),uR("putString",[hR(),hR(Qk,!0),fR(!0)],arguments),this.throwIfRoot_("putString");var r=Gk(e,t),i=Object.assign({},n);return!cD(i.contentType)&&cD(r.contentType)&&(i.contentType=r.contentType),new gR(this,this.authWrapper,this.location,this.mappings(),new TD(r.data,!0),i)},wR.prototype.delete=function(){var n=this;return uR("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e){var n=AD(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new QD(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=JD(e),i}(n.authWrapper,n.location);return n.authWrapper.makeRequest(e,t).getPromise()})},wR.prototype.listAll=function(){uR("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},wR.prototype.listAllHelper=function(o,a){return ua(this,void 0,void 0,function(){var e,n,r,i;return ca(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,n.prefixes),(i=o.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},wR.prototype.list=function(r){uR("list",[function(t){return new cR(KD,t)}(!0)],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=AD(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new QD(a,"GET",zD(t),s);return u.urlParams=o,u.errorHandler=XD(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},wR.prototype.getMetadata=function(){var n=this;return uR("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=$D(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},wR.prototype.updateMetadata=function(n){var r=this;return uR("updateMetadata",[fR()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n,r){var i=AD(e.fullServerUrl()),o=xD(n,r),a=t.maxOperationRetryTime(),s=new QD(i,"PATCH",GD(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=JD(e),s}(r.authWrapper,r.location,n,r.mappings());return r.authWrapper.makeRequest(e,t).getPromise()})},wR.prototype.getDownloadURL=function(){var n=this;return uR("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n){var r=AD(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new QD(r,"GET",YD(t,n),i);return o.errorHandler=JD(e),o}(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise().then(function(t){if(null===t)throw new Pk(Lk.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},wR.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new Pk(Lk.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},wR);function wR(t,e){this.authWrapper=t,this.location=e instanceof SD?e:SD.makeFromUrl(e)}var _R=(TR.prototype.getPromise=function(){return this.promise_},TR.prototype.cancel=function(t){},TR);function TR(t){this.promise_=Promise.reject(t)}var ER=(SR.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},SR.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},SR);function SR(){this.map=new Map,this.id=-9007199254740991}var IR=(CR.extractBucket_=function(t){var e=t[Ok]||null;return null==e?null:SD.makeFromBucketSpec(e).bucket},CR.prototype.getAuthToken=function(){return null!==this.app_&&cD(this.app_.INTERNAL)&&cD(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},CR.prototype.bucket=function(){if(this.deleted_)throw Bk();return this.bucket_},CR.prototype.service=function(){return this.service_},CR.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},CR.prototype.makeRequest=function(t,e){if(this.deleted_)return new _R(Bk());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},CR.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},CR.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},CR.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},CR.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},CR.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},CR);function CR(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;cD(o)&&(this.bucket_=CR.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requestMap_=new ER}var NR=(AR.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());hD(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=Fk()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?Bk():Uk()):i(n=new Pk(Lk.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new kR(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,pa([null,t],e)):s()||o?c.call.apply(c,pa([null,t],e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new kR(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===Jk.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new kR(r,t))}else{var i=t.getErrorCode()===Jk.ABORT;o(!1,new kR(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},AR.prototype.getPromise=function(){return this.promise_},AR.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},AR.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},AR);function AR(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var kR=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function DR(t,e,n){var r=kD(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==fl?fl.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new NR(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var RR=(OR.prototype.ref=function(t){if(uR("ref",[hR(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new bR(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},OR.prototype.refFromURL=function(t){return uR("refFromURL",[hR(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{SD.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new bR(this.authWrapper_,t)},Object.defineProperty(OR.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),OR.prototype.setMaxUploadRetryTime=function(t){uR("setMaxUploadRetryTime",[pR()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},OR.prototype.setMaxOperationRetryTime=function(t){uR("setMaxOperationRetryTime",[pR()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(OR.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(OR.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),OR);function OR(t,e,n){if(this.bucket_=null,this.authWrapper_=new IR(t,function(t,e){return new bR(t,e)},DR,this,e),this.app_=t,null!=n)this.bucket_=SD.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new SD(r,""))}this.internals_=new PR(this)}var PR=(MR.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},MR);function MR(t){this.service_=t}var LR;function xR(t,e,n){return new RR(t,new bD,n)}LR={TaskState:sD,TaskEvent:Zk,StringFormat:Kk,Storage:RR,Reference:bR},fl.INTERNAL.registerService("storage",xR,LR,void 0,!0);var FR,UR,VR,qR,BR="0.2.26",jR="FB-PERF-TRACE-MEASURE",WR="@firebase/performance/config",KR="@firebase/performance/configexpire",QR="Performance",HR=((FR={})["trace started"]="Trace {$traceName} was started before.",FR["trace stopped"]="Trace {$traceName} is not running.",FR["no window"]="Window is not available.",FR["no app id"]="App id is not available.",FR["no project id"]="Project id is not available.",FR["no api key"]="Api key is not available.",FR["invalid cc log"]="Attempted to queue invalid cc event",FR["FB not default"]="Performance can only start when Firebase app instance is the default one.",FR["RC response not ok"]="RC response is not ok",FR["invalid attribute name"]="Attribute name {$attributeName} is invalid.",FR["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",FR["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",FR),GR=new Ra("performance",QR,HR),zR=(YR.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},YR.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},YR.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},YR.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},YR.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},YR.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},YR.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},YR.prototype.setupObserver=function(t,i){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var e=0,n=t.getEntries();e<n.length;e++){var r=n[e];i(r)}}).observe({entryTypes:[t]})},YR.getInstance=function(){return void 0===UR&&(UR=new YR(VR)),UR},YR);function YR(t){if(!t)throw GR.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var XR,JR,$R,ZR=(tO.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw GR.create("no app id");return t},tO.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw GR.create("no project id");return t},tO.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw GR.create("no api key");return t},tO.getInstance=function(){return void 0===qR&&(qR=new tO),qR},tO);function tO(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function eO(){return XR}($R=JR=JR||{})[$R.UNKNOWN=0]="UNKNOWN",$R[$R.VISIBLE=1]="VISIBLE",$R[$R.HIDDEN=2]="HIDDEN";var nO=["firebase_","google_","ga_"],rO=new RegExp("^[a-zA-Z]\\w*$");function iO(){switch(zR.getInstance().document.visibilityState){case"visible":return JR.VISIBLE;case"hidden":return JR.HIDDEN;default:return JR.UNKNOWN}}var oO=new is(QR);oO.logLevel=$a.INFO;var aO="0.0.1",sO={loggingEnabled:!0},uO="FIREBASE_INSTALLATIONS_AUTH";function cO(t){var e=function(){var t=zR.getInstance().localStorage,e=t.getItem(KR);if(!e||!function(t){return Number(t)>Date.now()}(e))return;var n=t.getItem(WR);if(!n)return;try{return JSON.parse(n)}catch(t){return}}();return e?(lO(e),Promise.resolve()):function(r){return function(){var t=ZR.getInstance().firebaseAppInstance.installations().getToken();return t.then(function(t){}),t}().then(function(t){var e="https://firebaseremoteconfig.googleapis.com/v1/projects/"+ZR.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+ZR.getInstance().getApiKey(),n=new Request(e,{method:"POST",headers:{Authorization:uO+" "+t},body:JSON.stringify({app_instance_id:r,app_instance_id_token:t,app_id:ZR.getInstance().getAppId(),app_version:BR,sdk_version:aO})});return fetch(n).then(function(t){if(t.ok)return t.json();throw GR.create("RC response not ok")})}).catch(function(){oO.info(hO)})}(t).then(function(t){return lO(t)}).then(function(t){return function(t){if(!t)return;var e=zR.getInstance().localStorage;e.setItem(WR,JSON.stringify(t)),e.setItem(KR,String(Date.now()+60*ZR.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var hO="Could not fetch config, will use default configs";function lO(t){if(!t)return t;var e=ZR.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=sO.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=fO(e.tracesSamplingRate),e.logNetworkAfterSampling=fO(e.networkRequestsSamplingRate),t}function fO(t){return Math.random()<=t}var pO,dO=1;function yO(){return dO=2,pO=pO||function(){var n=zR.getInstance().document;return new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})}().then(function(){return function(){var t=ZR.getInstance().firebaseAppInstance.installations().getId();return t.then(function(t){XR=t}),t}()}).then(function(t){return cO(t)}).then(function(){return mO()},function(){return mO()})}function mO(){dO=3}var gO,vO=1e4,bO=3,wO=bO,_O=[];function TO(i){return function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];!function(t){if(!t.eventTime||!t.message)throw GR.create("invalid cc log");_O=pa(_O,[t])}({message:i.apply(void 0,n),eventTime:Date.now()})}}function EO(){if(gO)return gO;var t=TO(CO);return(gO=new is("@firebase/performance/cc")).logHandler=t,gO}function SO(t){var e=ZR.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&zR.getInstance().requiredApisAvailable()&&(t.isAuto&&iO()!==JR.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===dO?IO(t):yO().then(function(){return IO(t)},function(){return IO(t)})))}function IO(t){eO()&&setTimeout(function(){return EO().log(t,1)},0)}function CO(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:NO(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=AO(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=AO(n));var r={application_info:NO(),trace_metric:e};return JSON.stringify(r)}(t)}function NO(){return{google_app_id:ZR.getInstance().getAppId(),app_instance_id:eO(),web_app_info:{sdk_version:BR,page_url:zR.getInstance().getUrl(),service_worker_status:function(){var t=zR.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:iO(),effective_connection_type:function(){var t=zR.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function AO(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==wO){if(!_O.length)return r(vO);var t=pa(_O);_O=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:ZR.getInstance().logSource,log_event:e};fetch(ZR.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||oO.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?vO:Math.max(vO,e);wO=bO,r(n)}).catch(function(){_O=pa(t,_O),wO--,oO.info("Tries left: "+wO+"."),r(vO)})}},t)}(5500);var kO=["_fp","_fcp","_fid"];var DO=(RO.prototype.start=function(){if(1!==this.state)throw GR.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},RO.prototype.stop=function(){if(2!==this.state)throw GR.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),SO(this)},RO.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=sa({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}SO(this)},RO.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},RO.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||100<t.length)&&(e&&e.startsWith("_wt_")&&-1<kO.indexOf(t)||!t.startsWith("_"))}(t,this.name))throw GR.create("invalide custom metric name",{customMetricName:t});this.counters[t]=e},RO.prototype.getMetric=function(t){return this.counters[t]||0},RO.prototype.putAttribute=function(t,e){var n=function(e){return!(0===e.length||40<e.length||nO.some(function(t){return e.startsWith(t)})||!e.match(rO))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw GR.create("invalid attribute name",{attributeName:t});if(!r)throw GR.create("invalid attribute value",{attributeValue:e})}},RO.prototype.getAttribute=function(t){return this.customAttributes[t]},RO.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},RO.prototype.getAttributes=function(){return sa({},this.customAttributes)},RO.prototype.setStartTime=function(t){this.startTimeUs=t},RO.prototype.setDuration=function(t){this.durationUs=t},RO.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},RO.createOobTrace=function(t,e,n){var r=zR.getInstance().getUrl();if(r){var i=new RO("_wt_"+r,!0),o=Math.floor(1e3*zR.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}SO(i)}},RO.createUserTimingTrace=function(t){SO(new RO(t,!1,t))},RO);function RO(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=zR.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||jR+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function OO(t){var e=t;if(e&&void 0!==e.responseStart){var n=zR.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=ZR.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return EO().log(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var PO=5e3;function MO(){eO()&&(setTimeout(function(){return function(){var t=zR.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){DO.createOobTrace(e,n),r=void 0},PO);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),DO.createOobTrace(e,n,t))})}else DO.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=zR.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){OO(r[n])}t.setupObserver("resource",OO)}()},0),setTimeout(function(){return function(){for(var t=zR.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){LO(r[n])}t.setupObserver("measure",LO)}()},0))}function LO(t){var e=t.name;e.substring(0,jR.length)!==jR&&DO.createUserTimingTrace(e)}var xO=(FO.prototype.trace=function(t){return new DO(t)},Object.defineProperty(FO.prototype,"instrumentationEnabled",{get:function(){return ZR.getInstance().instrumentationEnabled},set:function(t){ZR.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(FO.prototype,"dataCollectionEnabled",{get:function(){return ZR.getInstance().dataCollectionEnabled},set:function(t){ZR.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),FO);function FO(t){this.app=t,zR.getInstance().requiredApisAvailable()?yO().then(MO,MO):oO.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}fl.INTERNAL.registerService("performance",function(t){if("[DEFAULT]"!==t.name)throw GR.create("FB not default");if("undefined"==typeof window)throw GR.create("no window");return function(t){VR=t}(window),ZR.getInstance().firebaseAppInstance=t,new xO(t)},{});var UO,VO,qO,BO,jO,WO="measurementId",KO="firebase_id",QO="origin",HO="https://www.googletagmanager.com/gtag/js";function GO(t,n,e){var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];window[n].push(arguments)};return window[e]&&"function"==typeof window[e]&&(r=window[e]),window[e]=function(f,p){return function(t,e,n){if(t===UO.EVENT){var r=[];if(n&&n.send_to){var i=n.send_to;Array.isArray(i)||(i=[i]);for(var o=0,a=i;o<a.length;o++){var s=a[o],u=p[s];if(!u){r=[];break}r.push(u)}}if(0===r.length)for(var c=0,h=Object.values(p);c<h.length;c++){var l=h[c];r.push(l)}Promise.all(r).then(function(){return f(UO.EVENT,e,n||{})}).catch(function(t){return console.error(t)})}else if(t===UO.CONFIG){(p[e]||Promise.resolve()).then(function(){f(UO.CONFIG,e,n)}).catch(function(t){return console.error(t)})}else f(UO.SET,e)}}(r,t),{gtagCore:r,wrappedGtag:window[e]}}(VO=UO=UO||{}).EVENT="event",VO.SET="set",VO.CONFIG="config",(BO=qO=qO||{}).ADD_PAYMENT_INFO="add_payment_info",BO.ADD_TO_CART="add_to_cart",BO.ADD_TO_WISHLIST="add_to_wishlist",BO.BEGIN_CHECKOUT="begin_checkout",BO.CHECKOUT_PROGRESS="checkout_progress",BO.EXCEPTION="exception",BO.GENERATE_LEAD="generate_lead",BO.LOGIN="login",BO.PAGE_VIEW="page_view",BO.PURCHASE="purchase",BO.REFUND="refund",BO.REMOVE_FROM_CART="remove_from_cart",BO.SCREEN_VIEW="screen_view",BO.SEARCH="search",BO.SELECT_CONTENT="select_content",BO.SET_CHECKOUT_OPTION="set_checkout_option",BO.SHARE="share",BO.SIGN_UP="sign_up",BO.TIMING_COMPLETE="timing_complete",BO.VIEW_ITEM="view_item",BO.VIEW_ITEM_LIST="view_item_list",BO.VIEW_PROMOTION="view_promotion",BO.VIEW_SEARCH_RESULTS="view_search_results";var zO,YO,XO=((jO={})["no-ga-id"]='"'+WO+'" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',jO["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",jO["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",jO),JO=new Ra("analytics","Analytics",XO),$O={},ZO="dataLayer",tP="gtag",eP=!1;function nP(t){if(eP)throw JO.create("already-initialized");t.dataLayerName&&(ZO=t.dataLayerName),t.gtagName&&(tP=t.gtagName)}function rP(t,e){var r=t.options[WO];if(!r)throw JO.create("no-ga-id");if(null!=$O[r])throw JO.create("already-exists",{id:r});if(!eP){!function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(HO))return r}return null}()&&function(t){var e=document.createElement("script");e.src=HO+"?l="+t,e.async=!0,document.head.appendChild(e)}(ZO),function(t){var e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(ZO);var n=GO($O,ZO,tP),i=n.wrappedGtag,o=n.gtagCore;YO=i,zO=o,eP=!0}$O[r]=function(r,i){return ua(this,void 0,void 0,function(){var e,n;return ca(this,function(t){switch(t.label){case 0:return[4,r.installations().getId()];case 1:return e=t.sent(),i("js",new Date),i(UO.CONFIG,r.options[WO],((n={})[KO]=e,n[QO]="firebase",n.update=!0,n)),[2]}})})}(t,zO);var a={app:t,logEvent:function(t,e,n){return function(t,e,n,r,i){var o=r||{};i&&i.global||(o=sa(sa({},r),{send_to:e})),t(UO.EVENT,n,o||{})}(YO,r,t,e,n)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(UO.SET,{screen_name:n}):t(UO.CONFIG,e,{update:!0,screen_name:n})}(YO,r,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(UO.SET,{user_id:n}):t(UO.CONFIG,e,{update:!0,user_id:n})}(YO,r,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}t(UO.SET,i)}else t(UO.CONFIG,e,{update:!0,user_properties:n})}(YO,r,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(r,t)}};return e({INTERNAL:{analytics:{logEvent:a.logEvent}}}),a}fl.INTERNAL.registerService("analytics",rP,{settings:nP,EventName:qO},void 0,!1);var iP,oP=(aP.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},aP.prototype.fetch=function(a){return ua(this,void 0,void 0,function(){var e,n,r,i,o;return ca(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=t.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(a.cacheMaxAgeMillis,n)?[2,r]:(a.eTag=r&&r.eTag,[4,this.client.fetch(a)]);case 2:return i=t.sent(),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===i.status&&o.push(this.storage.setLastSuccessfulFetchResponse(i)),[4,Promise.all(o)];case 3:return t.sent(),[2,i]}})})},aP);function aP(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}var sP=((iP={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",iP["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",iP["registration-api-key"]="Undefined API key. Check Firebase app initialization.",iP["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",iP["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",iP["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",iP["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",iP["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",iP["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",iP["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',iP["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',iP["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",iP["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",iP),uP=new Ra("remoteconfig","Remote Config",sP);var cP=(hP.prototype.fetch=function(w){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p,d,y,m,g,v,b;return ca(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=t.sent(),n=e[0],r=e[1],i=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",o=i+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,a={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":w.eTag||"*"},s={sdk_version:this.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:this.appId,language_code:function(t){return void 0===t&&(t=navigator),t.languages&&t.languages[0]||t.language}()},u={method:"POST",headers:a,body:JSON.stringify(s)},c=fetch(o,u),h=new Promise(function(t,e){w.signal.addEventListener(function(){var t=new Error("The operation was aborted.");t.name="AbortError",e(t)})}),t.label=2;case 2:return t.trys.push([2,5,,6]),[4,Promise.race([c,h])];case 3:return t.sent(),[4,c];case 4:return l=t.sent(),[3,6];case 5:throw f=t.sent(),p="fetch-client-network","AbortError"===f.name&&(p="fetch-timeout"),uP.create(p,{originalErrorMessage:f.message});case 6:if(d=l.status,y=l.headers.get("ETag")||void 0,200!==l.status)return[3,11];v=void 0,t.label=7;case 7:return t.trys.push([7,9,,10]),[4,l.json()];case 8:return v=t.sent(),[3,10];case 9:throw b=t.sent(),uP.create("fetch-client-parse",{originalErrorMessage:b.message});case 10:m=v.entries,g=v.state,t.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===g?d=500:"NO_CHANGE"===g?d=304:"NO_TEMPLATE"!==g&&"EMPTY_CONFIG"!==g||(m={}),304!==d&&200!==d)throw uP.create("fetch-status",{httpStatus:d});return[2,{status:d,eTag:y,config:m}]}})})},hP);function hP(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}var lP=(fP.prototype.addEventListener=function(t){this.listeners.push(t)},fP.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},fP);function fP(){this.listeners=[]}var pP=["1","true","t","yes","y","on"],dP=(yP.prototype.asString=function(){return this._value},yP.prototype.asBoolean=function(){return"static"!==this._source&&0<=pP.indexOf(this._value.toLowerCase())},yP.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},yP.prototype.getSource=function(){return this._source},yP);function yP(t,e){void 0===e&&(e=""),this._source=t,this._value=e}var mP=(gP.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=$a.DEBUG;break;case"silent":this._logger.logLevel=$a.SILENT;break;default:this._logger.logLevel=$a.ERROR}},Object.defineProperty(gP.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!0,configurable:!0}),Object.defineProperty(gP.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!0,configurable:!0}),gP.prototype.activate=function(){return ua(this,void 0,void 0,function(){var e,n,r;return ca(this,function(t){switch(t.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return e=t.sent(),n=e[0],r=e[1],n&&n.config&&n.eTag&&n.eTag!==r?[4,Promise.all([this._storageCache.setActiveConfig(n.config),this._storage.setActiveConfigEtag(n.eTag)])]:[2,!1];case 2:return t.sent(),[2,!0]}})})},gP.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0})),this._initializePromise},gP.prototype.fetch=function(){return ua(this,void 0,void 0,function(){var e=this;return ca(this,function(t){return[2,new Promise(function(o,a){return ua(e,void 0,void 0,function(){var e,n,r,i=this;return ca(this,function(t){switch(t.label){case 0:e=new lP,setTimeout(function(){return ua(i,void 0,void 0,function(){return ca(this,function(t){return e.abort(),[2]})})},this.settings.fetchTimeoutMillis),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:e})];case 2:return t.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return t.sent(),o(),[3,6];case 4:return n=t.sent(),r=function(t,e){return t instanceof ka&&-1!==t.code.indexOf(e)}(n,"fetch-throttle")?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(r)];case 5:return t.sent(),a(n),[3,6];case 6:return[2]}})})})]})})},gP.prototype.fetchAndActivate=function(){return ua(this,void 0,void 0,function(){return ca(this,function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}})})},gP.prototype.getAll=function(){var n=this;return function(t,e){return void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(sa(sa({},t),e))}(this._storageCache.getActiveConfig(),this.defaultConfig).reduce(function(t,e){return t[e]=n.getValue(e),t},{})},gP.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},gP.prototype.getNumber=function(t){return this.getValue(t).asNumber()},gP.prototype.getString=function(t){return this.getValue(t).asString()},gP.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new dP("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new dP("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new dP("static"))},gP);function gP(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}function vP(t,e){var n=t.target.error||void 0;return uP.create(e,{originalErrorMessage:n&&n.message})}var bP="app_namespace_store",wP="firebase_remote_config",_P=1;var TP=(EP.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},EP.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},EP.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},EP.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},EP.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},EP.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},EP.prototype.getActiveConfig=function(){return this.get("active_config")},EP.prototype.setActiveConfig=function(t){return this.set("active_config",t)},EP.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},EP.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},EP.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},EP.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},EP.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},EP.prototype.get=function(s){return ua(this,void 0,void 0,function(){var o,a=this;return ca(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(n,e){var t=o.transaction([bP],"readonly").objectStore(bP),r=a.createCompositeKey(s);try{var i=t.get(r);i.onerror=function(t){e(vP(t,"storage-get"))},i.onsuccess=function(t){var e=t.target.result;n(e?e.value:void 0)}}catch(t){e(uP.create("storage-get",{originalErrorMessage:t&&t.message}))}})]}})})},EP.prototype.set=function(s,u){return ua(this,void 0,void 0,function(){var o,a=this;return ca(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(t,e){var n=o.transaction([bP],"readwrite").objectStore(bP),r=a.createCompositeKey(s);try{var i=n.put({compositeKey:r,value:u});i.onerror=function(t){e(vP(t,"storage-set"))},i.onsuccess=function(){t()}}catch(t){e(uP.create("storage-set",{originalErrorMessage:t&&t.message}))}})]}})})},EP.prototype.delete=function(s){return ua(this,void 0,void 0,function(){var o,a=this;return ca(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(t,e){var n=o.transaction([bP],"readwrite").objectStore(bP),r=a.createCompositeKey(s);try{var i=n.delete(r);i.onerror=function(t){e(vP(t,"storage-delete"))},i.onsuccess=function(){t()}}catch(t){e(uP.create("storage-delete",{originalErrorMessage:t&&t.message}))}})]}})})},EP.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},EP);function EP(t,e,n,r){void 0===r&&(r=new Promise(function(e,n){var t=indexedDB.open(wP,_P);t.onerror=function(t){n(vP(t,"storage-open"))},t.onsuccess=function(t){e(t.target.result)},t.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore(bP,{keyPath:"compositeKey"})}}})),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}var SP=(IP.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},IP.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},IP.prototype.getActiveConfig=function(){return this.activeConfig},IP.prototype.loadFromStorage=function(){return ua(this,void 0,void 0,function(){var e,n,r,i,o,a;return ca(this,function(t){switch(t.label){case 0:return e=this.storage.getLastFetchStatus(),n=this.storage.getLastSuccessfulFetchTimestampMillis(),r=this.storage.getActiveConfig(),[4,e];case 1:return(i=t.sent())&&(this.lastFetchStatus=i),[4,n];case 2:return(o=t.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,r];case 3:return(a=t.sent())&&(this.activeConfig=a),[2]}})})},IP.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},IP.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},IP.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},IP);function IP(t){this.storage=t}var CP=(NP.prototype.fetch=function(n){return ua(this,void 0,void 0,function(){var e;return ca(this,function(t){switch(t.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=t.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(n,e)]}})})},NP.prototype.attemptFetch=function(i,t){var o=t.throttleEndTimeMillis,a=t.backoffCount;return ua(this,void 0,void 0,function(){var e,n,r;return ca(this,function(t){switch(t.label){case 0:return[4,function(i,o){return new Promise(function(t,e){var n=Math.max(o-Date.now(),0),r=setTimeout(t,n);i.addEventListener(function(){clearTimeout(r),e(uP.create("fetch-throttle",{throttleEndTimeMillis:o}))})})}(i.signal,o)];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this.client.fetch(i)];case 3:return e=t.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return t.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof ka))return!1;var e=Number(t.httpStatus);return 429===e||500===e||503===e||504===e}(n=t.sent()))throw n;return r={throttleEndTimeMillis:Date.now()+function(t){var e=1e3*Math.pow(2,t),n=Math.round(.5*e*(Math.random()-.5)*2);return Math.min(144e5,e+n)}(a),backoffCount:a+1},[4,this.storage.setThrottleMetadata(r)];case 6:return t.sent(),[2,this.attemptFetch(i,r)];case 7:return[2]}})})},NP);function NP(t,e){this.client=t,this.storage=e}var AP;return(AP=fl).INTERNAL.registerService("remoteConfig",function(t,e,n){if("undefined"==typeof window)throw uP.create("registration-window");var r=t.options,i=r.projectId,o=r.apiKey,a=r.appId;if(!i)throw uP.create("registration-project-id");if(!o)throw uP.create("registration-api-key");if(!a)throw uP.create("registration-app-id");n=n||"firebase";var s=new TP(a,t.name,n),u=new SP(s),c=new is("@firebase/remote-config");c.logLevel=$a.ERROR;var h=new cP(t.installations(),AP.SDK_VERSION,n,i,o,a),l=new CP(h,s),f=new oP(l,s,u,c),p=new mP(t,f,u,s,c);return p.ensureInitialized(),p},void 0,void 0,!0),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),fl});
//# sourceMappingURL=firebase.js.map
